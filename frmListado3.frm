VERSION 5.00
Object = "{F9043C88-F6F2-101A-A3C9-08002B2F49FB}#1.2#0"; "COMDLG32.OCX"
Object = "{831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.2#0"; "MSCOMCTL.OCX"
Begin VB.Form frmListado3 
   BorderStyle     =   1  'Fixed Single
   Caption         =   "Form1"
   ClientHeight    =   8205
   ClientLeft      =   45
   ClientTop       =   435
   ClientWidth     =   11910
   LinkTopic       =   "Form1"
   MaxButton       =   0   'False
   MinButton       =   0   'False
   ScaleHeight     =   8205
   ScaleWidth      =   11910
   StartUpPosition =   2  'CenterScreen
   Visible         =   0   'False
   Begin VB.Frame FrameCambioFamiliaArticulo 
      Height          =   5895
      Left            =   1080
      TabIndex        =   931
      Top             =   480
      Visible         =   0   'False
      Width           =   6495
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   27
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   1017
         Text            =   "Text5"
         Top             =   3960
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   27
         Left            =   1560
         TabIndex        =   936
         Top             =   3960
         Width           =   1095
      End
      Begin VB.TextBox txtDescmarca 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   3
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   948
         Text            =   "Text5"
         Top             =   3480
         Width           =   3495
      End
      Begin VB.TextBox txtmarca 
         Height          =   285
         Index           =   3
         Left            =   1560
         TabIndex        =   935
         Text            =   "Text1"
         Top             =   3480
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   24
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   946
         Text            =   "Text5"
         Top             =   3000
         Width           =   3495
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   24
         Left            =   1560
         TabIndex        =   934
         Text            =   "Text1"
         Top             =   3000
         Width           =   1095
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   26
         Left            =   1560
         TabIndex        =   932
         Top             =   1320
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   26
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   942
         Text            =   "Text5"
         Top             =   1320
         Width           =   3495
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   23
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   939
         Text            =   "Text5"
         Top             =   1800
         Width           =   3495
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   23
         Left            =   1560
         TabIndex        =   933
         Text            =   "Text1"
         Top             =   1800
         Width           =   1095
      End
      Begin VB.CommandButton cmdActFamiliaMarca 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3840
         TabIndex        =   937
         Top             =   5280
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   49
         Left            =   5160
         TabIndex        =   938
         Top             =   5280
         Width           =   1095
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   27
         Left            =   1320
         Picture         =   "frmListado3.frx":0000
         Top             =   3960
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   184
         Left            =   360
         TabIndex        =   1018
         Top             =   3960
         Width           =   750
      End
      Begin VB.Image imgMarca 
         Height          =   240
         Index           =   3
         Left            =   1320
         Picture         =   "frmListado3.frx":0102
         Top             =   3480
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Marca"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   170
         Left            =   360
         TabIndex        =   949
         Top             =   3480
         Width           =   435
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   169
         Left            =   360
         TabIndex        =   947
         Top             =   3000
         Width           =   480
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   24
         Left            =   1320
         Picture         =   "frmListado3.frx":0204
         Top             =   3000
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   168
         Left            =   360
         TabIndex        =   945
         Top             =   1800
         Width           =   480
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   167
         Left            =   360
         TabIndex        =   944
         Top             =   1320
         Width           =   750
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   26
         Left            =   1320
         Picture         =   "frmListado3.frx":0306
         Top             =   1320
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Origen"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   166
         Left            =   120
         TabIndex        =   943
         Top             =   960
         Width           =   555
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Cambio familia/marca/prove. en artículos"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   45
         Left            =   120
         TabIndex        =   941
         Top             =   360
         Width           =   6165
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   23
         Left            =   1320
         Picture         =   "frmListado3.frx":0408
         Top             =   1800
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Destino"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   165
         Left            =   120
         TabIndex        =   940
         Top             =   2640
         Width           =   645
      End
   End
   Begin VB.Frame FrameListadoManipulador 
      Height          =   3495
      Left            =   960
      TabIndex        =   1149
      Top             =   0
      Visible         =   0   'False
      Width           =   6375
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   27
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   1161
         Text            =   "Text1"
         Top             =   1560
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   27
         Left            =   1440
         TabIndex        =   1151
         Text            =   "Text1"
         Top             =   1560
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   26
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   1158
         Text            =   "Text1"
         Top             =   1200
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   26
         Left            =   1440
         TabIndex        =   1150
         Text            =   "Text1"
         Top             =   1200
         Width           =   1095
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Imprimir autorizados"
         Height          =   255
         Index           =   37
         Left            =   240
         TabIndex        =   1154
         Top             =   2520
         Value           =   1  'Checked
         Width           =   2295
      End
      Begin VB.CommandButton cmdListadoCarnetMani 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3720
         TabIndex        =   1155
         Top             =   2880
         Width           =   1095
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Clientes sin carnet"
         Height          =   255
         Index           =   36
         Left            =   3480
         TabIndex        =   1153
         Top             =   2160
         Value           =   1  'Checked
         Width           =   2295
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Clientes con carnet"
         Height          =   255
         Index           =   35
         Left            =   1320
         TabIndex        =   1152
         Top             =   2160
         Value           =   1  'Checked
         Width           =   2295
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   64
         Left            =   5040
         TabIndex        =   1156
         Top             =   2880
         Width           =   1095
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Carnet"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   79
         Left            =   240
         TabIndex        =   1164
         Top             =   2160
         Width           =   570
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   97
         Left            =   240
         TabIndex        =   1163
         Top             =   3000
         Width           =   3465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   210
         Left            =   480
         TabIndex        =   1162
         Top             =   1560
         Width           =   420
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   27
         Left            =   1200
         Picture         =   "frmListado3.frx":050A
         Top             =   1560
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   209
         Left            =   480
         TabIndex        =   1160
         Top             =   1200
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   78
         Left            =   240
         TabIndex        =   1159
         Top             =   960
         Width           =   585
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   26
         Left            =   1200
         Picture         =   "frmListado3.frx":060C
         Top             =   1200
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Listado carnets manipulador fitosanitarios"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   57
         Left            =   240
         TabIndex        =   1157
         Top             =   360
         Width           =   5775
      End
   End
   Begin VB.Frame FramepedidoSolicitante 
      Height          =   3975
      Left            =   5040
      TabIndex        =   1128
      Top             =   720
      Visible         =   0   'False
      Width           =   6495
      Begin VB.CommandButton cmd 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3600
         TabIndex        =   1134
         Top             =   3240
         Width           =   1095
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Detalla cliente"
         Height          =   255
         Index           =   31
         Left            =   240
         TabIndex        =   1133
         Top             =   2880
         Width           =   2295
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   15
         Left            =   1560
         TabIndex        =   1132
         Text            =   "186"
         Top             =   2280
         Width           =   735
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   15
         Left            =   2400
         Locked          =   -1  'True
         TabIndex        =   1143
         Text            =   "Text1"
         Top             =   2280
         Width           =   3855
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   14
         Left            =   1560
         TabIndex        =   1131
         Text            =   "186"
         Top             =   1920
         Width           =   735
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   14
         Left            =   2400
         Locked          =   -1  'True
         TabIndex        =   1140
         Text            =   "Text1"
         Top             =   1920
         Width           =   3855
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   65
         Left            =   3720
         TabIndex        =   1130
         Text            =   "Text1"
         Top             =   1200
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   64
         Left            =   1560
         TabIndex        =   1129
         Text            =   "Text1"
         Top             =   1200
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   63
         Left            =   4920
         TabIndex        =   1135
         Top             =   3240
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   96
         Left            =   240
         TabIndex        =   1145
         Top             =   3360
         Width           =   3465
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   15
         Left            =   1200
         Picture         =   "frmListado3.frx":070E
         Top             =   2280
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   207
         Left            =   600
         TabIndex        =   1144
         Top             =   2280
         Width           =   420
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Agente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   77
         Left            =   120
         TabIndex        =   1142
         Top             =   1680
         Width           =   615
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   14
         Left            =   1200
         Picture         =   "frmListado3.frx":0810
         Top             =   1920
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   206
         Left            =   600
         TabIndex        =   1141
         Top             =   1920
         Width           =   450
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   205
         Left            =   3000
         TabIndex        =   1139
         Top             =   1200
         Width           =   420
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   65
         Left            =   3480
         Picture         =   "frmListado3.frx":0912
         Top             =   1200
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   204
         Left            =   600
         TabIndex        =   1138
         Top             =   1200
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   64
         Left            =   1080
         Picture         =   "frmListado3.frx":099D
         Top             =   1200
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   76
         Left            =   120
         TabIndex        =   1137
         Top             =   840
         Width           =   540
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Estadística de pedido x tipo solicitado"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   56
         Left            =   750
         TabIndex        =   1136
         Top             =   240
         Width           =   5295
      End
   End
   Begin VB.Frame FrameArtEnPromo 
      Height          =   8055
      Left            =   480
      TabIndex        =   64
      Top             =   0
      Visible         =   0   'False
      Width           =   6495
      Begin VB.CheckBox chkVarios 
         Caption         =   "Detalla familia"
         Height          =   255
         Index           =   28
         Left            =   4800
         TabIndex        =   74
         Top             =   4680
         Width           =   1575
      End
      Begin VB.Frame FrameConsolidado 
         Caption         =   "FrameConsolidado"
         Height          =   1335
         Left            =   120
         TabIndex        =   999
         Top             =   4990
         Visible         =   0   'False
         Width           =   6255
         Begin VB.TextBox txtDescAlma 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   6
            Left            =   2640
            Locked          =   -1  'True
            TabIndex        =   1003
            Text            =   "Text5"
            Top             =   720
            Width           =   3495
         End
         Begin VB.TextBox txtAlma 
            Height          =   285
            Index           =   6
            Left            =   1440
            TabIndex        =   83
            Text            =   "Text1"
            Top             =   720
            Width           =   1095
         End
         Begin VB.TextBox txtDescAlma 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   5
            Left            =   2640
            Locked          =   -1  'True
            TabIndex        =   1000
            Text            =   "Text5"
            Top             =   360
            Width           =   3495
         End
         Begin VB.TextBox txtAlma 
            Height          =   285
            Index           =   5
            Left            =   1440
            TabIndex        =   82
            Text            =   "Text1"
            Top             =   360
            Width           =   1095
         End
         Begin VB.Label Label3 
            Caption         =   "Alm 3"
            Height          =   195
            Index           =   88
            Left            =   480
            TabIndex        =   1004
            Top             =   720
            Width           =   465
         End
         Begin VB.Image imgAlma 
            Height          =   240
            Index           =   6
            Left            =   1080
            Picture         =   "frmListado3.frx":0A28
            Top             =   720
            Width           =   240
         End
         Begin VB.Label Label3 
            Caption         =   "Alm 2"
            Height          =   195
            Index           =   87
            Left            =   480
            TabIndex        =   1002
            Top             =   360
            Width           =   465
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Consolidado almacenes"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   179
            Left            =   60
            TabIndex        =   1001
            Top             =   0
            Width           =   1980
         End
         Begin VB.Image imgAlma 
            Height          =   240
            Index           =   5
            Left            =   1080
            Picture         =   "frmListado3.frx":0B2A
            Top             =   360
            Width           =   240
         End
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Agrupado por agente"
         Height          =   255
         Index           =   12
         Left            =   120
         TabIndex        =   81
         Top             =   7320
         Width           =   2295
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   5
         Left            =   2400
         Locked          =   -1  'True
         TabIndex        =   648
         Text            =   "Text1"
         Top             =   6960
         Width           =   3855
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   5
         Left            =   1560
         TabIndex        =   80
         Text            =   "186"
         Top             =   6960
         Width           =   735
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   4
         Left            =   2400
         Locked          =   -1  'True
         TabIndex        =   645
         Text            =   "Text1"
         Top             =   6600
         Width           =   3855
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   4
         Left            =   1560
         TabIndex        =   79
         Text            =   "186"
         Top             =   6600
         Width           =   735
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   13
         Left            =   1440
         TabIndex        =   76
         Text            =   "Text1"
         Top             =   5280
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   13
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   643
         Text            =   "Text1"
         Top             =   5280
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   12
         Left            =   1440
         TabIndex        =   75
         Text            =   "Text1"
         Top             =   4920
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   12
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   640
         Text            =   "Text1"
         Top             =   4920
         Width           =   3495
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   31
         Left            =   3960
         TabIndex        =   78
         Text            =   "Text1"
         Top             =   6000
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   30
         Left            =   1680
         TabIndex        =   77
         Text            =   "Text1"
         Top             =   6000
         Width           =   1215
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Detalla cliente"
         Height          =   255
         Index           =   0
         Left            =   3360
         TabIndex        =   73
         Top             =   4680
         Width           =   1575
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   2
         Left            =   2040
         TabIndex        =   72
         Text            =   "Text1"
         Top             =   4680
         Width           =   1215
      End
      Begin VB.CommandButton cmdArtEnPromo 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3840
         TabIndex        =   84
         Top             =   7560
         Width           =   1095
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   3
         Left            =   1440
         TabIndex        =   71
         Top             =   4200
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   3
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   102
         Text            =   "Text5"
         Top             =   4200
         Width           =   3495
      End
      Begin VB.TextBox txtAlma 
         Height          =   285
         Index           =   2
         Left            =   1440
         TabIndex        =   65
         Text            =   "Text1"
         Top             =   1080
         Width           =   1095
      End
      Begin VB.TextBox txtDescAlma 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   2
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   98
         Text            =   "Text5"
         Top             =   1080
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   2
         Left            =   1440
         TabIndex        =   70
         Top             =   3840
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   2
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   97
         Text            =   "Text5"
         Top             =   3840
         Width           =   3495
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   2
         Left            =   3120
         Locked          =   -1  'True
         TabIndex        =   94
         Text            =   "Text5"
         Top             =   2160
         Width           =   3015
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   2
         Left            =   1440
         MaxLength       =   16
         TabIndex        =   67
         Top             =   2160
         Width           =   1455
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   1
         Left            =   3120
         Locked          =   -1  'True
         TabIndex        =   91
         Text            =   "Text5"
         Top             =   1800
         Width           =   3015
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   1
         Left            =   1440
         MaxLength       =   16
         TabIndex        =   66
         Top             =   1800
         Width           =   1455
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   1
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   89
         Text            =   "Text5"
         Top             =   3120
         Width           =   3495
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   1
         Left            =   1440
         TabIndex        =   69
         Text            =   "Text1"
         Top             =   3120
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   86
         Text            =   "Text5"
         Top             =   2760
         Width           =   3495
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   0
         Left            =   1440
         TabIndex        =   68
         Text            =   "Text1"
         Top             =   2760
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   5
         Left            =   5160
         TabIndex        =   85
         Top             =   7560
         Width           =   1095
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   129
         Left            =   480
         TabIndex        =   649
         Top             =   6960
         Width           =   420
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   5
         Left            =   1200
         Picture         =   "frmListado3.frx":0C2C
         Top             =   6960
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   128
         Left            =   480
         TabIndex        =   647
         Top             =   6600
         Width           =   450
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   4
         Left            =   1200
         Picture         =   "frmListado3.frx":0D2E
         Top             =   6600
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Agente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   35
         Left            =   120
         TabIndex        =   646
         Top             =   6360
         Width           =   615
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   13
         Left            =   1200
         Picture         =   "frmListado3.frx":0E30
         Top             =   5280
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   127
         Left            =   480
         TabIndex        =   644
         Top             =   5280
         Width           =   420
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   12
         Left            =   1200
         Picture         =   "frmListado3.frx":0F32
         Top             =   4920
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   34
         Left            =   120
         TabIndex        =   642
         Top             =   4680
         Width           =   585
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   126
         Left            =   480
         TabIndex        =   641
         Top             =   4920
         Width           =   450
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   59
         Left            =   3000
         TabIndex        =   639
         Top             =   6000
         Width           =   465
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   58
         Left            =   480
         TabIndex        =   638
         Top             =   6000
         Width           =   465
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   31
         Left            =   3600
         Picture         =   "frmListado3.frx":1034
         Top             =   6000
         Width           =   240
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   30
         Left            =   1320
         Picture         =   "frmListado3.frx":10BF
         Top             =   6000
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   10
         Left            =   120
         TabIndex        =   105
         Top             =   7680
         Width           =   3465
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "F"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   0
         Left            =   120
         TabIndex        =   104
         Top             =   5640
         Width           =   90
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   2
         Left            =   1680
         Picture         =   "frmListado3.frx":114A
         Top             =   4680
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   9
         Left            =   480
         TabIndex        =   103
         Top             =   4200
         Width           =   420
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   3
         Left            =   1200
         Picture         =   "frmListado3.frx":11D5
         Top             =   4200
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   8
         Left            =   480
         TabIndex        =   101
         Top             =   3840
         Width           =   450
      End
      Begin VB.Image imgAlma 
         Height          =   240
         Index           =   2
         Left            =   1200
         Picture         =   "frmListado3.frx":12D7
         Top             =   1080
         Width           =   240
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   2
         Left            =   1200
         Picture         =   "frmListado3.frx":13D9
         Top             =   3840
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   7
         Left            =   120
         TabIndex        =   100
         Top             =   3600
         Width           =   885
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Almacén"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   6
         Left            =   120
         TabIndex        =   99
         Top             =   1080
         Width           =   735
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   9
         Left            =   480
         TabIndex        =   96
         Top             =   2160
         Width           =   465
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   8
         Left            =   480
         TabIndex        =   95
         Top             =   1800
         Width           =   465
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   2
         Left            =   1200
         Picture         =   "frmListado3.frx":14DB
         Top             =   2160
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Artículo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   5
         Left            =   120
         TabIndex        =   93
         Top             =   1560
         Width           =   660
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   3
         Left            =   720
         TabIndex        =   92
         Top             =   360
         Width           =   4845
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   1
         Left            =   1200
         Picture         =   "frmListado3.frx":15DD
         Top             =   1800
         Width           =   240
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   1
         Left            =   1200
         Picture         =   "frmListado3.frx":16DF
         Top             =   3120
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   7
         Left            =   480
         TabIndex        =   90
         Top             =   3120
         Width           =   465
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   0
         Left            =   1200
         Picture         =   "frmListado3.frx":17E1
         Top             =   2760
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   35
         Left            =   120
         TabIndex        =   88
         Top             =   2520
         Width           =   600
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   128
         Left            =   480
         TabIndex        =   87
         Top             =   2760
         Width           =   465
      End
   End
   Begin VB.Frame FrameReposcionAlmacen 
      Height          =   3855
      Left            =   2880
      TabIndex        =   654
      Top             =   120
      Visible         =   0   'False
      Width           =   6255
      Begin VB.CheckBox chkVarios 
         Height          =   255
         Index           =   34
         Left            =   2880
         TabIndex        =   660
         Top             =   2880
         Width           =   2055
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   32
         Left            =   1440
         TabIndex        =   656
         Top             =   1560
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   32
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   1148
         Text            =   "Text5"
         Top             =   1560
         Width           =   3615
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Imprimir solo a reponer"
         Height          =   255
         Index           =   24
         Left            =   240
         TabIndex        =   659
         Top             =   2880
         Width           =   2295
      End
      Begin VB.CommandButton cmdLeerDatosGuardados 
         Height          =   375
         Left            =   3120
         Picture         =   "frmListado3.frx":18E3
         Style           =   1  'Graphical
         TabIndex        =   950
         ToolTipText     =   "Leer datos guardados"
         Top             =   3240
         Width           =   495
      End
      Begin VB.CommandButton cmdReposicionAlmacen 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3840
         TabIndex        =   661
         Top             =   3240
         Width           =   975
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   33
         Left            =   3600
         TabIndex        =   658
         Text            =   "Text1"
         Top             =   2280
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   32
         Left            =   1320
         TabIndex        =   657
         Text            =   "Text1"
         Top             =   2280
         Width           =   1215
      End
      Begin VB.TextBox txtDescAlma 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   4
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   665
         Text            =   "Text5"
         Top             =   960
         Width           =   3495
      End
      Begin VB.TextBox txtAlma 
         Height          =   285
         Index           =   4
         Left            =   1440
         TabIndex        =   655
         Text            =   "Text1"
         Top             =   960
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   35
         Left            =   4920
         TabIndex        =   662
         Top             =   3240
         Width           =   975
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   32
         Left            =   1200
         Picture         =   "frmListado3.frx":22E5
         Top             =   1560
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   208
         Left            =   120
         TabIndex        =   1147
         Top             =   1560
         Width           =   885
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   33
         Left            =   3360
         Picture         =   "frmListado3.frx":23E7
         Top             =   2280
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   62
         Left            =   2760
         TabIndex        =   669
         Top             =   2280
         Width           =   465
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   32
         Left            =   1080
         Picture         =   "frmListado3.frx":2472
         Top             =   2280
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   61
         Left            =   480
         TabIndex        =   668
         Top             =   2280
         Width           =   465
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   36
         Left            =   120
         TabIndex        =   667
         Top             =   2040
         Width           =   495
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Almacén"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   106
         Left            =   120
         TabIndex        =   666
         Top             =   960
         Width           =   735
      End
      Begin VB.Image imgAlma 
         Height          =   240
         Index           =   4
         Left            =   1200
         Picture         =   "frmListado3.frx":24FD
         Top             =   960
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Reposición almacén"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   32
         Left            =   1080
         TabIndex        =   664
         Top             =   360
         Width           =   4005
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   60
         Left            =   120
         TabIndex        =   663
         Top             =   3360
         Width           =   2985
      End
   End
   Begin VB.Frame FrameAgeFamMar 
      Height          =   6255
      Left            =   3120
      TabIndex        =   866
      Top             =   120
      Visible         =   0   'False
      Width           =   6495
      Begin VB.CheckBox chkVarios 
         Caption         =   "Detalla familia"
         Height          =   255
         Index           =   33
         Left            =   3600
         TabIndex        =   1146
         Top             =   5280
         Width           =   1815
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Proveedor"
         Height          =   255
         Index           =   26
         Left            =   1320
         TabIndex        =   877
         Top             =   5280
         Width           =   1815
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Incluir presupuestos"
         Height          =   255
         Index           =   22
         Left            =   3600
         TabIndex        =   876
         Top             =   4800
         Width           =   2175
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Detalla factura"
         Height          =   255
         Index           =   20
         Left            =   1320
         TabIndex        =   875
         Top             =   4800
         Width           =   1455
      End
      Begin VB.CommandButton cmdAgenFamMar 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3960
         TabIndex        =   878
         Top             =   5760
         Width           =   1095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   51
         Left            =   3960
         TabIndex        =   874
         Text            =   "Text1"
         Top             =   4200
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   50
         Left            =   1560
         TabIndex        =   873
         Text            =   "Text1"
         Top             =   4200
         Width           =   1215
      End
      Begin VB.TextBox txtDescmarca 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   1
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   893
         Text            =   "Text5"
         Top             =   3120
         Width           =   3495
      End
      Begin VB.TextBox txtmarca 
         Height          =   285
         Index           =   1
         Left            =   1560
         TabIndex        =   871
         Text            =   "Text1"
         Top             =   3120
         Width           =   1095
      End
      Begin VB.TextBox txtDescmarca 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   2
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   890
         Text            =   "Text5"
         Top             =   3480
         Width           =   3495
      End
      Begin VB.TextBox txtmarca 
         Height          =   285
         Index           =   2
         Left            =   1560
         TabIndex        =   872
         Text            =   "Text1"
         Top             =   3480
         Width           =   1095
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   22
         Left            =   1560
         TabIndex        =   870
         Text            =   "Text1"
         Top             =   2400
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   22
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   888
         Text            =   "Text5"
         Top             =   2400
         Width           =   3495
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   21
         Left            =   1560
         TabIndex        =   869
         Text            =   "Text1"
         Top             =   2040
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   21
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   885
         Text            =   "Text5"
         Top             =   2040
         Width           =   3495
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   11
         Left            =   1680
         TabIndex        =   868
         Text            =   "186"
         Top             =   1320
         Width           =   735
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   11
         Left            =   2520
         Locked          =   -1  'True
         TabIndex        =   883
         Text            =   "Text1"
         Top             =   1320
         Width           =   3855
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   10
         Left            =   1680
         TabIndex        =   867
         Text            =   "186"
         Top             =   960
         Width           =   735
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   10
         Left            =   2520
         Locked          =   -1  'True
         TabIndex        =   881
         Text            =   "Text1"
         Top             =   960
         Width           =   3855
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   46
         Left            =   5160
         TabIndex        =   879
         Top             =   5760
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   81
         Left            =   360
         TabIndex        =   899
         Top             =   5880
         Width           =   3225
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   51
         Left            =   3720
         Picture         =   "frmListado3.frx":25FF
         Top             =   4200
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   80
         Left            =   3000
         TabIndex        =   898
         Top             =   4200
         Width           =   465
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   50
         Left            =   1320
         Picture         =   "frmListado3.frx":268A
         Top             =   4200
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   79
         Left            =   600
         TabIndex        =   897
         Top             =   4200
         Width           =   465
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   62
         Left            =   240
         TabIndex        =   896
         Top             =   3960
         Width           =   495
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   160
         Left            =   600
         TabIndex        =   895
         Top             =   960
         Width           =   450
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   78
         Left            =   600
         TabIndex        =   894
         Top             =   3480
         Width           =   465
      End
      Begin VB.Image imgMarca 
         Height          =   240
         Index           =   1
         Left            =   1320
         Picture         =   "frmListado3.frx":2715
         Top             =   3120
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   154
         Left            =   600
         TabIndex        =   892
         Top             =   3120
         Width           =   450
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Marca"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   159
         Left            =   240
         TabIndex        =   891
         Top             =   2880
         Width           =   525
      End
      Begin VB.Image imgMarca 
         Height          =   240
         Index           =   2
         Left            =   1320
         Picture         =   "frmListado3.frx":2817
         Top             =   3480
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   77
         Left            =   600
         TabIndex        =   889
         Top             =   2400
         Width           =   465
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   22
         Left            =   1320
         Picture         =   "frmListado3.frx":2919
         Top             =   2400
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   76
         Left            =   600
         TabIndex        =   887
         Top             =   2040
         Width           =   465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   158
         Left            =   240
         TabIndex        =   886
         Top             =   1800
         Width           =   600
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   21
         Left            =   1320
         Picture         =   "frmListado3.frx":2A1B
         Top             =   2040
         Width           =   240
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   11
         Left            =   1320
         Picture         =   "frmListado3.frx":2B1D
         Top             =   1320
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   157
         Left            =   600
         TabIndex        =   884
         Top             =   1320
         Width           =   420
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Agente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   60
         Left            =   240
         TabIndex        =   882
         Top             =   720
         Width           =   615
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   10
         Left            =   1320
         Picture         =   "frmListado3.frx":2C1F
         Top             =   960
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Listado agente-familia-marca"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   42
         Left            =   1080
         TabIndex        =   880
         Top             =   240
         Width           =   4125
      End
   End
   Begin VB.Frame FrameProveedor 
      Height          =   1695
      Left            =   3840
      TabIndex        =   1019
      Top             =   4680
      Visible         =   0   'False
      Width           =   6495
      Begin VB.CheckBox chkVarios 
         Caption         =   "Cabel"
         Height          =   255
         Index           =   32
         Left            =   1440
         TabIndex        =   1021
         Top             =   1080
         Width           =   2295
      End
      Begin VB.CommandButton cmdProveedor 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3840
         TabIndex        =   1022
         Top             =   1080
         Width           =   1095
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   28
         Left            =   1440
         TabIndex        =   1020
         Top             =   600
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   28
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   1025
         Text            =   "Text5"
         Top             =   600
         Width           =   3495
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   56
         Left            =   5040
         TabIndex        =   1023
         Top             =   1080
         Width           =   1095
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   28
         Left            =   1200
         Picture         =   "frmListado3.frx":2D21
         Top             =   600
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   185
         Left            =   120
         TabIndex        =   1024
         Top             =   600
         Width           =   885
      End
   End
   Begin VB.Frame FrameIncremPrecioPorcen 
      Height          =   5295
      Left            =   3480
      TabIndex        =   0
      Top             =   0
      Visible         =   0   'False
      Width           =   6615
      Begin VB.TextBox txtDecimal 
         Height          =   285
         Index           =   18
         Left            =   4680
         TabIndex        =   1108
         Text            =   "Text1"
         Top             =   840
         Width           =   1095
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   31
         Left            =   1440
         TabIndex        =   1110
         Top             =   2280
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   31
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   1125
         Text            =   "Text5"
         Top             =   2280
         Width           =   3615
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   30
         Left            =   1440
         TabIndex        =   1109
         Top             =   1800
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   30
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   1122
         Text            =   "Text5"
         Top             =   1800
         Width           =   3615
      End
      Begin VB.CommandButton cmdIncrePrecioPorcentual 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3840
         TabIndex        =   1113
         Top             =   4680
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   62
         Left            =   5040
         TabIndex        =   1114
         Top             =   4680
         Width           =   1095
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   26
         Left            =   1440
         TabIndex        =   1112
         Text            =   "Text1"
         Top             =   3720
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   26
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   1120
         Text            =   "Text5"
         Top             =   3720
         Width           =   3615
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   25
         Left            =   1440
         TabIndex        =   1111
         Text            =   "Text1"
         Top             =   3240
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   25
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   1117
         Text            =   "Text5"
         Top             =   3240
         Width           =   3615
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   63
         Left            =   1920
         TabIndex        =   1107
         Text            =   "Text1"
         Top             =   840
         Width           =   1215
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "% a aplicar"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   75
         Left            =   3600
         TabIndex        =   1127
         Top             =   840
         Width           =   960
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   31
         Left            =   1200
         Picture         =   "frmListado3.frx":2E23
         Top             =   2280
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   203
         Left            =   480
         TabIndex        =   1126
         Top             =   2280
         Width           =   420
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   30
         Left            =   1200
         Picture         =   "frmListado3.frx":2F25
         Top             =   1800
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   202
         Left            =   240
         TabIndex        =   1124
         Top             =   1440
         Width           =   885
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   201
         Left            =   480
         TabIndex        =   1123
         Top             =   1800
         Width           =   450
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   95
         Left            =   480
         TabIndex        =   1121
         Top             =   3720
         Width           =   465
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   26
         Left            =   1200
         Picture         =   "frmListado3.frx":3027
         Top             =   3720
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   94
         Left            =   480
         TabIndex        =   1119
         Top             =   3240
         Width           =   465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   200
         Left            =   240
         TabIndex        =   1118
         Top             =   2880
         Width           =   600
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   25
         Left            =   1200
         Picture         =   "frmListado3.frx":3129
         Top             =   3240
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha cambio"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   74
         Left            =   240
         TabIndex        =   1116
         Top             =   840
         Width           =   1155
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   63
         Left            =   1600
         Picture         =   "frmListado3.frx":322B
         Top             =   840
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Incremento precio porcentual"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   55
         Left            =   1545
         TabIndex        =   1115
         Top             =   240
         Width           =   4155
      End
   End
   Begin VB.Frame FramemarjaChipos 
      Height          =   3735
      Left            =   1320
      TabIndex        =   1093
      Top             =   0
      Visible         =   0   'False
      Width           =   6135
      Begin VB.CommandButton cmdDerrama 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3480
         TabIndex        =   1098
         Top             =   3120
         Width           =   1095
      End
      Begin VB.TextBox textoSinControl 
         Height          =   405
         Index           =   0
         Left            =   240
         MaxLength       =   80
         ScrollBars      =   2  'Vertical
         TabIndex        =   1097
         Text            =   "Text3"
         Top             =   2520
         Width           =   5655
      End
      Begin VB.TextBox txtDecimal 
         Height          =   285
         Index           =   17
         Left            =   2160
         TabIndex        =   1095
         Text            =   "Text1"
         Top             =   1080
         Width           =   1095
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   15
         Left            =   240
         MaxLength       =   16
         TabIndex        =   1096
         Top             =   1800
         Width           =   1455
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   15
         Left            =   1800
         Locked          =   -1  'True
         TabIndex        =   1102
         Text            =   "Text5"
         Top             =   1800
         Width           =   4095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   62
         Left            =   240
         TabIndex        =   1094
         Text            =   "Text1"
         Top             =   1080
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   61
         Left            =   4800
         TabIndex        =   1099
         Top             =   3120
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   93
         Left            =   240
         TabIndex        =   1106
         Top             =   3000
         Width           =   2865
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Observaciones"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   199
         Left            =   240
         TabIndex        =   1105
         Top             =   2280
         Width           =   1245
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Importe hanegada"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   198
         Left            =   1920
         TabIndex        =   1104
         Top             =   840
         Width           =   1590
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   15
         Left            =   1080
         Picture         =   "frmListado3.frx":32B6
         Top             =   1560
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Artículo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   197
         Left            =   240
         TabIndex        =   1103
         Top             =   1560
         Width           =   660
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   62
         Left            =   1200
         Picture         =   "frmListado3.frx":33B8
         Top             =   840
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fe. albaran"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   73
         Left            =   240
         TabIndex        =   1101
         Top             =   840
         Width           =   930
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Facturación derrama"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   54
         Left            =   720
         TabIndex        =   1100
         Top             =   240
         Width           =   4125
      End
   End
   Begin VB.Frame FrameAgua2 
      Height          =   3495
      Left            =   1680
      TabIndex        =   1075
      Top             =   480
      Visible         =   0   'False
      Width           =   6615
      Begin VB.Frame Frame4 
         Caption         =   "Baja"
         Height          =   615
         Index           =   3
         Left            =   4800
         TabIndex        =   1091
         Top             =   120
         Visible         =   0   'False
         Width           =   2535
         Begin VB.CheckBox chkAgua2 
            Caption         =   "Si"
            Height          =   195
            Index           =   7
            Left            =   720
            TabIndex        =   1082
            Tag             =   "1"
            Top             =   270
            Width           =   735
         End
         Begin VB.CheckBox chkAgua2 
            Caption         =   "No"
            Height          =   195
            Index           =   8
            Left            =   1680
            TabIndex        =   1083
            Tag             =   "0"
            Top             =   270
            Value           =   1  'Checked
            Width           =   735
         End
      End
      Begin VB.Frame Frame4 
         Caption         =   "Facturar"
         Height          =   615
         Index           =   2
         Left            =   3720
         TabIndex        =   1089
         Top             =   1680
         Width           =   2415
         Begin VB.CheckBox chkAgua2 
            Caption         =   "No"
            Height          =   195
            Index           =   6
            Left            =   1440
            TabIndex        =   1090
            Tag             =   "0"
            Top             =   240
            Width           =   735
         End
         Begin VB.CheckBox chkAgua2 
            Caption         =   "Si"
            Height          =   195
            Index           =   5
            Left            =   720
            TabIndex        =   1081
            Tag             =   "1"
            Top             =   240
            Value           =   1  'Checked
            Width           =   1335
         End
      End
      Begin VB.Frame Frame4 
         Caption         =   "Tipo uso"
         Height          =   615
         Index           =   1
         Left            =   240
         TabIndex        =   1088
         Top             =   1680
         Width           =   3375
         Begin VB.CheckBox chkAgua2 
            Caption         =   "Industrial"
            Height          =   195
            Index           =   4
            Left            =   2160
            TabIndex        =   1080
            Tag             =   "1"
            Top             =   270
            Value           =   1  'Checked
            Width           =   1095
         End
         Begin VB.CheckBox chkAgua2 
            Caption         =   "Doméstico"
            Height          =   195
            Index           =   3
            Left            =   720
            TabIndex        =   1079
            Tag             =   "0"
            Top             =   270
            Value           =   1  'Checked
            Width           =   1335
         End
      End
      Begin VB.Frame Frame4 
         Caption         =   "Tipo facturación"
         Height          =   735
         Index           =   0
         Left            =   240
         TabIndex        =   1087
         Top             =   840
         Width           =   5895
         Begin VB.CheckBox chkAgua2 
            Caption         =   "Anexo"
            Height          =   195
            Index           =   2
            Left            =   3480
            TabIndex        =   1078
            Tag             =   "2"
            Top             =   360
            Width           =   855
         End
         Begin VB.CheckBox chkAgua2 
            Caption         =   "Contador"
            Height          =   195
            Index           =   0
            Left            =   720
            TabIndex        =   1076
            Tag             =   "0"
            Top             =   360
            Value           =   1  'Checked
            Width           =   1335
         End
         Begin VB.CheckBox chkAgua2 
            Caption         =   "Aforo"
            Height          =   195
            Index           =   1
            Left            =   2160
            TabIndex        =   1077
            Tag             =   "1"
            Top             =   360
            Width           =   1335
         End
      End
      Begin VB.CommandButton cmdAgua2 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3720
         TabIndex        =   1084
         Top             =   2640
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   60
         Left            =   5040
         TabIndex        =   1085
         Top             =   2640
         Width           =   1095
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Listado exportacion contadores AGUA"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   53
         Left            =   105
         TabIndex        =   1086
         Top             =   240
         Width           =   5355
      End
   End
   Begin VB.Frame FrameExportarFAS 
      Height          =   2415
      Left            =   2280
      TabIndex        =   1066
      Top             =   1440
      Visible         =   0   'False
      Width           =   5295
      Begin VB.CommandButton cmdExportarFAS 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   2640
         TabIndex        =   1069
         Top             =   1680
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   59
         Left            =   3960
         TabIndex        =   1070
         Top             =   1680
         Width           =   1095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   60
         Left            =   1320
         TabIndex        =   1067
         Top             =   1080
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   61
         Left            =   3840
         TabIndex        =   1068
         Top             =   1080
         Width           =   1215
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   60
         Left            =   960
         Picture         =   "frmListado3.frx":3443
         Top             =   1080
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   72
         Left            =   240
         TabIndex        =   1074
         Top             =   720
         Width           =   495
      End
      Begin VB.Label Label1 
         Caption         =   "Desde"
         Height          =   195
         Index           =   12
         Left            =   360
         TabIndex        =   1073
         Top             =   1080
         Width           =   465
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   61
         Left            =   3480
         Picture         =   "frmListado3.frx":34CE
         Top             =   1080
         Width           =   240
      End
      Begin VB.Label Label1 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   13
         Left            =   2880
         TabIndex        =   1072
         Top             =   1080
         Width           =   465
      End
      Begin VB.Label Label9 
         Alignment       =   2  'Center
         Caption         =   "Exportar albaranes servicios"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   14.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   345
         Index           =   13
         Left            =   240
         TabIndex        =   1071
         Top             =   240
         Width           =   4770
      End
   End
   Begin VB.Frame FrameAguaDeclaracion 
      Height          =   2775
      Left            =   960
      TabIndex        =   1059
      Top             =   0
      Visible         =   0   'False
      Width           =   4695
      Begin VB.ComboBox cbAnyo 
         Height          =   315
         Left            =   2160
         Style           =   2  'Dropdown List
         TabIndex        =   1064
         Top             =   960
         Width           =   1695
      End
      Begin VB.CommandButton cmdAguaDeclaracion 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   2040
         TabIndex        =   1062
         Top             =   1920
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   58
         Left            =   3240
         TabIndex        =   1060
         Top             =   1920
         Width           =   1095
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Año declaración"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   71
         Left            =   840
         TabIndex        =   1065
         Top             =   960
         Width           =   1140
      End
      Begin VB.Label Label3 
         Height          =   195
         Index           =   92
         Left            =   240
         TabIndex        =   1063
         Top             =   1560
         Width           =   4065
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Declaración detallada EPSAR"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   52
         Left            =   240
         TabIndex        =   1061
         Top             =   360
         Width           =   4125
      End
   End
   Begin VB.Frame FrameComsionHerbelca 
      Height          =   2655
      Left            =   240
      TabIndex        =   579
      Top             =   600
      Width           =   4335
      Begin VB.CommandButton cmdComisionesMes 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   1680
         TabIndex        =   585
         Top             =   2040
         Width           =   1095
      End
      Begin VB.TextBox TxtComision 
         BackColor       =   &H80000018&
         Height          =   285
         Left            =   1680
         Locked          =   -1  'True
         TabIndex        =   583
         Text            =   "Text3"
         Top             =   1080
         Width           =   1335
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   31
         Left            =   2880
         TabIndex        =   581
         Top             =   2040
         Width           =   1095
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Mes"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   110
         Left            =   1200
         TabIndex        =   584
         Top             =   1080
         Width           =   345
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   57
         Left            =   120
         TabIndex        =   582
         Top             =   1560
         Width           =   2625
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Generación comisiones"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   28
         Left            =   570
         TabIndex        =   580
         Top             =   240
         Width           =   3345
      End
   End
   Begin VB.Frame FrameSimularPedidoProveedor 
      Height          =   4095
      Left            =   2280
      TabIndex        =   1027
      Top             =   360
      Visible         =   0   'False
      Width           =   6135
      Begin VB.CommandButton cmdImpSimulacionPedProv 
         Caption         =   "Cambiar"
         Height          =   375
         Index           =   1
         Left            =   240
         TabIndex        =   1053
         ToolTipText     =   "Cambiar proveedor en el pedido"
         Top             =   3600
         Width           =   1095
      End
      Begin VB.CommandButton cmdImpSimulacionPedProv 
         Caption         =   "&Imprimir"
         Height          =   375
         Index           =   0
         Left            =   3600
         TabIndex        =   1030
         Top             =   3600
         Width           =   1095
      End
      Begin VB.Frame Frame3 
         Enabled         =   0   'False
         Height          =   855
         Left            =   240
         TabIndex        =   1042
         Top             =   2520
         Width           =   5535
         Begin VB.TextBox txtDecimal 
            Alignment       =   1  'Right Justify
            Height          =   285
            Index           =   14
            Left            =   2040
            TabIndex        =   1051
            Text            =   "Text3"
            Top             =   480
            Width           =   735
         End
         Begin VB.TextBox txtDecimal 
            Alignment       =   1  'Right Justify
            Height          =   285
            Index           =   16
            Left            =   4200
            TabIndex        =   1049
            Text            =   "Text3"
            Top             =   480
            Width           =   1095
         End
         Begin VB.TextBox txtDecimal 
            Alignment       =   1  'Right Justify
            Height          =   285
            Index           =   15
            Left            =   3240
            TabIndex        =   1047
            Text            =   "Text3"
            Top             =   480
            Width           =   855
         End
         Begin VB.TextBox txtDecimal 
            Alignment       =   1  'Right Justify
            Height          =   285
            Index           =   13
            Left            =   1080
            TabIndex        =   1045
            Text            =   "Text3"
            Top             =   480
            Width           =   735
         End
         Begin VB.TextBox txtDecimal 
            Alignment       =   1  'Right Justify
            Height          =   285
            Index           =   12
            Left            =   120
            TabIndex        =   1043
            Text            =   "Text3"
            Top             =   480
            Width           =   735
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Cambiada"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   194
            Left            =   2040
            TabIndex        =   1052
            Top             =   240
            Width           =   705
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Total"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   193
            Left            =   4800
            TabIndex        =   1050
            Top             =   240
            Width           =   360
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Suma lineas"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   192
            Left            =   3240
            TabIndex        =   1048
            Top             =   240
            Width           =   840
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Dtos"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   191
            Left            =   1080
            TabIndex        =   1046
            Top             =   240
            Width           =   330
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Sin cambio"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   190
            Left            =   120
            TabIndex        =   1044
            Top             =   240
            Width           =   750
         End
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   29
         Left            =   360
         TabIndex        =   1029
         Top             =   960
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   29
         Left            =   1560
         Locked          =   -1  'True
         TabIndex        =   1033
         Text            =   "Text5"
         Top             =   960
         Width           =   3495
      End
      Begin VB.Frame Frame2 
         Enabled         =   0   'False
         Height          =   975
         Left            =   240
         TabIndex        =   1032
         Top             =   1440
         Width           =   5535
         Begin VB.TextBox txtFecha 
            Height          =   285
            Index           =   59
            Left            =   240
            TabIndex        =   1039
            Text            =   "Text1"
            Top             =   600
            Width           =   1215
         End
         Begin VB.TextBox txtDecimal 
            Alignment       =   1  'Right Justify
            Height          =   285
            Index           =   11
            Left            =   3840
            TabIndex        =   1037
            Text            =   "Text3"
            Top             =   600
            Width           =   1095
         End
         Begin VB.TextBox txtDecimal 
            Alignment       =   1  'Right Justify
            Height          =   285
            Index           =   10
            Left            =   2160
            TabIndex        =   1035
            Text            =   "Text3"
            Top             =   600
            Width           =   1095
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Fecha"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   189
            Left            =   240
            TabIndex        =   1041
            Top             =   360
            Width           =   435
         End
         Begin VB.Image imgFecha 
            Height          =   240
            Index           =   59
            Left            =   1440
            Picture         =   "frmListado3.frx":3559
            Top             =   240
            Visible         =   0   'False
            Width           =   240
         End
         Begin VB.Label lblDpto 
            AutoSize        =   -1  'True
            Caption         =   "Datos pedido"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   69
            Left            =   120
            TabIndex        =   1040
            Top             =   0
            Width           =   1110
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Dto general"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   187
            Left            =   3840
            TabIndex        =   1038
            Top             =   360
            Width           =   840
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Dto P.P."
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   186
            Left            =   2160
            TabIndex        =   1036
            Top             =   360
            Width           =   600
         End
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   57
         Left            =   4800
         TabIndex        =   1031
         Top             =   3600
         Width           =   975
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   29
         Left            =   1440
         Picture         =   "frmListado3.frx":35E4
         Top             =   720
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   188
         Left            =   360
         TabIndex        =   1034
         Top             =   720
         Width           =   885
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Simular proveedor del pedido"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   51
         Left            =   840
         TabIndex        =   1028
         Top             =   240
         Width           =   4515
      End
   End
   Begin VB.Frame FrameImportarAgua 
      Height          =   2775
      Left            =   960
      TabIndex        =   973
      Top             =   3720
      Visible         =   0   'False
      Width           =   6255
      Begin VB.CheckBox chkVarios 
         Caption         =   "Listado resumen e importacion"
         Height          =   255
         Index           =   27
         Left            =   360
         TabIndex        =   1026
         Top             =   1920
         Width           =   2775
      End
      Begin VB.TextBox TxtFichero 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   1200
         Locked          =   -1  'True
         TabIndex        =   980
         Text            =   "Text3"
         Top             =   1440
         Width           =   4815
      End
      Begin VB.CommandButton cmdAguaImportLectura 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3600
         TabIndex        =   976
         Top             =   2160
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   52
         Left            =   4920
         TabIndex        =   977
         Top             =   2160
         Width           =   1095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   56
         Left            =   1800
         TabIndex        =   975
         Text            =   "Text1"
         Top             =   840
         Width           =   1215
      End
      Begin VB.Image imgAyuda 
         Height          =   255
         Index           =   8
         Left            =   3240
         ToolTipText     =   "IMportar fichero agua"
         Top             =   2160
         Width           =   255
      End
      Begin VB.Image imgCommonDialog 
         Height          =   240
         Index           =   0
         Left            =   960
         Picture         =   "frmListado3.frx":36E6
         Top             =   1440
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Fichero"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   176
         Left            =   240
         TabIndex        =   981
         Top             =   1440
         Width           =   525
      End
      Begin VB.Label Label3 
         Height          =   195
         Index           =   86
         Left            =   120
         TabIndex        =   979
         Top             =   2280
         Width           =   3225
      End
      Begin VB.Label Label4 
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   175
         Left            =   240
         TabIndex        =   978
         Top             =   840
         Width           =   1125
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   56
         Left            =   1440
         Picture         =   "frmListado3.frx":37E8
         Top             =   840
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Agua"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   48
         Left            =   240
         TabIndex        =   974
         Top             =   240
         Width           =   5685
      End
   End
   Begin VB.Frame FramePresuFAS 
      Height          =   4575
      Left            =   120
      TabIndex        =   848
      Top             =   120
      Visible         =   0   'False
      Width           =   6495
      Begin VB.CommandButton cmdPresuFAS 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3960
         TabIndex        =   855
         Top             =   3960
         Width           =   1095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   49
         Left            =   1680
         TabIndex        =   854
         Text            =   "Text1"
         Top             =   3240
         Width           =   1215
      End
      Begin VB.TextBox txtDescBanco 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   2
         Left            =   2280
         Locked          =   -1  'True
         TabIndex        =   862
         Text            =   "Text5"
         Top             =   2640
         Width           =   3975
      End
      Begin VB.TextBox txtBanco 
         Height          =   285
         Index           =   2
         Left            =   1680
         TabIndex        =   853
         Text            =   "Text1"
         Top             =   2640
         Width           =   615
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   48
         Left            =   4320
         TabIndex        =   851
         Text            =   "Text1"
         Top             =   1200
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   47
         Left            =   1560
         TabIndex        =   850
         Text            =   "Text1"
         Top             =   1200
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   45
         Left            =   5160
         TabIndex        =   856
         Top             =   3960
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   21
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   857
         Text            =   "Text1"
         Top             =   2160
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   21
         Left            =   1680
         TabIndex        =   852
         Text            =   "Text1"
         Top             =   2160
         Width           =   975
      End
      Begin VB.Label Label3 
         Caption         =   "Fecha fac."
         Height          =   195
         Index           =   75
         Left            =   600
         TabIndex        =   865
         Top             =   3240
         Width           =   825
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   49
         Left            =   1440
         Picture         =   "frmListado3.frx":3873
         Top             =   3240
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Banco"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   156
         Left            =   600
         TabIndex        =   864
         Top             =   2640
         Width           =   435
      End
      Begin VB.Image imgBanco 
         Height          =   240
         Index           =   2
         Left            =   1440
         Picture         =   "frmListado3.frx":38FE
         Top             =   2640
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "FAS"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   155
         Left            =   240
         TabIndex        =   863
         Top             =   1800
         Width           =   315
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha presu."
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   61
         Left            =   240
         TabIndex        =   861
         Top             =   840
         Width           =   1065
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   74
         Left            =   720
         TabIndex        =   860
         Top             =   1200
         Width           =   465
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   48
         Left            =   4080
         Picture         =   "frmListado3.frx":3A00
         Top             =   1200
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   73
         Left            =   3600
         TabIndex        =   859
         Top             =   1200
         Width           =   465
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   47
         Left            =   1320
         Picture         =   "frmListado3.frx":3A8B
         Top             =   1200
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   153
         Left            =   600
         TabIndex        =   858
         Top             =   2160
         Width           =   495
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   21
         Left            =   1440
         Picture         =   "frmListado3.frx":3B16
         Top             =   2160
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Traspaso contados ruta"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   41
         Left            =   1080
         TabIndex        =   849
         Top             =   240
         Width           =   4125
      End
   End
   Begin VB.Frame frameRecalUPC 
      Height          =   5535
      Left            =   3360
      TabIndex        =   440
      Top             =   -120
      Visible         =   0   'False
      Width           =   6375
      Begin VB.OptionButton optVarios 
         Caption         =   "Precio medio ponderado"
         Height          =   255
         Index           =   12
         Left            =   3720
         TabIndex        =   451
         ToolTipText     =   "precio medio ponderado"
         Top             =   4440
         Width           =   2295
      End
      Begin VB.OptionButton optVarios 
         Caption         =   "precio standard"
         Height          =   255
         Index           =   11
         Left            =   1920
         TabIndex        =   450
         ToolTipText     =   "Precio standard"
         Top             =   4440
         Width           =   1695
      End
      Begin VB.OptionButton optVarios 
         Caption         =   "P.V.P."
         Height          =   255
         Index           =   10
         Left            =   600
         TabIndex        =   449
         ToolTipText     =   "precio venta publico"
         Top             =   4440
         Width           =   975
      End
      Begin VB.TextBox txtDecimal 
         Alignment       =   1  'Right Justify
         Height          =   285
         Index           =   4
         Left            =   4440
         TabIndex        =   448
         Text            =   "Text3"
         Top             =   3960
         Width           =   1095
      End
      Begin VB.CommandButton cmdRecalUPC 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3840
         TabIndex        =   452
         Top             =   4920
         Width           =   1095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   16
         Left            =   1560
         TabIndex        =   447
         Text            =   "Text1"
         Top             =   3960
         Width           =   1215
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   19
         Left            =   1440
         TabIndex        =   446
         Top             =   3360
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   19
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   468
         Text            =   "Text5"
         Top             =   3360
         Width           =   3495
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   18
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   464
         Text            =   "Text5"
         Top             =   3000
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   18
         Left            =   1440
         TabIndex        =   445
         Top             =   3000
         Width           =   1095
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   13
         Left            =   1440
         TabIndex        =   444
         Text            =   "Text1"
         Top             =   2400
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   13
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   462
         Text            =   "Text5"
         Top             =   2400
         Width           =   3495
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   12
         Left            =   1440
         TabIndex        =   443
         Text            =   "Text1"
         Top             =   2040
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   12
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   459
         Text            =   "Text5"
         Top             =   2040
         Width           =   3495
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   12
         Left            =   1440
         MaxLength       =   16
         TabIndex        =   442
         Top             =   1440
         Width           =   1455
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   12
         Left            =   2880
         Locked          =   -1  'True
         TabIndex        =   457
         Text            =   "Text5"
         Top             =   1440
         Width           =   3255
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   11
         Left            =   1440
         MaxLength       =   16
         TabIndex        =   441
         Top             =   1080
         Width           =   1455
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   11
         Left            =   2880
         Locked          =   -1  'True
         TabIndex        =   454
         Text            =   "Text5"
         Top             =   1080
         Width           =   3255
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   21
         Left            =   5040
         TabIndex        =   453
         Top             =   4920
         Width           =   1095
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Incremento(%)"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   85
         Left            =   3120
         TabIndex        =   472
         Top             =   3960
         Width           =   1350
      End
      Begin VB.Image imgAyuda 
         Height          =   255
         Index           =   0
         Left            =   3480
         ToolTipText     =   "Recálculo último precio compra"
         Top             =   4920
         Width           =   255
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   16
         Left            =   1200
         Picture         =   "frmListado3.frx":3C18
         Top             =   3960
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Fecha U.P.C."
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   86
         Left            =   120
         TabIndex        =   471
         Top             =   3960
         Width           =   1005
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Recálculo último precio compra"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   19
         Left            =   240
         TabIndex        =   470
         Top             =   360
         Width           =   5715
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   84
         Left            =   480
         TabIndex        =   469
         Top             =   3360
         Width           =   420
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   19
         Left            =   1200
         Picture         =   "frmListado3.frx":3CA3
         Top             =   3360
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   46
         Left            =   120
         TabIndex        =   467
         Top             =   4920
         Width           =   3315
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   83
         Left            =   120
         TabIndex        =   466
         Top             =   2760
         Width           =   885
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   18
         Left            =   1200
         Picture         =   "frmListado3.frx":3DA5
         Top             =   3000
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   82
         Left            =   480
         TabIndex        =   465
         Top             =   3000
         Width           =   450
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   45
         Left            =   480
         TabIndex        =   463
         Top             =   2400
         Width           =   465
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   13
         Left            =   1200
         Picture         =   "frmListado3.frx":3EA7
         Top             =   2400
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   44
         Left            =   480
         TabIndex        =   461
         Top             =   2040
         Width           =   465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   81
         Left            =   120
         TabIndex        =   460
         Top             =   1800
         Width           =   600
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   12
         Left            =   1200
         Picture         =   "frmListado3.frx":3FA9
         Top             =   2040
         Width           =   240
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   12
         Left            =   1200
         Picture         =   "frmListado3.frx":40AB
         Top             =   1440
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   43
         Left            =   480
         TabIndex        =   458
         Top             =   1440
         Width           =   465
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   11
         Left            =   1200
         Picture         =   "frmListado3.frx":41AD
         Top             =   1080
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Artículo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   80
         Left            =   120
         TabIndex        =   456
         Top             =   840
         Width           =   660
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   42
         Left            =   480
         TabIndex        =   455
         Top             =   1080
         Width           =   465
      End
   End
   Begin VB.Frame FramePideBanco 
      Height          =   2775
      Left            =   2400
      TabIndex        =   955
      Top             =   720
      Visible         =   0   'False
      Width           =   6135
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   55
         Left            =   1320
         TabIndex        =   951
         Text            =   "Text1"
         Top             =   960
         Width           =   1215
      End
      Begin VB.CommandButton cmdBancoFAZ 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3480
         TabIndex        =   953
         Top             =   2160
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   50
         Left            =   4800
         TabIndex        =   954
         Top             =   2160
         Width           =   1095
      End
      Begin VB.TextBox txtBanco 
         Height          =   285
         Index           =   3
         Left            =   1320
         TabIndex        =   952
         Text            =   "Text1"
         Top             =   1560
         Width           =   615
      End
      Begin VB.TextBox txtDescBanco 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   3
         Left            =   1920
         Locked          =   -1  'True
         TabIndex        =   956
         Text            =   "Text5"
         Top             =   1560
         Width           =   3975
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   55
         Left            =   960
         Picture         =   "frmListado3.frx":42AF
         Top             =   960
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Fecha"
         Height          =   195
         Index           =   85
         Left            =   240
         TabIndex        =   972
         Top             =   960
         Width           =   465
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Facturar oferta presupuesto"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   46
         Left            =   960
         TabIndex        =   958
         Top             =   240
         Width           =   4125
      End
      Begin VB.Image imgBanco 
         Height          =   240
         Index           =   3
         Left            =   1080
         Picture         =   "frmListado3.frx":433A
         Top             =   1560
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Banco"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   171
         Left            =   240
         TabIndex        =   957
         Top             =   1560
         Width           =   435
      End
   End
   Begin VB.Frame FrameVtasForpa 
      Height          =   5775
      Left            =   2040
      TabIndex        =   395
      Top             =   120
      Visible         =   0   'False
      Width           =   6015
      Begin VB.CommandButton cmdVtasForPa 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3240
         TabIndex        =   401
         Top             =   5280
         Width           =   1095
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   9
         Left            =   1200
         TabIndex        =   399
         Text            =   "Text1"
         Top             =   1920
         Width           =   975
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   9
         Left            =   2160
         Locked          =   -1  'True
         TabIndex        =   406
         Text            =   "Text1"
         Top             =   1920
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   8
         Left            =   1200
         TabIndex        =   398
         Text            =   "Text1"
         Top             =   1560
         Width           =   975
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   8
         Left            =   2160
         Locked          =   -1  'True
         TabIndex        =   404
         Text            =   "Text1"
         Top             =   1560
         Width           =   3495
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   15
         Left            =   3960
         TabIndex        =   397
         Text            =   "Text1"
         Top             =   960
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   14
         Left            =   1200
         TabIndex        =   396
         Text            =   "Text1"
         Top             =   960
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   19
         Left            =   4560
         TabIndex        =   402
         Top             =   5280
         Width           =   1095
      End
      Begin MSComctlLib.ListView lwFact 
         Height          =   2775
         Left            =   1800
         TabIndex        =   400
         Top             =   2400
         Width           =   3855
         _ExtentX        =   6800
         _ExtentY        =   4895
         View            =   3
         LabelEdit       =   1
         SortOrder       =   -1  'True
         Sorted          =   -1  'True
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         Checkboxes      =   -1  'True
         FullRowSelect   =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   2
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Text            =   "Tipo"
            Object.Width           =   1411
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   1
            Text            =   "Descripción"
            Object.Width           =   4233
         EndProperty
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   36
         Left            =   120
         TabIndex        =   413
         Top             =   5400
         Width           =   2265
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Facturas"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   24
         Left            =   120
         TabIndex        =   412
         Top             =   2400
         Width           =   735
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   74
         Left            =   3120
         TabIndex        =   411
         Top             =   960
         Width           =   420
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   73
         Left            =   480
         TabIndex        =   410
         Top             =   960
         Width           =   450
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   11
         Left            =   1440
         Picture         =   "frmListado3.frx":443C
         Top             =   2400
         Width           =   240
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   10
         Left            =   1080
         Picture         =   "frmListado3.frx":4586
         Top             =   2400
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Ventas por forma de pago"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   17
         Left            =   480
         TabIndex        =   409
         Top             =   240
         Width           =   4935
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   23
         Left            =   120
         TabIndex        =   408
         Top             =   1320
         Width           =   585
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   9
         Left            =   840
         Picture         =   "frmListado3.frx":46D0
         Top             =   1920
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   72
         Left            =   360
         TabIndex        =   407
         Top             =   1920
         Width           =   420
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   8
         Left            =   840
         Picture         =   "frmListado3.frx":47D2
         Top             =   1560
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   71
         Left            =   360
         TabIndex        =   405
         Top             =   1560
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   15
         Left            =   3720
         Picture         =   "frmListado3.frx":48D4
         Top             =   960
         Width           =   240
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   14
         Left            =   960
         Picture         =   "frmListado3.frx":495F
         Top             =   960
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   22
         Left            =   120
         TabIndex        =   403
         Top             =   600
         Width           =   585
      End
   End
   Begin VB.Frame FrameGenDtoProv 
      Height          =   5655
      Left            =   2640
      TabIndex        =   608
      Top             =   0
      Width           =   6495
      Begin VB.TextBox txtDecimal 
         Alignment       =   1  'Right Justify
         Height          =   285
         Index           =   8
         Left            =   5520
         TabIndex        =   617
         Text            =   "Text3"
         Top             =   4080
         Width           =   615
      End
      Begin VB.TextBox txtDecimal 
         Alignment       =   1  'Right Justify
         Height          =   285
         Index           =   7
         Left            =   3960
         TabIndex        =   616
         Text            =   "Text3"
         Top             =   4080
         Width           =   735
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Actualiar datos existentes"
         Height          =   255
         Index           =   11
         Left            =   360
         TabIndex        =   618
         Top             =   4680
         Width           =   2415
      End
      Begin VB.TextBox txtDecimal 
         Alignment       =   1  'Right Justify
         Height          =   285
         Index           =   6
         Left            =   2280
         TabIndex        =   615
         Text            =   "Text3"
         Top             =   4080
         Width           =   735
      End
      Begin VB.CommandButton cmdGenDtoProv 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3840
         TabIndex        =   619
         Top             =   5040
         Width           =   1095
      End
      Begin VB.TextBox txtDecimal 
         Alignment       =   1  'Right Justify
         Height          =   285
         Index           =   5
         Left            =   960
         TabIndex        =   614
         Text            =   "Text3"
         Top             =   4080
         Width           =   735
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   29
         Left            =   1560
         TabIndex        =   613
         Text            =   "Text1"
         Top             =   3600
         Width           =   1095
      End
      Begin VB.TextBox txtmarca 
         Height          =   285
         Index           =   0
         Left            =   1560
         TabIndex        =   612
         Text            =   "Text1"
         Top             =   3000
         Width           =   1095
      End
      Begin VB.TextBox txtDescmarca 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   629
         Text            =   "Text5"
         Top             =   3000
         Width           =   3495
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   16
         Left            =   1560
         TabIndex        =   611
         Text            =   "Text1"
         Top             =   2400
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   16
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   627
         Text            =   "Text5"
         Top             =   2400
         Width           =   3495
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   23
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   625
         Text            =   "Text5"
         Top             =   1560
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   23
         Left            =   1560
         TabIndex        =   610
         Top             =   1560
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   22
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   622
         Text            =   "Text5"
         Top             =   1200
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   22
         Left            =   1560
         TabIndex        =   609
         Top             =   1200
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   33
         Left            =   5160
         TabIndex        =   620
         Top             =   5040
         Width           =   1095
      End
      Begin VB.Image imgAyuda 
         Height          =   255
         Index           =   5
         Left            =   3480
         ToolTipText     =   "Generar descuentos"
         Top             =   5160
         Width           =   255
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Rappel 1"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   125
         Left            =   3240
         TabIndex        =   637
         Top             =   4080
         Width           =   630
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Rappel 2"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   124
         Left            =   4800
         TabIndex        =   636
         Top             =   4080
         Width           =   630
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   16
         Left            =   240
         TabIndex        =   635
         Top             =   5280
         Width           =   2625
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Dto 2"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   123
         Left            =   1800
         TabIndex        =   634
         Top             =   4080
         Width           =   390
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Dto 1"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   122
         Left            =   360
         TabIndex        =   633
         Top             =   4080
         Width           =   390
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Fecha"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   121
         Left            =   360
         TabIndex        =   632
         Top             =   3600
         Width           =   435
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Marca"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   120
         Left            =   360
         TabIndex        =   631
         Top             =   3000
         Width           =   435
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   119
         Left            =   360
         TabIndex        =   630
         Top             =   2400
         Width           =   480
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   29
         Left            =   1320
         Picture         =   "frmListado3.frx":49EA
         Top             =   3600
         Width           =   240
      End
      Begin VB.Image imgMarca 
         Height          =   240
         Index           =   0
         Left            =   1320
         Picture         =   "frmListado3.frx":4A75
         Top             =   3000
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Valores"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   118
         Left            =   240
         TabIndex        =   628
         Top             =   2040
         Width           =   630
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   16
         Left            =   1320
         Picture         =   "frmListado3.frx":4B77
         Top             =   2400
         Width           =   240
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   23
         Left            =   1320
         Picture         =   "frmListado3.frx":4C79
         Top             =   1560
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   117
         Left            =   600
         TabIndex        =   626
         Top             =   1560
         Width           =   420
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   116
         Left            =   240
         TabIndex        =   624
         Top             =   960
         Width           =   885
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   22
         Left            =   1320
         Picture         =   "frmListado3.frx":4D7B
         Top             =   1200
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   115
         Left            =   600
         TabIndex        =   623
         Top             =   1200
         Width           =   450
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Generar descuentos proveedor"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   31
         Left            =   960
         TabIndex        =   621
         Top             =   360
         Width           =   4845
      End
   End
   Begin VB.Frame FrameTelefCuotas 
      Height          =   4455
      Left            =   3720
      TabIndex        =   920
      Top             =   120
      Visible         =   0   'False
      Width           =   6495
      Begin VB.CheckBox chkVarios 
         Caption         =   "Ordenado por cliente"
         Height          =   255
         Index           =   19
         Left            =   3480
         TabIndex        =   930
         Top             =   2520
         Width           =   2055
      End
      Begin VB.CommandButton cmdTelefoniaCuotas 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3840
         TabIndex        =   912
         Top             =   3720
         Width           =   1095
      End
      Begin VB.OptionButton optCuotasTf 
         Caption         =   "Telefonos x cuota"
         Height          =   255
         Index           =   1
         Left            =   3480
         TabIndex        =   910
         Top             =   2040
         Width           =   2535
      End
      Begin VB.OptionButton optCuotasTf 
         Caption         =   "Cuotas por telefono"
         Height          =   255
         Index           =   0
         Left            =   960
         TabIndex        =   923
         Top             =   2040
         Value           =   -1  'True
         Width           =   2295
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   25
         Left            =   1440
         TabIndex        =   922
         Text            =   "Text1"
         Top             =   1440
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   25
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   928
         Text            =   "Text1"
         Top             =   1440
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   24
         Left            =   1440
         TabIndex        =   921
         Text            =   "Text1"
         Top             =   1080
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   24
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   925
         Text            =   "Text1"
         Top             =   1080
         Width           =   3495
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   48
         Left            =   5160
         TabIndex        =   913
         Top             =   3720
         Width           =   1095
      End
      Begin MSComctlLib.ListView ListView2 
         Height          =   1695
         Index           =   1
         Left            =   120
         TabIndex        =   911
         Top             =   2520
         Width           =   3255
         _ExtentX        =   5741
         _ExtentY        =   2990
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         HideColumnHeaders=   -1  'True
         Checkboxes      =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   1
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Object.Width           =   4304
         EndProperty
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   25
         Left            =   1200
         Picture         =   "frmListado3.frx":4E7D
         Top             =   1440
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   164
         Left            =   480
         TabIndex        =   929
         Top             =   1440
         Width           =   420
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   24
         Left            =   1200
         Picture         =   "frmListado3.frx":4F7F
         Top             =   1080
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   65
         Left            =   240
         TabIndex        =   927
         Top             =   720
         Width           =   585
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   163
         Left            =   480
         TabIndex        =   926
         Top             =   1080
         Width           =   450
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Cuotas telefonía"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   44
         Left            =   840
         TabIndex        =   924
         Top             =   240
         Width           =   4485
      End
   End
   Begin VB.Frame FrameTelefonia 
      Height          =   5295
      Left            =   2040
      TabIndex        =   778
      Top             =   120
      Visible         =   0   'False
      Width           =   6495
      Begin MSComctlLib.ListView ListView2 
         Height          =   1935
         Index           =   0
         Left            =   240
         TabIndex        =   835
         Top             =   3240
         Width           =   3255
         _ExtentX        =   5741
         _ExtentY        =   3413
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         HideColumnHeaders=   -1  'True
         Checkboxes      =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   1
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Object.Width           =   4304
         EndProperty
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   43
         Left            =   4200
         TabIndex        =   783
         Text            =   "Text1"
         Top             =   2160
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   42
         Left            =   1560
         TabIndex        =   782
         Text            =   "Text1"
         Top             =   2160
         Width           =   1215
      End
      Begin VB.Frame FrameRenovacionTfno 
         BorderStyle     =   0  'None
         Caption         =   "Frame2"
         Height          =   615
         Left            =   3720
         TabIndex        =   794
         Top             =   2640
         Visible         =   0   'False
         Width           =   2175
         Begin VB.TextBox txtNumEntero 
            Height          =   285
            Index           =   3
            Left            =   1080
            TabIndex        =   786
            Text            =   "Text1"
            Top             =   90
            Width           =   735
         End
         Begin VB.Label Label3 
            Caption         =   "Meses"
            Height          =   195
            Index           =   70
            Left            =   360
            TabIndex        =   798
            Top             =   150
            Width           =   465
         End
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Renovación"
         Height          =   255
         Index           =   16
         Left            =   2040
         TabIndex        =   785
         Top             =   2760
         Width           =   1695
      End
      Begin VB.CommandButton cmdListTelefonos 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3960
         TabIndex        =   787
         Top             =   4800
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   19
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   792
         Text            =   "Text1"
         Top             =   1440
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   19
         Left            =   1440
         TabIndex        =   781
         Text            =   "Text1"
         Top             =   1440
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   18
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   789
         Text            =   "Text1"
         Top             =   1080
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   18
         Left            =   1440
         TabIndex        =   780
         Text            =   "Text1"
         Top             =   1080
         Width           =   1095
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Solo activos"
         Height          =   255
         Index           =   15
         Left            =   240
         TabIndex        =   784
         Top             =   2760
         Width           =   1455
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   41
         Left            =   5160
         TabIndex        =   788
         Top             =   4800
         Width           =   1095
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   43
         Left            =   3840
         Picture         =   "frmListado3.frx":5081
         Top             =   2160
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   69
         Left            =   3240
         TabIndex        =   797
         Top             =   2160
         Width           =   465
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha alta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   46
         Left            =   240
         TabIndex        =   796
         Top             =   1800
         Width           =   1215
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   42
         Left            =   1200
         Picture         =   "frmListado3.frx":510C
         Top             =   2160
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   68
         Left            =   600
         TabIndex        =   795
         Top             =   2160
         Width           =   465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   150
         Left            =   480
         TabIndex        =   793
         Top             =   1440
         Width           =   420
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   19
         Left            =   1200
         Picture         =   "frmListado3.frx":5197
         Top             =   1440
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   149
         Left            =   480
         TabIndex        =   791
         Top             =   1080
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   45
         Left            =   240
         TabIndex        =   790
         Top             =   720
         Width           =   585
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   18
         Left            =   1200
         Picture         =   "frmListado3.frx":5299
         Top             =   1080
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Listado de teléfonos"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   38
         Left            =   1200
         TabIndex        =   779
         Top             =   240
         Width           =   4125
      End
   End
   Begin VB.Frame FrameExportarAlmagrupo 
      Height          =   3735
      Left            =   5040
      TabIndex        =   560
      Top             =   360
      Visible         =   0   'False
      Width           =   4695
      Begin VB.Frame Frame1 
         Height          =   735
         Left            =   480
         TabIndex        =   651
         Top             =   1320
         Width           =   3975
         Begin VB.CheckBox chkVarios 
            Caption         =   "Detalla compras"
            Height          =   255
            Index           =   8
            Left            =   240
            TabIndex        =   653
            Top             =   240
            Width           =   1455
         End
         Begin VB.CheckBox chkVarios 
            Caption         =   "Datos almacen"
            Height          =   255
            Index           =   9
            Left            =   2160
            TabIndex        =   652
            Top             =   240
            Value           =   1  'Checked
            Width           =   1575
         End
      End
      Begin VB.CommandButton cmdExportAlmagrupo 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   2160
         TabIndex        =   562
         Top             =   3120
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   29
         Left            =   3360
         TabIndex        =   563
         Top             =   3120
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   55
         Left            =   240
         TabIndex        =   564
         Top             =   2520
         Width           =   3945
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Exportacion ficheros GRUPO"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   25
         Left            =   120
         TabIndex        =   561
         Top             =   360
         Width           =   4485
      End
   End
   Begin VB.Frame FrameAlmaGrupo 
      Height          =   2775
      Left            =   240
      TabIndex        =   553
      Top             =   120
      Visible         =   0   'False
      Width           =   4695
      Begin VB.CheckBox chkAlmagrupoAnual 
         Caption         =   "Dos años"
         Height          =   255
         Left            =   3480
         TabIndex        =   650
         Top             =   1200
         Width           =   1095
      End
      Begin VB.CommandButton cmdAlmaGrupo 
         Appearance      =   0  'Flat
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   2160
         TabIndex        =   559
         Top             =   2160
         Width           =   1095
      End
      Begin VB.TextBox txtAlmaGrupo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   960
         Locked          =   -1  'True
         TabIndex        =   557
         Text            =   "Text3"
         Top             =   1080
         Width           =   2415
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   28
         Left            =   3360
         TabIndex        =   554
         Top             =   2160
         Width           =   1095
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Periodo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   105
         Left            =   240
         TabIndex        =   558
         Top             =   1080
         Width           =   540
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Generación datos GRUPO"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   24
         Left            =   480
         TabIndex        =   556
         Top             =   360
         Width           =   4005
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   54
         Left            =   240
         TabIndex        =   555
         Top             =   1680
         Width           =   4185
      End
   End
   Begin VB.Frame FrameControlDirEnvio 
      Height          =   3255
      Left            =   960
      TabIndex        =   900
      Top             =   600
      Visible         =   0   'False
      Width           =   6495
      Begin VB.CommandButton cmdControDirEnv 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3960
         TabIndex        =   905
         Top             =   2640
         Width           =   1095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   53
         Left            =   3960
         TabIndex        =   904
         Text            =   "Text1"
         Top             =   2160
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   52
         Left            =   1440
         TabIndex        =   903
         Text            =   "Text1"
         Top             =   2160
         Width           =   1215
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   23
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   915
         Text            =   "Text1"
         Top             =   1440
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   23
         Left            =   1440
         TabIndex        =   902
         Text            =   "Text1"
         Top             =   1440
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   22
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   908
         Text            =   "Text1"
         Top             =   1080
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   22
         Left            =   1440
         TabIndex        =   901
         Text            =   "Text1"
         Top             =   1080
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   47
         Left            =   5160
         TabIndex        =   906
         Top             =   2640
         Width           =   1095
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   53
         Left            =   3600
         Picture         =   "frmListado3.frx":539B
         Top             =   2160
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   83
         Left            =   3120
         TabIndex        =   919
         Top             =   2160
         Width           =   465
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   52
         Left            =   1200
         Picture         =   "frmListado3.frx":5426
         Top             =   2160
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   82
         Left            =   360
         TabIndex        =   918
         Top             =   2160
         Width           =   465
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha factura"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   64
         Left            =   120
         TabIndex        =   917
         Top             =   1800
         Width           =   1155
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   162
         Left            =   480
         TabIndex        =   916
         Top             =   1440
         Width           =   420
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   23
         Left            =   1200
         Picture         =   "frmListado3.frx":54B1
         Top             =   1440
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   161
         Left            =   480
         TabIndex        =   914
         Top             =   1080
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   63
         Left            =   120
         TabIndex        =   909
         Top             =   840
         Width           =   585
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   22
         Left            =   1200
         Picture         =   "frmListado3.frx":55B3
         Top             =   1080
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Control direcciones envio albaran/factura"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   43
         Left            =   360
         TabIndex        =   907
         Top             =   240
         Width           =   6045
      End
   End
   Begin VB.Frame FrameRenovacion 
      Height          =   4695
      Left            =   480
      TabIndex        =   799
      Top             =   240
      Visible         =   0   'False
      Width           =   5775
      Begin VB.Frame FrameRenov1 
         Height          =   1815
         Index           =   0
         Left            =   240
         TabIndex        =   836
         Top             =   2280
         Width           =   5415
         Begin VB.CheckBox chkRenove 
            Alignment       =   1  'Right Justify
            Caption         =   "Internet"
            Height          =   195
            Left            =   120
            TabIndex        =   803
            Top             =   1560
            Width           =   1275
         End
         Begin VB.TextBox txtNumEntero 
            Alignment       =   1  'Right Justify
            Height          =   285
            Index           =   0
            Left            =   4440
            TabIndex        =   802
            Text            =   "Text1"
            Top             =   1080
            Width           =   735
         End
         Begin VB.TextBox txtVariosBloqueado 
            Alignment       =   1  'Right Justify
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   4
            Left            =   1200
            Locked          =   -1  'True
            TabIndex        =   843
            Text            =   "Text5"
            Top             =   1080
            Width           =   855
         End
         Begin VB.TextBox txtDescModelo 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   0
            Left            =   2040
            Locked          =   -1  'True
            TabIndex        =   841
            Text            =   "Text1"
            Top             =   600
            Width           =   3135
         End
         Begin VB.TextBox txtModelo 
            Height          =   285
            Index           =   0
            Left            =   1200
            TabIndex        =   801
            Text            =   "Text1"
            Top             =   600
            Width           =   855
         End
         Begin VB.TextBox txtFecha 
            Height          =   285
            Index           =   44
            Left            =   1200
            TabIndex        =   800
            Text            =   "Text1"
            Top             =   120
            Width           =   1215
         End
         Begin VB.TextBox txtVariosBloqueado 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   5
            Left            =   3960
            Locked          =   -1  'True
            TabIndex        =   838
            Text            =   "Text5"
            Top             =   120
            Width           =   1215
         End
         Begin VB.Label Label3 
            Alignment       =   1  'Right Justify
            Caption         =   "Puntos utlizados para renovar"
            Height          =   195
            Index           =   71
            Left            =   1920
            TabIndex        =   845
            Top             =   1080
            Width           =   2385
         End
         Begin VB.Label lblDpto 
            AutoSize        =   -1  'True
            Caption         =   "Puntos"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   51
            Left            =   120
            TabIndex        =   844
            Top             =   1080
            Width           =   495
         End
         Begin VB.Label lblDpto 
            AutoSize        =   -1  'True
            Caption         =   "Modelo"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   53
            Left            =   120
            TabIndex        =   842
            Top             =   600
            Width           =   510
         End
         Begin VB.Image imgModelo 
            Height          =   240
            Index           =   0
            Left            =   720
            Picture         =   "frmListado3.frx":56B5
            Top             =   600
            Width           =   240
         End
         Begin VB.Label lblDpto 
            AutoSize        =   -1  'True
            Caption         =   "Fecha"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   52
            Left            =   120
            TabIndex        =   840
            Top             =   120
            Width           =   435
         End
         Begin VB.Image imgFecha 
            Height          =   240
            Index           =   44
            Left            =   720
            Picture         =   "frmListado3.frx":57B7
            Top             =   120
            Width           =   240
         End
         Begin VB.Label lblDpto 
            AutoSize        =   -1  'True
            Caption         =   "Anterior"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   54
            Left            =   3240
            TabIndex        =   839
            Top             =   120
            Width           =   585
         End
      End
      Begin VB.CommandButton cmdRenovar 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3240
         TabIndex        =   805
         Top             =   4200
         Width           =   1095
      End
      Begin VB.TextBox txtVariosBloqueado 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   3
         Left            =   1320
         Locked          =   -1  'True
         TabIndex        =   815
         Text            =   "Text5"
         Top             =   1800
         Width           =   4095
      End
      Begin VB.TextBox txtVariosBloqueado 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   2
         Left            =   3720
         Locked          =   -1  'True
         TabIndex        =   813
         Text            =   "Text5"
         Top             =   1320
         Width           =   1695
      End
      Begin VB.TextBox txtVariosBloqueado 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   1
         Left            =   1320
         Locked          =   -1  'True
         TabIndex        =   812
         Text            =   "Text5"
         Top             =   1320
         Width           =   1335
      End
      Begin VB.TextBox txtVariosBloqueado 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   1320
         Locked          =   -1  'True
         TabIndex        =   808
         Text            =   "Text5"
         Top             =   840
         Width           =   4095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   42
         Left            =   4440
         TabIndex        =   806
         Top             =   4200
         Width           =   1095
      End
      Begin VB.Frame FrameRenov1 
         Height          =   1335
         Index           =   1
         Left            =   240
         TabIndex        =   837
         Top             =   2520
         Width           =   5295
         Begin VB.TextBox txtDescClie 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   20
            Left            =   1320
            Locked          =   -1  'True
            TabIndex        =   846
            Text            =   "Text1"
            Top             =   720
            Width           =   3855
         End
         Begin VB.TextBox txtCliente 
            Height          =   285
            Index           =   20
            Left            =   120
            TabIndex        =   804
            Text            =   "Text1"
            Top             =   720
            Width           =   1095
         End
         Begin VB.Label lblDpto 
            AutoSize        =   -1  'True
            Caption         =   "Cliente"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   59
            Left            =   120
            TabIndex        =   847
            Top             =   360
            Width           =   585
         End
         Begin VB.Image imgCliente 
            Height          =   240
            Index           =   20
            Left            =   720
            Picture         =   "frmListado3.frx":5842
            Top             =   360
            Width           =   240
         End
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Modelo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   50
         Left            =   360
         TabIndex        =   814
         Top             =   1800
         Width           =   510
      End
      Begin VB.Label lblDpto 
         Caption         =   "Compañia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   49
         Left            =   2880
         TabIndex        =   811
         Top             =   1320
         Width           =   840
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Teléfono"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   48
         Left            =   360
         TabIndex        =   810
         Top             =   1320
         Width           =   630
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   47
         Left            =   360
         TabIndex        =   809
         Top             =   840
         Width           =   495
      End
      Begin VB.Line Line1 
         X1              =   360
         X2              =   5520
         Y1              =   2280
         Y2              =   2280
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   39
         Left            =   840
         TabIndex        =   807
         Top             =   240
         Width           =   4125
      End
   End
   Begin MSComDlg.CommonDialog cd1 
      Left            =   120
      Top             =   7440
      _ExtentX        =   847
      _ExtentY        =   847
      _Version        =   393216
   End
   Begin VB.Frame FrameArtMasVendido 
      Height          =   4815
      Left            =   1440
      TabIndex        =   752
      Top             =   0
      Visible         =   0   'False
      Width           =   6495
      Begin VB.CommandButton cmdArtMasVendidos 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3960
         TabIndex        =   750
         Top             =   4200
         Width           =   1095
      End
      Begin VB.OptionButton optArtMasVendidos 
         Caption         =   "Importe"
         Height          =   375
         Index           =   1
         Left            =   2880
         TabIndex        =   749
         Top             =   4080
         Width           =   1455
      End
      Begin VB.OptionButton optArtMasVendidos 
         Caption         =   "Cantidad"
         Height          =   375
         Index           =   0
         Left            =   1440
         TabIndex        =   748
         Top             =   4080
         Value           =   -1  'True
         Width           =   1455
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   20
         Left            =   1440
         TabIndex        =   747
         Text            =   "Text1"
         Top             =   3600
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   20
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   765
         Text            =   "Text5"
         Top             =   3600
         Width           =   3615
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   19
         Left            =   1440
         TabIndex        =   746
         Text            =   "Text1"
         Top             =   3120
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   19
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   762
         Text            =   "Text5"
         Top             =   3120
         Width           =   3615
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   25
         Left            =   1440
         TabIndex        =   745
         Top             =   2400
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   25
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   760
         Text            =   "Text5"
         Top             =   2400
         Width           =   3615
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   24
         Left            =   1440
         TabIndex        =   744
         Top             =   1920
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   24
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   757
         Text            =   "Text5"
         Top             =   1920
         Width           =   3615
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   38
         Left            =   1440
         TabIndex        =   742
         Text            =   "Text1"
         Top             =   1080
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   39
         Left            =   3960
         TabIndex        =   743
         Text            =   "Text1"
         Top             =   1080
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   39
         Left            =   5160
         TabIndex        =   751
         Top             =   4200
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   67
         Left            =   480
         TabIndex        =   766
         Top             =   3600
         Width           =   465
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   20
         Left            =   1200
         Picture         =   "frmListado3.frx":5944
         Top             =   3600
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   66
         Left            =   480
         TabIndex        =   764
         Top             =   3120
         Width           =   465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   146
         Left            =   240
         TabIndex        =   763
         Top             =   2760
         Width           =   600
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   19
         Left            =   1200
         Picture         =   "frmListado3.frx":5A46
         Top             =   3120
         Width           =   240
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   25
         Left            =   1200
         Picture         =   "frmListado3.frx":5B48
         Top             =   2400
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   145
         Left            =   480
         TabIndex        =   761
         Top             =   2400
         Width           =   420
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   24
         Left            =   1200
         Picture         =   "frmListado3.frx":5C4A
         Top             =   1920
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   144
         Left            =   240
         TabIndex        =   759
         Top             =   1560
         Width           =   885
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   143
         Left            =   480
         TabIndex        =   758
         Top             =   1920
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   43
         Left            =   240
         TabIndex        =   756
         Top             =   720
         Width           =   585
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   38
         Left            =   1200
         Picture         =   "frmListado3.frx":5D4C
         Top             =   1095
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   142
         Left            =   600
         TabIndex        =   755
         Top             =   1080
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   39
         Left            =   3600
         Picture         =   "frmListado3.frx":5DD7
         Top             =   1095
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   141
         Left            =   3120
         TabIndex        =   754
         Top             =   1080
         Width           =   420
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Artículos más vendidos"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   36
         Left            =   1080
         TabIndex        =   753
         Top             =   240
         Width           =   4005
      End
   End
   Begin VB.Frame FrameFacturarRenting 
      Height          =   4455
      Left            =   2880
      TabIndex        =   473
      Top             =   960
      Visible         =   0   'False
      Width           =   5895
      Begin VB.TextBox txtanyo 
         Height          =   315
         Index           =   2
         Left            =   2880
         TabIndex        =   476
         Text            =   "Text2"
         Top             =   960
         Width           =   735
      End
      Begin VB.ComboBox cboMes 
         Height          =   315
         Index           =   1
         Left            =   1560
         Style           =   2  'Dropdown List
         TabIndex        =   475
         Top             =   960
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   24
         Left            =   1560
         TabIndex        =   477
         Text            =   "Esta OCULTO"
         Top             =   1440
         Width           =   1215
      End
      Begin VB.CommandButton cmdFacturarRenting 
         Appearance      =   0  'Flat
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3480
         TabIndex        =   481
         Top             =   3720
         Width           =   1095
      End
      Begin VB.Frame FrameDHRenting 
         BorderStyle     =   0  'None
         Height          =   1335
         Left            =   120
         TabIndex        =   487
         Top             =   2280
         Width           =   5655
         Begin VB.TextBox txtCliente 
            Height          =   285
            Index           =   11
            Left            =   1080
            TabIndex        =   480
            Text            =   "Text1"
            Top             =   840
            Width           =   1095
         End
         Begin VB.TextBox txtDescClie 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   11
            Left            =   2160
            Locked          =   -1  'True
            TabIndex        =   491
            Text            =   "Text1"
            Top             =   840
            Width           =   3495
         End
         Begin VB.TextBox txtCliente 
            Height          =   285
            Index           =   10
            Left            =   1080
            TabIndex        =   479
            Text            =   "Text1"
            Top             =   480
            Width           =   1095
         End
         Begin VB.TextBox txtDescClie 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   10
            Left            =   2160
            Locked          =   -1  'True
            TabIndex        =   488
            Text            =   "Text1"
            Top             =   480
            Width           =   3495
         End
         Begin VB.Image imgCliente 
            Height          =   240
            Index           =   11
            Left            =   720
            Picture         =   "frmListado3.frx":5E62
            Top             =   840
            Width           =   240
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Hasta"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   89
            Left            =   240
            TabIndex        =   492
            Top             =   840
            Width           =   420
         End
         Begin VB.Image imgCliente 
            Height          =   240
            Index           =   10
            Left            =   720
            Picture         =   "frmListado3.frx":5F64
            Top             =   480
            Width           =   240
         End
         Begin VB.Label lblDpto 
            AutoSize        =   -1  'True
            Caption         =   "Cliente"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   26
            Left            =   0
            TabIndex        =   490
            Top             =   120
            Width           =   585
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Desde"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   88
            Left            =   240
            TabIndex        =   489
            Top             =   480
            Width           =   450
         End
      End
      Begin VB.TextBox txtDescBanco 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   1920
         Locked          =   -1  'True
         TabIndex        =   486
         Text            =   "Text5"
         Top             =   1920
         Width           =   3855
      End
      Begin VB.TextBox txtBanco 
         Height          =   285
         Index           =   0
         Left            =   1200
         TabIndex        =   478
         Text            =   "Text1"
         Top             =   1920
         Width           =   615
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   17
         Left            =   4440
         TabIndex        =   483
         Text            =   "Esta OCULTO"
         Top             =   600
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   22
         Left            =   4680
         TabIndex        =   482
         Top             =   3720
         Width           =   1095
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Mes facturación"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   104
         Left            =   120
         TabIndex        =   549
         Top             =   960
         Width           =   1350
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   24
         Left            =   1320
         Picture         =   "frmListado3.frx":6066
         Top             =   1440
         Width           =   240
      End
      Begin VB.Image imgAyuda 
         Height          =   240
         Index           =   2
         Left            =   3120
         ToolTipText     =   "Facturacion Renting y servicios"
         Top             =   3840
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   47
         Left            =   240
         TabIndex        =   493
         Top             =   3840
         Width           =   2745
      End
      Begin VB.Image imgBanco 
         Height          =   240
         Index           =   0
         Left            =   840
         Picture         =   "frmListado3.frx":60F1
         Top             =   1920
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Banco"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   87
         Left            =   120
         TabIndex        =   485
         Top             =   1920
         Width           =   510
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  factura"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   25
         Left            =   120
         TabIndex        =   484
         Top             =   1440
         Width           =   1200
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   17
         Left            =   4080
         Picture         =   "frmListado3.frx":61F3
         Top             =   600
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   20
         Left            =   120
         TabIndex        =   474
         Top             =   240
         Width           =   5565
      End
   End
   Begin VB.Frame FrameComisionAgente 
      Height          =   3975
      Left            =   480
      TabIndex        =   589
      Top             =   360
      Visible         =   0   'False
      Width           =   6135
      Begin VB.OptionButton optVarios 
         Caption         =   "Fecha"
         Height          =   255
         Index           =   16
         Left            =   1800
         TabIndex        =   606
         Top             =   3480
         Width           =   1335
      End
      Begin VB.OptionButton optVarios 
         Caption         =   "Agente"
         Height          =   255
         Index           =   15
         Left            =   240
         TabIndex        =   605
         Top             =   3480
         Width           =   1335
      End
      Begin VB.CommandButton cmdListComisionAgente 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3480
         TabIndex        =   594
         Top             =   3360
         Width           =   1095
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   3
         Left            =   1080
         TabIndex        =   593
         Text            =   "186"
         Top             =   2760
         Width           =   735
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   3
         Left            =   1920
         Locked          =   -1  'True
         TabIndex        =   603
         Text            =   "Text1"
         Top             =   2760
         Width           =   3855
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   32
         Left            =   4680
         TabIndex        =   595
         Top             =   3360
         Width           =   1095
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   2
         Left            =   1080
         TabIndex        =   592
         Text            =   "186"
         Top             =   2400
         Width           =   735
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   2
         Left            =   1920
         Locked          =   -1  'True
         TabIndex        =   599
         Text            =   "Text1"
         Top             =   2400
         Width           =   3855
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   28
         Left            =   3120
         TabIndex        =   591
         Text            =   "Text1"
         Top             =   1320
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   27
         Left            =   960
         TabIndex        =   590
         Text            =   "Text1"
         Top             =   1320
         Width           =   1215
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   3
         Left            =   720
         Picture         =   "frmListado3.frx":627E
         Top             =   2760
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   114
         Left            =   120
         TabIndex        =   604
         Top             =   2760
         Width           =   420
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Agente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   33
         Left            =   120
         TabIndex        =   602
         Top             =   2040
         Width           =   615
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   32
         Left            =   120
         TabIndex        =   601
         Top             =   960
         Width           =   585
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   2
         Left            =   720
         Picture         =   "frmListado3.frx":6380
         Top             =   2400
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   113
         Left            =   120
         TabIndex        =   600
         Top             =   2400
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   28
         Left            =   2880
         Picture         =   "frmListado3.frx":6482
         Top             =   1320
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   112
         Left            =   2400
         TabIndex        =   598
         Top             =   1320
         Width           =   420
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   27
         Left            =   720
         Picture         =   "frmListado3.frx":650D
         Top             =   1320
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   111
         Left            =   120
         TabIndex        =   597
         Top             =   1320
         Width           =   450
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Listado comisiones agentes"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   29
         Left            =   960
         TabIndex        =   596
         Top             =   360
         Width           =   4005
      End
   End
   Begin VB.Frame FramePrevPagos 
      Height          =   3735
      Left            =   240
      TabIndex        =   138
      Top             =   0
      Visible         =   0   'False
      Width           =   6255
      Begin VB.CheckBox chkVarios 
         Caption         =   "Todos los datos"
         Height          =   255
         Index           =   10
         Left            =   600
         TabIndex        =   607
         Top             =   2880
         Width           =   1455
      End
      Begin VB.CommandButton cmdPrevPagos 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3600
         TabIndex        =   144
         Top             =   3120
         Width           =   1095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   1
         Left            =   3960
         TabIndex        =   143
         Text            =   "Text1"
         Top             =   2400
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   0
         Left            =   1560
         TabIndex        =   142
         Text            =   "Text1"
         Top             =   2400
         Width           =   1215
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   7
         Left            =   1440
         TabIndex        =   141
         Top             =   1560
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   7
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   149
         Text            =   "Text5"
         Top             =   1560
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   6
         Left            =   1440
         TabIndex        =   140
         Top             =   1200
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   6
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   146
         Text            =   "Text5"
         Top             =   1200
         Width           =   3495
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   7
         Left            =   4920
         TabIndex        =   145
         Top             =   3120
         Width           =   1095
      End
      Begin VB.Image imgAyuda 
         Height          =   255
         Index           =   4
         Left            =   3240
         ToolTipText     =   "Prevision pagos"
         Top             =   3240
         Width           =   255
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   17
         Left            =   120
         TabIndex        =   154
         Top             =   3360
         Width           =   3465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   22
         Left            =   3000
         TabIndex        =   153
         Top             =   2400
         Width           =   420
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   1
         Left            =   3600
         Picture         =   "frmListado3.frx":6598
         Top             =   2400
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   21
         Left            =   600
         TabIndex        =   152
         Top             =   2400
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   0
         Left            =   1200
         Picture         =   "frmListado3.frx":6623
         Top             =   2400
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   1
         Left            =   120
         TabIndex        =   151
         Top             =   2040
         Width           =   585
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   20
         Left            =   480
         TabIndex        =   150
         Top             =   1560
         Width           =   420
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   7
         Left            =   1200
         Picture         =   "frmListado3.frx":66AE
         Top             =   1560
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   18
         Left            =   480
         TabIndex        =   148
         Top             =   1200
         Width           =   450
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   6
         Left            =   1200
         Picture         =   "frmListado3.frx":67B0
         Top             =   1200
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   16
         Left            =   120
         TabIndex        =   147
         Top             =   960
         Width           =   885
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Previsión pagos de compras"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   5
         Left            =   360
         TabIndex        =   139
         Top             =   360
         Width           =   5565
      End
   End
   Begin VB.Frame FrameVtasCredito 
      Height          =   2895
      Left            =   240
      TabIndex        =   494
      Top             =   0
      Visible         =   0   'False
      Width           =   5415
      Begin VB.CommandButton cmdVtasCredito 
         Caption         =   "Aceptar"
         Height          =   375
         Left            =   2880
         TabIndex        =   497
         Top             =   2400
         Width           =   975
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   19
         Left            =   3480
         TabIndex        =   496
         Text            =   "Text1"
         Top             =   1200
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   18
         Left            =   1200
         TabIndex        =   495
         Text            =   "Text1"
         Top             =   1200
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   25
         Left            =   4080
         TabIndex        =   498
         Top             =   2400
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   48
         Left            =   120
         TabIndex        =   503
         Top             =   1800
         Width           =   4905
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   91
         Left            =   2640
         TabIndex        =   502
         Top             =   1200
         Width           =   420
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   90
         Left            =   360
         TabIndex        =   501
         Top             =   1200
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   19
         Left            =   3120
         Picture         =   "frmListado3.frx":68B2
         Top             =   1222
         Width           =   240
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   18
         Left            =   840
         Picture         =   "frmListado3.frx":693D
         Top             =   1222
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   27
         Left            =   120
         TabIndex        =   500
         Top             =   840
         Width           =   585
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Informe ventas a crédito"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   21
         Left            =   240
         TabIndex        =   499
         Top             =   360
         Width           =   4845
      End
   End
   Begin VB.Frame FramePuntoPedido 
      Height          =   3135
      Left            =   1560
      TabIndex        =   504
      Top             =   4200
      Visible         =   0   'False
      Width           =   5895
      Begin VB.CheckBox chkVarios 
         Caption         =   "Ordenado por artículo/fecha"
         Height          =   255
         Index           =   7
         Left            =   1200
         TabIndex        =   507
         Top             =   1680
         Width           =   3735
      End
      Begin VB.CommandButton cmdPuntoVenta 
         Caption         =   "Aceptar"
         Height          =   375
         Left            =   3360
         TabIndex        =   508
         Top             =   2520
         Width           =   975
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   21
         Left            =   3720
         TabIndex        =   506
         Text            =   "Text1"
         Top             =   1200
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   20
         Left            =   1200
         TabIndex        =   505
         Text            =   "Text1"
         Top             =   1200
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   26
         Left            =   4560
         TabIndex        =   509
         Top             =   2520
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   50
         Left            =   120
         TabIndex        =   514
         Top             =   2040
         Width           =   4905
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   21
         Left            =   3360
         Picture         =   "frmListado3.frx":69C8
         Top             =   1215
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   93
         Left            =   2880
         TabIndex        =   513
         Top             =   1200
         Width           =   420
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   28
         Left            =   120
         TabIndex        =   512
         Top             =   840
         Width           =   585
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   20
         Left            =   840
         Picture         =   "frmListado3.frx":6A53
         Top             =   1215
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   92
         Left            =   360
         TabIndex        =   511
         Top             =   1200
         Width           =   450
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Movimientos punto pedido"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   22
         Left            =   480
         TabIndex        =   510
         Top             =   360
         Width           =   4845
      End
   End
   Begin VB.Frame FrameIncValorCoste 
      Height          =   2175
      Left            =   120
      TabIndex        =   284
      Top             =   1440
      Visible         =   0   'False
      Width           =   5295
      Begin VB.CommandButton cmdModCoste 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   2640
         TabIndex        =   286
         Top             =   1560
         Width           =   1095
      End
      Begin VB.TextBox txtDecimal 
         Alignment       =   1  'Right Justify
         Height          =   285
         Index           =   1
         Left            =   2160
         TabIndex        =   285
         Text            =   "Text3"
         Top             =   840
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   14
         Left            =   3960
         TabIndex        =   287
         Top             =   1560
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "p.coste= precio vta  / valor margen"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   -1  'True
            Strikethrough   =   0   'False
         EndProperty
         Height          =   195
         Index           =   30
         Left            =   960
         TabIndex        =   291
         Top             =   1200
         Width           =   2625
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   29
         Left            =   240
         TabIndex        =   290
         Top             =   1680
         Width           =   2385
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Modificar coste"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   12
         Left            =   360
         TabIndex        =   289
         Top             =   240
         Width           =   4485
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Valor margen"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   49
         Left            =   720
         TabIndex        =   288
         Top             =   840
         Width           =   1140
      End
   End
   Begin VB.Frame FrameListDto 
      Height          =   3615
      Left            =   3000
      TabIndex        =   242
      Top             =   0
      Visible         =   0   'False
      Width           =   6375
      Begin VB.CheckBox chkVarios 
         Caption         =   "Dto particulares"
         Height          =   255
         Index           =   2
         Left            =   2040
         TabIndex        =   248
         Top             =   3120
         Width           =   1695
      End
      Begin VB.CommandButton cmdDescuentos 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3960
         TabIndex        =   249
         Top             =   3120
         Width           =   1095
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Mostrar descuentos"
         Height          =   255
         Index           =   1
         Left            =   120
         TabIndex        =   247
         Top             =   3120
         Width           =   1935
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   7
         Left            =   1560
         TabIndex        =   246
         Text            =   "Text1"
         Top             =   2520
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   7
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   260
         Text            =   "Text5"
         Top             =   2520
         Width           =   3495
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   6
         Left            =   1560
         TabIndex        =   245
         Text            =   "Text1"
         Top             =   2160
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   6
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   257
         Text            =   "Text5"
         Top             =   2160
         Width           =   3495
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   12
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   255
         Text            =   "Text5"
         Top             =   1440
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   12
         Left            =   1560
         TabIndex        =   244
         Top             =   1440
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   11
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   252
         Text            =   "Text5"
         Top             =   1080
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   11
         Left            =   1560
         TabIndex        =   243
         Top             =   1080
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   12
         Left            =   5160
         TabIndex        =   250
         Top             =   3120
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   25
         Left            =   600
         TabIndex        =   261
         Top             =   2520
         Width           =   465
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   7
         Left            =   1320
         Picture         =   "frmListado3.frx":6ADE
         Top             =   2520
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   24
         Left            =   600
         TabIndex        =   259
         Top             =   2160
         Width           =   465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   45
         Left            =   240
         TabIndex        =   258
         Top             =   1920
         Width           =   600
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   6
         Left            =   1320
         Picture         =   "frmListado3.frx":6BE0
         Top             =   2160
         Width           =   240
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   12
         Left            =   1320
         Picture         =   "frmListado3.frx":6CE2
         Top             =   1440
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   44
         Left            =   600
         TabIndex        =   256
         Top             =   1440
         Width           =   420
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   43
         Left            =   240
         TabIndex        =   254
         Top             =   840
         Width           =   885
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   11
         Left            =   1320
         Picture         =   "frmListado3.frx":6DE4
         Top             =   1080
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   42
         Left            =   600
         TabIndex        =   253
         Top             =   1080
         Width           =   450
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Listado familias / descuentos"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   10
         Left            =   240
         TabIndex        =   251
         Top             =   240
         Width           =   4845
      End
   End
   Begin VB.Frame FramePrevision 
      Height          =   4695
      Left            =   120
      TabIndex        =   11
      Top             =   0
      Width           =   6975
      Begin VB.CommandButton cmdBanco 
         Height          =   375
         Index           =   1
         Left            =   1320
         Picture         =   "frmListado3.frx":6EE6
         Style           =   1  'Graphical
         TabIndex        =   283
         ToolTipText     =   "Modificar"
         Top             =   1560
         Width           =   375
      End
      Begin VB.CommandButton cmdBanco 
         Height          =   375
         Index           =   2
         Left            =   1800
         Picture         =   "frmListado3.frx":7470
         Style           =   1  'Graphical
         TabIndex        =   282
         ToolTipText     =   "Eliminar"
         Top             =   1560
         Width           =   375
      End
      Begin VB.CommandButton cmdPrevision 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   4320
         TabIndex        =   18
         Top             =   4200
         Width           =   1095
      End
      Begin VB.OptionButton optPrevision 
         Caption         =   "2ª quincena"
         Height          =   195
         Index           =   1
         Left            =   5280
         TabIndex        =   16
         Top             =   1080
         Width           =   1215
      End
      Begin VB.OptionButton optPrevision 
         Caption         =   "1ª quincena"
         Height          =   195
         Index           =   0
         Left            =   3600
         TabIndex        =   15
         Top             =   1080
         Value           =   -1  'True
         Width           =   1215
      End
      Begin VB.ComboBox cboMes 
         Height          =   315
         Index           =   0
         Left            =   1560
         Style           =   2  'Dropdown List
         TabIndex        =   14
         Top             =   1080
         Width           =   1215
      End
      Begin VB.TextBox txtanyo 
         Height          =   315
         Index           =   0
         Left            =   240
         TabIndex        =   13
         Text            =   "Text2"
         Top             =   1080
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   1
         Left            =   5640
         TabIndex        =   19
         Top             =   4200
         Width           =   1095
      End
      Begin MSComctlLib.ListView ListView1 
         Height          =   2175
         Index           =   3
         Left            =   240
         TabIndex        =   17
         Top             =   1920
         Width           =   6495
         _ExtentX        =   11456
         _ExtentY        =   3836
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         FullRowSelect   =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   3
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Text            =   "Cuenta"
            Object.Width           =   2187
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   1
            Text            =   "Descripcion"
            Object.Width           =   5186
         EndProperty
         BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   2
            Text            =   "Saldo"
            Object.Width           =   2540
         EndProperty
      End
      Begin VB.Label Label3 
         Caption         =   "Saldo bancos"
         Height          =   195
         Index           =   28
         Left            =   240
         TabIndex        =   281
         Top             =   1680
         Width           =   1185
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   4
         Left            =   360
         TabIndex        =   22
         Top             =   4200
         Width           =   3705
      End
      Begin VB.Label Label3 
         Caption         =   "Mes"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   195
         Index           =   3
         Left            =   1560
         TabIndex        =   21
         Top             =   840
         Width           =   705
      End
      Begin VB.Label Label3 
         Caption         =   "Año"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   195
         Index           =   2
         Left            =   240
         TabIndex        =   20
         Top             =   840
         Width           =   705
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Informe previsión tesorería"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   0
         Left            =   1200
         TabIndex        =   12
         Top             =   240
         Width           =   4485
      End
   End
   Begin VB.Frame FrameCliVar 
      Height          =   3375
      Left            =   1920
      TabIndex        =   303
      Top             =   0
      Visible         =   0   'False
      Width           =   4815
      Begin VB.Frame FrameOrden2 
         BorderStyle     =   0  'None
         Caption         =   "Frame1"
         Height          =   375
         Left            =   240
         TabIndex        =   308
         Top             =   2400
         Width           =   3855
         Begin VB.OptionButton optVarios 
            Caption         =   "NIF"
            Height          =   195
            Index           =   5
            Left            =   960
            TabIndex        =   311
            Top             =   120
            Width           =   1335
         End
         Begin VB.OptionButton optVarios 
            Caption         =   "Nombre"
            Height          =   195
            Index           =   4
            Left            =   2640
            TabIndex        =   310
            Top             =   120
            Value           =   -1  'True
            Width           =   975
         End
         Begin VB.Label lblDpto 
            AutoSize        =   -1  'True
            Caption         =   "Orden2"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   13
            Left            =   0
            TabIndex        =   312
            Top             =   120
            Width           =   615
         End
      End
      Begin VB.TextBox txtNumEntero 
         BackColor       =   &H00FFFFFF&
         Height          =   285
         Index           =   2
         Left            =   3240
         TabIndex        =   297
         Text            =   "Text1"
         Top             =   1440
         Width           =   1095
      End
      Begin VB.TextBox txtNumEntero 
         BackColor       =   &H00FFFFFF&
         Height          =   285
         Index           =   1
         Left            =   1320
         TabIndex        =   296
         Text            =   "Text1"
         Top             =   1440
         Width           =   1095
      End
      Begin VB.OptionButton optVarios 
         Caption         =   "NIF"
         Height          =   195
         Index           =   2
         Left            =   2880
         TabIndex        =   299
         Top             =   2040
         Width           =   975
      End
      Begin VB.OptionButton optVarios 
         Caption         =   "Poblacion"
         Height          =   195
         Index           =   3
         Left            =   1200
         TabIndex        =   298
         Top             =   2040
         Value           =   -1  'True
         Width           =   1335
      End
      Begin VB.CommandButton cmdClivaarios 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   2160
         TabIndex        =   300
         Top             =   2880
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   15
         Left            =   3480
         TabIndex        =   301
         Top             =   2880
         Width           =   1095
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Orden1"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   12
         Left            =   240
         TabIndex        =   309
         Top             =   2040
         Width           =   615
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   52
         Left            =   2760
         TabIndex        =   307
         Top             =   1440
         Width           =   420
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   51
         Left            =   600
         TabIndex        =   306
         Top             =   1440
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Código postal"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   11
         Left            =   240
         TabIndex        =   305
         Top             =   1080
         Width           =   1140
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Listado clientes varios"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   13
         Left            =   1080
         TabIndex        =   304
         Top             =   360
         Width           =   3105
      End
   End
   Begin VB.Frame frmStockMeses 
      Height          =   4575
      Left            =   240
      TabIndex        =   43
      Top             =   0
      Visible         =   0   'False
      Width           =   6495
      Begin VB.CheckBox chkVarios 
         Caption         =   "Utilizar precio articulo"
         Height          =   255
         Index           =   5
         Left            =   4320
         TabIndex        =   52
         Top             =   3360
         Width           =   1815
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Incluir art. varios"
         Height          =   255
         Index           =   4
         Left            =   2520
         TabIndex        =   51
         Top             =   3360
         Width           =   1695
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Regulariza stocks"
         Height          =   255
         Index           =   3
         Left            =   600
         TabIndex        =   50
         Top             =   3360
         Width           =   1815
      End
      Begin VB.TextBox txtDecimal 
         Alignment       =   1  'Right Justify
         Height          =   285
         Index           =   2
         Left            =   4800
         TabIndex        =   49
         Text            =   "Text3"
         Top             =   2880
         Width           =   1215
      End
      Begin VB.CommandButton cmdStockMes 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3840
         TabIndex        =   53
         Top             =   3960
         Width           =   1095
      End
      Begin VB.TextBox txtanyo 
         Height          =   315
         Index           =   1
         Left            =   1560
         TabIndex        =   48
         Text            =   "Text2"
         Top             =   2880
         Width           =   1095
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   1
         Left            =   1560
         TabIndex        =   47
         Top             =   2160
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   1
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   59
         Text            =   "Text5"
         Top             =   2160
         Width           =   3495
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   57
         Text            =   "Text5"
         Top             =   1800
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   0
         Left            =   1560
         TabIndex        =   46
         Top             =   1800
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   4
         Left            =   5160
         TabIndex        =   54
         Top             =   3960
         Width           =   1095
      End
      Begin VB.TextBox txtDescAlma 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   1
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   55
         Text            =   "Text5"
         Top             =   960
         Width           =   3495
      End
      Begin VB.TextBox txtAlma 
         Height          =   285
         Index           =   1
         Left            =   1560
         TabIndex        =   45
         Text            =   "Text1"
         Top             =   960
         Width           =   1095
      End
      Begin VB.Image imgAyuda 
         Height          =   255
         Index           =   1
         Left            =   240
         ToolTipText     =   "Regulariza stock"
         Top             =   3360
         Width           =   255
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Importe mínimo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   50
         Left            =   3120
         TabIndex        =   292
         Top             =   2880
         Width           =   1380
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   4
         Left            =   480
         TabIndex        =   63
         Top             =   2160
         Width           =   420
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   6
         Left            =   240
         TabIndex        =   62
         Top             =   4080
         Width           =   3585
      End
      Begin VB.Label Label3 
         Caption         =   "Año"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   5
         Left            =   240
         TabIndex        =   61
         Top             =   2880
         Width           =   705
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Almacén"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   3
         Left            =   240
         TabIndex        =   60
         Top             =   960
         Width           =   735
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   1
         Left            =   1320
         Picture         =   "frmListado3.frx":75BA
         Top             =   2160
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   17
         Left            =   240
         TabIndex        =   58
         Top             =   1440
         Width           =   885
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   0
         Left            =   1320
         Picture         =   "frmListado3.frx":76BC
         Top             =   1800
         Width           =   240
      End
      Begin VB.Image imgAlma 
         Height          =   240
         Index           =   1
         Left            =   1320
         Picture         =   "frmListado3.frx":77BE
         Top             =   960
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   2
         Left            =   480
         TabIndex        =   56
         Top             =   1800
         Width           =   450
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Stocks por meses"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   2
         Left            =   720
         TabIndex        =   44
         Top             =   360
         Width           =   4845
      End
   End
   Begin VB.Frame FrameComprDtoActiv 
      Height          =   3735
      Left            =   120
      TabIndex        =   262
      Top             =   0
      Visible         =   0   'False
      Width           =   6975
      Begin VB.CommandButton cmdControlDtoActiv 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   4080
         TabIndex        =   267
         Top             =   3120
         Width           =   1095
      End
      Begin VB.TextBox txtcodactiv 
         Height          =   285
         Index           =   1
         Left            =   1560
         TabIndex        =   266
         Text            =   "Text1"
         Top             =   2520
         Width           =   975
      End
      Begin VB.TextBox txtDescActiv 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   1
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   278
         Text            =   "Text5"
         Top             =   2520
         Width           =   3615
      End
      Begin VB.TextBox txtcodactiv 
         Height          =   285
         Index           =   0
         Left            =   1560
         TabIndex        =   265
         Text            =   "Text1"
         Top             =   2160
         Width           =   975
      End
      Begin VB.TextBox txtDescActiv 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   275
         Text            =   "Text5"
         Top             =   2160
         Width           =   3615
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   3
         Left            =   1560
         TabIndex        =   264
         Text            =   "Text1"
         Top             =   1440
         Width           =   1335
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   3
         Left            =   3000
         Locked          =   -1  'True
         TabIndex        =   273
         Text            =   "Text1"
         Top             =   1440
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   2
         Left            =   1560
         TabIndex        =   263
         Text            =   "Text1"
         Top             =   1080
         Width           =   1335
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   2
         Left            =   3000
         Locked          =   -1  'True
         TabIndex        =   270
         Text            =   "Text1"
         Top             =   1080
         Width           =   3495
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   13
         Left            =   5400
         TabIndex        =   268
         Top             =   3120
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   27
         Left            =   120
         TabIndex        =   280
         Top             =   3360
         Width           =   3465
      End
      Begin VB.Image imgActividad 
         Height          =   240
         Index           =   1
         Left            =   1320
         Picture         =   "frmListado3.frx":78C0
         Top             =   2520
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   26
         Left            =   480
         TabIndex        =   279
         Top             =   2520
         Width           =   465
      End
      Begin VB.Image imgActividad 
         Height          =   240
         Index           =   0
         Left            =   1320
         Picture         =   "frmListado3.frx":79C2
         Top             =   2160
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Actividad"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   48
         Left            =   120
         TabIndex        =   277
         Top             =   1800
         Width           =   795
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   116
         Left            =   480
         TabIndex        =   276
         Top             =   2160
         Width           =   465
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   3
         Left            =   1320
         Picture         =   "frmListado3.frx":7AC4
         Top             =   1440
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   47
         Left            =   600
         TabIndex        =   274
         Top             =   1440
         Width           =   420
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   2
         Left            =   1320
         Picture         =   "frmListado3.frx":7BC6
         Top             =   1080
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   10
         Left            =   240
         TabIndex        =   272
         Top             =   720
         Width           =   585
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   46
         Left            =   600
         TabIndex        =   271
         Top             =   1080
         Width           =   450
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Control descuentos cliente / actividad"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   11
         Left            =   870
         TabIndex        =   269
         Top             =   240
         Width           =   5265
      End
   End
   Begin VB.Frame FramePregunta 
      Height          =   3975
      Left            =   120
      TabIndex        =   4
      Top             =   0
      Width           =   5295
      Begin VB.TextBox Text1 
         Height          =   1335
         Left            =   1320
         TabIndex        =   1
         Text            =   "Text1"
         Top             =   1920
         Width           =   3735
      End
      Begin VB.TextBox txtNombre 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   1
         Left            =   1320
         Locked          =   -1  'True
         TabIndex        =   7
         Text            =   "Text5"
         Top             =   1440
         Width           =   3735
      End
      Begin VB.TextBox txtNombre 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   1320
         Locked          =   -1  'True
         TabIndex        =   6
         Text            =   "Text5"
         Top             =   960
         Width           =   3735
      End
      Begin VB.CommandButton cmdLogModPrecioDto 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   2640
         TabIndex        =   2
         Top             =   3360
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   0
         Left            =   3960
         TabIndex        =   3
         Top             =   3360
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "Motivo"
         Height          =   195
         Index           =   1
         Left            =   240
         TabIndex        =   10
         Top             =   1920
         Width           =   585
      End
      Begin VB.Label Label3 
         Caption         =   "Documento"
         Height          =   195
         Index           =   0
         Left            =   240
         TabIndex        =   9
         Top             =   1440
         Width           =   825
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   49
         Left            =   240
         TabIndex        =   8
         Top             =   960
         Width           =   465
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Motivo cambio precio / dto"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   30
         Left            =   360
         TabIndex        =   5
         Top             =   360
         Width           =   4485
      End
   End
   Begin VB.Frame FramePrecioCompraProvArt 
      Height          =   6615
      Left            =   120
      TabIndex        =   183
      Top             =   0
      Visible         =   0   'False
      Width           =   5895
      Begin VB.CommandButton cmdRegresaPrecio 
         Caption         =   "&Regresar"
         Height          =   375
         Left            =   3240
         TabIndex        =   187
         Top             =   6000
         Width           =   1095
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   5
         Left            =   1800
         Locked          =   -1  'True
         TabIndex        =   192
         Text            =   "Text5"
         Top             =   1680
         Width           =   3255
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   5
         Left            =   240
         MaxLength       =   16
         TabIndex        =   185
         Top             =   1680
         Width           =   1455
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   8
         Left            =   240
         TabIndex        =   184
         Top             =   960
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   8
         Left            =   1440
         Locked          =   -1  'True
         TabIndex        =   190
         Text            =   "Text5"
         Top             =   960
         Width           =   3615
      End
      Begin MSComctlLib.ListView lwPrecUC 
         Height          =   3735
         Left            =   240
         TabIndex        =   186
         Top             =   2160
         Width           =   5415
         _ExtentX        =   9551
         _ExtentY        =   6588
         SortKey         =   5
         View            =   3
         LabelEdit       =   1
         SortOrder       =   -1  'True
         Sorted          =   -1  'True
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         FullRowSelect   =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   6
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Text            =   "Tipo"
            Object.Width           =   1235
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   1
            Text            =   "Documento"
            Object.Width           =   2469
         EndProperty
         BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   2
            Text            =   "Fecha"
            Object.Width           =   1940
         EndProperty
         BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   3
            Text            =   "Cant."
            Object.Width           =   1058
         EndProperty
         BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   4
            Text            =   "Precio"
            Object.Width           =   2187
         EndProperty
         BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   5
            Text            =   "FechaOculta"
            Object.Width           =   0
         EndProperty
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   10
         Left            =   4440
         TabIndex        =   188
         Top             =   6000
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   20
         Left            =   240
         TabIndex        =   194
         Top             =   6000
         Width           =   1545
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Artículo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   28
         Left            =   240
         TabIndex        =   193
         Top             =   1440
         Width           =   660
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   5
         Left            =   960
         Picture         =   "frmListado3.frx":7CC8
         Top             =   1440
         Width           =   240
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   8
         Left            =   1200
         Picture         =   "frmListado3.frx":7DCA
         Top             =   720
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   27
         Left            =   240
         TabIndex        =   191
         Top             =   720
         Width           =   885
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Precio compra artículo"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   8
         Left            =   120
         TabIndex        =   189
         Top             =   240
         Width           =   4845
      End
   End
   Begin VB.Frame FrameFlotas 
      Height          =   8055
      Left            =   3000
      TabIndex        =   565
      Top             =   0
      Visible         =   0   'False
      Width           =   6495
      Begin VB.TextBox txtDescVehiculo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   2280
         Locked          =   -1  'True
         TabIndex        =   588
         Text            =   "Text5"
         Top             =   2280
         Width           =   3615
      End
      Begin VB.TextBox txtVehiculo 
         Height          =   285
         Index           =   0
         Left            =   720
         TabIndex        =   587
         Text            =   "Text3"
         Top             =   2280
         Width           =   1335
      End
      Begin VB.OptionButton optVarios 
         Caption         =   "Incidencia"
         Height          =   195
         Index           =   14
         Left            =   2640
         TabIndex        =   576
         Top             =   6960
         Width           =   1335
      End
      Begin VB.OptionButton optVarios 
         Caption         =   "Vehículo"
         Height          =   195
         Index           =   13
         Left            =   1200
         TabIndex        =   575
         Top             =   6960
         Width           =   1335
      End
      Begin VB.CommandButton cmdFlotas 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3840
         TabIndex        =   574
         Top             =   7560
         Width           =   1095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   26
         Left            =   3240
         TabIndex        =   572
         Text            =   "Text1"
         Top             =   1080
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   25
         Left            =   960
         TabIndex        =   570
         Text            =   "Text1"
         Top             =   1080
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   30
         Left            =   5160
         TabIndex        =   566
         Top             =   7560
         Width           =   1095
      End
      Begin MSComctlLib.ListView ListView1 
         Height          =   3615
         Index           =   4
         Left            =   240
         TabIndex        =   568
         Top             =   3240
         Width           =   6015
         _ExtentX        =   10610
         _ExtentY        =   6376
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         Checkboxes      =   -1  'True
         FullRowSelect   =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   2
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Text            =   "Descripcion"
            Object.Width           =   9243
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   1
            Text            =   "Resumido(para el listado)"
            Object.Width           =   0
         EndProperty
      End
      Begin VB.Image imgVehiculo 
         Height          =   240
         Index           =   0
         Left            =   960
         Picture         =   "frmListado3.frx":7ECC
         Top             =   1920
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Vehiculo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   31
         Left            =   240
         TabIndex        =   586
         Top             =   1920
         Width           =   705
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   56
         Left            =   240
         TabIndex        =   578
         Top             =   7560
         Width           =   3465
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Orden"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   30
         Left            =   240
         TabIndex        =   577
         Top             =   6960
         Width           =   510
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   109
         Left            =   2520
         TabIndex        =   573
         Top             =   1080
         Width           =   420
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   26
         Left            =   3000
         Picture         =   "frmListado3.frx":7FCE
         Top             =   1080
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   108
         Left            =   240
         TabIndex        =   571
         Top             =   1080
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   25
         Left            =   720
         Picture         =   "frmListado3.frx":8059
         Top             =   1080
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Incidencias"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   29
         Left            =   240
         TabIndex        =   569
         Top             =   3000
         Width           =   960
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   13
         Left            =   1680
         Picture         =   "frmListado3.frx":80E4
         Top             =   2880
         Width           =   240
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   12
         Left            =   1320
         Picture         =   "frmListado3.frx":822E
         Top             =   2880
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Informes registro flotas"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   27
         Left            =   960
         TabIndex        =   567
         Top             =   360
         Width           =   4485
      End
   End
   Begin VB.Frame FrameVtasArticulo 
      Height          =   6255
      Left            =   3840
      TabIndex        =   351
      Top             =   240
      Visible         =   0   'False
      Width           =   6375
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   5
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   388
         Text            =   "Text1"
         Top             =   5160
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   5
         Left            =   1440
         TabIndex        =   361
         Text            =   "Text1"
         Top             =   5160
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   4
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   385
         Text            =   "Text1"
         Top             =   4800
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   4
         Left            =   1440
         TabIndex        =   360
         Text            =   "Text1"
         Top             =   4800
         Width           =   1095
      End
      Begin VB.OptionButton optVarios 
         Caption         =   "Artículo / cliente"
         Height          =   255
         Index           =   9
         Left            =   2040
         TabIndex        =   363
         Top             =   5760
         Width           =   1695
      End
      Begin VB.OptionButton optVarios 
         Caption         =   "Cliente / artículo"
         Height          =   255
         Index           =   8
         Left            =   240
         TabIndex        =   362
         Top             =   5760
         Value           =   -1  'True
         Width           =   1575
      End
      Begin VB.CommandButton cmdArtixFactura 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   4080
         TabIndex        =   364
         Top             =   5760
         Width           =   975
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   15
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   381
         Text            =   "Text5"
         Top             =   4200
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   15
         Left            =   1440
         TabIndex        =   359
         Top             =   4200
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   14
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   377
         Text            =   "Text5"
         Top             =   3840
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   14
         Left            =   1440
         TabIndex        =   358
         Top             =   3840
         Width           =   1095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   13
         Left            =   3840
         TabIndex        =   357
         Text            =   "Text1"
         Top             =   3240
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   12
         Left            =   1440
         TabIndex        =   356
         Text            =   "Text1"
         Top             =   3240
         Width           =   1215
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   9
         Left            =   1440
         TabIndex        =   355
         Text            =   "Text1"
         Top             =   2640
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   9
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   375
         Text            =   "Text5"
         Top             =   2640
         Width           =   3495
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   8
         Left            =   1440
         TabIndex        =   354
         Text            =   "Text1"
         Top             =   2280
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   8
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   372
         Text            =   "Text5"
         Top             =   2280
         Width           =   3495
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   8
         Left            =   1440
         MaxLength       =   16
         TabIndex        =   353
         Top             =   1560
         Width           =   1455
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   8
         Left            =   2880
         Locked          =   -1  'True
         TabIndex        =   370
         Text            =   "Text5"
         Top             =   1560
         Width           =   3255
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   7
         Left            =   1440
         MaxLength       =   16
         TabIndex        =   352
         Top             =   1200
         Width           =   1455
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   7
         Left            =   2880
         Locked          =   -1  'True
         TabIndex        =   367
         Text            =   "Text5"
         Top             =   1200
         Width           =   3255
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   18
         Left            =   5160
         TabIndex        =   365
         Top             =   5760
         Width           =   1095
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   68
         Left            =   480
         TabIndex        =   389
         Top             =   5160
         Width           =   420
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   5
         Left            =   1200
         Picture         =   "frmListado3.frx":8378
         Top             =   5160
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   67
         Left            =   480
         TabIndex        =   387
         Top             =   4800
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   20
         Left            =   120
         TabIndex        =   386
         Top             =   4560
         Width           =   585
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   4
         Left            =   1200
         Picture         =   "frmListado3.frx":847A
         Top             =   4800
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   66
         Left            =   3120
         TabIndex        =   384
         Top             =   3240
         Width           =   420
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   65
         Left            =   480
         TabIndex        =   383
         Top             =   3240
         Width           =   450
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   15
         Left            =   1200
         Picture         =   "frmListado3.frx":857C
         Top             =   4200
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   64
         Left            =   480
         TabIndex        =   382
         Top             =   4200
         Width           =   420
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Fechas"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   63
         Left            =   120
         TabIndex        =   380
         Top             =   3000
         Width           =   585
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   62
         Left            =   120
         TabIndex        =   379
         Top             =   3600
         Width           =   885
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   14
         Left            =   1200
         Picture         =   "frmListado3.frx":867E
         Top             =   3840
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   61
         Left            =   480
         TabIndex        =   378
         Top             =   3840
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   13
         Left            =   3600
         Picture         =   "frmListado3.frx":8780
         Top             =   3240
         Width           =   240
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   12
         Left            =   1200
         Picture         =   "frmListado3.frx":880B
         Top             =   3240
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   35
         Left            =   480
         TabIndex        =   376
         Top             =   2640
         Width           =   465
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   9
         Left            =   1200
         Picture         =   "frmListado3.frx":8896
         Top             =   2640
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   34
         Left            =   480
         TabIndex        =   374
         Top             =   2280
         Width           =   465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   60
         Left            =   120
         TabIndex        =   373
         Top             =   2040
         Width           =   600
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   8
         Left            =   1200
         Picture         =   "frmListado3.frx":8998
         Top             =   2280
         Width           =   240
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   8
         Left            =   1200
         Picture         =   "frmListado3.frx":8A9A
         Top             =   1560
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   33
         Left            =   480
         TabIndex        =   371
         Top             =   1560
         Width           =   465
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   7
         Left            =   1200
         Picture         =   "frmListado3.frx":8B9C
         Top             =   1200
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Artículo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   59
         Left            =   120
         TabIndex        =   369
         Top             =   960
         Width           =   660
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   32
         Left            =   480
         TabIndex        =   368
         Top             =   1200
         Width           =   465
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Artículos / Factura"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   16
         Left            =   480
         TabIndex        =   366
         Top             =   360
         Width           =   4845
      End
   End
   Begin VB.Frame frameRecalPMP 
      Height          =   4575
      Left            =   600
      TabIndex        =   414
      Top             =   0
      Width           =   6495
      Begin VB.CommandButton cmdRecalPMP 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3840
         TabIndex        =   421
         Top             =   3960
         Width           =   1095
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   10
         Left            =   2880
         Locked          =   -1  'True
         TabIndex        =   437
         Text            =   "Text5"
         Top             =   1560
         Width           =   3255
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   10
         Left            =   1440
         MaxLength       =   16
         TabIndex        =   416
         Top             =   1560
         Width           =   1455
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   9
         Left            =   2880
         Locked          =   -1  'True
         TabIndex        =   434
         Text            =   "Text5"
         Top             =   1200
         Width           =   3255
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   9
         Left            =   1440
         MaxLength       =   16
         TabIndex        =   415
         Top             =   1200
         Width           =   1455
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   11
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   432
         Text            =   "Text5"
         Top             =   2520
         Width           =   3495
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   11
         Left            =   1560
         TabIndex        =   418
         Text            =   "Text1"
         Top             =   2520
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   10
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   429
         Text            =   "Text5"
         Top             =   2160
         Width           =   3495
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   10
         Left            =   1560
         TabIndex        =   417
         Text            =   "Text1"
         Top             =   2160
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   17
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   427
         Text            =   "Text5"
         Top             =   3480
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   17
         Left            =   1560
         TabIndex        =   420
         Top             =   3480
         Width           =   1095
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   16
         Left            =   1560
         TabIndex        =   419
         Top             =   3120
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   16
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   424
         Text            =   "Text5"
         Top             =   3120
         Width           =   3495
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   20
         Left            =   5160
         TabIndex        =   422
         Top             =   3960
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   41
         Left            =   360
         TabIndex        =   439
         Top             =   4080
         Width           =   3465
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   40
         Left            =   480
         TabIndex        =   438
         Top             =   1560
         Width           =   465
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   10
         Left            =   1200
         Picture         =   "frmListado3.frx":8C9E
         Top             =   1560
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   39
         Left            =   480
         TabIndex        =   436
         Top             =   1200
         Width           =   465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Artículo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   79
         Left            =   120
         TabIndex        =   435
         Top             =   960
         Width           =   660
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   9
         Left            =   1200
         Picture         =   "frmListado3.frx":8DA0
         Top             =   1200
         Width           =   240
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   11
         Left            =   1320
         Picture         =   "frmListado3.frx":8EA2
         Top             =   2520
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   38
         Left            =   600
         TabIndex        =   433
         Top             =   2520
         Width           =   465
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   10
         Left            =   1320
         Picture         =   "frmListado3.frx":8FA4
         Top             =   2160
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   78
         Left            =   240
         TabIndex        =   431
         Top             =   1920
         Width           =   600
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   37
         Left            =   600
         TabIndex        =   430
         Top             =   2160
         Width           =   465
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   17
         Left            =   1320
         Picture         =   "frmListado3.frx":90A6
         Top             =   3480
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   77
         Left            =   600
         TabIndex        =   428
         Top             =   3480
         Width           =   420
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   76
         Left            =   600
         TabIndex        =   426
         Top             =   3120
         Width           =   450
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   16
         Left            =   1320
         Picture         =   "frmListado3.frx":91A8
         Top             =   3120
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   75
         Left            =   240
         TabIndex        =   425
         Top             =   2880
         Width           =   885
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Recálculo precio medio ponderado"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   18
         Left            =   450
         TabIndex        =   423
         Top             =   360
         Width           =   5715
      End
   End
   Begin VB.Frame FrameModEstaVta 
      Height          =   6375
      Left            =   600
      TabIndex        =   195
      Top             =   0
      Visible         =   0   'False
      Width           =   6735
      Begin VB.Frame FrameMoDVtaArt 
         Caption         =   "Frame1"
         Height          =   2535
         Index           =   1
         Left            =   120
         TabIndex        =   213
         Top             =   3120
         Visible         =   0   'False
         Width           =   6375
         Begin VB.CheckBox chkVarios 
            Caption         =   "Aplica  rappels"
            Height          =   255
            Index           =   6
            Left            =   4800
            TabIndex        =   293
            Top             =   2160
            Width           =   1455
         End
         Begin VB.OptionButton optModCostVta 
            Caption         =   "U.P.C."
            Height          =   195
            Index           =   0
            Left            =   240
            TabIndex        =   302
            Top             =   2160
            Width           =   975
         End
         Begin VB.OptionButton optModCostVta 
            Caption         =   "P.St."
            Height          =   195
            Index           =   1
            Left            =   1440
            TabIndex        =   295
            Top             =   2160
            Width           =   975
         End
         Begin VB.OptionButton optModCostVta 
            Caption         =   "P.M.P"
            Height          =   195
            Index           =   2
            Left            =   2520
            TabIndex        =   294
            Top             =   2160
            Value           =   -1  'True
            Width           =   975
         End
         Begin VB.TextBox txtFamia 
            Height          =   285
            Index           =   5
            Left            =   1440
            TabIndex        =   209
            Text            =   "Text1"
            Top             =   1680
            Width           =   1095
         End
         Begin VB.TextBox txtDescFamia 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   5
            Left            =   2760
            Locked          =   -1  'True
            TabIndex        =   239
            Text            =   "Text5"
            Top             =   1680
            Width           =   3495
         End
         Begin VB.TextBox txtFamia 
            Height          =   285
            Index           =   4
            Left            =   1440
            TabIndex        =   208
            Text            =   "Text1"
            Top             =   1320
            Width           =   1095
         End
         Begin VB.TextBox txtDescFamia 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   4
            Left            =   2760
            Locked          =   -1  'True
            TabIndex        =   236
            Text            =   "Text5"
            Top             =   1320
            Width           =   3495
         End
         Begin VB.TextBox txtDescProve 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   10
            Left            =   2760
            Locked          =   -1  'True
            TabIndex        =   234
            Text            =   "Text5"
            Top             =   720
            Width           =   3495
         End
         Begin VB.TextBox txtCodProve 
            Height          =   285
            Index           =   10
            Left            =   1440
            TabIndex        =   207
            Top             =   720
            Width           =   1095
         End
         Begin VB.TextBox txtDescProve 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   9
            Left            =   2760
            Locked          =   -1  'True
            TabIndex        =   231
            Text            =   "Text5"
            Top             =   360
            Width           =   3495
         End
         Begin VB.TextBox txtCodProve 
            Height          =   285
            Index           =   9
            Left            =   1440
            TabIndex        =   206
            Top             =   360
            Width           =   1095
         End
         Begin VB.Label Label3 
            Caption         =   "Hasta"
            Height          =   195
            Index           =   22
            Left            =   480
            TabIndex        =   240
            Top             =   1680
            Width           =   465
         End
         Begin VB.Image imgFamilia 
            Height          =   240
            Index           =   5
            Left            =   1200
            Picture         =   "frmListado3.frx":92AA
            Top             =   1680
            Width           =   240
         End
         Begin VB.Label Label3 
            Caption         =   "Desde"
            Height          =   195
            Index           =   21
            Left            =   480
            TabIndex        =   238
            Top             =   1320
            Width           =   465
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Familia"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   41
            Left            =   120
            TabIndex        =   237
            Top             =   1080
            Width           =   600
         End
         Begin VB.Image imgFamilia 
            Height          =   240
            Index           =   4
            Left            =   1200
            Picture         =   "frmListado3.frx":93AC
            Top             =   1320
            Width           =   240
         End
         Begin VB.Image imgProveedor 
            Height          =   240
            Index           =   10
            Left            =   1200
            Picture         =   "frmListado3.frx":94AE
            Top             =   720
            Width           =   240
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Hasta"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   40
            Left            =   480
            TabIndex        =   235
            Top             =   720
            Width           =   420
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Proveedor"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   39
            Left            =   120
            TabIndex        =   233
            Top             =   120
            Width           =   885
         End
         Begin VB.Image imgProveedor 
            Height          =   240
            Index           =   9
            Left            =   1200
            Picture         =   "frmListado3.frx":95B0
            Top             =   360
            Width           =   240
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Desde"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   38
            Left            =   480
            TabIndex        =   232
            Top             =   360
            Width           =   450
         End
      End
      Begin VB.CommandButton cmdModCostEstVta 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   4080
         TabIndex        =   210
         Top             =   5760
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   1
         Left            =   3000
         Locked          =   -1  'True
         TabIndex        =   219
         Text            =   "Text1"
         Top             =   2760
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   1
         Left            =   1560
         TabIndex        =   201
         Text            =   "Text1"
         Top             =   2760
         Width           =   1335
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   3000
         Locked          =   -1  'True
         TabIndex        =   218
         Text            =   "Text1"
         Top             =   2400
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   0
         Left            =   1560
         TabIndex        =   200
         Text            =   "Text1"
         Top             =   2400
         Width           =   1335
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   8
         Left            =   4080
         TabIndex        =   199
         Text            =   "Text1"
         Top             =   1680
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   7
         Left            =   1800
         TabIndex        =   198
         Text            =   "Text1"
         Top             =   1680
         Width           =   1215
      End
      Begin VB.Frame FrameMoDVtaArt 
         Caption         =   "Frame1"
         Height          =   2175
         Index           =   0
         Left            =   120
         TabIndex        =   214
         Top             =   3120
         Width           =   6375
         Begin VB.TextBox txtDecimal 
            Alignment       =   1  'Right Justify
            Height          =   285
            Index           =   0
            Left            =   1440
            TabIndex        =   205
            Text            =   "Text3"
            Top             =   1800
            Width           =   1335
         End
         Begin VB.TextBox txtArticulo 
            Height          =   285
            Index           =   6
            Left            =   1440
            MaxLength       =   16
            TabIndex        =   204
            Top             =   1320
            Width           =   1455
         End
         Begin VB.TextBox txtDescArticulo 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   6
            Left            =   3120
            Locked          =   -1  'True
            TabIndex        =   228
            Text            =   "Text5"
            Top             =   1320
            Width           =   3015
         End
         Begin VB.TextBox txtAgente 
            Height          =   285
            Index           =   1
            Left            =   1440
            TabIndex        =   203
            Text            =   "Text1"
            Top             =   720
            Width           =   735
         End
         Begin VB.TextBox txtDescAgente 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   1
            Left            =   2280
            Locked          =   -1  'True
            TabIndex        =   226
            Text            =   "Text1"
            Top             =   720
            Width           =   3855
         End
         Begin VB.TextBox txtDescAgente 
            BackColor       =   &H80000018&
            Height          =   285
            Index           =   0
            Left            =   2280
            Locked          =   -1  'True
            TabIndex        =   223
            Text            =   "Text1"
            Top             =   360
            Width           =   3855
         End
         Begin VB.TextBox txtAgente 
            Height          =   285
            Index           =   0
            Left            =   1440
            TabIndex        =   202
            Text            =   "186"
            Top             =   360
            Width           =   735
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Precio coste"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   37
            Left            =   120
            TabIndex        =   230
            Top             =   1800
            Width           =   1035
         End
         Begin VB.Image imgArticulo 
            Height          =   240
            Index           =   6
            Left            =   1200
            Picture         =   "frmListado3.frx":96B2
            Top             =   1320
            Width           =   240
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Artículo"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   36
            Left            =   120
            TabIndex        =   229
            Top             =   1320
            Width           =   660
         End
         Begin VB.Image imgAgente 
            Height          =   240
            Index           =   1
            Left            =   1200
            Picture         =   "frmListado3.frx":97B4
            Top             =   720
            Width           =   240
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Hasta"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   34
            Left            =   480
            TabIndex        =   227
            Top             =   720
            Width           =   420
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Desde"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   33
            Left            =   480
            TabIndex        =   225
            Top             =   360
            Width           =   450
         End
         Begin VB.Label lblDpto 
            AutoSize        =   -1  'True
            Caption         =   "Agente"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   9
            Left            =   120
            TabIndex        =   224
            Top             =   120
            Width           =   615
         End
         Begin VB.Image imgAgente 
            Height          =   240
            Index           =   0
            Left            =   1200
            Picture         =   "frmListado3.frx":98B6
            Top             =   360
            Width           =   240
         End
      End
      Begin VB.OptionButton optModEstVta 
         Caption         =   "Global"
         Height          =   255
         Index           =   1
         Left            =   3960
         TabIndex        =   197
         Top             =   1080
         Width           =   1095
      End
      Begin VB.OptionButton optModEstVta 
         Caption         =   "Artículo"
         Height          =   255
         Index           =   0
         Left            =   1320
         TabIndex        =   196
         Top             =   1080
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   11
         Left            =   5400
         TabIndex        =   211
         Top             =   5760
         Width           =   1095
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   23
         Left            =   120
         TabIndex        =   241
         Top             =   5880
         Width           =   3465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   32
         Left            =   600
         TabIndex        =   222
         Top             =   2760
         Width           =   420
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   31
         Left            =   600
         TabIndex        =   221
         Top             =   2400
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   8
         Left            =   240
         TabIndex        =   220
         Top             =   2040
         Width           =   585
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   1
         Left            =   1320
         Picture         =   "frmListado3.frx":99B8
         Top             =   2760
         Width           =   240
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   0
         Left            =   1320
         Picture         =   "frmListado3.frx":9ABA
         Top             =   2400
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   30
         Left            =   3360
         TabIndex        =   217
         Top             =   1680
         Width           =   420
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   8
         Left            =   3840
         Picture         =   "frmListado3.frx":9BBC
         Top             =   1680
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   7
         Left            =   240
         TabIndex        =   216
         Top             =   1440
         Width           =   585
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   29
         Left            =   1080
         TabIndex        =   215
         Top             =   1680
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   7
         Left            =   1560
         Picture         =   "frmListado3.frx":9C47
         Top             =   1680
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Modificar coste estadística de venta"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   9
         Left            =   480
         TabIndex        =   212
         Top             =   360
         Width           =   5565
      End
   End
   Begin VB.Frame FrameListadVtaTraba 
      Height          =   6255
      Left            =   240
      TabIndex        =   171
      Top             =   0
      Visible         =   0   'False
      Width           =   5415
      Begin VB.CommandButton cmdVtasTraba 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   2760
         TabIndex        =   175
         Top             =   5640
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   9
         Left            =   3960
         TabIndex        =   176
         Top             =   5640
         Width           =   1095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   6
         Left            =   3960
         TabIndex        =   173
         Text            =   "Text1"
         Top             =   720
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   5
         Left            =   1680
         TabIndex        =   172
         Text            =   "Text1"
         Top             =   720
         Width           =   1215
      End
      Begin MSComctlLib.ListView ListView1 
         Height          =   3855
         Index           =   2
         Left            =   120
         TabIndex        =   174
         Top             =   1560
         Width           =   5055
         _ExtentX        =   8916
         _ExtentY        =   6800
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         Checkboxes      =   -1  'True
         FullRowSelect   =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   1
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Object.Width           =   7761
         EndProperty
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   5
         Left            =   1800
         Picture         =   "frmListado3.frx":9CD2
         Top             =   1200
         Width           =   240
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   4
         Left            =   1440
         Picture         =   "frmListado3.frx":9E1C
         Top             =   1200
         Width           =   240
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   6
         Left            =   3720
         Picture         =   "frmListado3.frx":9F66
         Top             =   720
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   26
         Left            =   3240
         TabIndex        =   182
         Top             =   720
         Width           =   420
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Ventas trabajador / Dia"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   7
         Left            =   480
         TabIndex        =   181
         Top             =   120
         Width           =   4365
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   5
         Left            =   1440
         Picture         =   "frmListado3.frx":9FF1
         Top             =   720
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   25
         Left            =   960
         TabIndex        =   180
         Top             =   720
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   6
         Left            =   120
         TabIndex        =   179
         Top             =   720
         Width           =   585
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   19
         Left            =   120
         TabIndex        =   178
         Top             =   5760
         Width           =   2985
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Trabajadores"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   5
         Left            =   120
         TabIndex        =   177
         Top             =   1200
         Width           =   1140
      End
   End
   Begin VB.Frame FrameRecalPrStan 
      Height          =   6255
      Left            =   600
      TabIndex        =   106
      Top             =   120
      Visible         =   0   'False
      Width           =   6375
      Begin VB.CheckBox chkRecalPrStd 
         Caption         =   "Solo con control de stock"
         Height          =   255
         Index           =   4
         Left            =   3120
         TabIndex        =   119
         Top             =   4920
         Value           =   1  'Checked
         Width           =   2535
      End
      Begin VB.CheckBox chkRecalPrStd 
         Caption         =   "Con articulos de varios"
         Height          =   255
         Index           =   5
         Left            =   360
         TabIndex        =   118
         Top             =   4920
         Width           =   2535
      End
      Begin VB.CommandButton cmdRecalPrStd 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3840
         TabIndex        =   120
         Top             =   5760
         Width           =   1095
      End
      Begin VB.CheckBox chkRecalPrStd 
         Caption         =   "Descuentos familia/proveedor"
         Height          =   255
         Index           =   3
         Left            =   360
         TabIndex        =   116
         Top             =   4560
         Value           =   1  'Checked
         Width           =   2655
      End
      Begin VB.CheckBox chkRecalPrStd 
         Caption         =   "Recalcular precio medio"
         Height          =   255
         Index           =   2
         Left            =   3120
         TabIndex        =   115
         Top             =   4200
         Width           =   2415
      End
      Begin VB.CheckBox chkRecalPrStd 
         Caption         =   "Aplica descuentos por rappel"
         Height          =   255
         Index           =   1
         Left            =   3120
         TabIndex        =   117
         Top             =   4560
         Width           =   2535
      End
      Begin VB.CheckBox chkRecalPrStd 
         Caption         =   "Desde último precio compra"
         Height          =   255
         Index           =   0
         Left            =   360
         TabIndex        =   114
         Top             =   4200
         Width           =   2295
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   5
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   135
         Text            =   "Text5"
         Top             =   3720
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   5
         Left            =   1560
         TabIndex        =   113
         Top             =   3720
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   4
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   132
         Text            =   "Text5"
         Top             =   3360
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   4
         Left            =   1560
         TabIndex        =   112
         Top             =   3360
         Width           =   1095
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   3
         Left            =   1560
         TabIndex        =   111
         Text            =   "Text1"
         Top             =   2640
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   3
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   130
         Text            =   "Text5"
         Top             =   2640
         Width           =   3495
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   2
         Left            =   1560
         TabIndex        =   110
         Text            =   "Text1"
         Top             =   2280
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   2
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   127
         Text            =   "Text5"
         Top             =   2280
         Width           =   3495
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   4
         Left            =   1560
         MaxLength       =   16
         TabIndex        =   109
         Top             =   1560
         Width           =   1455
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   4
         Left            =   3000
         Locked          =   -1  'True
         TabIndex        =   125
         Text            =   "Text5"
         Top             =   1560
         Width           =   3255
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   3
         Left            =   1560
         MaxLength       =   16
         TabIndex        =   108
         Top             =   1200
         Width           =   1455
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   3
         Left            =   3000
         Locked          =   -1  'True
         TabIndex        =   122
         Text            =   "Text5"
         Top             =   1200
         Width           =   3255
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   6
         Left            =   5040
         TabIndex        =   121
         Top             =   5760
         Width           =   1095
      End
      Begin VB.Image imgAyuda 
         Height          =   240
         Index           =   6
         Left            =   5880
         ToolTipText     =   "Recálculo precio standard"
         Top             =   4200
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   15
         Left            =   240
         TabIndex        =   137
         Top             =   5880
         Width           =   3465
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   5
         Left            =   1320
         Picture         =   "frmListado3.frx":A07C
         Top             =   3720
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   15
         Left            =   600
         TabIndex        =   136
         Top             =   3720
         Width           =   420
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   13
         Left            =   240
         TabIndex        =   134
         Top             =   3120
         Width           =   885
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   4
         Left            =   1320
         Picture         =   "frmListado3.frx":A17E
         Top             =   3360
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   12
         Left            =   600
         TabIndex        =   133
         Top             =   3360
         Width           =   450
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   14
         Left            =   600
         TabIndex        =   131
         Top             =   2640
         Width           =   465
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   3
         Left            =   1320
         Picture         =   "frmListado3.frx":A280
         Top             =   2640
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   13
         Left            =   600
         TabIndex        =   129
         Top             =   2280
         Width           =   465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   11
         Left            =   240
         TabIndex        =   128
         Top             =   2040
         Width           =   600
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   2
         Left            =   1320
         Picture         =   "frmListado3.frx":A382
         Top             =   2280
         Width           =   240
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   4
         Left            =   1320
         Picture         =   "frmListado3.frx":A484
         Top             =   1560
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   12
         Left            =   600
         TabIndex        =   126
         Top             =   1560
         Width           =   465
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   3
         Left            =   1320
         Picture         =   "frmListado3.frx":A586
         Top             =   1200
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Artículo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   10
         Left            =   240
         TabIndex        =   124
         Top             =   960
         Width           =   660
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   11
         Left            =   600
         TabIndex        =   123
         Top             =   1200
         Width           =   465
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Recálculo precio estandard"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   4
         Left            =   1200
         TabIndex        =   107
         Top             =   480
         Width           =   4845
      End
   End
   Begin VB.Frame FrameALbConPortes 
      Height          =   6495
      Left            =   120
      TabIndex        =   23
      Top             =   0
      Visible         =   0   'False
      Width           =   7095
      Begin MSComctlLib.TreeView tv1 
         Height          =   5055
         Left            =   240
         TabIndex        =   27
         Top             =   720
         Width           =   6495
         _ExtentX        =   11456
         _ExtentY        =   8916
         _Version        =   393217
         LabelEdit       =   1
         LineStyle       =   1
         Style           =   7
         Appearance      =   1
      End
      Begin VB.CommandButton cmdCalcPortes 
         Caption         =   "Continuar"
         Height          =   375
         Left            =   4200
         TabIndex        =   26
         Top             =   6000
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   2
         Left            =   5640
         TabIndex        =   25
         Top             =   6000
         Width           =   1095
      End
      Begin VB.Label Label1 
         Caption         =   "Continuar con el proceso de facturacion?"
         Height          =   255
         Index           =   0
         Left            =   240
         TabIndex        =   28
         Top             =   6120
         Width           =   3375
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Albaranes con portes "
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   1
         Left            =   840
         TabIndex        =   24
         Top             =   240
         Width           =   4485
      End
   End
   Begin VB.Frame FrameFrarTelefonia 
      Height          =   2295
      Left            =   360
      TabIndex        =   670
      Top             =   120
      Visible         =   0   'False
      Width           =   6015
      Begin VB.CommandButton cmdFrarTelefonia 
         Appearance      =   0  'Flat
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3360
         TabIndex        =   674
         Top             =   1680
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   36
         Left            =   4680
         TabIndex        =   675
         Top             =   1680
         Width           =   1095
      End
      Begin VB.TextBox txtBanco 
         Height          =   285
         Index           =   1
         Left            =   1200
         TabIndex        =   673
         Text            =   "Text1"
         Top             =   1080
         Width           =   615
      End
      Begin VB.TextBox txtDescBanco 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   1
         Left            =   1920
         Locked          =   -1  'True
         TabIndex        =   672
         Text            =   "Text5"
         Top             =   1080
         Width           =   3855
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Banco"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   107
         Left            =   240
         TabIndex        =   676
         Top             =   1080
         Width           =   510
      End
      Begin VB.Image imgBanco 
         Height          =   240
         Index           =   1
         Left            =   840
         Picture         =   "frmListado3.frx":A688
         Top             =   1080
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Facturar telefonía"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   33
         Left            =   840
         TabIndex        =   671
         Top             =   360
         Width           =   4005
      End
   End
   Begin VB.Frame FrameAguaFacturar 
      Height          =   3135
      Left            =   2040
      TabIndex        =   959
      Top             =   120
      Visible         =   0   'False
      Width           =   6255
      Begin VB.CheckBox chkVarios 
         Caption         =   "Marcar periodo en parámetros"
         Height          =   255
         Index           =   23
         Left            =   3240
         TabIndex        =   961
         Top             =   1080
         Width           =   2775
      End
      Begin VB.CommandButton cmdAguaFacturar 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3600
         TabIndex        =   963
         Top             =   2520
         Width           =   1095
      End
      Begin VB.TextBox TxtNoEscribible 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   1440
         Locked          =   -1  'True
         TabIndex        =   969
         Text            =   "Text3"
         Top             =   2040
         Width           =   3375
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   54
         Left            =   1440
         TabIndex        =   960
         Text            =   "Text1"
         Top             =   1080
         Width           =   1215
      End
      Begin VB.TextBox txtDescBanco 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   4
         Left            =   2040
         Locked          =   -1  'True
         TabIndex        =   965
         Text            =   "Text5"
         Top             =   1560
         Width           =   3975
      End
      Begin VB.TextBox txtBanco 
         Height          =   285
         Index           =   4
         Left            =   1440
         TabIndex        =   962
         Text            =   "Text1"
         Top             =   1560
         Width           =   615
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   51
         Left            =   4920
         TabIndex        =   964
         Top             =   2520
         Width           =   1095
      End
      Begin VB.Label Label3 
         Height          =   195
         Index           =   84
         Left            =   240
         TabIndex        =   971
         Top             =   2640
         Width           =   3225
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Periodo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   174
         Left            =   360
         TabIndex        =   970
         Top             =   2040
         Width           =   540
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   54
         Left            =   1200
         Picture         =   "frmListado3.frx":A78A
         Top             =   1080
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Fecha"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   173
         Left            =   360
         TabIndex        =   968
         Top             =   1080
         Width           =   435
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Banco"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   172
         Left            =   360
         TabIndex        =   967
         Top             =   1560
         Width           =   435
      End
      Begin VB.Image imgBanco 
         Height          =   240
         Index           =   4
         Left            =   1200
         Picture         =   "frmListado3.frx":A815
         Top             =   1560
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Facturar contadores agua"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   47
         Left            =   840
         TabIndex        =   966
         Top             =   240
         Width           =   4125
      End
   End
   Begin VB.Frame FrameVtasAgeTraba 
      Height          =   5055
      Left            =   240
      TabIndex        =   677
      Top             =   120
      Visible         =   0   'False
      Width           =   10695
      Begin VB.CheckBox chkVarios 
         Caption         =   "Detalla facturas"
         Height          =   255
         Index           =   25
         Left            =   4320
         TabIndex        =   689
         Top             =   4320
         Value           =   1  'Checked
         Width           =   1815
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Incluir presupuestos"
         Height          =   255
         Index           =   21
         Left            =   2160
         TabIndex        =   688
         Top             =   4320
         Value           =   1  'Checked
         Width           =   2175
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Incluir albaranes"
         Height          =   255
         Index           =   18
         Left            =   120
         TabIndex        =   687
         Top             =   4320
         Width           =   2295
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   15
         Left            =   2520
         Locked          =   -1  'True
         TabIndex        =   704
         Text            =   "Text1"
         Top             =   3840
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   15
         Left            =   1320
         TabIndex        =   685
         Text            =   "Text1"
         Top             =   3840
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   14
         Left            =   2520
         Locked          =   -1  'True
         TabIndex        =   701
         Text            =   "Text1"
         Top             =   3480
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   14
         Left            =   1320
         TabIndex        =   684
         Text            =   "Text1"
         Top             =   3480
         Width           =   1095
      End
      Begin VB.CommandButton cmdVtaAgeTraba 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   8040
         TabIndex        =   690
         Top             =   4440
         Width           =   1095
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   7
         Left            =   1320
         TabIndex        =   683
         Text            =   "186"
         Top             =   2280
         Width           =   735
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   7
         Left            =   2160
         Locked          =   -1  'True
         TabIndex        =   698
         Text            =   "Text1"
         Top             =   2280
         Width           =   3855
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   6
         Left            =   1320
         TabIndex        =   682
         Text            =   "186"
         Top             =   1920
         Width           =   735
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   6
         Left            =   2160
         Locked          =   -1  'True
         TabIndex        =   695
         Text            =   "Text1"
         Top             =   1920
         Width           =   3855
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   35
         Left            =   4080
         TabIndex        =   681
         Text            =   "Text1"
         Top             =   960
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   34
         Left            =   1320
         TabIndex        =   680
         Text            =   "Text1"
         Top             =   960
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   37
         Left            =   9360
         TabIndex        =   691
         Top             =   4440
         Width           =   1095
      End
      Begin MSComctlLib.ListView ListView1 
         Height          =   3375
         Index           =   5
         Left            =   6240
         TabIndex        =   686
         Top             =   960
         Width           =   4215
         _ExtentX        =   7435
         _ExtentY        =   5953
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         Checkboxes      =   -1  'True
         FullRowSelect   =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   1
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Object.Width           =   6703
         EndProperty
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   135
         Left            =   360
         TabIndex        =   705
         Top             =   3840
         Width           =   420
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   15
         Left            =   960
         Picture         =   "frmListado3.frx":A917
         Top             =   3840
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   134
         Left            =   360
         TabIndex        =   703
         Top             =   3480
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   40
         Left            =   120
         TabIndex        =   702
         Top             =   3240
         Width           =   585
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   14
         Left            =   960
         Picture         =   "frmListado3.frx":AA19
         Top             =   3480
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   63
         Left            =   120
         TabIndex        =   700
         Top             =   4680
         Width           =   3105
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   7
         Left            =   960
         Picture         =   "frmListado3.frx":AB1B
         Top             =   2280
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   133
         Left            =   360
         TabIndex        =   699
         Top             =   2280
         Width           =   420
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Agente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   39
         Left            =   120
         TabIndex        =   697
         Top             =   1680
         Width           =   615
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   6
         Left            =   960
         Picture         =   "frmListado3.frx":AC1D
         Top             =   1920
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   132
         Left            =   360
         TabIndex        =   696
         Top             =   1920
         Width           =   450
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   131
         Left            =   3360
         TabIndex        =   694
         Top             =   1005
         Width           =   420
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   35
         Left            =   3840
         Picture         =   "frmListado3.frx":AD1F
         Top             =   975
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   38
         Left            =   120
         TabIndex        =   693
         Top             =   720
         Width           =   585
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   130
         Left            =   360
         TabIndex        =   692
         Top             =   1005
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   34
         Left            =   960
         Picture         =   "frmListado3.frx":ADAA
         Top             =   975
         Width           =   240
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   15
         Left            =   7680
         Picture         =   "frmListado3.frx":AE35
         Top             =   720
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Trabajadores"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   37
         Left            =   6120
         TabIndex        =   679
         Top             =   720
         Width           =   1140
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   14
         Left            =   7320
         Picture         =   "frmListado3.frx":AF7F
         Top             =   720
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Ventas agente  - trabajador "
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   34
         Left            =   2880
         TabIndex        =   678
         Top             =   240
         Width           =   4365
      End
   End
   Begin VB.Frame FrameAguaGeneralitat 
      Height          =   2535
      Left            =   1080
      TabIndex        =   990
      Top             =   1080
      Visible         =   0   'False
      Width           =   5655
      Begin VB.CommandButton cmdAguaCanonGeneralitat 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3240
         TabIndex        =   993
         Top             =   2040
         Width           =   1095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   58
         Left            =   4200
         TabIndex        =   992
         Text            =   "Text1"
         Top             =   1080
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   57
         Left            =   1200
         TabIndex        =   991
         Text            =   "Text1"
         Top             =   1080
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   55
         Left            =   4440
         TabIndex        =   994
         Top             =   2040
         Width           =   1095
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Aguas. Canon Generalitat"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   50
         Left            =   120
         TabIndex        =   998
         Top             =   240
         Width           =   5325
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   58
         Left            =   3840
         Picture         =   "frmListado3.frx":B0C9
         Top             =   1095
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   178
         Left            =   480
         TabIndex        =   997
         Top             =   1125
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  facturación"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   68
         Left            =   240
         TabIndex        =   996
         Top             =   840
         Width           =   1545
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   57
         Left            =   960
         Picture         =   "frmListado3.frx":B154
         Top             =   1095
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   177
         Left            =   3360
         TabIndex        =   995
         Top             =   1125
         Width           =   420
      End
   End
   Begin VB.Frame FrameAnulados 
      Height          =   4935
      Left            =   240
      TabIndex        =   313
      Top             =   0
      Visible         =   0   'False
      Width           =   11535
      Begin MSComctlLib.ListView lwInci 
         Height          =   3255
         Left            =   5880
         TabIndex        =   329
         Top             =   1080
         Width           =   5415
         _ExtentX        =   9551
         _ExtentY        =   5741
         View            =   3
         LabelEdit       =   1
         SortOrder       =   -1  'True
         Sorted          =   -1  'True
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         Checkboxes      =   -1  'True
         FullRowSelect   =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   2
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Text            =   "Codigo"
            Object.Width           =   2117
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   1
            Text            =   "Descripción"
            Object.Width           =   5115
         EndProperty
      End
      Begin VB.OptionButton optVarios 
         Caption         =   "Pedidos"
         Height          =   195
         Index           =   7
         Left            =   3360
         TabIndex        =   319
         Top             =   3720
         Width           =   1335
      End
      Begin VB.OptionButton optVarios 
         Caption         =   "Albaranes"
         Height          =   195
         Index           =   6
         Left            =   1680
         TabIndex        =   318
         Top             =   3720
         Value           =   -1  'True
         Width           =   1335
      End
      Begin VB.TextBox txtCodTraba 
         Height          =   285
         Index           =   1
         Left            =   1440
         TabIndex        =   317
         Top             =   2400
         Width           =   615
      End
      Begin VB.TextBox txtDescTraba 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   1
         Left            =   2160
         Locked          =   -1  'True
         TabIndex        =   330
         Text            =   "Text5"
         Top             =   2400
         Width           =   3495
      End
      Begin VB.CommandButton cmdAnulados 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   8760
         TabIndex        =   320
         Top             =   4440
         Width           =   1095
      End
      Begin VB.TextBox txtCodTraba 
         Height          =   285
         Index           =   0
         Left            =   1440
         TabIndex        =   316
         Top             =   1920
         Width           =   615
      End
      Begin VB.TextBox txtDescTraba 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   2160
         Locked          =   -1  'True
         TabIndex        =   326
         Text            =   "Text5"
         Top             =   1920
         Width           =   3495
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   10
         Left            =   4320
         TabIndex        =   315
         Text            =   "Text1"
         Top             =   1200
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   9
         Left            =   1560
         TabIndex        =   314
         Text            =   "Text1"
         Top             =   1200
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   16
         Left            =   10080
         TabIndex        =   321
         Top             =   4440
         Width           =   1095
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   7
         Left            =   7920
         Picture         =   "frmListado3.frx":B1DF
         Top             =   840
         Width           =   240
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   6
         Left            =   7560
         Picture         =   "frmListado3.frx":B329
         Top             =   840
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Motivos anulación"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   16
         Left            =   5880
         TabIndex        =   332
         Top             =   840
         Width           =   1530
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   56
         Left            =   600
         TabIndex        =   331
         Top             =   2400
         Width           =   405
      End
      Begin VB.Image imgTraba 
         Height          =   240
         Index           =   1
         Left            =   1080
         Picture         =   "frmListado3.frx":B473
         Top             =   2400
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Trabajador"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   15
         Left            =   240
         TabIndex        =   328
         Top             =   1680
         Width           =   945
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   55
         Left            =   600
         TabIndex        =   327
         Top             =   1920
         Width           =   450
      End
      Begin VB.Image imgTraba 
         Height          =   240
         Index           =   0
         Left            =   1080
         Picture         =   "frmListado3.frx":B575
         Top             =   1920
         Width           =   240
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   10
         Left            =   4080
         Picture         =   "frmListado3.frx":B677
         Top             =   1200
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   54
         Left            =   3600
         TabIndex        =   325
         Top             =   1200
         Width           =   420
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   9
         Left            =   1320
         Picture         =   "frmListado3.frx":B702
         Top             =   1200
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   53
         Left            =   600
         TabIndex        =   324
         Top             =   1200
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   14
         Left            =   240
         TabIndex        =   323
         Top             =   840
         Width           =   585
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Albaranes / pedidos anulados"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   14
         Left            =   3240
         TabIndex        =   322
         Top             =   240
         Width           =   4215
      End
   End
   Begin VB.Frame FrameAguaCuotaVarios 
      Height          =   3255
      Left            =   2160
      TabIndex        =   982
      Top             =   1320
      Visible         =   0   'False
      Width           =   5655
      Begin VB.TextBox txtNombre 
         Height          =   285
         Index           =   2
         Left            =   1320
         MaxLength       =   40
         TabIndex        =   983
         Text            =   "Text3"
         Top             =   1320
         Width           =   4215
      End
      Begin VB.TextBox txtDecimal 
         Height          =   285
         Index           =   9
         Left            =   1320
         TabIndex        =   984
         Text            =   "Text3"
         Top             =   2040
         Width           =   975
      End
      Begin VB.CommandButton cmdAguaCuotaVarios 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3120
         TabIndex        =   985
         Top             =   2520
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   54
         Left            =   4320
         TabIndex        =   986
         Top             =   2520
         Width           =   1095
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Cuota varios agua"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   49
         Left            =   720
         TabIndex        =   989
         Top             =   480
         Width           =   4365
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Importe"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   67
         Left            =   240
         TabIndex        =   988
         Top             =   2040
         Width           =   705
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Descripcion"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   66
         Left            =   240
         TabIndex        =   987
         Top             =   1320
         Width           =   975
      End
   End
   Begin VB.Frame FrameAccionesRealizadas 
      Height          =   5775
      Left            =   5280
      TabIndex        =   155
      Top             =   240
      Visible         =   0   'False
      Width           =   6135
      Begin VB.OptionButton optVarios 
         Caption         =   "Trabajador"
         Height          =   195
         Index           =   1
         Left            =   1440
         TabIndex        =   161
         Top             =   5040
         Width           =   1455
      End
      Begin VB.OptionButton optVarios 
         Caption         =   "Fecha"
         Height          =   195
         Index           =   0
         Left            =   240
         TabIndex        =   160
         Top             =   5040
         Value           =   -1  'True
         Width           =   975
      End
      Begin VB.CommandButton cmdAccionesRealizada 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3480
         TabIndex        =   162
         Top             =   5280
         Width           =   1095
      End
      Begin MSComctlLib.ListView ListView1 
         Height          =   3135
         Index           =   0
         Left            =   240
         TabIndex        =   158
         Top             =   1680
         Width           =   2775
         _ExtentX        =   4895
         _ExtentY        =   5530
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         Checkboxes      =   -1  'True
         FullRowSelect   =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   1
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Object.Width           =   4304
         EndProperty
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   4
         Left            =   4440
         TabIndex        =   157
         Text            =   "Text1"
         Top             =   720
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   3
         Left            =   1800
         TabIndex        =   156
         Text            =   "Text1"
         Top             =   720
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   8
         Left            =   4680
         TabIndex        =   163
         Top             =   5280
         Width           =   1095
      End
      Begin MSComctlLib.ListView ListView1 
         Height          =   3135
         Index           =   1
         Left            =   3240
         TabIndex        =   159
         Top             =   1680
         Width           =   2775
         _ExtentX        =   4895
         _ExtentY        =   5530
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         Checkboxes      =   -1  'True
         FullRowSelect   =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   1
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Object.Width           =   4304
         EndProperty
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   18
         Left            =   240
         TabIndex        =   170
         Top             =   5400
         Width           =   2985
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   2
         Left            =   4200
         Picture         =   "frmListado3.frx":B78D
         Top             =   1440
         Width           =   240
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   3
         Left            =   4560
         Picture         =   "frmListado3.frx":B8D7
         Top             =   1440
         Width           =   240
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   0
         Left            =   1200
         Picture         =   "frmListado3.frx":BA21
         Top             =   1440
         Width           =   240
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   1
         Left            =   1560
         Picture         =   "frmListado3.frx":BB6B
         Top             =   1440
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Usuarios"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   4
         Left            =   3240
         TabIndex        =   169
         Top             =   1440
         Width           =   735
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Acciones"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   3
         Left            =   240
         TabIndex        =   168
         Top             =   1440
         Width           =   750
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   2
         Left            =   240
         TabIndex        =   167
         Top             =   720
         Width           =   585
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   4
         Left            =   4200
         Picture         =   "frmListado3.frx":BCB5
         Top             =   720
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   24
         Left            =   1080
         TabIndex        =   166
         Top             =   720
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   3
         Left            =   1560
         Picture         =   "frmListado3.frx":BD40
         Top             =   720
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   23
         Left            =   3720
         TabIndex        =   165
         Top             =   720
         Width           =   420
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Listado acciones realizadas"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   6
         Left            =   600
         TabIndex        =   164
         Top             =   120
         Width           =   4845
      End
   End
   Begin VB.Frame FrameCESCE 
      Height          =   3135
      Left            =   120
      TabIndex        =   767
      Top             =   0
      Visible         =   0   'False
      Width           =   5055
      Begin VB.CommandButton cmdCesce 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   2400
         TabIndex        =   772
         Top             =   2520
         Width           =   1095
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Incluir efectivo"
         Height          =   255
         Index           =   14
         Left            =   3120
         TabIndex        =   771
         Top             =   1920
         Width           =   1695
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Incluir rectificativas/abonos"
         Height          =   255
         Index           =   13
         Left            =   360
         TabIndex        =   770
         Top             =   1920
         Width           =   2295
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   41
         Left            =   3600
         TabIndex        =   769
         Text            =   "Text1"
         Top             =   1320
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   40
         Left            =   1200
         TabIndex        =   768
         Text            =   "Text1"
         Top             =   1320
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   40
         Left            =   3720
         TabIndex        =   773
         Top             =   2520
         Width           =   1095
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   148
         Left            =   2760
         TabIndex        =   777
         Top             =   1320
         Width           =   420
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   41
         Left            =   3240
         Picture         =   "frmListado3.frx":BDCB
         Top             =   1320
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   147
         Left            =   360
         TabIndex        =   776
         Top             =   1320
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   40
         Left            =   840
         Picture         =   "frmListado3.frx":BE56
         Top             =   1320
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   44
         Left            =   360
         TabIndex        =   775
         Top             =   960
         Width           =   585
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Comunicación datos CESCE"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   37
         Left            =   480
         TabIndex        =   774
         Top             =   240
         Width           =   4125
      End
   End
   Begin VB.Frame frmaUpdateDtoProve 
      Height          =   6855
      Left            =   3600
      TabIndex        =   333
      Top             =   120
      Visible         =   0   'False
      Width           =   7575
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   7
         Left            =   3240
         Locked          =   -1  'True
         TabIndex        =   393
         Text            =   "Text1"
         Top             =   2160
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   7
         Left            =   2040
         TabIndex        =   338
         Text            =   "Text1"
         Top             =   2160
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   6
         Left            =   3240
         Locked          =   -1  'True
         TabIndex        =   390
         Text            =   "Text1"
         Top             =   1800
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   6
         Left            =   2040
         TabIndex        =   337
         Text            =   "Text1"
         Top             =   1800
         Width           =   1095
      End
      Begin VB.ComboBox cboDtoEsp 
         Height          =   315
         ItemData        =   "frmListado3.frx":BEE1
         Left            =   5160
         List            =   "frmListado3.frx":BEEE
         Style           =   2  'Dropdown List
         TabIndex        =   340
         Top             =   3000
         Width           =   1695
      End
      Begin VB.CommandButton cmdUpdDtosProve 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   5040
         TabIndex        =   341
         Top             =   6240
         Width           =   1095
      End
      Begin VB.TextBox txtDecimal 
         Alignment       =   1  'Right Justify
         Height          =   285
         Index           =   3
         Left            =   5640
         TabIndex        =   335
         Text            =   "Text3"
         Top             =   720
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   13
         Left            =   3240
         Locked          =   -1  'True
         TabIndex        =   346
         Text            =   "Text5"
         Top             =   1200
         Width           =   3495
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   13
         Left            =   2040
         TabIndex        =   336
         Top             =   1200
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   17
         Left            =   6240
         TabIndex        =   342
         Top             =   6240
         Width           =   1095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   11
         Left            =   1200
         TabIndex        =   334
         Text            =   "Text1"
         Top             =   720
         Width           =   1215
      End
      Begin MSComctlLib.ListView lwFam 
         Height          =   3735
         Left            =   240
         TabIndex        =   339
         Top             =   2880
         Width           =   4695
         _ExtentX        =   8281
         _ExtentY        =   6588
         View            =   3
         LabelEdit       =   1
         SortOrder       =   -1  'True
         Sorted          =   -1  'True
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         Checkboxes      =   -1  'True
         FullRowSelect   =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   -2147483643
         BorderStyle     =   1
         Appearance      =   1
         NumItems        =   2
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Text            =   "Codigo"
            Object.Width           =   2117
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   1
            Text            =   "Descripción"
            Object.Width           =   5115
         EndProperty
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   70
         Left            =   1080
         TabIndex        =   394
         Top             =   2160
         Width           =   420
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   7
         Left            =   1680
         Picture         =   "frmListado3.frx":BF13
         Top             =   2160
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   69
         Left            =   1080
         TabIndex        =   392
         Top             =   1800
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   21
         Left            =   240
         TabIndex        =   391
         Top             =   1800
         Width           =   585
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   6
         Left            =   1680
         Picture         =   "frmListado3.frx":C015
         Top             =   1800
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Descuento especial"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   19
         Left            =   5160
         TabIndex        =   350
         Top             =   2760
         Width           =   1635
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   31
         Left            =   5160
         TabIndex        =   349
         Top             =   5880
         Width           =   2265
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Descuento"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   58
         Left            =   4560
         TabIndex        =   348
         Top             =   720
         Width           =   900
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   57
         Left            =   240
         TabIndex        =   347
         Top             =   1200
         Width           =   885
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   13
         Left            =   1680
         Picture         =   "frmListado3.frx":C117
         Top             =   1200
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Actualizar dtos desde proveedor"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   15
         Left            =   1440
         TabIndex        =   345
         Top             =   120
         Width           =   4935
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Familias"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   18
         Left            =   240
         TabIndex        =   344
         Top             =   2640
         Width           =   690
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   9
         Left            =   1080
         Picture         =   "frmListado3.frx":C219
         Top             =   2640
         Width           =   240
      End
      Begin VB.Image imgCheck 
         Height          =   240
         Index           =   8
         Left            =   1440
         Picture         =   "frmListado3.frx":C363
         Top             =   2640
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   17
         Left            =   240
         TabIndex        =   343
         Top             =   720
         Width           =   585
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   11
         Left            =   840
         Picture         =   "frmListado3.frx":C4AD
         Top             =   720
         Width           =   240
      End
   End
   Begin VB.Frame FrameVtasAgentePvpMenor 
      Height          =   4695
      Left            =   3960
      TabIndex        =   816
      Top             =   120
      Width           =   6495
      Begin VB.CheckBox chkVarios 
         Caption         =   "Presupuestos"
         Height          =   255
         Index           =   30
         Left            =   2520
         TabIndex        =   822
         Top             =   3480
         Width           =   2295
      End
      Begin VB.CommandButton cmdComisiones 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3840
         TabIndex        =   823
         Top             =   4080
         Width           =   1095
      End
      Begin VB.CheckBox chkVarios 
         Caption         =   "Detalla facturas"
         Height          =   255
         Index           =   17
         Left            =   480
         TabIndex        =   821
         Top             =   3480
         Width           =   2295
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   9
         Left            =   1560
         TabIndex        =   818
         Text            =   "186"
         Top             =   1800
         Width           =   735
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   9
         Left            =   2400
         Locked          =   -1  'True
         TabIndex        =   831
         Text            =   "Text1"
         Top             =   1800
         Width           =   3855
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   8
         Left            =   1560
         TabIndex        =   817
         Text            =   "186"
         Top             =   1320
         Width           =   735
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   8
         Left            =   2400
         Locked          =   -1  'True
         TabIndex        =   828
         Text            =   "Text1"
         Top             =   1320
         Width           =   3855
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   46
         Left            =   4200
         TabIndex        =   820
         Text            =   "Text1"
         Top             =   2760
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   45
         Left            =   1560
         TabIndex        =   819
         Text            =   "Text1"
         Top             =   2760
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   43
         Left            =   5160
         TabIndex        =   824
         Top             =   4080
         Width           =   1095
      End
      Begin VB.Image imgAyuda 
         Height          =   240
         Index           =   9
         Left            =   3480
         ToolTipText     =   "Comisiones ECO"
         Top             =   4080
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   72
         Left            =   240
         TabIndex        =   834
         Top             =   4080
         Width           =   3225
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha factura"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   58
         Left            =   240
         TabIndex        =   833
         Top             =   2400
         Width           =   1155
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   9
         Left            =   1200
         Picture         =   "frmListado3.frx":C538
         Top             =   1800
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   152
         Left            =   480
         TabIndex        =   832
         Top             =   1800
         Width           =   420
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Agente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   57
         Left            =   240
         TabIndex        =   830
         Top             =   960
         Width           =   615
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   8
         Left            =   1200
         Picture         =   "frmListado3.frx":C63A
         Top             =   1320
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   151
         Left            =   480
         TabIndex        =   829
         Top             =   1320
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   56
         Left            =   3240
         TabIndex        =   827
         Top             =   2760
         Width           =   420
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   46
         Left            =   3840
         Picture         =   "frmListado3.frx":C73C
         Top             =   2760
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   55
         Left            =   480
         TabIndex        =   826
         Top             =   2760
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   45
         Left            =   1200
         Picture         =   "frmListado3.frx":C7C7
         Top             =   2760
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Comisiones ECO"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   40
         Left            =   1200
         TabIndex        =   825
         Top             =   360
         Width           =   4125
      End
   End
   Begin VB.Frame frameVtaTipoPrecio 
      Height          =   8175
      Left            =   3600
      TabIndex        =   706
      Top             =   0
      Visible         =   0   'False
      Width           =   6615
      Begin VB.CheckBox chkVarios 
         Caption         =   "Agrupado proveedor /familia"
         Height          =   255
         Index           =   29
         Left            =   120
         TabIndex        =   1092
         Top             =   7680
         Width           =   2775
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   13
         Left            =   1560
         TabIndex        =   720
         Text            =   "186"
         Top             =   6360
         Width           =   735
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   13
         Left            =   2400
         Locked          =   -1  'True
         TabIndex        =   1057
         Text            =   "Text1"
         Top             =   6360
         Width           =   3855
      End
      Begin VB.TextBox txtAgente 
         Height          =   285
         Index           =   12
         Left            =   1560
         TabIndex        =   719
         Text            =   "186"
         Top             =   6000
         Width           =   735
      End
      Begin VB.TextBox txtDescAgente 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   12
         Left            =   2400
         Locked          =   -1  'True
         TabIndex        =   1054
         Text            =   "Text1"
         Top             =   6000
         Width           =   3855
      End
      Begin VB.TextBox txtDescTraba 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   3
         Left            =   2280
         Locked          =   -1  'True
         TabIndex        =   1014
         Text            =   "Text5"
         Top             =   5400
         Width           =   3495
      End
      Begin VB.TextBox txtCodTraba 
         Height          =   285
         Index           =   3
         Left            =   1560
         TabIndex        =   718
         Top             =   5400
         Width           =   615
      End
      Begin VB.TextBox txtDescTraba 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   2
         Left            =   2280
         Locked          =   -1  'True
         TabIndex        =   1013
         Text            =   "Text5"
         Top             =   5040
         Width           =   3495
      End
      Begin VB.TextBox txtCodTraba 
         Height          =   285
         Index           =   2
         Left            =   1560
         TabIndex        =   717
         Top             =   5040
         Width           =   615
      End
      Begin VB.TextBox txtAlma 
         Height          =   285
         Index           =   9
         Left            =   1440
         TabIndex        =   716
         Text            =   "Text1"
         Top             =   4320
         Width           =   1095
      End
      Begin VB.TextBox txtDescAlma 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   9
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   1009
         Text            =   "Text5"
         Top             =   4320
         Width           =   3495
      End
      Begin VB.TextBox txtAlma 
         Height          =   285
         Index           =   8
         Left            =   1440
         TabIndex        =   715
         Text            =   "Text1"
         Top             =   3960
         Width           =   1095
      End
      Begin VB.TextBox txtDescAlma 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   8
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   1007
         Text            =   "Text5"
         Top             =   3960
         Width           =   3495
      End
      Begin VB.TextBox txtAlma 
         Height          =   285
         Index           =   7
         Left            =   1440
         TabIndex        =   714
         Text            =   "Text1"
         Top             =   3600
         Width           =   1095
      End
      Begin VB.TextBox txtDescAlma 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   7
         Left            =   2640
         Locked          =   -1  'True
         TabIndex        =   1005
         Text            =   "Text5"
         Top             =   3600
         Width           =   3495
      End
      Begin VB.CommandButton cmdVentasxTipoPrecio 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3960
         TabIndex        =   726
         Top             =   7680
         Width           =   1095
      End
      Begin VB.Frame FrameInterno1 
         Caption         =   "Tipo precio"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   615
         Left            =   120
         TabIndex        =   741
         Top             =   6840
         Width           =   6255
         Begin VB.OptionButton optTipoPrecio 
            Caption         =   "&Manual"
            Height          =   255
            Index           =   4
            Left            =   5040
            TabIndex        =   725
            Top             =   300
            Value           =   -1  'True
            Width           =   1095
         End
         Begin VB.OptionButton optTipoPrecio 
            Caption         =   "&Artículo"
            Height          =   255
            Index           =   3
            Left            =   3840
            TabIndex        =   724
            Top             =   300
            Width           =   975
         End
         Begin VB.OptionButton optTipoPrecio 
            Caption         =   "&Tarifa"
            Height          =   255
            Index           =   2
            Left            =   2760
            TabIndex        =   723
            Top             =   300
            Width           =   855
         End
         Begin VB.OptionButton optTipoPrecio 
            Caption         =   "&Especial"
            Height          =   255
            Index           =   1
            Left            =   1560
            TabIndex        =   722
            Top             =   300
            Width           =   1095
         End
         Begin VB.OptionButton optTipoPrecio 
            Caption         =   "&Promoción"
            Height          =   255
            Index           =   0
            Left            =   120
            TabIndex        =   721
            Top             =   300
            Width           =   1095
         End
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   18
         Left            =   1560
         TabIndex        =   713
         Text            =   "Text1"
         Top             =   2880
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   18
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   739
         Text            =   "Text5"
         Top             =   2880
         Width           =   3615
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   17
         Left            =   1560
         TabIndex        =   712
         Text            =   "Text1"
         Top             =   2520
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   17
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   736
         Text            =   "Text5"
         Top             =   2520
         Width           =   3615
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   17
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   734
         Text            =   "Text1"
         Top             =   1800
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   17
         Left            =   1560
         TabIndex        =   711
         Text            =   "Text1"
         Top             =   1800
         Width           =   1095
      End
      Begin VB.TextBox txtDescClie 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   16
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   731
         Text            =   "Text1"
         Top             =   1440
         Width           =   3495
      End
      Begin VB.TextBox txtCliente 
         Height          =   285
         Index           =   16
         Left            =   1560
         TabIndex        =   710
         Text            =   "Text1"
         Top             =   1440
         Width           =   1095
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   37
         Left            =   3960
         TabIndex        =   709
         Text            =   "Text1"
         Top             =   840
         Width           =   1215
      End
      Begin VB.TextBox txtFecha 
         Height          =   285
         Index           =   36
         Left            =   1560
         TabIndex        =   708
         Text            =   "Text1"
         Top             =   840
         Width           =   1215
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   38
         Left            =   5280
         TabIndex        =   727
         Top             =   7680
         Width           =   1095
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   13
         Left            =   1200
         Picture         =   "frmListado3.frx":C852
         Top             =   6360
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   196
         Left            =   480
         TabIndex        =   1058
         Top             =   6360
         Width           =   420
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Agente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   70
         Left            =   120
         TabIndex        =   1056
         Top             =   5760
         Width           =   615
      End
      Begin VB.Image imgAgente 
         Height          =   240
         Index           =   12
         Left            =   1200
         Picture         =   "frmListado3.frx":C954
         Top             =   6000
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   195
         Left            =   480
         TabIndex        =   1055
         Top             =   6000
         Width           =   450
      End
      Begin VB.Image imgTraba 
         Height          =   240
         Index           =   3
         Left            =   1200
         Picture         =   "frmListado3.frx":CA56
         Top             =   5400
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   183
         Left            =   480
         TabIndex        =   1016
         Top             =   5040
         Width           =   450
      End
      Begin VB.Image imgTraba 
         Height          =   240
         Index           =   2
         Left            =   1200
         Picture         =   "frmListado3.frx":CB58
         Top             =   5040
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   182
         Left            =   480
         TabIndex        =   1015
         Top             =   5400
         Width           =   420
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Trabajadores"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   181
         Left            =   240
         TabIndex        =   1012
         Top             =   4680
         Width           =   1140
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Almacenes"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   180
         Left            =   240
         TabIndex        =   1011
         Top             =   3240
         Width           =   1050
      End
      Begin VB.Image imgAyuda 
         Height          =   240
         Index           =   7
         Left            =   3360
         ToolTipText     =   "Ventas x tipo de precio"
         Top             =   7680
         Width           =   240
      End
      Begin VB.Image imgAlma 
         Height          =   240
         Index           =   9
         Left            =   1080
         Picture         =   "frmListado3.frx":CC5A
         Top             =   4320
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Alm 3"
         Height          =   195
         Index           =   91
         Left            =   480
         TabIndex        =   1010
         Top             =   4320
         Width           =   465
      End
      Begin VB.Image imgAlma 
         Height          =   240
         Index           =   8
         Left            =   1080
         Picture         =   "frmListado3.frx":CD5C
         Top             =   3960
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Alm 2"
         Height          =   195
         Index           =   90
         Left            =   480
         TabIndex        =   1008
         Top             =   3960
         Width           =   465
      End
      Begin VB.Image imgAlma 
         Height          =   240
         Index           =   7
         Left            =   1080
         Picture         =   "frmListado3.frx":CE5E
         Top             =   3600
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Alm 1"
         Height          =   195
         Index           =   89
         Left            =   480
         TabIndex        =   1006
         Top             =   3600
         Width           =   465
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   65
         Left            =   480
         TabIndex        =   740
         Top             =   2880
         Width           =   465
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   18
         Left            =   1320
         Picture         =   "frmListado3.frx":CF60
         Top             =   2880
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   64
         Left            =   480
         TabIndex        =   738
         Top             =   2520
         Width           =   465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   140
         Left            =   240
         TabIndex        =   737
         Top             =   2160
         Width           =   600
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   17
         Left            =   1320
         Picture         =   "frmListado3.frx":D062
         Top             =   2520
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   139
         Left            =   480
         TabIndex        =   735
         Top             =   1800
         Width           =   420
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   17
         Left            =   1320
         Picture         =   "frmListado3.frx":D164
         Top             =   1800
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   138
         Left            =   480
         TabIndex        =   733
         Top             =   1440
         Width           =   450
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Cliente"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   42
         Left            =   240
         TabIndex        =   732
         Top             =   1200
         Width           =   585
      End
      Begin VB.Image imgCliente 
         Height          =   240
         Index           =   16
         Left            =   1320
         Picture         =   "frmListado3.frx":D266
         Top             =   1440
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   137
         Left            =   3120
         TabIndex        =   730
         Top             =   840
         Width           =   420
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   37
         Left            =   3600
         Picture         =   "frmListado3.frx":D368
         Top             =   855
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   136
         Left            =   600
         TabIndex        =   729
         Top             =   840
         Width           =   450
      End
      Begin VB.Image imgFecha 
         Height          =   240
         Index           =   36
         Left            =   1320
         Picture         =   "frmListado3.frx":D3F3
         Top             =   855
         Width           =   240
      End
      Begin VB.Label lblDpto 
         AutoSize        =   -1  'True
         Caption         =   "Fecha  "
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   41
         Left            =   240
         TabIndex        =   728
         Top             =   520
         Width           =   585
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Ventas x tipo de precio"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   480
         Index           =   35
         Left            =   1440
         TabIndex        =   707
         Top             =   150
         Width           =   4005
      End
   End
   Begin VB.Frame FrameRectifInven 
      Height          =   4335
      Left            =   120
      TabIndex        =   29
      Top             =   960
      Visible         =   0   'False
      Width           =   7095
      Begin VB.TextBox txtcantidad 
         Height          =   285
         Index           =   0
         Left            =   1440
         TabIndex        =   33
         Text            =   "Text3"
         Top             =   3360
         Width           =   1455
      End
      Begin VB.CommandButton cmdRectificaInven 
         Caption         =   "Actualizar"
         Height          =   375
         Left            =   4200
         TabIndex        =   34
         Top             =   3600
         Width           =   1095
      End
      Begin VB.TextBox Text2 
         Enabled         =   0   'False
         Height          =   975
         Left            =   1440
         MultiLine       =   -1  'True
         TabIndex        =   41
         Text            =   "frmListado3.frx":D47E
         Top             =   2160
         Width           =   5175
      End
      Begin VB.TextBox txtAlma 
         Height          =   285
         Index           =   0
         Left            =   1440
         TabIndex        =   32
         Text            =   "Text1"
         Top             =   1680
         Width           =   1095
      End
      Begin VB.TextBox txtDescAlma 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   2880
         Locked          =   -1  'True
         TabIndex        =   38
         Text            =   "Text5"
         Top             =   1680
         Width           =   3495
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   3
         Left            =   5400
         TabIndex        =   35
         Top             =   3600
         Width           =   1095
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   0
         Left            =   1440
         MaxLength       =   16
         TabIndex        =   31
         Top             =   1200
         Width           =   1455
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   0
         Left            =   3120
         Locked          =   -1  'True
         TabIndex        =   30
         Text            =   "Text5"
         Top             =   1200
         Width           =   3495
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Cantidad nueva"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   1
         Left            =   120
         TabIndex        =   42
         Top             =   3360
         Width           =   1140
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Datos inventario"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   0
         Left            =   120
         TabIndex        =   40
         Top             =   2160
         Width           =   1185
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Almacén"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   19
         Left            =   120
         TabIndex        =   39
         Top             =   1680
         Width           =   600
      End
      Begin VB.Image imgAlma 
         Height          =   240
         Index           =   0
         Left            =   1080
         Picture         =   "frmListado3.frx":D484
         Top             =   1680
         Width           =   240
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   26
         Left            =   1080
         TabIndex        =   37
         Top             =   240
         Width           =   4845
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   0
         Left            =   1080
         Picture         =   "frmListado3.frx":D586
         Top             =   1200
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Artículo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   14
         Left            =   120
         TabIndex        =   36
         Top             =   1200
         Width           =   540
      End
   End
   Begin VB.Frame FrameRevStokInven 
      Caption         =   " "
      Height          =   6975
      Left            =   -120
      TabIndex        =   515
      Top             =   120
      Visible         =   0   'False
      Width           =   6375
      Begin VB.OptionButton optCtrlStock 
         Caption         =   "Ventas periodo con stock"
         Height          =   195
         Index           =   2
         Left            =   3840
         TabIndex        =   552
         Top             =   5160
         Width           =   2415
      End
      Begin VB.OptionButton optCtrlStock 
         Caption         =   "Negativos"
         Height          =   195
         Index           =   1
         Left            =   2400
         TabIndex        =   551
         Top             =   5160
         Width           =   1215
      End
      Begin VB.OptionButton optCtrlStock 
         Caption         =   "Desde inventario"
         Height          =   195
         Index           =   0
         Left            =   600
         TabIndex        =   550
         Top             =   5160
         Value           =   -1  'True
         Width           =   1695
      End
      Begin VB.Frame FrameVtasPer 
         BorderStyle     =   0  'None
         Height          =   495
         Left            =   840
         TabIndex        =   546
         Top             =   5640
         Visible         =   0   'False
         Width           =   4575
         Begin VB.TextBox txtFecha 
            Height          =   285
            Index           =   23
            Left            =   3120
            TabIndex        =   524
            Text            =   "Text1"
            Top             =   120
            Width           =   1215
         End
         Begin VB.TextBox txtFecha 
            Height          =   285
            Index           =   22
            Left            =   960
            TabIndex        =   523
            Text            =   "Text1"
            Top             =   120
            Width           =   1215
         End
         Begin VB.Image imgFecha 
            Height          =   240
            Index           =   23
            Left            =   600
            Picture         =   "frmListado3.frx":D688
            Top             =   120
            Width           =   240
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Desde"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   103
            Left            =   0
            TabIndex        =   548
            Top             =   120
            Width           =   450
         End
         Begin VB.Image imgFecha 
            Height          =   240
            Index           =   22
            Left            =   2880
            Picture         =   "frmListado3.frx":D713
            Top             =   120
            Width           =   240
         End
         Begin VB.Label Label4 
            AutoSize        =   -1  'True
            Caption         =   "Hasta"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   102
            Left            =   2400
            TabIndex        =   547
            Top             =   120
            Width           =   420
         End
      End
      Begin VB.CommandButton cmdRevStokInven 
         Caption         =   "&Aceptar"
         Height          =   375
         Left            =   3720
         TabIndex        =   525
         Top             =   6360
         Width           =   1095
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   14
         Left            =   1200
         MaxLength       =   16
         TabIndex        =   522
         Top             =   4680
         Width           =   1455
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   14
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   543
         Text            =   "Text5"
         Top             =   4680
         Width           =   3375
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   15
         Left            =   2520
         Locked          =   -1  'True
         TabIndex        =   541
         Text            =   "Text5"
         Top             =   3360
         Width           =   3615
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   15
         Left            =   1320
         TabIndex        =   520
         Text            =   "Text1"
         Top             =   3360
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   21
         Left            =   2520
         Locked          =   -1  'True
         TabIndex        =   539
         Text            =   "Text5"
         Top             =   2280
         Width           =   3615
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   21
         Left            =   1320
         TabIndex        =   518
         Top             =   2280
         Width           =   1095
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "&Cancelar"
         Height          =   375
         Index           =   27
         Left            =   4920
         TabIndex        =   536
         Top             =   6360
         Width           =   1095
      End
      Begin VB.TextBox txtDescAlma 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   3
         Left            =   2520
         Locked          =   -1  'True
         TabIndex        =   534
         Text            =   "Text5"
         Top             =   1080
         Width           =   3495
      End
      Begin VB.TextBox txtAlma 
         Height          =   285
         Index           =   3
         Left            =   1320
         TabIndex        =   516
         Text            =   "Text1"
         Top             =   1080
         Width           =   1095
      End
      Begin VB.TextBox txtDescFamia 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   14
         Left            =   2520
         Locked          =   -1  'True
         TabIndex        =   531
         Text            =   "Text5"
         Top             =   3000
         Width           =   3615
      End
      Begin VB.TextBox txtFamia 
         Height          =   285
         Index           =   14
         Left            =   1320
         TabIndex        =   519
         Text            =   "Text1"
         Top             =   3000
         Width           =   1095
      End
      Begin VB.TextBox txtDescProve 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   20
         Left            =   2520
         Locked          =   -1  'True
         TabIndex        =   529
         Text            =   "Text5"
         Top             =   1920
         Width           =   3615
      End
      Begin VB.TextBox txtCodProve 
         Height          =   285
         Index           =   20
         Left            =   1320
         TabIndex        =   517
         Top             =   1920
         Width           =   1095
      End
      Begin VB.TextBox txtArticulo 
         Height          =   285
         Index           =   13
         Left            =   1200
         MaxLength       =   16
         TabIndex        =   521
         Top             =   4320
         Width           =   1455
      End
      Begin VB.TextBox txtDescArticulo 
         BackColor       =   &H80000018&
         Height          =   285
         Index           =   13
         Left            =   2760
         Locked          =   -1  'True
         TabIndex        =   527
         Text            =   "Text5"
         Top             =   4320
         Width           =   3375
      End
      Begin VB.Image imgAyuda 
         Height          =   255
         Index           =   3
         Left            =   240
         ToolTipText     =   "Control stock "
         Top             =   5160
         Width           =   255
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   53
         Left            =   120
         TabIndex        =   545
         Top             =   6480
         Width           =   3465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   101
         Left            =   360
         TabIndex        =   544
         Top             =   4680
         Width           =   420
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   14
         Left            =   960
         Picture         =   "frmListado3.frx":D79E
         Top             =   4680
         Width           =   240
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   15
         Left            =   1080
         Picture         =   "frmListado3.frx":D8A0
         Top             =   3360
         Width           =   240
      End
      Begin VB.Label Label3 
         Caption         =   "Hasta"
         Height          =   195
         Index           =   52
         Left            =   360
         TabIndex        =   542
         Top             =   3360
         Width           =   465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Hasta"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   100
         Left            =   360
         TabIndex        =   540
         Top             =   2280
         Width           =   420
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   21
         Left            =   1080
         Picture         =   "frmListado3.frx":D9A2
         Top             =   2280
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   99
         Left            =   360
         TabIndex        =   538
         Top             =   4320
         Width           =   450
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Almacen"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   98
         Left            =   120
         TabIndex        =   537
         Top             =   1080
         Width           =   735
      End
      Begin VB.Image imgAlma 
         Height          =   240
         Index           =   3
         Left            =   1080
         Picture         =   "frmListado3.frx":DAA4
         Top             =   1080
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Desde"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   195
         Index           =   97
         Left            =   360
         TabIndex        =   535
         Top             =   1920
         Width           =   450
      End
      Begin VB.Image imgFamilia 
         Height          =   240
         Index           =   14
         Left            =   1080
         Picture         =   "frmListado3.frx":DBA6
         Top             =   3000
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Familia"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   96
         Left            =   120
         TabIndex        =   533
         Top             =   2760
         Width           =   600
      End
      Begin VB.Label Label3 
         Caption         =   "Desde"
         Height          =   195
         Index           =   51
         Left            =   360
         TabIndex        =   532
         Top             =   3000
         Width           =   465
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Proveedor"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   95
         Left            =   120
         TabIndex        =   530
         Top             =   1560
         Width           =   885
      End
      Begin VB.Image imgProveedor 
         Height          =   240
         Index           =   20
         Left            =   1080
         Picture         =   "frmListado3.frx":DCA8
         Top             =   1920
         Width           =   240
      End
      Begin VB.Image imgArticulo 
         Height          =   240
         Index           =   13
         Left            =   960
         Picture         =   "frmListado3.frx":DDAA
         Top             =   4320
         Width           =   240
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "Artículo"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000080&
         Height          =   195
         Index           =   94
         Left            =   120
         TabIndex        =   528
         Top             =   3960
         Width           =   660
      End
      Begin VB.Label lblTitulo 
         Alignment       =   2  'Center
         Caption         =   "Control de stocks"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   13.5
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   360
         Index           =   23
         Left            =   360
         TabIndex        =   526
         Top             =   360
         Width           =   5505
      End
   End
End
Attribute VB_Name = "frmListado3"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit


Private Const InicioComisionesHerbelca = "01/08/2012"

Public Opcion As Byte
    '0  .-  Pregunta del pq se cambia el precio o dto
    '1  .-  Informe de prevision
    '2  .-  Estan facturando. Albaranes que ya tienen la linea de portes
    '3  .-  rectificar inventario
    '4  .-  stocks meses
    '5  .-  Articulos en promocion
    '6  .-  Recalculo precio standard
    '7  .-  Previson pagos compras
    '8  .-  Listado acciones realizadas
    '9  .-  Ventas trabajador dia
    '10 .-  Correccion de precios. Sugiere los precios para un proveedor/articulo
    '11 .-  Modificar estadística de venta (costes)
    '12 .-  Listado DTOS. Normal y tipor herbelca
    '13 .-  Comprobacion dto / cliente
    '14 .-  Modificar coste masivo a partir de un incremento/decre
    '15 .-  Clientes Varios
    '16 .-  Albaranes / pedidos anulados
    '17 .-  Updatear dtos familia marca desde proveedor
    '18 .-  Lisatado de articulos con desde /hastas y la fra en la que esta vendido
    '19 .-  Listado ventas por forma de pago
    '20 .-  Recalculo precio medio ponderado
    '21 .-  Recalculo ultimo precio compra
        
    '22 .-  Facturar RENTINGs
            'Otrosdatos:  ID, solo facturaremos el ID
            '  "       = ""
    '23 .-  Prefacturacion de rentings
    
    '25 .-  Ventas a credito
        
    '26 .-  Articulos que han disparado el punto de pedido
    
    '27 .-  Revision STOCKS desde ult fecha inventario
    
    '28 .-  Creacion datos almagrupo
    '29 .-  Exportaion fichero
    
    '30 .- Listados flotas   *** NO ESTA ACABADO
    
    '31 .- Generacion comisiones tipo Herbelca
    
    '32 .- Impresion comisiones (de la 31)
    
    '33 .- Generar descuentos proveedor
    
    '34 .- aRTICULO con dtospc (frame de articulos en promocion. Opcino 5 )
    
    
    '35 .- Reposción almaceén
    '36 .-  Facturacion telefonia cooperativas
        
    '37 .- Ventas por agente - Trabajador
    '38 .- Ventas por tipo de precio
    
    '39 .- Articulos mas vendidos
    '40 .- Comunicacion datos CESCE
    '41 .- Listado de telefonos(TELEFONIA)
    '42 .- Renovacion de TELEFONO
    
    '43 .- Listado de comisiones en funcion del
    
    '44 .- Cambiar de titular
    
    '45 .- Herbelca. Contados ruta. --->  Pase de presu a FAS
    
    '46 .- Listado agente-familia-marca
    
    '47 .- Cavevinum Desde/Hasta para el control de direcciones de envio
    
    '48 .- Cuotas x telefono telefonia
    
    '49 .- Cambio familia/marca en articulos
    
    '50 .- Pedir banco. Lo utilizo para facturar las ofertas directamente. Devolvera en cadena desdeotroform o "" o el banco
    
    
    '51 .- Facturar contadores agua
    '52 .- importar lectura aguas
    '53 .- Listado  agua ayuntamiento
    '54 .- Agua. Cuota varios. Poner descripcion e importe
    '55 .- Agua. Listado para rellenar modelos Generalitat EPSAR 101-102
    '56 .- Devuelve un codigo de proveedor. De momento TELEMATEL borre datos
    
    '57 .- Simular pedido proveedor con otro proveedor
    '58 .- Presentacion fichero declaracion agua
    
    '59 .- Exporatar facturas FAS (Bolbaite, anna..) retiradas de aceite
    
    '60 .- AGUA.  Listado contadores por diverso criterios. Activos-noactivos    tipo anexo, boca....)
    
    '61 .- Inventariar un articulo (como Opcion=3)
    
    '62 .- Cambio precio % en slista
    
    '63 .- Estadisticas pedido x solicitante
    
    '64 .- Fitosnaitarios. Listado que tenga, los que no y han comprado fitos alguna vez
    
Public OtrosDatos As String
    

Private PuedeCerrar As Boolean
Private PrimeraVez As Boolean

Private WithEvents frmC As frmCal
Attribute frmC.VB_VarHelpID = -1
Private WithEvents frmB As frmBuscaGrid
Attribute frmB.VB_VarHelpID = -1
Private WithEvents frmMtoArticulos As frmAlmArticu2
Attribute frmMtoArticulos.VB_VarHelpID = -1
Private WithEvents frmPr As frmComProveedores
Attribute frmPr.VB_VarHelpID = -1
Private WithEvents frmCli As frmFacClientes3
Attribute frmCli.VB_VarHelpID = -1
Private WithEvents frmAg As frmFacAgentesCom
Attribute frmAg.VB_VarHelpID = -1
Private WithEvents frmT As frmAdmTrabajadores
Attribute frmT.VB_VarHelpID = -1
Private WithEvents frmModeloTel As frmTelefoniaModelos
Attribute frmModeloTel.VB_VarHelpID = -1


'Los reports
Private cadFormula As String 'Cadena con la FormulaSelection para Crystal Report
Private CadParam As String 'Cadena con los parametros para Crystal Report
Private numParam As Byte 'Numero de parametros que se pasan a Crystal Report
Private cadSelect As String 'Cadena para comprobar si hay datos antes de abrir Informe
Private cadTitulo As String 'Titulo para el frmImprimir
Private cadNomRPT As String 'Nombre del informe a Imprimir
Private conSubRPT As Boolean 'Si el informe tiene subreports
'nuevo Febrero 2010
Private cadPDFrpt As String 'Nombre del informe a enviar por email
Private vMostrarTree As Boolean
'-----------------------------------







Dim ResultadoFuncion As Boolean
Dim miSQL As String
Dim codigo As String
Dim FI As Date
Dim FF As Date

Dim vectorSQL(6) As String  '6 formas de pago

Private Sub cboMes_Click(Index As Integer)
    If Index = 0 Then PrecargaSaldosBanco
End Sub

Private Sub cboMes_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 3, False
End Sub






Private Sub chkRecalPrStd_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub chkRenove_KeyPress(KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub chkVarios_Click(Index As Integer)
    If Index = 16 Then
        'Renovacion
        FrameRenovacionTfno.visible = Me.chkVarios(Index).Value = 1
        lblDpto(46).Caption = "Fecha "
        If Me.chkVarios(Index).Value = 1 Then
            lblDpto(46).Caption = lblDpto(46).Caption & "renovación"
        Else
            lblDpto(46).Caption = lblDpto(46).Caption & "alta"
        End If
    ElseIf Index = 26 Then
        Me.chkVarios(33).visible = Me.chkVarios(Index).Value = 1
    End If
End Sub

Private Sub chkVarios_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
    
    
        
End Sub

Private Sub cmd_Click()
Dim Importe As Currency

    InicializarVbles True
    NumRegElim = 0
    
    Screen.MousePointer = vbHourglass
    
    Label3(96).Caption = "Preparando datos"
    Label3(96).Refresh
    
    miSQL = "DELETE from tmpinformes where codusu =" & vUsu.codigo
    conn.Execute miSQL
    miSQL = ""
    cadPDFrpt = ""
    
    If txtFecha(64).Text <> "" Or txtFecha(65).Text <> "" Then
        miSQL = "pdh1=""Fechas: "
        codigo = "{slifac.fecfactu}"
        If Not PonerDesdeHasta(codigo, "F", 64, 65, miSQL) Then Exit Sub
    End If
    If txtAgente(14).Text <> "" Or txtAgente(15).Text <> "" Then
        miSQL = "pdh2=""Agente: "
        codigo = "{scafac.codagent}"
        If Not PonerDesdeHasta(codigo, "AGT", 14, 15, miSQL) Then Exit Sub
        If cadPDFrpt <> "" Then cadPDFrpt = cadPDFrpt & "              "
        cadPDFrpt = cadPDFrpt & miSQL
    End If
    
    
    

    miSQL = "select scafac.codtipom,scafac.numfactu,scafac.fecfactu, "
    miSQL = miSQL & " scafac1.NumAlbar , scafac1.codtipoa, CodAgent, codclien, Nomclien, DtoPPago, DtoGnral, Sum(ImporteL) ElImporte, PideCliente"
    miSQL = miSQL & " from scafac,scafac1,slifac  WHERE scafac1.Codtipom = scafac.Codtipom And"
    miSQL = miSQL & " scafac1.NumFactu = scafac.NumFactu And  scafac1.FecFactu = scafac.FecFactu And"
    miSQL = miSQL & " scafac1.codtipom = slifac.codtipom And scafac1.NumFactu = slifac.NumFactu And"
    miSQL = miSQL & " scafac1.FecFactu = slifac.FecFactu and scafac1.numalbar=slifac.numalbar and scafac1.codtipoa=slifac.codtipoa"
    If cadSelect <> "" Then
        cadSelect = Replace(cadSelect, "{", "")
        cadSelect = Replace(cadSelect, "}", "")
        miSQL = miSQL & " AND " & cadSelect
    End If
    miSQL = miSQL & " group by 1,2,3,4,5 ORDER BY codagent"
    
    Label3(96).Caption = "Leyendo BD"
    Label3(96).Refresh
    Set miRsAux = New ADODB.Recordset
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    cadPDFrpt = ""
    
    cadTitulo = ""
    While Not miRsAux.EOF
        NumRegElim = NumRegElim + 1
            
        Label3(96).Caption = "Insertando reg: " & NumRegElim
        Label3(96).Refresh
        
        If cadTitulo <> miRsAux!CodAgent Then
            cadTitulo = miRsAux!CodAgent
            cadNomRPT = DBSet(DevuelveDesdeBD(conAri, "nomagent", "sagent", "codagent", cadTitulo), "T")
        End If

        'codusu,codigo1,campo1,campo2,nombre1,nombre2,importe1,importe2
        cadPDFrpt = cadPDFrpt & ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!codClien & "," & cadTitulo
        cadPDFrpt = cadPDFrpt & "," & DBSet(miRsAux!Nomclien, "T") & "," & cadNomRPT & ","
        Importe = 0
        If miRsAux!DtoPPago <> 0 And miRsAux!DtoGnral <> 0 Then Stop
        If miRsAux!DtoPPago <> 0 Then Importe = Importe + (miRsAux!DtoPPago / 100)
        If miRsAux!DtoGnral <> 0 Then Importe = Importe + (miRsAux!DtoGnral / 100)
        
        Importe = 1 - Importe
        Importe = miRsAux!elimporte * Importe
        If miRsAux!PideCliente = 0 Then
            cadPDFrpt = cadPDFrpt & DBSet(Importe, "N") & ",0"
        Else
            cadPDFrpt = cadPDFrpt & "0," & DBSet(Importe, "N")
        End If
        cadPDFrpt = cadPDFrpt & ")"
        
        If Len(cadPDFrpt) > 50000 Then
            Label3(96).Caption = "Actualiza BD "
            Label3(96).Refresh
            
            cadPDFrpt = Mid(cadPDFrpt, 2)
            miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,nombre1,nombre2,importe1,importe2) VALUES " & cadPDFrpt
            conn.Execute miSQL
            cadPDFrpt = ""
            Me.Refresh
            DoEvents
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    If Len(cadPDFrpt) > 0 Then
         cadPDFrpt = Mid(cadPDFrpt, 2)
         miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,nombre1,nombre2,importe1,importe2) VALUES " & cadPDFrpt
         conn.Execute miSQL
    End If
        
    
    Label3(96).Caption = "Actualizando importe"
    Label3(96).Refresh
    miSQL = "UPDATE tmpInformes set importe3=importe1+importe2 WHERE codusu = " & vUsu.codigo
    conn.Execute miSQL
        
    Screen.MousePointer = vbDefault
    Label3(96).Caption = ""
    If NumRegElim > 0 Then
        CadParam = CadParam & "Detalla=" & Abs(Me.chkVarios(31).Value) & "|"
        numParam = numParam + 1
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
    
    
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadNomRPT = "rPedidoDirectoCl.rpt"
        cadPDFrpt = cadNomRPT
        cadTitulo = "Pedidos por cliente directo"
        conSubRPT = False
        vMostrarTree = False
        LlamarImprimir
    End If
End Sub

Private Sub cmdAccionesRealizada_Click()
    
    miSQL = ""
    codigo = ""
    For NumRegElim = 1 To Me.ListView1(0).ListItems.Count
        If Me.ListView1(0).ListItems(NumRegElim).Checked = True Then
            miSQL = "O"
            Exit For
        End If
    Next
    If miSQL = "" Then codigo = "-Seleccione alguna accion"
    miSQL = ""
    For NumRegElim = 1 To Me.ListView1(1).ListItems.Count
        If Me.ListView1(1).ListItems(NumRegElim).Checked = True Then
            miSQL = "O"
            Exit For
        End If
    Next
    If miSQL = "" Then codigo = codigo & vbCrLf & "-Seleccione algun trabajador"
    If codigo <> "" Then
        codigo = "Falta campos: " & vbCrLf & codigo
        MsgBox codigo, vbExclamation
        Exit Sub
    End If
    
    
    'Vamos p'alla
    Screen.MousePointer = vbHourglass
    Set miRsAux = New ADODB.Recordset
    CargarDatosAcciones
    Label3(18).Caption = ""
    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
    If NumRegElim > 0 Then
        'Crgamos el report
        VariablesReportLog
        '-----------------------------------------------
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        conSubRPT = False
        vMostrarTree = True
        LlamarImprimir
    End If
    
    

End Sub



'Mayo 2015
'Dejaremos modificar toooooodo un proveedor (HERBELCA, Roberto)
' Es decir, con que ponga proveedor origen destino
' ya podra continuar con el proceso
' Eso si, si pone familia tiene que ponerlo tooodo
Private Sub cmdActFamiliaMarca_Click()
Dim K As Integer

    CadParam = ""
    'If Me.txtCodProve(26).Text = "" Or Me.txtDescProve(26) = "" Then CadParam = CadParam & "-Proveedor" & vbCrLf
    'O pone proveedor o familia
    If txtFamia(23).Text = "" And Me.txtCodProve(26).Text = "" Then
        MsgBox "En origen debe indicar proveedor y/o  familia  ", vbExclamation
        Exit Sub
    End If
    
    miSQL = ""
    'Si pone familia.prov,marca debe existir
    If Me.txtmarca(3).Text = "" Xor Me.txtDescmarca(3) = "" Then miSQL = miSQL & "- Err Marca" & vbCrLf
    If Me.txtFamia(24).Text = "" Xor Me.txtDescFamia(24) = "" Then miSQL = miSQL & "-Error familia destino" & vbCrLf
    If Me.txtCodProve(27).Text = "" Xor Me.txtDescProve(27) = "" Then miSQL = miSQL & "- Err proveedor" & vbCrLf
    
    If miSQL <> "" Then
        MsgBox miSQL, vbExclamation
        Exit Sub
    End If
    
    'DFestino. ... alguno;  o el proveedor o la la familia
    If txtFamia(24).Text = "" And Me.txtCodProve(27).Text = "" Then
        MsgBox "En destino debe indicar proveedor y/o  familia  ", vbExclamation
        Exit Sub
    End If
    
    
    If Me.txtFamia(23).Text = "" Then
        'SOLO CAMBIA PROVEEDOR
        miSQL = "codprove = " & Me.txtCodProve(26).Text & "|||"
        numParam = 15
    Else
        'origen familia y/o proveedor
        miSQL = "codfamia =" & Me.txtFamia(23)
        If Me.txtCodProve(26).Text <> "" Then miSQL = miSQL & " AND codprove = " & Me.txtCodProve(26).Text
        miSQL = miSQL & "|" & Me.txtFamia(24).Text & "|" & Me.txtmarca(3).Text & "|"
        numParam = 12
    End If
    
    'Nov 2014  Cambia proveedor tb
    If Me.txtCodProve(27).Text <> "" Then
        miSQL = miSQL & Me.txtCodProve(27).Text & "|" & Me.txtDescProve(27).Text & "|"
    Else
        miSQL = miSQL & "-1|Solo cambio familia|"
    End If
    CadenaDesdeOtroForm = "ORIGEN" & vbCrLf
    If Me.txtCodProve(26).Text <> "" Then CadenaDesdeOtroForm = CadenaDesdeOtroForm & "-Proveedor : " & Me.txtCodProve(26).Text & " " & Me.txtDescProve(26).Text & vbCrLf
    If Me.txtFamia(23).Text <> "" Then CadenaDesdeOtroForm = CadenaDesdeOtroForm & "-Familia : " & Me.txtFamia(23).Text & " " & Me.txtDescFamia(23).Text & vbCrLf & vbCrLf
    CadenaDesdeOtroForm = CadenaDesdeOtroForm & vbCrLf & "DESTINO" & vbCrLf
    If Me.txtFamia(24).Text <> "" Then CadenaDesdeOtroForm = CadenaDesdeOtroForm & "Familia : " & Me.txtFamia(24).Text & " " & Me.txtDescFamia(24).Text & vbCrLf
    If Me.txtmarca(3).Text <> "" Then CadenaDesdeOtroForm = CadenaDesdeOtroForm & "Marca: " & Me.txtmarca(3).Text & " " & Me.txtDescmarca(3).Text & vbCrLf
    If Me.txtCodProve(27).Text <> "" Then CadenaDesdeOtroForm = CadenaDesdeOtroForm & "Proveedor " & Me.txtDescProve(27).Text
    
    frmListado4.Opcion = numParam
    frmListado4.vCadena = miSQL
    frmListado4.Show vbModal
    
    If CadenaDesdeOtroForm = "" Then Unload Me
End Sub

Private Sub cmdAgenFamMar_Click()
    Screen.MousePointer = vbHourglass
    Label3(81).Caption = "Inicio proceso"
    Label3(81).Refresh
    
    
    Set miRsAux = New ADODB.Recordset

    If AgenteFamiliaMarca Then
        
        
        CadParam = CadParam & "Detalla=" & Abs(Me.chkVarios(20).Value) & "|"
        cadNomRPT = "1"
        If Me.chkVarios(33).visible Then
            If Me.chkVarios(33).Value = 0 Then cadNomRPT = "0"
        End If
        CadParam = CadParam & "DetallaFam=" & cadNomRPT & "|"
        
        numParam = numParam + 1
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        
        
        If Me.chkVarios(26).Value = 1 Then
            cadTitulo = "Ventas agente-proveedor-marca-familia"
            cadNomRPT = "rAgenFamMarcaProv.rpt"
            vMostrarTree = True
        Else
            cadNomRPT = "rAgenFamMarca.rpt"
            cadTitulo = "Ventas agente-familia-marca"
            vMostrarTree = False
        End If
        cadPDFrpt = cadNomRPT
        
        conSubRPT = False
        
        LlamarImprimir
        
    End If
    
    
    Screen.MousePointer = vbDefault
    Label3(81).Caption = ""
    

End Sub

Private Sub cmdAgua2_Click()
    
    InicializarVbles True
    
    If ListadoContadoresAgua Then
        
        
        
        cadNomRPT = "aguListExportar.rpt"
        cadPDFrpt = cadNomRPT
        cadTitulo = "Facturación agua por periodo"
        conSubRPT = False
        vMostrarTree = False
        LlamarImprimir
    End If
End Sub

Private Sub cmdAguaCanonGeneralitat_Click()
    
    If Me.txtFecha(57).Text = "" Or Me.txtFecha(58).Text = "" Then
        MsgBox "Periodo facturación obligatorio", vbExclamation
        Exit Sub
    End If
    
    
    
    'Ahora. Ya tenemos la facturacion. Veremos todas las facturas
    If ObtenerDatosFacturacionAguaGeneralitat Then
        
        InicializarVbles True
                    
        CadParam = CadParam & "pdh1=""Periódo " & txtFecha(57).Text & " - " & txtFecha(58).Text & """|"
        numParam = numParam + 1
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadNomRPT = "aguFacPeriodo.rpt"
        cadPDFrpt = cadNomRPT
        cadTitulo = "Facturación agua por periodo"
        conSubRPT = False
        vMostrarTree = False
        LlamarImprimir
    End If
End Sub

Private Sub cmdAguaCuotaVarios_Click()
    If Me.txtNombre(2).Text = "" Or Me.txtDecimal(9).Text = "" Then
        MsgBox "Campos obligatorios", vbExclamation
        Exit Sub
    End If
    
'    numparm = MsgBox("¿Desea insertar el concepto a kla facturacion del contador?", vbQuestion + vbYesNoCancel)
'    If numParam = vbCancel Then Exit Sub
'    CadenaDesdeOtroForm = ""
'    If numParam = vbYes Then CadenaDesdeOtroForm = Me.txtNombre(2).Text & "|" & txtDecimal(9).Text & "|"
'
    CadenaDesdeOtroForm = Me.txtNombre(2).Text & "|" & txtDecimal(9).Text & "|"
    Unload Me
End Sub

Private Sub cmdAguaDeclaracion_Click()
    If cbAnyo.Text = "" Then Exit Sub

    If GenerarFicheroPresentacionAgua(CInt(cbAnyo.Text), Label3(92)) Then
        cadNomRPT = App.Path & "\AguaPres.dat"
        CopiarEnDisco False
    
    End If
    Label3(92).Caption = ""
    
End Sub

Private Sub cmdAguaFacturar_Click()
Dim B As Boolean
    codigo = ""
    If Me.txtFecha(54).Text = "" Then
        codigo = vbCrLf & "-Fecha factura"
    Else
        'Vemos si la fecha es correcta para la contabilidad
        If EsFechaOKConta(CDate(txtFecha(54).Text)) > 0 Then codigo = vbCrLf & "-Fecha factura fuera de ejercicios"
    End If
    If Me.txtBanco(4).Text = "" Then codigo = codigo & vbCrLf & "-Banco propio"

    cadTitulo = PonerTrabajadorConectado("")
    If cadTitulo = "" Then codigo = vbCrLf & " -Imposible poner trabajador conectado"

    'Veampos si existe el agente por defecto
    cadTitulo = Val(vParamAplic.PorDefecto_Agente)
    cadTitulo = DevuelveDesdeBD(conAri, "codagent", "sagent", "codagent", cadTitulo)
    If cadTitulo = "" Then codigo = vbCrLf & " -Imposible poner agente por defecto"


    If codigo <> "" Then
        MsgBox "Campos requeridos " & codigo, vbExclamation
        Exit Sub
    End If

    
    

    'Vamos con las comprobaciones
    If Not ComprobacionesAgua Then Exit Sub


    'Pregunta
    
    codigo = DevuelveDesdeBD(conAri, "count(*)", "aguacontadores", "facturar", "1")
    If Val(codigo) = 0 Then
        MsgBox "Ningun dato a facturar"
        Exit Sub
    End If
    
    codigo = "Desa continuar con el proceso de facturacion de los contadores?   (" & codigo & ")"
    If MsgBox(codigo, vbQuestion + vbYesNoCancel) <> vbYes Then Exit Sub
    
    
    
    Screen.MousePointer = vbHourglass
    
    B = procesoFacturacionAgua_
    
    Screen.MousePointer = vbDefault
    Label3(84).Caption = ""
    If B Then Unload Me
    
    


End Sub

Private Sub cmdAguaImportLectura_Click()
Dim LeeLaFechaDelFichero As Boolean
    
    codigo = ""
    LeeLaFechaDelFichero = False
    If Me.txtFecha(56).Text = "" Then
        If Opcion = 53 Then codigo = vbCrLf & "-Fecha obligatoria"
        LeeLaFechaDelFichero = True
    
    Else
        If Opcion = 52 Then
            miSQL = DevuelveDesdeBD(conAri, "max(fecha_anterior)", "aguacontadores", "1", "1")
            If miSQL <> "" Then
                If CDate(miSQL) >= CDate(txtFecha(56).Text) Then codigo = codigo & vbCrLf & "-menor que lectura efectuada " & miSQL
            End If
        End If
    End If
    
    If Opcion = 52 Then
        If TxtFichero(0).Text = "" Then
            codigo = codigo & vbCrLf & "-Falta fichero"
        Else
            If Dir(TxtFichero(0).Text, vbArchive) = "" Then codigo = codigo & vbCrLf & "-No existe fichero"
        End If
    End If
    
    If codigo <> "" Then
        MsgBox "Error campos " & codigo, vbExclamation
        Exit Sub
    End If

    
    Set miRsAux = New ADODB.Recordset
    Screen.MousePointer = vbHourglass
    If Opcion = 53 Then
        ResultadoFuncion = ListadoAguaEmpresa
    Else
        ResultadoFuncion = False
        If BloqueoManual("IMPAGUA", "1") Then
            ResultadoFuncion = ImportarFicherolecturasAgua(LeeLaFechaDelFichero)
            
            
            
                
            
            DesBloqueoManual "IMPAGUA"
        End If
        
    End If
    Screen.MousePointer = vbDefault
    Set miRsAux = Nothing
    Label3(86).Caption = ""
    
    If ResultadoFuncion Then Unload Me
    
    
End Sub

Private Sub cmdAlmaGrupo_Click()
    If txtAlmaGrupo(0).Text = "" Then
        MsgBox "Fecha en blanco", vbExclamation
        Exit Sub
    End If
    
    If Not IsDate(txtAlmaGrupo(0).Text) Then
        MsgBox "Deberia ser una fecha", vbExclamation
        Exit Sub
    End If
    
    
        
    
    
    If MsgBox("Seguro que desea generar los datos", vbQuestion + vbYesNo) = vbNo Then Exit Sub
    
    Label3(54).Caption = "Inicio proceso"
    Label3(54).Refresh
    
    Screen.MousePointer = vbHourglass
    
    
    
    GeneraDatosAlmagrupo 1 + Abs(chkAlmagrupoAnual.Value), Label3(54)
    Screen.MousePointer = vbDefault
    Label3(54).Caption = ""
    
    CadenaDesdeOtroForm = ""
    Unload Me
End Sub



Private Sub cmdAnulados_Click()
        InicializarVbles True
        
        'En el tag del listview tendre todas las incidencias ordenadas asc
        ' y separadas por comas
        
        OtrosDatos = ""
        codigo = Me.lwInci.Tag
        cadNomRPT = ""
        vMostrarTree = True 'Si estan todos marcados
        For NumRegElim = 1 To Me.lwInci.ListItems.Count
            If Not lwInci.ListItems(NumRegElim).Checked Then
                cadNomRPT = ",'" & lwInci.ListItems(NumRegElim).Text & "',"
                codigo = Replace(codigo, cadNomRPT, ",")
                vMostrarTree = False
            End If
        Next
        'Quito la primera coma y la ultima
        If codigo <> "," Then
            codigo = Mid(codigo, 2)
            codigo = Left(codigo, Len(codigo) - 1)
        Else
            codigo = ""
        End If
        
        If codigo = "" Then
            MsgBox "Selecccione algun motivo de anulacion", vbExclamation
            Exit Sub
        End If
        OtrosDatos = codigo
    
        
    
        
        If txtCodTraba(0).Text <> "" Or txtCodTraba(1).Text <> "" Then
            miSQL = "pDHTrabajador=""Trabajador: "
            If Me.optVarios(7).Value Then
                codigo = "{schped"
            Else
                codigo = "{schalb"
            End If
            codigo = codigo & ".trabelim}"
            If Not PonerDesdeHasta(codigo, "TRA", 0, 1, miSQL) Then Exit Sub
            
        End If
        cadNomRPT = ""
        If txtFecha(9).Text <> "" Or txtFecha(10).Text <> "" Then
            miSQL = " Fecha eli.: "
            If Me.optVarios(7).Value Then
                codigo = "{schped.fechelim}"
            Else
                codigo = "{schalb.fechelim}" 'index=6
            End If
            If Not PonerDesdeHasta(codigo, "F", 9, 10, miSQL) Then Exit Sub
            cadNomRPT = miSQL
            
        End If
        
        cadPDFrpt = "schped"
        If Me.optVarios(6).Value Then cadPDFrpt = "schalb"
        miSQL = cadPDFrpt & ".codincid"
        
        'Si no estan todos marcados...
        If Not vMostrarTree Then
            If cadNomRPT <> "" Then cadNomRPT = cadNomRPT & "   "
            cadNomRPT = cadNomRPT & "Incid:" & Replace(OtrosDatos, "'", "")
            
            
            If cadFormula <> "" Then cadFormula = cadFormula & " AND "
            If cadSelect <> "" Then cadSelect = cadSelect & " AND "
            
            cadFormula = cadFormula & " ({" & miSQL & "} IN [" & OtrosDatos & "])"
            cadSelect = cadSelect & " (" & miSQL & " IN (" & OtrosDatos & "))"
            
        End If

        If Not HayRegParaInforme(cadPDFrpt, cadSelect, True) Then
            MsgBox "No hay datos para mostrar con estos valores", vbExclamation
            Exit Sub
        End If
    
        CadParam = CadParam & "pDHFecha=""" & cadNomRPT & """|"
        numParam = numParam + 1

        
'
'        cadParam = cadParam & "pdh2=""" & cadPDFrpt & """|"
'        numParam = numParam + 1
                
        If Me.optVarios(6).Value Then
            cadNomRPT = "rAlbAnulados.rpt"
        Else
            cadNomRPT = "rpedAnulados.rpt"
        End If
        cadPDFrpt = cadNomRPT
        cadTitulo = "ALB/PED anulados"
        conSubRPT = False
        vMostrarTree = True
        LlamarImprimir
   
End Sub

Private Sub cmdArtEnPromo_Click()
    miSQL = ""
    If Me.txtAlma(2).Text = "" Then miSQL = "-Almacen principal" & vbCrLf
    If txtAlma(5).Text = "" And txtAlma(6).Text <> "" Then miSQL = "-Almacen 2 vacio" & vbCrLf
    If Opcion = 5 Then
        If Me.txtFecha(2).Text = "" Then miSQL = miSQL & "-Fecha promocion" & vbCrLf
    Else
        If Me.txtFecha(30).Text = "" Or Me.txtFecha(31).Text = "" Then miSQL = miSQL & "-Fecha obligatorias" & vbCrLf
    End If
    
    If Me.chkVarios(28).Value = 0 Then
        If Me.chkVarios(0).Value = 1 Then
            miSQL = miSQL & vbCrLf & "- No puede detallar cliente si no detalla familia"
        End If
    End If
    
    If miSQL <> "" Then
        MsgBox "Faltan campos: " & vbCrLf & miSQL, vbExclamation
        Exit Sub
    End If
    


    Screen.MousePointer = vbHourglass
    Set miRsAux = New ADODB.Recordset
    
    If Opcion = 5 Then
        ResultadoFuncion = GeneraDatosPromociones
    Else
        ResultadoFuncion = GeneraDatosDotEspecial
    
    End If
    Label3(10).Caption = ""
    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
    
    If ResultadoFuncion Then
        'Llamamos a imprimir
        
            
        InicializarVbles True
    

        miSQL = ""
        If Me.txtArticulo(1).Text <> "" Then miSQL = " desde  " & Me.txtArticulo(1).Text
        If Me.txtArticulo(2).Text <> "" Then miSQL = miSQL & " hasta" & Me.txtArticulo(2).Text
        If miSQL <> "" Then miSQL = miSQL & "        Art: " & miSQL
        
        
        If txtCliente(1).Text <> "" Then miSQL = " desde  " & txtCliente(12).Text
        If txtCliente(2).Text <> "" Then miSQL = miSQL & " hasta" & txtCliente(13).Text

        'ANTEs
        'miSQL = "pdh1=""Almacén: " & txtAlma(2).Text & " " & Me.txtDescAlma(2).Text & miSQL & """|"
        cadPDFrpt = txtAlma(2).Text & " " & Me.txtDescAlma(2).Text
        If txtAlma(5).Text <> "" Then cadPDFrpt = cadPDFrpt & "   " & txtAlma(5).Text & " " & Me.txtDescAlma(5).Text
        If txtAlma(6).Text <> "" Then cadPDFrpt = cadPDFrpt & "   " & txtAlma(6).Text & " " & Me.txtDescAlma(6).Text
        
        
        
        miSQL = "pdh1=""Almacén: " & cadPDFrpt & miSQL & """|"
        
        CadParam = CadParam & miSQL
        numParam = numParam + 1
          
        
        cadPDFrpt = ""
        If txtCodProve(2).Text <> "" Or txtCodProve(3).Text <> "" Then
            miSQL = "Prov: "
            codigo = "{sartic.codprove}"
            If Not PonerDesdeHasta(codigo, "PRO", 2, 3, miSQL) Then Exit Sub
            cadPDFrpt = miSQL
        End If
        If txtFamia(0).Text <> "" Or txtFamia(1).Text <> "" Then
            miSQL = "Fam: "
            codigo = "{sartic.codfamia}"
            If Not PonerDesdeHasta(codigo, "FAM", 0, 1, miSQL) Then Exit Sub
            'If cadPDFrpt <> "" Then cadPDFrpt = cadPDFrpt & "              "
            If cadPDFrpt <> "" Then cadPDFrpt = cadPDFrpt & """ + chr(13) + """
            
            cadPDFrpt = cadPDFrpt & miSQL
        End If
        
        CadParam = CadParam & "pdh2=""" & cadPDFrpt & """|"
        numParam = numParam + 1
            
            
        CadParam = CadParam & "detalla=" & Abs(Me.chkVarios(0).Value) & "|"
        numParam = numParam + 1
                
        If Opcion = 5 Then
            CadParam = CadParam & "DetallaFamilia=" & Abs(Me.chkVarios(28).Value) & "|"
            numParam = numParam + 1
        End If
                 
        'Solo lo tienen dtoesp
        If Opcion = 34 Then
            If txtAgente(4).Text <> "" Or txtAgente(5).Text <> "" Then
                miSQL = "pdH3=""Agente: "
                codigo = "{}"
                If Not PonerDesdeHasta(codigo, "AGT", 4, 5, miSQL) Then Exit Sub

            End If
        End If
        
        
        cadPDFrpt = cadNomRPT
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        If Opcion = 5 Then
            cadNomRPT = "rPromoArtiVta.rpt"
            cadTitulo = "Articulos en promocion"
        Else
            cadTitulo = "Articulos descuento especial"
            If Me.chkVarios(12).Value = 0 Then
                cadNomRPT = "rVtaArtDtoEsp.rpt"
            Else
                cadTitulo = cadTitulo & " (agente)"
                cadNomRPT = "rVtaArtDtoEspAge.rpt"
            End If
        End If
        
        conSubRPT = False
        vMostrarTree = True
        LlamarImprimir
    End If
End Sub


Private Function GeneraDatosPromociones() As Boolean
Dim RT As ADODB.Recordset

    On Error GoTo EGeneraDatosPromociones
    GeneraDatosPromociones = False
    

    'Leer gastos fijos
    Label3(10).Caption = "Leyendo datos"
    Label3(10).Refresh
    
    'Lo metere en : tmpnseries
    miSQL = "DELETE FROM tmpinformes where codusu =" & vUsu.codigo
    conn.Execute miSQL
    
    
    Set RT = New ADODB.Recordset
    miSQL = " select  spromo.*,nomartic,codprove,codfamia from spromo,sartic where spromo.codartic=sartic.codartic"
    miSQL = miSQL & " and fechaini<=" & DBSet(txtFecha(2).Text, "F") & " AND fechafin >= " & DBSet(txtFecha(2).Text, "F")
    'Si ha puesto desde hasta proveedor
    If Me.txtCodProve(2).Text <> "" Then miSQL = miSQL & " AND sartic.codprove >= " & Me.txtCodProve(2).Text
    If Me.txtCodProve(3).Text <> "" Then miSQL = miSQL & " AND sartic.codprove <= " & Me.txtCodProve(3).Text
    'Si ha puesto desde hasta familia
    If Me.txtFamia(0).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia >= " & Me.txtFamia(0).Text
    If Me.txtFamia(1).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia <= " & Me.txtFamia(1).Text
    'Si ha puesto desde hasta codartic
    If Me.txtArticulo(1).Text <> "" Then miSQL = miSQL & " AND sartic.codartic >= " & DBSet(Me.txtArticulo(1).Text, "T")
    If Me.txtArticulo(2).Text <> "" Then miSQL = miSQL & " AND sartic.codartic <= " & DBSet(Me.txtArticulo(2).Text, "T")
    
    RT.Open miSQL, conn, adOpenKeyset, adLockPessimistic, adCmdText
    miSQL = ""
    NumRegElim = 0
    While Not RT.EOF
    
    
    

        
        Label3(10).Caption = RT!codArtic
        Label3(10).Refresh
        If (NumRegElim Mod 10) = 0 Then DoEvents
        
        miSQL = " select codartic,codclien,nomclien,sum(cantidad),sum(importel),sum(preciouc * cantidad) from scafac,scafac1,slifac  WHERE"
        miSQL = miSQL & " scafac1.Codtipom = scafac.Codtipom And scafac1.NumFactu = scafac.NumFactu And scafac1.FecFactu = scafac.FecFactu"
        miSQL = miSQL & " AND scafac1.Codtipom = slifac.Codtipom And scafac1.NumFactu = slifac.NumFactu And scafac1.FecFactu = slifac.FecFactu"
        miSQL = miSQL & " and scafac1.numalbar=slifac.numalbar and scafac1.codtipoa=slifac.codtipoa"
        'Noviembre 2014. Consolida
        'miSQL = miSQL & " AND codalmac = " & txtAlma(2).Text
        miSQL = miSQL & " AND codalmac IN (" & txtAlma(2).Text
        If txtAlma(5).Text <> "" Then miSQL = miSQL & ", " & txtAlma(5).Text
        If txtAlma(6).Text <> "" Then miSQL = miSQL & ", " & txtAlma(6).Text
        miSQL = miSQL & ") AND scafac.fecfactu >=" & DBSet(RT!FechaIni, "F")
        miSQL = miSQL & " AND scafac.fecfactu <=" & DBSet(RT!FechaFin, "F")
        miSQL = miSQL & " AND codartic = " & DBSet(RT!codArtic, "T") & " GROUP BY 1,2"
        miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        If miRsAux.EOF Then
            'NO HA VENDIDO NADA DEL ARTICULO
            
            NumRegElim = NumRegElim + 1
            miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & "," & RT!Codprove & "," & RT!Codfamia
            miSQL = miSQL & ",''"
            miSQL = miSQL & "," & DBSet(RT!codArtic, "T") & "," & DBSet(RT!NomArtic, "T") & ",0"
            miSQL = miSQL & "," & DBSet(RT!FechaIni, "F") & "," & DBSet(RT!FechaFin, "F") & ",0,0,0)"

        Else
            'tmpinformes(codusu,codigo1,campo1,nombre1,nombre2nombre3importe1ifecha1fecha2,campo2,importe2)
            '                            prove  nomcli  codartic nomart  cantidad fini ffin  famia  codclien
            
            While Not miRsAux.EOF
                If DBSet(miRsAux.Fields(3), "N") <> 0 Then
                    NumRegElim = NumRegElim + 1
                    miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & "," & RT!Codprove & "," & RT!Codfamia
                    miSQL = miSQL & "," & DBSet(miRsAux!Nomclien, "T")
                    miSQL = miSQL & "," & DBSet(miRsAux!codArtic, "T") & "," & DBSet(RT!NomArtic, "T") & "," & DBSet(miRsAux.Fields(3), "N")
                    miSQL = miSQL & "," & DBSet(RT!FechaIni, "F") & "," & DBSet(RT!FechaFin, "F") & "," & miRsAux!codClien & "," & DBSet(miRsAux.Fields(4), "N")
                    miSQL = miSQL & "," & DBSet(miRsAux.Fields(5), "N") & ")"  'coste
                End If
                miRsAux.MoveNext
            Wend
        End If
        
        miRsAux.Close
        If miSQL <> "" Then
            miSQL = Mid(miSQL, 2)                                                                                               'imporline
            miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,nombre1,nombre2,nombre3,importe1,fecha1,fecha2,importe2,importeb1,importeb2) VALUES " & miSQL
            conn.Execute miSQL
        End If
        RT.MoveNext
    Wend
    RT.Close

    If NumRegElim = 0 Then
        MsgBox "No hay datos con estos valores", vbExclamation
    Else
        GeneraDatosPromociones = True
    End If
EGeneraDatosPromociones:
    If Err.Number <> 0 Then MuestraError Err.Number
    Set RT = Nothing
End Function

Private Sub cmdArtixFactura_Click()
    
        InicializarVbles True
    
        cadPDFrpt = ""
        If txtCodProve(14).Text <> "" Or txtCodProve(15).Text <> "" Then
            miSQL = " Prov: "
            codigo = "{sartic.codprove}"
            If Not PonerDesdeHasta(codigo, "PRO", 14, 15, miSQL) Then Exit Sub
            cadPDFrpt = miSQL
        End If
        If txtFamia(8).Text <> "" Or txtFamia(9).Text <> "" Then
            miSQL = " Fam: "
            codigo = "{sartic.codfamia}"
            If Not PonerDesdeHasta(codigo, "FAM", 8, 9, miSQL) Then Exit Sub
            If cadPDFrpt <> "" Then cadPDFrpt = cadPDFrpt & "              "
            cadPDFrpt = cadPDFrpt & miSQL
        End If
        
        CadParam = CadParam & "pdh1=""" & cadPDFrpt & """|"
        numParam = numParam + 1
    
        cadPDFrpt = ""
        If txtArticulo(7).Text <> "" Or txtArticulo(8).Text <> "" Then
            miSQL = " Art: "
            codigo = "{sartic.codartic}"
            If Not PonerDesdeHasta(codigo, "ART", 7, 8, miSQL) Then Exit Sub
            cadPDFrpt = miSQL
        End If
        
        If txtFecha(12).Text <> "" Or txtFecha(13).Text <> "" Then
            miSQL = " Fecha: "
            codigo = "{slifac.fecfactu}"
            If Not PonerDesdeHasta(codigo, "F", 12, 13, miSQL) Then Exit Sub
            If cadPDFrpt <> "" Then cadPDFrpt = cadPDFrpt & "              "
            cadPDFrpt = cadPDFrpt & miSQL
        End If
    
        If txtCliente(4).Text <> "" Or txtCliente(5).Text <> "" Then
            miSQL = " Cli: "
            codigo = "{scafac.codclien}"
            If Not PonerDesdeHasta(codigo, "CLI", 4, 5, miSQL) Then Exit Sub
            If cadPDFrpt <> "" Then cadPDFrpt = cadPDFrpt & "              "
            cadPDFrpt = cadPDFrpt & miSQL
        End If
    
    
        CadParam = CadParam & "pdh2=""" & cadPDFrpt & """|"
        numParam = numParam + 1
        
        
        codigo = " scafac.codtipom=slifac.codtipom and scafac.numfactu=slifac.numfactu and scafac.fecfactu=slifac.fecfactu AND slifac.codartic=sartic.codartic"
        
        If cadSelect <> "" Then codigo = codigo & " AND " & cadSelect
        Screen.MousePointer = vbHourglass
        If Not HayRegParaInforme("scafac,slifac,sartic", codigo, True) Then
            MsgBox "No hay datos para mostrar con estos valores", vbExclamation

        Else
        
            cadTitulo = "Listado articulos por factura"
            cadPDFrpt = ""
            cadNomRPT = "rArtiVentas"
            If optVarios(9).Value Then cadNomRPT = cadNomRPT & "ART"
            cadNomRPT = cadNomRPT & ".rpt"
            conSubRPT = False
            vMostrarTree = True
            LlamarImprimir

        End If
        Screen.MousePointer = vbDefault
End Sub

Private Sub cmdArtMasVendidos_Click()

        InicializarVbles True
    
        cadPDFrpt = ""
 
        If txtFecha(38).Text <> "" Or txtFecha(39).Text <> "" Then
            miSQL = " Fecha alb: "
            codigo = "{scafac1.fechaalb}"
            If Not PonerDesdeHasta(codigo, "F", 38, 39, miSQL) Then Exit Sub
            cadPDFrpt = miSQL
            
        End If
        If txtFamia(19).Text <> "" Or txtFamia(20).Text <> "" Then
            miSQL = " Fam: "
            codigo = "{sartic.codfamia}"
            If Not PonerDesdeHasta(codigo, "FAM", 19, 20, miSQL) Then Exit Sub
            If cadPDFrpt <> "" Then cadPDFrpt = cadPDFrpt & "              "
            cadPDFrpt = cadPDFrpt & miSQL
        End If
        
        CadParam = CadParam & "pdh1=""" & cadPDFrpt & """|"
        numParam = numParam + 1
        
        If Me.optArtMasVendidos(0).Value Then
            cadPDFrpt = Me.optArtMasVendidos(0).Caption
            miSQL = "1"
        Else
            cadPDFrpt = Me.optArtMasVendidos(1).Caption
            miSQL = "2"
        End If
        miSQL = "{tmpinformes.importe" & miSQL
        CadParam = CadParam & "Orden=" & miSQL & "}|"
        numParam = numParam + 1
        
        
        
        cadPDFrpt = "Orden: " & cadPDFrpt & "   "
        If txtCodProve(24).Text <> "" Or txtCodProve(25).Text <> "" Then
            miSQL = "Proveedor: "
            codigo = "{sartic.codprove}"
            If Not PonerDesdeHasta(codigo, "PRO", 24, 25, miSQL) Then Exit Sub
            cadPDFrpt = cadPDFrpt & miSQL
        End If
        CadParam = CadParam & "pdh2=""" & cadPDFrpt & """|"
        numParam = numParam + 1

        Screen.MousePointer = vbHourglass
        If GenerarArticulosMasVendidos Then
            cadTitulo = "Articulos mas vendidos"
            cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
            cadPDFrpt = ""
            cadNomRPT = "rArtmasVendido.rpt"
            conSubRPT = False
            vMostrarTree = False
            LlamarImprimir

        
        End If
        Screen.MousePointer = vbDefault


End Sub

Private Sub cmdBanco_Click(Index As Integer)
Dim V As Currency

    If ListView1(3).ListItems.Count = 0 Then Exit Sub
    If ListView1(3).SelectedItem Is Nothing Then Exit Sub
    
    If Index = 2 Then
        'Eliminar
        
        miSQL = "Seguro que quiere quitar del listado a " & ListView1(3).SelectedItem.SubItems(1) & "?"
        If MsgBox(miSQL, vbQuestion + vbYesNo) = vbYes Then ListView1(3).ListItems.Remove ListView1(3).SelectedItem.Index
    Else
        miSQL = InputBox("Nuevo importe: " & ListView1(3).SelectedItem.SubItems(1), "Banco", ListView1(3).SelectedItem.SubItems(2))
        If miSQL <> "" Then
            If IsNumeric(miSQL) Then
                If InStr(1, miSQL, ",") > 0 Then
                    V = ImporteFormateado(miSQL)
                Else
                    V = CCur(TransformaPuntosComas(miSQL))
                End If
                ListView1(3).SelectedItem.SubItems(2) = Format(V, FormatoImporte)
            Else
                MsgBox "Importe incorrecto: " & miSQL, vbExclamation
            End If
        End If
    
    End If
End Sub

Private Sub cmdBancoFAZ_Click()
    
    If CDate(txtFecha(55).Text) < vEmpresa.FechaIni Or CDate(txtFecha(55).Text) > DateAdd("yyyy", 1, vEmpresa.FechaFin) Then
        MsgBox "Fechas fuera de ejercicio", vbExclamation
        PonerFoco txtFecha(55)
        Exit Sub
    End If
    
    
    If Me.txtBanco(3).Text = "" Or Me.txtDescBanco(3).Text = "" Then
        MsgBox "Banco incorrecto", vbExclamation
        Exit Sub
    End If
    
    If MsgBox("Desea realizar la factura?", vbQuestion + vbYesNo) = vbNo Then Exit Sub
    
    CadenaDesdeOtroForm = "OK#" & txtBanco(3).Text & "|" & Me.txtFecha(55).Text & "|"
    Unload Me
End Sub

Private Sub cmdCalcPortes_Click()
    CadenaDesdeOtroForm = "VALE"
    Unload Me
End Sub

Private Sub cmdCancelar_Click(Index As Integer)
    If Index = 0 Then
        MsgBox "Debes indicar el motivo del cambio de precio/descuento", vbExclamation
        Exit Sub
    End If
    If Index = 10 Or Index = 28 Or Index = 45 Or Index = 54 Then CadenaDesdeOtroForm = ""
    
    
    Unload Me
End Sub

Private Sub cmdCesce_Click()
    Screen.MousePointer = vbHourglass
    If GeneracionFicheroCESCE Then CopiarEnDisco True
    Screen.MousePointer = vbDefault
            
    
End Sub

Private Sub cmdClivaarios_Click()
    
    InicializarVbles True
    If txtNumEntero(1).Text <> "" Or txtNumEntero(2).Text <> "" Then
        miSQL = "pdH1=""Cod. postal: "
        If txtNumEntero(1).Text <> "" Then
            miSQL = miSQL & "  desde " & txtNumEntero(1).Text
            codigo = "{sclvar.codpobla} >= """ & txtNumEntero(1).Text & """"
            If Not AnyadirAFormula(cadFormula, codigo) Then Exit Sub
        End If
        If txtNumEntero(2).Text <> "" Then
            miSQL = miSQL & "  hasta " & txtNumEntero(2).Text
            codigo = "{sclvar.codpobla} <= """ & txtNumEntero(2).Text & """"
            If Not AnyadirAFormula(cadFormula, codigo) Then Exit Sub
        End If
        CadParam = CadParam & miSQL & """|"
        numParam = numParam + 1
        
    End If
    
    codigo = cadFormula 'cambia la variable en el sub de abajo
    If Not HayRegParaInforme("sclvar", codigo, True) Then
        MsgBox "No hay datos para mostrar con estos valores", vbExclamation
        Exit Sub
    End If
    
    If optVarios(3).Value = 0 Then
        'Listado NIF
        cadTitulo = "List. clientes varios NIF"
        cadNomRPT = "rFacClivarNIF.rpt"
        cadPDFrpt = cadNomRPT
    
    Else
        cadTitulo = "List. clientes varios poblacion"
        cadNomRPT = "rFacClivar.rpt"
        cadPDFrpt = cadNomRPT
        
        If Me.optVarios(4).Value Then
            codigo = "nomclien"
        Else
            codigo = "nifclien"
        End If
        codigo = "{sclvar." & codigo & "}"
        CadParam = CadParam & "orden2=" & codigo & "|"
        numParam = numParam + 1
    End If
    
    LlamarImprimir
    
    
    
End Sub

Private Sub cmdComisiones_Click()
    
    
    
    
    miSQL = "DELETE FROM tmpinformes where codusu = " & vUsu.codigo
    conn.Execute miSQL
    
    InicializarVbles True
    
    
    
    If txtFecha(45).Text <> "" Or txtFecha(46).Text <> "" Then
        miSQL = " Fecha: "
        codigo = "{slifac.fecfactu}"
        If Not PonerDesdeHasta(codigo, "F", 45, 46, miSQL) Then Exit Sub
        cadNomRPT = miSQL
        
    End If
    If txtAgente(8).Text <> "" Or txtAgente(9).Text <> "" Then
        miSQL = "Agente: "
        codigo = "{scafac.codagent}"
    
        If Not PonerDesdeHasta(codigo, "AGT", 8, 9, miSQL) Then Exit Sub
        cadNomRPT = Trim(cadNomRPT & "   " & miSQL)
    End If
    
    
    'Sept 2015
    
    If Me.chkVarios(30).Value = 1 Then cadNomRPT = Trim(cadNomRPT & "    Presu.")
      
    
    
    CadParam = CadParam & "pdh1=""" & cadNomRPT & """|"
    numParam = numParam + 1
    CadParam = CadParam & "Detalla=" & chkVarios(17).Value & "|"
    numParam = numParam + 1
    
    Screen.MousePointer = vbHourglass
    Set miRsAux = New ADODB.Recordset
    conSubRPT = HazComisionesEco   'FUNCION
    Set miRsAux = Nothing
    
    If conSubRPT Then
        conSubRPT = False
        

        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        
        cadTitulo = "Listado comisiones ECO"
        cadNomRPT = "rComisionesECO.rpt"
        cadPDFrpt = cadNomRPT

        codigo = "{sclvar." & codigo & "}"
        CadParam = CadParam & "orden2=" & codigo & "|"
        numParam = numParam + 1
    
    
        LlamarImprimir
        
        
        
    End If
    Screen.MousePointer = vbDefault
    Label3(72).Caption = ""

    
End Sub

Private Sub cmdComisionesMes_Click()
Dim B As Boolean
    
    
    'Comprobacion. No puede tener genrados datos hoy
    
    
    miSQL = "Seguro que desea continuar con el proceso?"
    If MsgBox(miSQL, vbQuestion + vbYesNo) = vbNo Then Exit Sub
    
    
    If BloqueoManual("COMISIONES", "1") Then
        Screen.MousePointer = vbHourglass
        Set miRsAux = New ADODB.Recordset
        B = GeneraComisionesMes
        Screen.MousePointer = vbDefault
        Set miRsAux = Nothing
        Label3(57).Caption = ""
        
        If B Then
            Espera 0.5
            Me.txtFecha(27).Text = FI: Me.txtFecha(28).Text = FF
            txtAgente(2).Text = "": txtAgente(3).Text = ""
            cmdListComisionAgente_Click
        End If


        DesBloqueoManual "COMISIONES"
        If B Then Unload Me
    End If
End Sub


Private Sub cmdControDirEnv_Click()
    CadenaDesdeOtroForm = Trim(txtCliente(22).Text) & "|" & Trim(txtCliente(23).Text) & "|"
    If Trim(txtFecha(52).Text) <> "" Then CadenaDesdeOtroForm = CadenaDesdeOtroForm & Format(txtFecha(52).Text, FormatoFecha)
    CadenaDesdeOtroForm = CadenaDesdeOtroForm & "|"
    If Trim(txtFecha(53).Text) <> "" Then CadenaDesdeOtroForm = CadenaDesdeOtroForm & Format(txtFecha(53).Text, FormatoFecha)
    CadenaDesdeOtroForm = CadenaDesdeOtroForm & "|"
    
    
        
    Screen.MousePointer = vbHourglass
    frmListado4.vCadena = CStr(CadenaDesdeOtroForm)
    frmListado4.Opcion = 11
    frmListado4.Show vbModal

    
    
End Sub

Private Sub cmdControlDtoActiv_Click()

    InicializarVbles True
    If txtCliente(2).Text <> "" Or txtCliente(3).Text <> "" Then
        miSQL = "pdH1=""Cliente: "
        codigo = "{sclien.codclien}"
        If Not PonerDesdeHasta(codigo, "CLI", 2, 3, miSQL) Then Exit Sub
    End If
    If txtcodactiv(0).Text <> "" Or txtcodactiv(1).Text <> "" Then
        miSQL = "pdH2=""Actividad: "
        codigo = "{sclien.codactiv}"
        If Not PonerDesdeHasta(codigo, "ACT", 0, 1, miSQL) Then Exit Sub
    End If
    
    Screen.MousePointer = vbHourglass
    Set miRsAux = New ADODB.Recordset

    If ComprobacionDtosActiv Then
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadTitulo = "Control error descuentos"
        cadNomRPT = "rDtoComprobar.rpt"
        cadPDFrpt = cadNomRPT
        vMostrarTree = True
        LlamarImprimir
    End If
    
    
    
    Label3(27).Caption = ""
    Screen.MousePointer = vbDefault
    Set miRsAux = Nothing

End Sub

Private Sub cmdDerrama_Click()
    
    'Comprabciones básicas
    miSQL = ""
    If txtDecimal(17).Text = "" Then miSQL = miSQL & "- Importe     "
    If txtArticulo(15).Text = "" Then
        miSQL = miSQL & "- Artículo     "
    Else
        If txtDescArticulo(15).Text = "" Then miSQL = miSQL & "- Artículo     "
    End If
    
    If txtFecha(62).Text = "" Then miSQL = miSQL & "- Importe      "
 
    If miSQL <> "" Then
        MsgBox "Campos obligatorios: " & vbCrLf & miSQL, vbExclamation
        Exit Sub
    End If
 
 
    Set miRsAux = New ADODB.Recordset
    cadTitulo = ""
    
    miSQL = "select distinct(codclien)  from sclienhuertos where fecbajas is null "
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    NumRegElim = 0
    While Not miRsAux.EOF
        NumRegElim = NumRegElim + 1
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    If NumRegElim = 0 Then
        MsgBox "Ningun dato!!!", vbExclamation
        Exit Sub
    End If
    
    miSQL = "select count(*),sum(round(supderec,2)) from sclienhuertos where fecbajas is null "
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    'NO PUEDE SER EOF
    miSQL = "Socios: " & NumRegElim & "     "
    miSQL = miSQL & "Campos: " & miRsAux.Fields(0) & vbCrLf & vbCrLf
    miSQL = miSQL & "Total Hanegadas: " & miRsAux.Fields(1) & vbCrLf & vbCrLf
    miSQL = miSQL & "Euros x hanegada: " & txtDecimal(17).Text & "" & vbCrLf
    miSQL = miSQL & "Total facturacion: " & Format(Round(ImporteFormateado(txtDecimal(17).Text) * miRsAux.Fields(1), 2), FormatoImporte) & ""
    
    miRsAux.Close
    
    miSQL = miSQL & vbCrLf & vbCrLf & "¿Continuar con el proceso?"
    
    
    NumRegElim = 0
    If MsgBox(miSQL, vbQuestion + vbYesNo) = vbYes Then
        Screen.MousePointer = vbHourglass
        
        
        InsertarAlbaranesMarjalChipos
        
        Screen.MousePointer = vbDefault
    End If
    Set miRsAux = Nothing
    Label3(93).Caption = ""
    If NumRegElim > 0 Then Unload Me
End Sub




Private Sub cmdDescuentos_Click()


    InicializarVbles True
    
    If chkVarios(1).Value = 0 And chkVarios(2).Value = 1 Then
        MsgBox "El descuento particulares solo para listado con descuentos", vbExclamation
        chkVarios(2).Value = 0
    End If
    
    If txtCodProve(11).Text <> "" Or txtCodProve(12).Text <> "" Then
        miSQL = " Prov: "
        codigo = "{sfamia.codprove}"
        If Not PonerDesdeHasta(codigo, "PRO", 11, 12, miSQL) Then Exit Sub
        cadPDFrpt = miSQL
    End If
    
    If txtFamia(6).Text <> "" Or txtFamia(7).Text <> "" Then
        miSQL = " Fam: "
        codigo = "{sfamia.codfamia}"
        If Not PonerDesdeHasta(codigo, "FAM", 6, 7, miSQL) Then Exit Sub
        If cadPDFrpt <> "" Then cadPDFrpt = cadPDFrpt & "              "
        cadPDFrpt = cadPDFrpt & miSQL
    End If
    CadParam = CadParam & "pdh=""" & cadPDFrpt & """|"
    numParam = numParam + 1
    cadPDFrpt = ""
    
    CadParam = CadParam & "Particulares=" & chkVarios(2).Value & "|"
    numParam = numParam + 1
    
    
    If chkVarios(1).Value = 1 Then
        'Hacemos el select este y cargamos tmpinformes
        If Not CargarDatosFamiliasDtoEnTmp Then Exit Sub
        
    End If
    
    
    If chkVarios(1).Value = 0 Then
        'Listado familias tradicional
        cadTitulo = "Listado Familia de Artículos"
        cadNomRPT = "rAlmFamArtic.rpt"
        cadPDFrpt = cadNomRPT
    
    Else
        cadFormula = "{tmpcommand.codusu} = " & vUsu.codigo
        cadTitulo = "Listado Familia / Descuentos"
        cadNomRPT = "rFamiaDtos.rpt"
        cadPDFrpt = cadNomRPT
    End If
    
    LlamarImprimir
    
'    With frmImprimir
'        .FormulaSeleccion = cadFormula
'        .OtrosParametros = cadParam
'        .NumeroParametros = numParam
'        .SoloImprimir = False
'        .EnvioEMail = False
'        .Opcion = 5
'        .Titulo = "Listado Familia de Artículos"
'        .NombreRPT = "rAlmFamArtic.rpt"  'Nombre fichero .rpt a Imprimir
'        .Show vbModal
'    End With

End Sub

Private Sub cmdExportAlmagrupo_Click()
    
    codigo = ""
    'Si marca compras 2 años no puede marcar stocks (datos almacen)
    
    If Me.chkVarios(9).Value = 0 And chkVarios(8).Value = 0 Then codigo = "Selecione alguna de las opciones"
    

    
    If codigo <> "" Then
        MsgBox codigo, vbExclamation
        Exit Sub
    End If
    
    If Not PrepararCarpetasEnvioMail(False) Then Exit Sub
    
    'app.Path & "\temp
    
    Screen.MousePointer = vbHourglass
    Label3(55).Caption = ""
    If DatosGeneradosExportacionAlmagrupo(Me.chkVarios(9).Value = 1, Me.chkVarios(8).Value = 1, Label3(55)) Then
        ExportarDatosFTP Label3(55)
    End If
    Label3(55).Caption = ""
    Screen.MousePointer = vbDefault
End Sub

Private Sub cmdExportarFAS_Click()
    
    Screen.MousePointer = vbHourglass
    If GenerarFicheroExportarFAS Then
        'OK, pedimos donde gaurdar
        CopiarEnDisco False
        If numParam = 2 Then Unload Me
    End If
    Screen.MousePointer = vbDefault
End Sub

Private Sub cmdFacturarRenting_Click()
    
    If Me.cboMes(1).ListIndex < 0 Or Me.txtAnyo(2).Text = "" Then
        MsgBox "Seleccione el peridodo facturacion", vbExclamation
        Exit Sub
    End If
    miSQL = DiasMes(Me.cboMes(1).ListIndex + 1, CInt(Me.txtAnyo(2).Text))
    txtFecha(17).Text = Right("0" & miSQL, 2) & "/" & Right("00" & Me.cboMes(1).ListIndex + 1, 2) & "/" & txtAnyo(2).Text
    
    miSQL = ""
    If Me.txtFecha(17).Text = "" Then miSQL = miSQL & vbCrLf & " -Fecha"
    If Opcion <> 23 Then
        If Me.txtBanco(0).Text = "" Then
            miSQL = miSQL & vbCrLf & " -Banco"
        Else
            If Me.txtDescBanco(0).Text = "" Then miSQL = miSQL & vbCrLf & " -Banco(2)"
        End If
        If Me.txtFecha(24).Text = "" Then miSQL = miSQL & vbCrLf & " -Fecha factura"

    End If
    If miSQL <> "" Then
        MsgBox "Campos obligados: " & miSQL, vbExclamation
        Exit Sub
    End If
    
    
    'MAYO 2012
    'Se puede facturar mensual, trimestral,smestral o anual
    'Es decir, veremos si ya se ha facturado el periodo y cual le toca facturar
    If OtrosDatos <> "" Then
        miSQL = Mid(OtrosDatos, 1, InStr(1, OtrosDatos, " AND ") - 1)
        miSQL = Mid(miSQL, InStr(miSQL, " = ") + 2)
        
        miSQL = DevuelveDesdeBD(conAri, "max(ultfec)", "sclienrenting", "codclien", miSQL)
        If miSQL = "" Then
            'No hay nada facturado
        
        Else
            'Veremos si la fecha de ultima factura es la que toca
            If CDate(miSQL) < Me.txtFecha(17).Text Then
                codigo = "El periodo NO ha sido facturado"
                If MsgBox(codigo & vbCrLf & "¿Continuar?", vbQuestion + vbYesNo) <> vbYes Then Exit Sub
            Else
                
            End If
        End If
    End If
    
    
    'Ahora se factura MEs, trimestre, semestre o AÑO
    'Por lo cual, la fecha de factura NOS indicara el mes a facturar
    If Opcion = 22 Then
        HacerFacturaRenting
    Else
        HacerPreFactRenting
    End If
    Me.Label3(47).Caption = ""
End Sub

'Fecha del ultimo dia del mes
Private Sub MontaSQLRenting(Fecha As Date, UlT_fec_Nul As Boolean)

    miSQL = miSQL & " AND fecbaja > '" & Format(Fecha, FormatoFecha) & "'"
    If UlT_fec_Nul Then
        miSQL = miSQL & " AND (ultfec is null or  adddate(ultfec,INTERVAL TipoFraRenting MONTH )  <= '" & Format(Fecha, FormatoFecha) & "')"
    Else
        miSQL = miSQL & " AND (  adddate(ultfec,INTERVAL TipoFraRenting MONTH ) <= '" & Format(Fecha, FormatoFecha) & "')"
    End If
    
    If Me.txtCliente(10).Text <> "" Then miSQL = miSQL & " AND sclienrenting.codclien >= " & txtCliente(10).Text
    If Me.txtCliente(11).Text <> "" Then miSQL = miSQL & " AND sclienrenting.codclien <= " & txtCliente(11).Text
    
    '2014. Estaba solo en la prefacturacion
    '2013 Octubre. La fecha de alta debe ser menor o igual al periodo que vamos a prefacturar
    miSQL = miSQL & " AND sclienrenting.fecalta<=" & DBSet(Fecha, "F")
End Sub

Private Sub HacerFacturaRenting()
Dim UltFecMes As Date
    codigo = PonerTrabajadorConectado(miSQL)
    If codigo = "" Then
        MsgBox "Error trabajador conectado", vbExclamation
        Exit Sub
    End If
    
    UltFecMes = CDate(txtFecha(17).Text)
    miSQL = DiasMes(CByte(Month(UltFecMes)), CInt(Year(UltFecMes)))
    miSQL = Right("0" & miSQL, 2) & "/" & Month(UltFecMes) & "/" & Year(UltFecMes)
    UltFecMes = CDate(miSQL)
    
    
    If OtrosDatos <> "" Then
        'Estoy facturando UN cliente con un renting acabado de añadir.
        'Le facturare los dias que correspondan
        miSQL = OtrosDatos
    Else
        'D/H cliente
        miSQL = " 1=1"
    End If
    
    
    MontaSQLRenting UltFecMes, True
    
    CadParam = " sclienrenting.codclien=sclien.codclien AND " & miSQL
    CadParam = DevuelveDesdeBD(conAri, "count(*)", "sclienrenting,sclien", CadParam & " AND 1", "1")
    If CadParam = "" Then CadParam = "0"
    If Val(CadParam) = 0 Then
        MsgBox "No existen datos para facturar", vbExclamation
        Exit Sub
    End If
    
    
    
    'Una comprobacion. Comprobaremos si hay rentings
    'cuya ultimo mes facturado sea null, fecha alta sea mas de un mes de antiguedad
    If OtrosDatos = "" Then
        Set miRsAux = New ADODB.Recordset
        miSQL = ""
        FI = DateAdd("m", -1, txtFecha(17).Text)
        FI = CDate("01/" & Format(FI, "mm/yyyy"))
        MontaSQLRenting FI, False
                        'Mayo, añado el tipo facturacion rentint que dira el tipofac:1men 3:tri 6:sem 12:anual
        CadParam = "Select sclienrenting.*,nomclien,TipoFraRenting from  sclienrenting,sclien WHERE sclienrenting.codclien=sclien.codclien  " & miSQL
        CadParam = CadParam & " ORDER BY sclienrenting.codclien,fecalta"
        CadenaDesdeOtroForm = "Cliente   Referencia     F.Alta        Ultima" & vbCrLf & String(50, "=") & vbCrLf
        miRsAux.Open CadParam, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        NumRegElim = -1
        While Not miRsAux.EOF
            
        
        
            If NumRegElim <> miRsAux!codClien Then
                If NumRegElim >= 0 Then CadenaDesdeOtroForm = CadenaDesdeOtroForm & vbCrLf
                CadenaDesdeOtroForm = CadenaDesdeOtroForm & Format(miRsAux!codClien, "0000") & " " & miRsAux!Nomclien & vbCrLf
                NumRegElim = miRsAux!codClien
            End If
            CadParam = Mid(miRsAux!Referencia & Space(15), 1, 15)
            CadenaDesdeOtroForm = CadenaDesdeOtroForm & Space(10) & CadParam & Format(miRsAux!fecalta, "dd/mm/yyyy")
            If Not IsNull(miRsAux!ultfec) Then CadenaDesdeOtroForm = CadenaDesdeOtroForm & "    " & Format(miRsAux!ultfec, "dd/mm/yyyy")
            CadenaDesdeOtroForm = CadenaDesdeOtroForm & vbCrLf
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        Set miRsAux = Nothing
        
        If NumRegElim >= 0 Then

            frmVarios.Opcion = 12
            frmVarios.Show vbModal
            Exit Sub
        End If
        'Lo dejo como estaba  miSQL
         miSQL = " 1=1"
        MontaSQLRenting UltFecMes, True
        
        
        'Si llega aqui preguntamos por seguir
        CadParam = "Seguro que desea facturar Renting y servicios a fecha: " & txtFecha(17).Text & "?"
        If MsgBox(CadParam, vbQuestion + vbYesNo) = vbNo Then Exit Sub
    End If
    
    
    
    FacturarRenting miSQL, txtFecha(24).Text, codigo, txtBanco(0).Text, Me.Label3(47), "", OtrosDatos, CDate(txtFecha(17).Text)
    
    Unload Me
End Sub




Private Sub HacerPreFactRenting()
Dim UltFecMes As Date

    Me.Label3(47).Caption = "Preparando datos"
    miSQL = "DELETE FROM tmpinformes where codusu =" & vUsu.codigo
    conn.Execute miSQL
    
        
    UltFecMes = CDate(txtFecha(17).Text)
    miSQL = DiasMes(CByte(Month(UltFecMes)), CInt(Year(UltFecMes)))
    miSQL = Right("0" & miSQL, 2) & "/" & Month(UltFecMes) & "/" & Year(UltFecMes)
    UltFecMes = CDate(miSQL)
    
    miSQL = "SELECT sclienrenting.*,nomclien,TipoFraRenting from sclienrenting,sclien WHERE "
    miSQL = miSQL & " sclienrenting.codclien=sclien.codclien "
    
    MontaSQLRenting UltFecMes, True
    
    

    
    
    Set miRsAux = New ADODB.Recordset
    
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    NumRegElim = 0
    'codusu ,codigo1,campo1,campo2,nombre1
    miSQL = ""
    While Not miRsAux.EOF
        
        NumRegElim = NumRegElim + 1
        If (NumRegElim Mod 30) = 0 Then
            'codusu ,codigo1,campo1,campo2,nombre1
            InsertartmpprefacRent
        End If
        Select Case Val(miRsAux!TipoFraRenting)
        Case 3
            codigo = "Trimestral"
        Case 6
            codigo = "Semestral"
        Case 12
            codigo = "Anual"
        Case Else
            codigo = "Mensual"
        End Select
        
        miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!codClien & ","
        miSQL = miSQL & DBSet(miRsAux!Id, "N") & "," & DBSet(miRsAux!Nomclien, "T") & "," & DBSet(codigo, "T") & ")"
        
        
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Set miRsAux = Nothing
    InsertartmpprefacRent
    
    If NumRegElim = 0 Then
        MsgBox "Ningun dato generado", vbInformation
    Else
        'mostraremos rpt
        Label3(47).Caption = "Ver informe"
        
        'Informe
        
        
        InicializarVbles True
        
        
        miSQL = "Fecha facturación: " & txtFecha(17).Text & """|"
        
        CadParam = CadParam & "pdh1=""" & Trim(miSQL)
        numParam = numParam + 1
        
        If txtCliente(10).Text <> "" Or txtCliente(11).Text <> "" Then
            miSQL = "pdH2=""Cliente: "
            codigo = ""
            If Not PonerDesdeHasta(codigo, "CLI", 10, 11, miSQL) Then Exit Sub
            
            
            
        End If
       
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadNomRPT = "rPrevFactRenting.rpt"
        cadTitulo = "Prevision facturación renting y servicios"
        conSubRPT = True
        vMostrarTree = False
        LlamarImprimir
    End If
End Sub

Private Sub InsertartmpprefacRent()
    If miSQL = "" Then Exit Sub
    miSQL = Mid(miSQL, 2) 'quitamos coma
    'codusu ,codigo1,campo1,campo2
    miSQL = "INSERT INTO tmpinformes(codusu ,codigo1,campo1,campo2,nombre1,nombre2) VALUES " & miSQL
    ejecutar miSQL, False
    miSQL = ""
End Sub


Private Sub cmdFlotas_Click()
        
     
    miSQL = ""
    For NumRegElim = 1 To Me.ListView1(4).ListItems.Count
        If Me.ListView1(4).ListItems(NumRegElim).Checked Then
            miSQL = "OK"
            Exit For
        End If
    Next
        
    If miSQL = "" Then
        MsgBox "Seleccione alguna indicencia", vbExclamation
        Exit Sub
    End If
        
        
    'Generaremos los dato sobre la tmp
    Screen.MousePointer = vbHourglass
    Set miRsAux = New ADODB.Recordset
    
    If CargaDatosListadoIncidenciasFlotas Then
         Label3(56).Caption = "Abrir informe"
        InicializarVbles True
    
        miSQL = ""
        codigo = "TODAS"
        For NumRegElim = 1 To Me.ListView1(4).ListItems.Count
            If Me.ListView1(4).ListItems(NumRegElim).Checked Then
                miSQL = miSQL & ", " & ListView1(4).ListItems(NumRegElim).Text
            Else
                codigo = ""
            End If
        Next


        If codigo = "" Then
            cadPDFrpt = "Conceptos:" & miSQL
        Else
            cadPDFrpt = ""
        End If
        
        
        miSQL = ""
        If txtFecha(25).Text <> "" Then miSQL = miSQL & "Desde " & txtFecha(25).Text
        If txtFecha(26).Text <> "" Then miSQL = miSQL & " hasta " & txtFecha(26).Text
        
        'Si pone un solo vehiculo
        If txtVehiculo(0).Text <> "" Then miSQL = miSQL & "            Vehiculo:  " & txtVehiculo(0).Text
    
        
        'Añadimos las incidencias
        If cadPDFrpt <> "" Then
            cadPDFrpt = Mid(cadPDFrpt, 2)
            If miSQL <> "" Then miSQL = miSQL & """ + chr(13) + """
            miSQL = miSQL & cadPDFrpt
        End If
        
        
        
        
        CadParam = CadParam & "pdh=""" & Trim(miSQL) & """|"
        numParam = numParam + 1
        

       
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadNomRPT = "rFlotasReg"
        If Me.optVarios(14).Value Then cadNomRPT = cadNomRPT & "in"
        cadNomRPT = cadNomRPT & ".rpt"
        
        cadPDFrpt = cadNomRPT
        cadTitulo = "Informes registro flotas "
        'conSubRPT = True
        vMostrarTree = True
        LlamarImprimir
    
    
    
    End If
    
    
    Label3(56).Caption = ""
    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
End Sub

Private Sub cmdFrarTelefonia_Click()
    If txtBanco(1).Text = "" Then
        MsgBox "Ponga el banco", vbExclamation
    Else
        miSQL = ""
        If vParamAplic.TieneTelefonia2 = 1 Then
            If MsgBox("¿Desea relizar la facturacion?", vbQuestion + vbYesNo) = vbYes Then miSQL = txtBanco(1).Text
        Else
            'COARVAL
            'Nopregunto nada
            miSQL = txtBanco(1).Text
        End If
        If miSQL <> "" Then
                CadenaDesdeOtroForm = miSQL
                Unload Me
        End If
    End If
End Sub

Private Sub cmdGenDtoProv_Click()
    'Comprobaciones
    'Obligado fecha, familia y descuento1
    miSQL = ""
    codigo = vbCrLf & "     "
    If txtFecha(29).Text = "" Then miSQL = miSQL & codigo & "-Fecha"
    If txtFamia(16).Text = "" Then miSQL = miSQL & codigo & "-Familia"
    If txtDecimal(5).Text = "" Then miSQL = miSQL & codigo & "-Descuento"
    If miSQL <> "" Then miSQL = "Campos obligados: " & miSQL
    
    
    'Campos deciaml no puede superior a 100
    codigo = ""
    For NumRegElim = 5 To 8
        If txtDecimal(NumRegElim).Text <> "" Then
            If ImporteFormateado(txtDecimal(NumRegElim)) > 99.99 Then
                codigo = codigo & "1"
            Else
                If ImporteFormateado(txtDecimal(NumRegElim)) < 0 Then codigo = codigo & "1"
            End If
        End If
    Next NumRegElim
        
    If Len(codigo) > 0 Then
        If miSQL <> "" Then miSQL = miSQL & String(3, vbCrLf)
        miSQL = miSQL & "Valores descuento/rappel entre 0 y 99.99"
    End If
    If miSQL <> "" Then
        MsgBox miSQL, vbExclamation
        Exit Sub
    End If
    
    
    cadSelect = ""
    If Me.txtCodProve(22).Text <> "" Then cadSelect = cadSelect & " AND codprove >= " & Me.txtCodProve(22).Text
    If Me.txtCodProve(23).Text <> "" Then cadSelect = cadSelect & " AND codprove <= " & Me.txtCodProve(23).Text
    
    
    
    'Si tiene marcado updatear comprobaremos si hay alguno para updatear
    Set miRsAux = New ADODB.Recordset
    NumRegElim = 0
    If Me.chkVarios(11).Value = 1 Then
        'Actualizara los registros existentes, tanto con fecha como con dtos
        miSQL = "Select count(*) from sdtomp WHERE codfamia = " & Me.txtFamia(16)
        miSQL = miSQL & " AND codmarca"
        
        If txtmarca(0).Text = "" Then
            miSQL = miSQL & " is null"
        Else
            miSQL = miSQL & " = " & txtmarca(0).Text
        End If
        
        If cadSelect <> "" Then miSQL = miSQL & cadSelect
        
        miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        If Not miRsAux.EOF Then
            NumRegElim = DBLet(miRsAux.Fields(0), "N")
        End If
        miRsAux.Close
        
    End If
    
    
    
    'La pregunta
    miSQL = "Va a generar los descuentos de proveedor."
    If NumRegElim > 0 Then miSQL = miSQL & vbCrLf & "Ademas " & NumRegElim & " filas serán actualizadas"
    miSQL = miSQL & vbCrLf & vbCrLf & "¿Continuar?"
    If MsgBox(miSQL, vbQuestion + vbYesNoCancel) = vbYes Then
        
    
    
        'Ok, adelante con el proceso
        Screen.MousePointer = vbHourglass
        GenerarDescuentosProveedor NumRegElim > 0
    
    
    End If
    
    Screen.MousePointer = vbDefault
    Set miRsAux = Nothing
    Label3(16).Caption = "" 'indicador
    
    
    If CadenaDesdeOtroForm <> "" Then Unload Me
End Sub




Private Sub cmdImpSimulacionPedProv_Click(Index As Integer)
Dim Au As String

    If Me.txtCodProve(29).Text = "" Then Exit Sub
    
    miSQL = RecuperaValor(OtrosDatos, 4)
    miSQL = DevuelveDesdeBD(conAri, "codprove", "scappr", "numpedpr", miSQL)
    If Val(Me.txtCodProve(29).Text) = Val(miSQL) Then
        MsgBox "Mismo proveedor que el original", vbExclamation
        Exit Sub
    End If
    
    If Index = 0 Then
        'IMPRIMIR
    
        
        conn.Execute "Delete from tmpinformes where codusu =" & vUsu.codigo
        
        
        miSQL = "INSERT INTO tmpinformes(codusu,codigo1,fecha1,campo1,nombre1,porcen1,fecha2,porcen2,campo2,nombre2,importe1,importe2) "
        miSQL = miSQL & " SELECT " & vUsu.codigo & ", numpedpr , fecpedpr, CodProve, nomprove, DtoGnral, DtoPPago,"
        miSQL = miSQL & " fecentrega, scappr.codforpa,nomforpa ," & DBSet(txtDecimal(15).Text, "N") & "," & DBSet(txtDecimal(16).Text, "N")
        miSQL = miSQL & " FROM scappr,sforpa where scappr.codforpa=sforpa.codforpa AND scappr.numpedpr =" & RecuperaValor(Me.OtrosDatos, 4)
        conn.Execute miSQL
        
        InicializarVbles False
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadNomRPT = "rPedProveeSimu.rpt"
        cadTitulo = "Simular pedido proveedor"
        conSubRPT = True
        vMostrarTree = False
        LlamarImprimir
    
    
    Else
        
        
        'Abre un listview  para ver cuantas lineas cambia de proveedor
        'Lo que hara es poner todas las lineas que no quiera traspasar
        ' El codalmac lo pondra a 250, con lo cual, esas lineas no las pasa
        frmListado5.OpcionListado = 11
        frmListado5.Show vbModal
        
        If CadenaDesdeOtroForm = "" Then Exit Sub
        
        conn.BeginTrans
        Au = RealizarCambiosProveedorPedido2
        If Au <> "" Then
            conn.CommitTrans
            
            CadenaDesdeOtroForm = Au
            Unload Me
        Else
            conn.RollbackTrans
            CadenaDesdeOtroForm = ""
        End If
    
    
    End If
    
    
    
End Sub

Private Sub cmdIncrePrecioPorcentual_Click()
Dim Porcentual As Currency

    miSQL = ""
    If Me.txtFecha(63).Text = "" Then miSQL = "- Fecha cambio"
    If Me.txtDecimal(18).Text = "" Then miSQL = miSQL & vbCrLf & "- % cambio"
    If miSQL <> "" Then
        miSQL = "Debe indicar: " & vbCrLf & miSQL
        MsgBox miSQL, vbExclamation
        Exit Sub
    End If
    
    miSQL = ""
    If Me.txtCodProve(30).Text <> "" Then miSQL = miSQL & " AND sartic.codprove >= " & Me.txtCodProve(30).Text
    If Me.txtCodProve(31).Text <> "" Then miSQL = miSQL & " AND sartic.codprove <= " & Me.txtCodProve(31).Text
    'Si ha puesto desde hasta familia
    If Me.txtFamia(25).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia >= " & Me.txtFamia(25).Text
    If Me.txtFamia(26).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia <= " & Me.txtFamia(26).Text
    
    miSQL = "slista.codartic=sartic.codartic  " & miSQL
    
    'Primera comprobacion.
    'Que en la tarifa no hay datos pendientes de actualizacion
    'select * from sartic,slista where slista.codartic=sartic.codartic
    codigo = miSQL & " AND not fechanue  is null"
    codigo = codigo & " AND 1"
    codigo = DevuelveDesdeBD(conAri, "count(*)", "slista,sartic", codigo, "1")
    If Val(codigo) > 0 Then
        codigo = "Existen " & codigo & " referencias pendientes de actualizar"
        MsgBox codigo, vbExclamation
        Exit Sub
    End If
    
    codigo = miSQL & " AND fechanue is null"
    codigo = miSQL & " AND 1"
    codigo = DevuelveDesdeBD(conAri, "count(*)", "slista,sartic", codigo, "1")
    If Val(codigo) = 0 Then
        codigo = "No existen  articulos para actualizar"
        MsgBox codigo, vbExclamation
        Exit Sub
    Else
        If MsgBox("Va a atualizar " & codigo & " referencias," & vbCrLf & "¿Continuar?", vbQuestion + vbYesNo) <> vbYes Then Exit Sub
    End If
    
   Screen.MousePointer = vbHourglass
   Porcentual = ImporteFormateado(txtDecimal(18).Text)
   Porcentual = Porcentual / 100
   codigo = "UPDATE slista,sartic SET fechanue=" & DBSet(txtFecha(63).Text, "F")
   codigo = codigo & ", precionu = precioac + round( " & DBSet(Porcentual, "N") & " * precioac,5)"
   codigo = codigo & " WHERE " & miSQL
   ejecutar codigo, False
   Screen.MousePointer = vbDefault
End Sub

Private Sub cmdLeerDatosGuardados_Click()
    
    
    
    miSQL = DevuelveDesdeBD(conAri, "count(*)", "straspaso", "1", "1")
    If miSQL = "" Then miSQL = "0"
    
    If Val(miSQL) = 0 Then
        MsgBox "No existen datos guardados", vbExclamation
        Exit Sub
    End If
    
    If BloqueoManual("TRASALMACEN", "1") Then
        frmAlmReposicion.Show vbModal
        DesBloqueoManual "TRASALMACEN"
    End If
End Sub

Private Sub cmdListadoCarnetMani_Click()
    Screen.MousePointer = vbHourglass
    If Me.chkVarios(35).Value = 0 And Me.chkVarios(36).Value = 0 Then
        MsgBox "Seleccione al menos una opcion (Carnet)", vbExclamation
        NumRegElim = 0
    Else
    
        Set miRsAux = New ADODB.Recordset
        Screen.MousePointer = vbHourglass
        HacerListadoFitos
    
        Set miRsAux = Nothing
     
    End If
    Screen.MousePointer = vbDefault
    Label3(97).Caption = ""
    
    If NumRegElim > 0 Then
        cadNomRPT = "rListCarnetMani.rpt"
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        conSubRPT = False
        vMostrarTree = False
        LlamarImprimir
    End If
    
End Sub

Private Sub HacerListadoFitos()
Dim ColClientes As Collection
    Label3(97).Caption = "Leyendo carnets"
    Label3(97).Refresh
    
    codigo = ""
    If Me.txtCliente(26).Text <> "" Then codigo = codigo & " AND codclien >=" & txtCliente(26).Text
    If Me.txtCliente(27).Text <> "" Then codigo = codigo & " AND codclien <=" & txtCliente(27).Text
    
    
    
    conn.Execute "DELETE FROM tmpinformes where codusu =" & vUsu.codigo
    If Me.chkVarios(35).Value = 1 Then
        '                                    codclien  nomcli  nºcarn  vigen tipoc
        miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,nombre1,nombre2,fecha1,nombre3)"
        miSQL = miSQL & " SELECT " & vUsu.codigo & ",codclien,0,nomclien, ManipuladorNumCarnet,"
        miSQL = miSQL & " ManipuladorFecCaducidad,if(ManipuladortipoCarnet=1,'Basico','Cualificado')"
        miSQL = miSQL & " from  sclien where ManipuladortipoCarnet>=1"
        miSQL = miSQL & codigo  'D/H cliente
        miSQL = miSQL & "  order by codclien"
        conn.Execute miSQL
    End If
    
    If Me.chkVarios(36).Value = 1 Then
        '                                    codclien  nomcli  nºcarn  vigen tipoc
        miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,nombre1,nombre2,fecha1,nombre3)"
        miSQL = miSQL & " SELECT " & vUsu.codigo & ",codclien,0,nomclien,null,null,null "
        miSQL = miSQL & "from  sclien where ManipuladortipoCarnet=0"
        miSQL = miSQL & codigo  'D/H cliente
        conn.Execute miSQL
    End If
    
    
    
    Espera 0.2
    Set ColClientes = New Collection
    miSQL = "Select codigo1 from tmpinformes where codusu=" & vUsu.codigo
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    NumRegElim = 0
    miSQL = ""
    
    While Not miRsAux.EOF
        miSQL = miSQL & ", " & miRsAux!Codigo1
        NumRegElim = NumRegElim + 1
        miRsAux.MoveNext
        If miRsAux.EOF Then NumRegElim = 21
            
        If NumRegElim > 20 Then
            ColClientes.Add Mid(miSQL, 2)
            miSQL = ""
            NumRegElim = 0
        End If
    Wend
    miRsAux.Close
    If ColClientes.Count = 0 Then
        NumRegElim = 0
    Else
    
        For NumRegElim = 1 To ColClientes.Count
                
                'Primero veremos los asociados de estos socios
                If Me.chkVarios(37).Value = 1 Then
                    Label3(97).Caption = "Fase " & NumRegElim & "/" & ColClientes.Count
                    Label3(97).Refresh
                    
                    codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo1,nombre1,nombre2,fecha1,nombre3)"
                    codigo = codigo & " SELECT " & vUsu.codigo & ",codclien,id+1,nombre, NumCarnet,"
                    codigo = codigo & " fcaducidad,if(tipoCarnet=1,'Basico','Cualificado') "
                    codigo = codigo & " from  sclienmani where  codclien IN (" & ColClientes.item(NumRegElim) & ") order by codclien"
                    conn.Execute codigo
    
                
                End If
                                
                Label3(97).Caption = "Fase2 " & NumRegElim & "/" & ColClientes.Count
                Label3(97).Refresh
                
                
                miSQL = "Select codclien,max(scafac.fecfactu) from scafac,slifac where "
                miSQL = miSQL & " scafac.fecfactu=slifac.fecfactu and scafac.numfactu=slifac.numfactu "
                miSQL = miSQL & " and scafac.codtipom=slifac.codtipom and scafac.codtipom<>'FRT' and"
                miSQL = miSQL & " numlote<>'' AND codclien in (" & ColClientes.item(NumRegElim) & ") GROUP BY codclien"
                miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
                While Not miRsAux.EOF
                    miSQL = "UPDATE tmpinformes set fecha2=" & DBSet(miRsAux.Fields(1), "F")
                    miSQL = miSQL & " WHERE codusu =" & vUsu.codigo & " AND campo1=0 AND codigo1=" & miRsAux!codClien
                    conn.Execute miSQL
                    miRsAux.MoveNext
                Wend
                miRsAux.Close
        Next
        
    End If
    
    
    
    If Me.chkVarios(36).Value = 1 Then
        Label3(97).Caption = "Eliminando clientes sin datos"
        Label3(97).Refresh
    
        'Quitamos todos aquiellos que no tienen carnet y no han compradp
        miSQL = "DELETE FROM tmpcrmclien WHERE codusu = " & vUsu.codigo
        conn.Execute miSQL
        
        miSQL = "INSERT INTO tmpcrmclien(codusu,codclien) "
        miSQL = miSQL & " SELECT distinct " & vUsu.codigo & ",codclien"
        miSQL = miSQL & " from  sclienmani "
        conn.Execute miSQL
        Espera 0.5
            
        miSQL = "DELETE from tmpinformes where codusu=" & vUsu.codigo
        miSQL = miSQL & " AND nombre2 is null and fecha1 is null"
        miSQL = miSQL & " and not codigo1  in (SELECT codclien from tmpcrmclien where codusu =" & vUsu.codigo & ")"
        conn.Execute miSQL

    End If
    Set ColClientes = Nothing
End Sub

Private Sub cmdListComisionAgente_Click()
    
    'Listado comisiones agentes mensuales
    InicializarVbles True
    
    If txtFecha(27).Text <> "" Or txtFecha(28).Text <> "" Then
        miSQL = "pDhFecha=""Fecha: "
        codigo = "{scomisionhco.fecha}"
    
        If Not PonerDesdeHasta(codigo, "F", 27, 28, miSQL) Then Exit Sub
        
    End If
        
    If txtAgente(2).Text <> "" Or txtAgente(3).Text <> "" Then
        miSQL = "pdHAge=""Agente: "
        codigo = "{scomisionhco.codagent}"
    
        If Not PonerDesdeHasta(codigo, "AGT", 2, 3, miSQL) Then Exit Sub
        
    End If
    
    If Not HayRegParaInforme("scomisionhco", cadSelect, True) Then
            MsgBox "No hay datos para mostrar con estos valores", vbExclamation
            Exit Sub
    End If
    
    If optVarios(15).Value Then
        cadNomRPT = "rPagoComision.rpt"
    Else
        cadNomRPT = "rPagoComisionRes.rpt"
    End If
    cadPDFrpt = cadNomRPT
    cadTitulo = "Pago comisiones"
    conSubRPT = False
    vMostrarTree = False
    LlamarImprimir
     
End Sub

Private Sub cmdListTelefonos_Click()

        ListView2(0).Tag = ""
        miSQL = ""
        codigo = ""
        For numParam = 1 To ListView2(0).ListItems.Count
            If ListView2(0).ListItems(numParam).Checked Then
                miSQL = miSQL & "X"
                codigo = codigo & ", " & ListView2(0).ListItems(numParam).Tag
                ListView2(0).Tag = ListView2(0).Tag & UCase(ListView2(0).ListItems(numParam))
            End If
        Next
        If miSQL = "" Then
            MsgBox "Seleccione alguna compañia"
            Exit Sub
        Else
            If Len(miSQL) = ListView2(0).ListItems.Count Then
                ListView2(0).Tag = ""              'Estan todas
                codigo = ""
            Else
                codigo = Mid(codigo, 2)
                codigo = "{sclientfno.operador} IN [" & codigo & "]"
            End If
        End If
        
        
        InicializarVbles True
        
        
        If codigo <> "" Then
            If Not AnyadirAFormula(cadFormula, codigo) Then Exit Sub
    
            If Not AnyadirAFormula(cadSelect, codigo) Then Exit Sub
        End If
        
        If Me.chkVarios(16).Value = 1 Then
            'RENOVACION
            miSQL = ""
            If Me.txtNumEntero(3).Text = "" Then
                miSQL = "Introduzca el número de meses"
            ElseIf Val(Me.txtNumEntero(3).Text) <= 0 Then
                miSQL = "Numero meses incorrecto"
            End If
            If miSQL <> "" Then
                MsgBox miSQL, vbExclamation
                PonerFoco txtNumEntero(3)
                Exit Sub
            End If
            If txtFecha(42).Text = "" Or txtFecha(43).Text = "" Then
                MsgBox "Debe poner la fecha inicio/fin de la fecha de renovacion", vbExclamation
                NumRegElim = 43
                If txtFecha(42).Text = "" Then NumRegElim = 42
                PonerFoco txtFecha(NumRegElim)
                Exit Sub
            End If
            
            
        End If
        'select sclientfno.* from sclientfno,sclien where sclien.codclien=sclientfno.codclien
        cadPDFrpt = ""
        If txtCliente(18).Text <> "" Or txtCliente(3).Text <> "" Then
            miSQL = "Cliente: "
            codigo = "{sclientfno.codclien}"
            If Not PonerDesdeHasta(codigo, "CLI", 18, 19, miSQL) Then Exit Sub
            cadPDFrpt = miSQL
        End If
        
        If Me.chkVarios(15).Value = 1 Then
            cadPDFrpt = "[Activos]     " & cadPDFrpt
            codigo = "{sclientfno.Inactivo}=0"
            AnyadirAFormula cadFormula, codigo
            AnyadirAFormula cadSelect, codigo
        End If
        
        
        If Me.chkVarios(16).Value = 1 Then
            'RENOVACION
            'Seran aquellos telefonos cuya fecha de alta + n meses
            'este en los valores que nos dice
            'Son obligadas las fechas
            
            cadPDFrpt = cadPDFrpt & "  MESES: " & Me.txtNumEntero(3).Text & "   F.Renovacion: " & Format(txtFecha(42).Text, "dd/mm/yyyy") & "-" & Format(txtFecha(43).Text, "dd/mm/yyyy")
            ',DATE_ADD(OrderDate,INTERVAL 45 DAY)  MYSQL
            'DateAdd ("m",12 , now())  rpt
            'DESDE
            FI = txtFecha(42).Text
            miSQL = "(DateAdd(""m""," & Me.txtNumEntero(3).Text & ",{sclientfno.fecharenove})"
            codigo = miSQL & ">= Date(" & Year(FI) & "," & Month(FI) & "," & Day(FI) & "))"
            AnyadirAFormula cadFormula, codigo
            
            miSQL = "DATE_ADD(fecharenove,INTERVAL " & Me.txtNumEntero(3).Text & " MONTH)"
            codigo = miSQL & ">= " & DBSet(FI, "F")
            AnyadirAFormula cadSelect, codigo
        
            'HASTA
            FI = txtFecha(43).Text
            miSQL = "(DateAdd(""m""," & Me.txtNumEntero(3).Text & ",{sclientfno.fecharenove})"
            codigo = miSQL & "<= Date(" & Year(FI) & "," & Month(FI) & "," & Day(FI) & "))"
            AnyadirAFormula cadFormula, codigo
            
            miSQL = "DATE_ADD(fecharenove,INTERVAL " & Me.txtNumEntero(3).Text & " MONTH)"
            codigo = miSQL & "<= " & DBSet(FI, "F")
            AnyadirAFormula cadSelect, codigo
            
            CadParam = CadParam & "meses=" & Me.txtNumEntero(3).Text & "|"
            numParam = numParam + 1
        
        Else
            'FECHA DE ALTA
            If txtFecha(42).Text <> "" Or txtFecha(43).Text <> "" Then
                miSQL = " Fecha alta "
                codigo = "{sclientfno.fechaalta}"
                If Not PonerDesdeHasta(codigo, "F", 42, 43, miSQL) Then Exit Sub
                cadPDFrpt = Trim(cadPDFrpt & "        " & miSQL)
                
            End If
                
        End If
        
        If ListView2(0).Tag <> "" Then cadPDFrpt = Trim(cadPDFrpt & "   " & ListView2(0).Tag)
        
        
        CadParam = CadParam & "Renovacion=" & chkVarios(16).Value & "|"
        numParam = numParam + 1
        
        CadParam = CadParam & "pdh1=""" & cadPDFrpt & """|"
        numParam = numParam + 1
        
        
        
        Screen.MousePointer = vbHourglass
       
        
        If HayRegParaInforme("sclientfno", cadSelect, False) Then
            cadTitulo = "Listado telefonos"
            cadFormula = cadFormula
            
            cadNomRPT = "rTelefonos.rpt"
            cadPDFrpt = cadNomRPT
            conSubRPT = False
            vMostrarTree = False
            LlamarImprimir

        
        End If
        Screen.MousePointer = vbDefault
        
        
End Sub

Private Sub cmdLogModPrecioDto_Click()
    
    '------------------------------------------------------------------------------
    '  LOG de acciones
    Set LOG = New cLOG
    LOG.Insertar 14, vUsu, Me.txtNombre(1).Text & vbCrLf & Text1.Text
    Set LOG = Nothing
    '-----------------------------------------------------------------------------
    

    PuedeCerrar = True
    Unload Me
End Sub

Private Sub cmdModCoste_Click()
Dim margen As Currency
    If Me.txtDecimal(1).Text = "" Then
        MsgBox "Ponga el valor del margen", vbExclamation
        Exit Sub
    End If
    margen = ImporteFormateado(txtDecimal(1).Text)
    If margen = 0 Then
        MsgBox "El valor del margen NO puede ser cero", vbExclamation
        Exit Sub
    End If
    
    'QUITO EL ORDER BY
    NumRegElim = InStr(1, OtrosDatos, " ORDER BY ")
    If NumRegElim > 0 Then OtrosDatos = Mid(OtrosDatos, 1, NumRegElim)
    
    
    
    
    '----------------------------------
    NumRegElim = InStr(1, OtrosDatos, " from ")
    If NumRegElim = 0 Then
        MsgBox "Error en SQL.  Avise soporte técnico", vbExclamation
        Exit Sub
    End If
    
    OtrosDatos = Mid(OtrosDatos, NumRegElim)
    
    
    miSQL = "Select count(*) " & OtrosDatos
    Set miRsAux = New ADODB.Recordset
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    NumRegElim = 0
    If Not miRsAux.EOF Then NumRegElim = DBLet(miRsAux.Fields(0), "N")
    miRsAux.Close
    
    If NumRegElim = 0 Then
        MsgBox "Ningun dato a actualizar", vbExclamation
    Else
        miSQL = "Va a actualizar " & NumRegElim & " registros aplicandoles el margen: " & txtDecimal(1).Text
        miSQL = miSQL & vbCrLf & vbCrLf & "¿Continuar?"
        If MsgBox(miSQL, vbQuestion + vbYesNo) = vbNo Then NumRegElim = 0
    End If
    
    Screen.MousePointer = vbHourglass
    If NumRegElim > 0 Then AplicarMargenCostes margen
        
    Label3(29).Caption = ""
    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
    
    
    If CadenaDesdeOtroForm <> "" Then Unload Me
End Sub



Private Sub AplicarMargenCostes(margen As Currency)
Dim J As Long
Dim Aux As Currency

    On Error GoTo EAplicarMargenCostes

    'Leer gastos fijos
    Label3(29).Caption = "Leyendo datos"
    Label3(29).Refresh
    
    miSQL = "Select slifac.* " & OtrosDatos
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    J = 0
    While Not miRsAux.EOF
        J = J + 1
        Label3(29).Caption = J & " de " & NumRegElim & "   " & miRsAux!codArtic
        Label3(29).Refresh
    
        'No es precioar
        If miRsAux!cantidad = 0 Then
            Aux = 0
        Else
            Aux = miRsAux!ImporteL / miRsAux!cantidad
            Aux = Round2(Aux / margen, 4)
       End If
       
       If Aux <> 0 Then
            miSQL = "UPDATE slifac set preciouc = " & DBSet(Aux, "N")
            miSQL = miSQL & ", preciomp = " & DBSet(Aux, "N")
            miSQL = miSQL & ",preciost = " & DBSet(Aux, "N")
            miSQL = miSQL & " WHERE codtipom='" & miRsAux!codtipom & "' AND numfactu = " & miRsAux!NumFactu
            miSQL = miSQL & " AND fecfactu=" & DBSet(miRsAux!FecFactu, "F") & " AND codtipoa = '" & miRsAux!codtipoa & "'"
            miSQL = miSQL & " AND numalbar=" & miRsAux!NumAlbar & " AND numlinea = " & miRsAux!numlinea
            conn.Execute miSQL
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    CadenaDesdeOtroForm = "OK"
    Exit Sub
EAplicarMargenCostes:
    MuestraError Err.Number
End Sub


Private Sub cmdModCostEstVta_Click()

    
    
    'Comprobaciones
    If Me.optModEstVta(0).Value Then
        miSQL = ""
        If Me.txtArticulo(6).Text = "" Then miSQL = miSQL & "   -Artículo" & vbCrLf
        If Me.txtDecimal(0).Text = "" Then miSQL = miSQL & "   -Coste" & vbCrLf
        If miSQL <> "" Then
            MsgBox "Falta: " & vbCrLf & miSQL, vbExclamation
            If Me.txtArticulo(6).Text = "" Then
                PonerFoco txtArticulo(6)
            Else
                PonerFoco txtDecimal(0)
            End If
            Exit Sub
        End If
    End If
    
    
    Screen.MousePointer = vbHourglass
    Set miRsAux = New ADODB.Recordset
    
    HacerModEstadiVenta
    
    Set miRsAux = Nothing
    Label3(23).Caption = ""
    Screen.MousePointer = vbDefault
    
End Sub

Private Sub HacerModEstadiVenta()
Dim Aux As String
Dim Importe As Currency
Dim PorceRap As Currency
Dim PorRap2 As Currency
    On Error GoTo EHacerModEstadiVenta
    
    Label3(23).Caption = "Obteniendo registros"
    Label3(23).Refresh
    
    'Montamos el SELECT
    miSQL = ""
    
    If Me.optModEstVta(1).Value Then
        If Me.txtCodProve(9).Text <> "" Then miSQL = miSQL & " AND sartic.codprove >= " & Me.txtCodProve(9).Text
        If Me.txtCodProve(10).Text <> "" Then miSQL = miSQL & " AND sartic.codprove <= " & Me.txtCodProve(10).Text
        'Si ha puesto desde hasta familia
        If Me.txtFamia(4).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia >= " & Me.txtFamia(4).Text
        If Me.txtFamia(5).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia <= " & Me.txtFamia(5).Text
    Else
        'Si ha puesto desde hasta codartic
        If Me.txtArticulo(6).Text <> "" Then miSQL = miSQL & " AND slifac.codartic = " & DBSet(Me.txtArticulo(6).Text, "T")
        'Agente
        If Me.txtAgente(0).Text <> "" Then miSQL = miSQL & " AND scafac.codagent >= " & Me.txtAgente(0).Text
        If Me.txtAgente(1).Text <> "" Then miSQL = miSQL & " AND scafac.codagent <= " & Me.txtAgente(1).Text
    End If
    
    If Me.txtFecha(7).Text <> "" Then miSQL = miSQL & " AND scafac.fecfactu >= " & DBSet(Me.txtFecha(7).Text, "F")
    If Me.txtFecha(8).Text <> "" Then miSQL = miSQL & " AND scafac.fecfactu <= " & DBSet(Me.txtFecha(8).Text, "F")
    If Me.txtCliente(0).Text <> "" Then miSQL = miSQL & " AND scafac.codclien >= " & Me.txtCliente(0).Text
    If Me.txtCliente(1).Text <> "" Then miSQL = miSQL & " AND scafac.codclien <= " & Me.txtCliente(1).Text
    
    
    miSQL = "  WHERE scafac.codtipom=slifac.codtipom and scafac.numfactu=slifac.numfactu and scafac.fecfactu=slifac.fecfactu AND slifac.codartic=sartic.codartic" & miSQL
    'Si es global los articulos no deben ser de varios (Man. Belarte)
    'Para una articulo no pongo nada de artvario
    If Me.optModEstVta(1).Value Then miSQL = miSQL & " AND artvario=0 "
    Aux = " FROM scafac,slifac,sartic" & miSQL
    If Me.optModEstVta(0).Value Then
        'Si es para un articulo veremos cuantas filas
        Aux = "Select count(*) " & Aux
    Else
        'Si es global, veremos cuantos articulos
        Aux = "Select slifac.codartic " & Aux & " GROUP BY 1"
    End If
    
    miRsAux.Open Aux, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    NumRegElim = 0
    If Not miRsAux.EOF Then
        If Me.optModEstVta(0).Value Then
            NumRegElim = DBLet(miRsAux.Fields(0), "N")
        Else
            While Not miRsAux.EOF
                NumRegElim = NumRegElim + 1
                miRsAux.MoveNext
            Wend
        End If
    End If
    miRsAux.Close
    
    If NumRegElim = 0 Then
        MsgBox "No existen datos con estos valores", vbExclamation
        Exit Sub
    End If
    
    
    'Si qu e hay
    If Me.optModEstVta(0).Value Then
        Aux = "Va a actualizar " & NumRegElim & " filas del articulo " & txtArticulo(6).Text & " " & Me.txtDescArticulo(6).Text
    Else
        Aux = "Va a actualizar " & NumRegElim & " artículos"
    End If
    Aux = Aux & vbCrLf & vbCrLf & "¿Continuar?"
    If MsgBox(Aux, vbQuestion + vbYesNo + vbDefaultButton2) = vbNo Then Exit Sub
    DoEvents
        
        
    'OK vamos p'alla
    '---------------------------------------------------------------------------------
    Label3(23).Caption = "Actualizando registros"
    Label3(23).Refresh
    If Me.optModEstVta(0).Value Then
        Aux = DBSet(txtDecimal(0).Text, "N")
        Aux = "UPDATE scafac,slifac,sartic SET slifac.preciouc = " & Aux & " , slifac.preciost = " & Aux & " , slifac.preciomp = " & Aux
        Aux = Aux & miSQL
        conn.Execute Aux
    Else
        If Me.chkVarios(6).Value = 0 Then
            'NO tiene en cueta los rappels. Es el que habia
    
    
               Aux = "FROM scafac,slifac,sartic" & miSQL
               Aux = "Select slifac.codartic " & Aux & " GROUP BY 1 ORDER BY codfamia,codprove"
               miRsAux.Open Aux, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
               While Not miRsAux.EOF
                   Label3(23).Caption = "Artículo " & miRsAux.Fields(0)
                   Label3(23).Refresh
                   
                   If Me.optModCostVta(0).Value Then
                       Aux = "sartic.preciouc"
                   ElseIf Me.optModCostVta(1).Value Then
                       Aux = "sartic.preciost"
                   Else
                       Aux = "sartic.preciomp"
                   End If
                   
                   
        
                   
                   Aux = "UPDATE scafac,slifac,sartic SET slifac.preciouc = " & Aux & " , slifac.preciost = " & Aux & " , slifac.preciomp = " & Aux
                   Aux = Aux & miSQL
                   Aux = Aux & " AND slifac.codartic = " & DBSet(miRsAux.Fields(0), "T")
                   
                   conn.Execute Aux
                   miRsAux.MoveNext
               Wend
               miRsAux.Close
    
    
    
            Else
                'Nuevo FEBRERO 2012
                'Tiene  en cuenta los rappels
                Aux = "FROM scafac,slifac,sartic" & miSQL
                Aux = "Select slifac.codartic,codprove,codfamia,sartic.preciost,sartic.PrecioUC,sartic.PrecioMP " & Aux & " GROUP BY 1 ORDER BY codfamia,codprove,codartic"
                miRsAux.Open Aux, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
                codigo = "" 'Llevaremos el PROVEEDOR-FAMILIA
                While Not miRsAux.EOF
                   Label3(23).Caption = "Artículo " & miRsAux.Fields(0)
                   Label3(23).Refresh
                   

                
                
                    Aux = Format(miRsAux!Codprove, "0000000") & Format(miRsAux!Codfamia, "000000")
                    If Aux = codigo Then
                        'Mismo que en RT
                        '
                    Else
                        codigo = Aux
                        CadParam = "if(rap2 is null,0,rap2)"
                        Aux = "codprove = " & miRsAux!Codprove & " AND codfamia"
                        Aux = DevuelveDesdeBD(conAri, "if(rap1 is null,0,rap1)", "sdtomp", Aux, CStr(miRsAux!Codfamia), "N", CadParam)
                        If Aux = "" Then
                            Aux = 0
                            CadParam = "0"
                        End If
                        PorceRap = CCur(Aux)
                        PorRap2 = CCur(CadParam)
                    End If
    
    
                    'Que importe cojo
                    If Me.optModCostVta(0).Value Then
                       Importe = DBLet(miRsAux!precioUC, "N")
                    ElseIf Me.optModCostVta(1).Value Then
                   
                       Importe = DBLet(miRsAux!preciost, "N")
                    Else
                       
                       Importe = DBLet(miRsAux!PrecioMP, "N")
                    End If
                    
                    
                    
                    If PorceRap <> 0 Or PorRap2 <> 0 Then
                        If Importe <> 0 Then
                            Importe = Round(Importe * (1 - (PorceRap / 100)), 4)
                            Importe = Round(Importe * (1 - (PorRap2 / 100)), 4)
                        End If
                    End If
                    
                    
                    
                    
                    Aux = TransformaComasPuntos(CStr(Importe))
                    Aux = "UPDATE scafac,slifac,sartic SET slifac.preciouc = " & Aux & " , slifac.preciost = " & Aux & " , slifac.preciomp = " & Aux
                    Aux = Aux & miSQL
                    Aux = Aux & " AND slifac.codartic = " & DBSet(miRsAux.Fields(0), "T")
                   
                    conn.Execute Aux
                    miRsAux.MoveNext
    
    
                Wend
                miRsAux.Close
            End If
    End If
    
    MsgBox "Proceso finalizado", vbInformation
    
    
    Exit Sub
EHacerModEstadiVenta:
    MuestraError Err.Number
    
End Sub

Private Sub cmdPresuFAS_Click()
Dim cControlFra As CControlFacturaContab
    
    'Traspaso de contados a presupuesto
    '-----------------------------------
    
    'Vamos a ver si hay algun dato
    InicializarVbles False
    
    miSQL = DevuelveDesdeBD(conConta, "porceiva", "tiposiva", "codigiva", vParamAplic.TipoIVA1)
    If miSQL = "" Then
        miSQL = "3000"
    Else
        miSQL = Int(3000 / (1 + (CCur(miSQL) / 100)))

    End If
    cadSelect = "scafac.codtipom = 'FAZ' AND scafac.totalfac>0 and scafac.totalfac<=" & miSQL & " AND sclien.tipoiva=0 "  'IVA NORMAL
    If txtFecha(47).Text <> "" Or txtFecha(48).Text <> "" Then
            codigo = "scafac.fecfactu"
            If Not PonerDesdeHasta(codigo, "F", 47, 48, miSQL) Then Exit Sub
    End If
    
    
'
    codigo = "scafac.codclien=sclien.codclien AND " & cadSelect
    codigo = codigo & " AND NOT (codtipom,numfactu,fecfactu) in (select distinct codtipom,numfactu,fecfactu FROM slifac where codartic='01005000')"
    codigo = codigo & " AND 1"
    miSQL = DevuelveDesdeBD(conAri, "count(*)", "scafac,sclien", codigo, "1")
    
    If Val(miSQL) = 0 Then
        MsgBox "Ningun dato para traspasar", vbExclamation
        Exit Sub
    End If
    
    'Si no ha puesto todos los datos para la facturacion
    miSQL = ""
    If Me.txtBanco(2).Text = "" Or Me.txtDescBanco(2).Text = "" Then miSQL = vbCrLf & "-Debe indicar el banco"
    If txtFecha(49).Text = "" Then miSQL = miSQL & vbCrLf & "-Indique la fecha de factura"
    If Me.txtCliente(21).Text = "" Or Me.txtDescClie(21).Text = "" Then
        miSQL = miSQL & vbCrLf & "-Debe indicar el cliente"
        PonerFoco Me.txtCliente(21)
    End If
    
    If miSQL <> "" Then
        MsgBox "Campos requeridos" & miSQL, vbExclamation
        Exit Sub
    End If
        
    'Comprobaciones
     
    '1.- La fecha es mayor que la ultima fecha de factura FAS
    
    If CDate(Me.txtFecha(49).Text) < vEmpresa.FechaIni Then
        miSQL = "-Fuera de ejercicios"
    Else
        codigo = Year(Me.txtFecha(49).Text)
        codigo = "fecfactu between '" & codigo & "-01-01' AND '" & codigo & "-12-31' AND codtipom"
        codigo = DevuelveDesdeBD(conAri, "max(fecfactu)", "scafac", codigo, "FAS", "T")
         
        If codigo = "" Then codigo = "12/04/1972"
        If CDate(codigo) > CDate(Me.txtFecha(49).Text) Then miSQL = "-Ultima fecha factura FAS: " & codigo
    End If
    
    
    
        
    
    If miSQL = "" Then
        Set cControlFra = New CControlFacturaContab
        
        codigo = cControlFra.FechaCorrectaContabilizazion(ConnConta, txtFecha(49).Text)
        If codigo <> "" Then miSQL = miSQL & "- " & codigo & vbCrLf
        codigo = cControlFra.FechaCorrectaIVA(ConnConta, txtFecha(49).Text)
        If codigo <> "" Then miSQL = miSQL & "- " & codigo & vbCrLf
        If cControlFra.FechaMenorUltimaFacturaCliente(ConnConta, txtFecha(49).Text, "FAS") Then miSQL = miSQL & "- " & codigo & vbCrLf
        Set cControlFra = Nothing
    End If
    
    
    If EsClienteBloqueado(Me.txtCliente(21).Text, False, True) Then miSQL = miSQL & vbCrLf & "-Cliente bloqueado"
        
    
    If miSQL <> "" Then
        MsgBox miSQL, vbExclamation
        Exit Sub
    End If
        
        
    'Si las fechas del traspaso incluyen el mes en curso. Dejo 5 dias de cortesia
    miSQL = ""
    FF = Now
    If Day(FF) <= 5 Then FF = DateAdd("m", -1, Now)
    FF = "01/" & Month(FF) & "/" & Year(FF)
    codigo = Format(FF, "dd/mm/yyyy")
    
    FI = "01/01/1900"
    If txtFecha(47).Text <> "" Then FI = CDate(Me.txtFecha(47))
    
    
    FF = "01/01/2100"
    If txtFecha(48).Text <> "" Then FF = CDate(Me.txtFecha(48))
    
    If FI >= CDate(codigo) Then
        miSQL = "0"
    Else
        If FF >= CDate(codigo) Then miSQL = "0"
    End If
    If miSQL <> "" Then
        miSQL = "Fecha mes en curso. Cuidado comisiones. ¿Continuar?"
    
        If MsgBox(miSQL, vbQuestion + vbYesNo) = vbNo Then Exit Sub
        miSQL = ""
    End If
        
    'OK cargamos la variable cadenadesdeotroform para que la pase al form con el listview
    
    CadenaDesdeOtroForm = Me.txtCliente(21).Text & "|" & Me.txtBanco(2).Text & "|" & Me.txtFecha(49).Text & "|"
    
    
    CadenaDesdeOtroForm = CadenaDesdeOtroForm & cadSelect & "|"
    frmListado4.vCadena = CadenaDesdeOtroForm
    frmListado4.Opcion = 9
    frmListado4.Show vbModal



End Sub

Private Sub cmdPrevision_Click()

    'Compruebo los campos
    miSQL = ""
    If Me.txtAnyo(0).Text = "" Then miSQL = miSQL & "-Año  "
    If Me.cboMes(0).ListIndex = -1 Then miSQL = miSQL & "   -mes"
    If miSQL <> "" Then
        MsgBox "Faltan campos: " & miSQL, vbExclamation
        Exit Sub
    End If
    
    
    
    '^Proceso
    Screen.MousePointer = vbHourglass
    Set miRsAux = New ADODB.Recordset
    If GenerarDatosPrevision Then
        InicializarVbles True
        PasaVariablesReport
        cadFormula = "{tmpprevision2.codusu} = " & vUsu.codigo
        CadParam = miSQL
        numParam = NumRegElim
        cadNomRPT = "rPrevision.rpt"
        cadTitulo = "Prevision tesoreria"
        conSubRPT = True
        vMostrarTree = False
        LlamarImprimir

    End If

    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
    Label3(4).Caption = ""
    
    
    
End Sub

Private Sub cmdPrevPagos_Click()

    If Me.chkVarios(10).Value = 1 Then
        If txtFecha(0).Text = "" Then
            MsgBox "Si marca la opcion de ""todos"" debe indicar fecha inicio", vbExclamation
            Exit Sub
        End If
    End If


    Screen.MousePointer = vbHourglass
    Set miRsAux = New ADODB.Recordset
    InicializarVbles True
    GenerarPrevisionPagosCompras
    If NumRegElim > 0 Then
        'A imprimir
        If txtCodProve(6).Text <> "" Or txtCodProve(7).Text <> "" Then
            miSQL = "pdH2=""Proveedor: "
            codigo = "{sartic.codprove}"
            If Not PonerDesdeHasta(codigo, "PRO", 6, 7, miSQL) Then Exit Sub
        End If
        If txtFecha(0).Text <> "" Or txtFecha(1).Text <> "" Then
            miSQL = "pdH1=""Fecha: "
            codigo = "{}"
            If Not PonerDesdeHasta(codigo, "F", 0, 1, miSQL) Then Exit Sub
        End If
    
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadNomRPT = "rPrevPagos.rpt"
        cadTitulo = "Previsión pagos"
        conSubRPT = True
        vMostrarTree = True
        LlamarImprimir
    
    End If
    Label3(17).Caption = ""
    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
End Sub

Private Sub cmdProveedor_Click()
    
    If txtCodProve(28).Text = "" And Me.chkVarios(32).Value = 0 Then
        MsgBox "seleccione un proveedor (o marque CABEL)", vbInformation
        Exit Sub
    End If
    
    If Me.chkVarios(32).Value = 0 Then
        miSQL = DevuelveDesdeBD(conAri, "count(*)", "stelem", "codprove", txtCodProve(28).Text)
    Else
        miSQL = DevuelveDesdeBD(conAri, "count(*)", "stelem", "(stelem.codprove)  IS null  AND 1", "1")
    End If
    If Val(miSQL) = 0 Then
        MsgBox "El proveedor no tiene datos en la tabla telematel", vbExclamation
    Else

        miSQL = "Registros telematel:    " & miSQL
        If Me.chkVarios(32).Value = 0 Then
            miSQL = "Proveedor:   " & Format(txtCodProve(28).Text, "0000") & "  " & Me.txtDescProve(28).Text & vbCrLf & miSQL & vbCrLf
        Else
            miSQL = "Proveedor:   CABEL" & vbCrLf & miSQL & vbCrLf
        End If
        miSQL = miSQL & vbCrLf & vbCrLf & "Desea eliminarlos?"
        If MsgBox(miSQL, vbQuestion + vbYesNoCancel) = vbYes Then
             If Me.chkVarios(32).Value = 0 Then
                CadenaDesdeOtroForm = txtCodProve(28).Text
            Else
                CadenaDesdeOtroForm = "null"
            End If
            Unload Me
        End If
    End If
End Sub

Private Sub cmdPuntoVenta_Click()
  
    If GenerarDatosPuntoPedido Then
        Label3(50).Caption = "Ver informe"
        
        'Informe
        
        
        InicializarVbles True
        
        If txtFecha(20).Text <> "" Or txtFecha(21).Text <> "" Then
            miSQL = "pdH1=""Fecha: "
            codigo = "{sartic.codprove}"
            If Not PonerDesdeHasta(codigo, "F", 20, 21, miSQL) Then Exit Sub
        End If
         miSQL = miSQL & cadTitulo
        CadParam = CadParam & "pdh1=""" & Trim(miSQL) & """|"
        numParam = numParam + 1
        

       
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        miSQL = "rPuntoPedido"
        If chkVarios(7).Value = 1 Then miSQL = miSQL & "Art"
        cadNomRPT = miSQL & ".rpt"
        cadTitulo = "Punto pedido"
        conSubRPT = True
        vMostrarTree = False
        LlamarImprimir
    End If
    Label3(50).Caption = ""
End Sub

Private Sub cmdRecalPMP_Click()
    
        InicializarVbles True
    
    
      
        If txtArticulo(9).Text <> "" Or txtArticulo(10).Text <> "" Then
            miSQL = " Art: "
            codigo = "{sartic.codartic}"
            If Not PonerDesdeHasta(codigo, "ART", 9, 10, miSQL) Then Exit Sub
        End If
        
        If txtCodProve(16).Text <> "" Or txtCodProve(17).Text <> "" Then
            miSQL = " Prov: "
            codigo = "{sartic.codprove}"
            If Not PonerDesdeHasta(codigo, "PRO", 16, 17, miSQL) Then Exit Sub
        End If
        If txtFamia(10).Text <> "" Or txtFamia(11).Text <> "" Then
            miSQL = " Fam: "
            codigo = "{sartic.codfamia}"
            If Not PonerDesdeHasta(codigo, "FAM", 10, 11, miSQL) Then Exit Sub
        End If
        
        

        If cadSelect <> "" Then cadSelect = " AND " & cadSelect
        cadSelect = "sartic.codartic=smoval.codartic " & cadSelect   'COMPRAS
        
        
        If Not HayRegParaInforme("sartic,smoval", cadSelect, True) Then
            MsgBox "No hay datos  con estos valores", vbExclamation
            Exit Sub
        End If
        Screen.MousePointer = vbHourglass
        If RecalculoPrecioMedioPonderado Then
            frmListado4.Opcion = 0
            frmListado4.Show vbModal
            Unload Me
        End If
        Screen.MousePointer = vbDefault
End Sub

Private Sub cmdRecalPrStd_Click()

    Screen.MousePointer = vbHourglass
    Set miRsAux = New ADODB.Recordset
    PuedeCerrar = False
    HacerRecalculoPrecio
    PuedeCerrar = True
    Label3(15).Caption = ""
    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
    
End Sub

Private Sub cmdRecalUPC_Click()
    
    
        If txtFecha(16).Text = "" Then
            MsgBox "Falta fecha ultima compra", vbExclamation
            PonerFoco txtFecha(16)
            Exit Sub
        End If
    
        InicializarVbles True
    
        'Fecha ultima compra MENOR
        cadSelect = "ultfecco < " & DBSet(txtFecha(16).Text, "F")
      
        If txtArticulo(11).Text <> "" Or txtArticulo(12).Text <> "" Then
            miSQL = " Art: "
            codigo = "{sartic.codartic}"
            If Not PonerDesdeHasta(codigo, "ART", 11, 12, miSQL) Then Exit Sub
        End If
        
        If txtCodProve(18).Text <> "" Or txtCodProve(19).Text <> "" Then
            miSQL = " Prov: "
            codigo = "{sartic.codprove}"
            If Not PonerDesdeHasta(codigo, "PRO", 18, 19, miSQL) Then Exit Sub
        End If
        If txtFamia(12).Text <> "" Or txtFamia(13).Text <> "" Then
            miSQL = " Fam: "
            codigo = "{sartic.codfamia}"
            If Not PonerDesdeHasta(codigo, "FAM", 12, 13, miSQL) Then Exit Sub
        End If
        
        
        If Not HayRegParaInforme("sartic", cadSelect, True) Then
            MsgBox "No hay datos  con estos valores", vbExclamation
            Exit Sub
        End If
        
        Screen.MousePointer = vbHourglass
        If RecalculoUltimoPrecioCompra Then
            frmListado4.Opcion = 2
            frmListado4.Show vbModal
            If CadenaDesdeOtroForm <> "" Then Unload Me
        End If
        Screen.MousePointer = vbDefault
    
    
    
    
End Sub

Private Sub cmdRectificaInven_Click()
Dim ArticuloFitoSanitarios As Boolean

    miSQL = ""
    If Me.txtAlma(0).Text = "" Or txtArticulo(0).Text = "" Or txtcantidad(0).Text = "" Then
        MsgBox "Datos obligatorios", vbExclamation
        Exit Sub
    End If
    
    If Opcion = 3 Then
        If Mid(Text2.Text, 1, 2) = "NO" Then
            MsgBox "Existen errores ", vbExclamation
            Exit Sub
        End If
    End If
    
    If ImporteFormateado(txtcantidad(0).Text) < 0 Then
        MsgBox "Cantidad debe ser mayor o igual que cero", vbExclamation
        Exit Sub
    End If
    
    ArticuloFitoSanitarios = False
    If vParamAplic.ManipuladorFitosanitarios2 Then
        'OK. Vemos si es articulo de fitosantiarios
        miSQL = Trim(DevuelveDesdeBD(conAri, "numserie", "sartic", "codartic", txtArticulo(0).Text, "T"))
        ArticuloFitoSanitarios = miSQL <> ""
        
        
    End If
    
    'Solo si rectificamos
    If Opcion = 3 Then
        If InStr(1, Text2.Text, "** No tiene") > 0 Then
            miSQL = "No existe inventario para el articulo / almacen. " & vbCrLf
            MsgBox miSQL, vbExclamation
            miSQL = ""  'Si lo habiito deja pasar pese a no haber sido inventariado
        Else
            miSQL = "Va a rectificar el inventario para el articulo."
            miSQL = miSQL & vbCrLf & vbCrLf & "¿Desea continuar?"
            If MsgBox(miSQL, vbQuestion + vbYesNo) = vbNo Then Exit Sub
        End If
        If miSQL = "" Then Exit Sub
        
    Else
        'Si tiene ArticuloFitoSanitarios no hago la pregunta, porque si me da a "cancelar" en la pantalla de introduccion de lotes
        'consideramos que no quiere inventariar
        If Not ArticuloFitoSanitarios Then
            miSQL = "Realizar el inventario para el articulo / almacen? " & vbCrLf
            If MsgBox(miSQL, vbQuestion + vbYesNo) = vbNo Then Exit Sub
        End If
    End If
        
    'Hacer actualizacion
    
    If ArticuloFitoSanitarios Then
        
        'Llamaremos para que ajuste los lotes
        If Not IntroduccionLotesFitosanitariosInventario Then Exit Sub
        
    End If
        
    Set miRsAux = New ADODB.Recordset
    If HacerActualizacion Then
        conSubRPT = True
        If ArticuloFitoSanitarios Then conSubRPT = ActualizarlosteFito
    
        If conSubRPT Then
            MsgBox "Proceso finalizado con exito", vbInformation
        Else
            miSQL = "Falta ajustar lotes. Avise soporte técnico"
            MsgBox miSQL, vbExclamation
        End If
    
        limpiar Me
        PonerFoco Me.txtArticulo(0)
    End If
    Set miRsAux = Nothing
        
End Sub

Private Sub cmdRegresaPrecio_Click()
   If Me.lwPrecUC.ListItems.Count = 0 Then Exit Sub
   If Me.lwPrecUC.SelectedItem Is Nothing Then Exit Sub
   
   CadenaDesdeOtroForm = Me.lwPrecUC.SelectedItem.SubItems(4)
   Unload Me
End Sub

Private Sub cmdRenovar_Click()
    If Opcion = 42 Then
        Renovar
    Else
        CambiarTitular
    End If
End Sub

Private Sub CambiarTitular()

    If Me.txtCliente(20).Text = "" Or Me.txtDescClie(20).Text = "" Then
        MsgBox "Seleccione un cliente", vbExclamation
        PonerFoco Me.txtCliente(20)
        Exit Sub
    End If
    
    If Val(txtCliente(20).Text) = NumRegElim Then
        MsgBox "Mismo titular", vbExclamation
        Exit Sub
    End If
    
    cadFormula = "Va a cambiar la titularidad del telefono:" & vbCrLf & vbCrLf
    cadFormula = cadFormula & "Teléfono: " & txtVariosBloqueado(1).Text & vbCrLf & vbCrLf
    
    cadFormula = cadFormula & "Antiguo: " & txtVariosBloqueado(0).Text & vbCrLf
    cadFormula = cadFormula & "Nuevo: " & Me.txtDescClie(20).Text & " [" & Me.txtCliente(20).Text & "]"
    cadFormula = cadFormula & vbCrLf & vbCrLf & "¿Continuar?"
    If MsgBox(cadFormula, vbQuestion + vbYesNoCancel) <> vbYes Then Exit Sub
    
    
    'Insertamos en scrmacciones
    cadFormula = "Telefono: " & Me.txtVariosBloqueado(1).Text & vbCrLf
    cadFormula = cadFormula & "Titular anterior:  " & Me.txtVariosBloqueado(0).Text
    cadFormula = cadFormula & vbCrLf & "Nuevo titular:  " & Me.txtDescClie(20).Text & " [" & Me.txtCliente(20).Text & "]"
    cadFormula = cadFormula & vbCrLf & "Fecha cambio: " & Format(Now, "dd/mm/yyyy hh:mm")
    cadTitulo = cadFormula 'Para el LOG
    
    'SOn OBSERVACCIONES EN DOS clientes. El del alta y el de la baja
    cadSelect = PonerTrabajadorConectado(CadParam)  'Trabajador conectado.Antes de lanzar este form hemos comprobado que exist
    CadParam = DevuelveDesdeBD(conAri, "codagent", "sagent", "codagent>0 AND 1", "1")  'AGENTE
    
    
    'BAJA
    miSQL = "insert into `scrmacciones` (`usuario`,`fechora`,`codclien`,`agente`,`codtraba`,`estado`,"
    miSQL = miSQL & "`tipo`,`medio`,`observaciones`) VALUES ('" & DevNombreSQL(vUsu.Login) & "','"
    miSQL = miSQL & Format(Now, "yyyy-mm-dd hh:nn:ss") & "',"
    miSQL = miSQL & NumRegElim & "," & CadParam & "," & cadSelect & ",2,"
    'tipo, medio observaciones
    cadNomRPT = "Cambio titular. BAJA."
    miSQL = miSQL & "3,'Otros'," & DBSet(cadNomRPT & vbCrLf & cadFormula, "T") & ")"
    conn.Execute miSQL
    
    'ALTA
    miSQL = "insert into `scrmacciones` (`usuario`,`fechora`,`codclien`,`agente`,`codtraba`,`estado`,"
    miSQL = miSQL & "`tipo`,`medio`,`observaciones`) VALUES ('" & DevNombreSQL(vUsu.Login) & "','"
    miSQL = miSQL & Format(Now, "yyyy-mm-dd hh:nn:ss") & "',"
    miSQL = miSQL & Me.txtCliente(20).Text & "," & CadParam & "," & cadSelect & ",2,"
    'tipo, medio observaciones
    cadNomRPT = "Cambio titular. ALTA."
    miSQL = miSQL & "3,'Otros'," & DBSet(cadNomRPT & vbCrLf & cadFormula, "T") & ")"
    conn.Execute miSQL
        
        
    'UPDATE stelefonos
    miSQL = "UPDATE sclientfno SET codclien=" & Me.txtCliente(20).Text
    miSQL = miSQL & " WHERE idtelefono='" & Me.txtVariosBloqueado(1).Text & "'"
    conn.Execute miSQL
    'SLOG
    Set LOG = New cLOG
    LOG.Insertar 23, vUsu, cadTitulo
    Set LOG = Nothing
    
    
    Unload Me
    
End Sub

Private Sub Renovar()
    'RENOVACION DEL TELEFONO.
    'Mete en scrmacciones con los datos viejos y updatea sclientfno con lo nuevo
    miSQL = ""
    codigo = "0"
    cadFormula = "0"
    If txtFecha(44).Text = "" Then miSQL = "-Fecha vacia" & vbCrLf
    If txtVariosBloqueado(4).Text <> "" Then
                
        'Tenia puntos
        If Val(txtVariosBloqueado(4).Text) > 0 Then
            'TIENE PUNTOS
            codigo = txtVariosBloqueado(4).Text
        End If
    End If
    If txtNumEntero(0).Text <> "" Then
        'Tenia puntos
        If Val(txtNumEntero(0).Text) >= 0 Then
            'TIENE PUNTOS
            cadFormula = txtNumEntero(0).Text
        Else
            miSQL = miSQL & " -Puntos utilizados negativos" & vbCrLf
        End If
    End If
    
    If Val(codigo) = 0 Then
        'NO tiene puntos
        If Val(cadFormula) > 0 Then miSQL = miSQL & " -No puede utilizar puntos" & vbCrLf
    Else
        If Val(cadFormula) > Val(codigo) Then miSQL = miSQL & " -Mas puntos de los que tiene" & vbCrLf
    End If
    
    If miSQL <> "" Then
        miSQL = "Errores: " & vbCrLf & vbCrLf & miSQL
        MsgBox miSQL, vbExclamation
        Exit Sub
    End If
    
    miSQL = ""
    If Val(codigo) > 0 And Val(cadFormula) = 0 Then miSQL = " - Tiene puntos y no va a utilizarlos " & vbCrLf
    If txtModelo(0).Text = "" Then miSQL = miSQL & " - No indica modelo de movil " & vbCrLf
    miSQL = miSQL & vbCrLf & vbCrLf & "¿Desea continuar con la renovacion del teléfono?"
    If MsgBox(miSQL, vbQuestion + vbYesNo + vbDefaultButton2) = vbNo Then Exit Sub
    
    
    'OK--> Ahora seguiremos
    
    If txtNumEntero(0).Text <> "" Then
        miSQL = txtNumEntero(0).Text
    Else
        miSQL = "0"
    End If
    miSQL = "UPDATE sclientfno SET puntos=puntos -  " & miSQL
    miSQL = miSQL & ", fecharenove = '" & Format(txtFecha(44).Text, FormatoFecha) & "'"
    miSQL = miSQL & ",coninternet=" & Abs(Me.chkRenove.Value)
    If txtModelo(0).Text <> "" Then miSQL = miSQL & ", modelo=" & txtModelo(0).Text
    
    miSQL = miSQL & " WHERE idtelefono='" & Me.txtVariosBloqueado(1).Text & "'"
    conn.Execute miSQL
            
    'Insertamos en scrmacciones
    cadFormula = "Nº Tel.: " & Me.txtVariosBloqueado(1).Text & "    "
    cadFormula = cadFormula & "Modelo: " & txtModelo(0).Text & " " & Me.txtDescModelo(0).Text
    cadFormula = cadFormula & vbCrLf & "Compañia: " & txtVariosBloqueado(2).Text
    cadFormula = cadFormula & "     Internet: " & CStr(Me.chkRenove.Value = 1)
    cadFormula = cadFormula & vbCrLf & "Ult fec. renovación: " & txtVariosBloqueado(5).Text
    cadFormula = cadFormula & vbCrLf & "Modelo anterior: " & txtVariosBloqueado(3).Text
    cadFormula = "Renovar teléfono. " & vbCrLf & cadFormula
    If txtNumEntero(0).Text <> "" Then
        cadFormula = cadFormula & vbCrLf & "Puntos anterior: " & txtVariosBloqueado(4).Text
        cadFormula = cadFormula & "   Gasto: " & txtNumEntero(0).Text
        cadFormula = cadFormula & "   Resto: " & Val(txtVariosBloqueado(4).Text) - Val(txtNumEntero(0).Text)
    End If
    
    cadSelect = PonerTrabajadorConectado(CadParam)  'Trabajador conectado.Antes de lanzar este form hemos comprobado que exist
    CadParam = DevuelveDesdeBD(conAri, "codagent", "sagent", "codagent>0 AND 1", "1")  'AGENTE
    miSQL = "insert into `scrmacciones` (`usuario`,`fechora`,`codclien`,`agente`,`codtraba`,`estado`,"
    miSQL = miSQL & "`tipo`,`medio`,`observaciones`) VALUES ('" & DevNombreSQL(vUsu.Login) & "','"
    miSQL = miSQL & Format(txtFecha(44).Text, FormatoFecha) & " " & Format(Now, "hh:mm:ss") & "',"
    miSQL = miSQL & NumRegElim & "," & CadParam & "," & cadSelect & ",2,"
    'tipo, medio observaciones
    miSQL = miSQL & "3,'Otros'," & DBSet(cadFormula, "T") & ")"
    conn.Execute miSQL
    
    
    
    Unload Me
End Sub


Private Sub cmdReposicionAlmacen_Click()
Dim B As Boolean


    miSQL = ""
    If Me.txtAlma(4).Text = "" Then miSQL = "-Almacen"
    If Me.txtFecha(32).Text = "" Then miSQL = "-Fecha inicio"
    
    If Me.txtCodProve(32).Text <> "" Xor txtDescProve(32).Text <> "" Then miSQL = "Proveedor incorrecto"
    If miSQL <> "" Then
        miSQL = "Campos requeridos:" & vbCrLf & miSQL
        MsgBox miSQL, vbExclamation
        Exit Sub
    End If
    
    Screen.MousePointer = vbHourglass
    Set miRsAux = New ADODB.Recordset
        
    Me.cmdReposicionAlmacen.Enabled = False
    B = ReposcionAlmacen2
    
    Me.cmdReposicionAlmacen.Enabled = True
    Label3(60).Caption = ""
    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
    
    If B Then
        InicializarVbles True
        
        miSQL = "Valores=""Almacen: " & Me.txtDescAlma(4).Text & "          "
        
        If chkVarios(24).Value = 1 Then miSQL = miSQL & " Solo reponer      "
        If Me.chkVarios(34).Value = 1 Then miSQL = miSQL & "   Inc. obras"
        If txtFecha(32).Text <> "" Or txtFecha(33).Text <> "" Then
            miSQL = miSQL & "      Fecha ventas: "
            codigo = ""
            If Not PonerDesdeHasta(codigo, "F", 32, 33, miSQL) Then Exit Sub
        Else
            miSQL = miSQL & """|"
        End If
        CadParam = CadParam & "|codalmac= " & Me.txtAlma(4).Text & "|"
        
        numParam = numParam + 1
        
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadNomRPT = "rReposAlmacen.rpt"
        cadTitulo = lblTitulo(32).Caption
        conSubRPT = True
        vMostrarTree = True
        HaPulsadoElBotonDeImprimir = False
        LlamarImprimir
        
        
        If HaPulsadoElBotonDeImprimir Then
            If Val(Me.txtAlma(4).Text) > 1 Then
                Label3(60).Caption = "Ajustando datos reposicion"
                Label3(60).Refresh
                miSQL = "DELETE FROM tmpinformes WHERE CodUsu = " & vUsu.codigo & " AND "
                'Quitamos los que no hay que pedir nada
                codigo = miSQL & "(importe3 -importe2 + importe4)<=0"
                conn.Execute codigo
                'Los que campo no es =1 . En teoria siempre es uno, aunque no se muy bien porque
                codigo = miSQL & "campo1<>1"
                conn.Execute codigo
                'Los que no son de varios
                codigo = miSQL & "porcen1>0"
                conn.Execute codigo
                
                
                
                codigo = "UPDATE tmpinformes SET"
                codigo = codigo & " importe1=(importe3 -importe2 + importe4) "
                'Para cuando genere el traspaso, saber ciertos datos fechas,almacen,trabajador
                codigo = codigo & ", fecha1=" & DBSet(txtFecha(32).Text, "F")
                codigo = codigo & ", fecha2=" & DBSet(txtFecha(33).Text, "F", "S")
                codigo = codigo & ", porcen2=" & DBSet(txtAlma(4).Text, "N")
                codigo = codigo & " Where CodUsu = " & vUsu.codigo
                conn.Execute codigo
                Espera 0.4
                codigo = DevuelveDesdeBD(conAri, "count(*)", "tmpinformes", "codusu", CStr(vUsu.codigo))
                If Val(codigo) = 0 Then
                    MsgBox "Ningun dato para generar el traspaso", vbExclamation
                Else
                    miSQL = DevuelveDesdeBD(conAri, "count(*)", "straspaso", "1", "1")
                    If miSQL = "" Then miSQL = "0"
                    codigo = ""
                    If Val(miSQL) > 0 Then
                        If MsgBox("Ya existen datos anteriores sin procesar.  Continuar?", vbQuestion + vbYesNo) = vbNo Then codigo = "N"
                    End If
                    
                    If codigo = "" Then
                        
                            conn.Execute "DELETE FROM straspaso"
                            'Insertamos en la tabla para poder leer
                            codigo = "INSERT INTO straspaso(codusu,secuencia,codprove,codartic,articulo,proveedor"
                            codigo = codigo & ",minimo,stock,reserva,propuesta,almdestino,fecha1,fecha2) "
                            codigo = codigo & " SELECT codusu,codigo1,campo2,nombre1,nombre2,nombre3"
                            codigo = codigo & ", importe3,importe2,importe4,importe1,round(porcen2,0),fecha1,fecha2 "
                            codigo = codigo & " FROM tmpinformes WHERE codusu = " & vUsu.codigo
                            conn.Execute codigo
                            
                            
                            codigo = "Los datos han sido generados correctamente. Pulse el boton de ""Leer datos guardados"" para modificar cantidades"
                            MsgBox codigo, vbInformation
                            
                    End If
                    
                    
                
                
                   
                    
                End If
                Label3(60).Caption = ""
            End If
        End If
    End If
    
End Sub

Private Sub cmdRevStokInven_Click()
Dim B As Boolean

    codigo = ""
    If txtAlma(3).Text = "" Then
        codigo = "Almacen obligado"
        PonerFoco txtAlma(3)
    End If
    
    If optCtrlStock(2).Value Then
        'ha pedido ventas peridod
        If txtFecha(22).Text = "" Or Me.txtFecha(23).Text = "" Then
            codigo = "Indique peridodo de ventas"
            PonerFoco txtFecha(22)
        End If
    End If

    If codigo <> "" Then
        MsgBox codigo, vbExclamation
        Exit Sub
    End If

    Screen.MousePointer = vbHourglass
    If Me.optCtrlStock(0).Value Or Me.optCtrlStock(1).Value Then
        B = GenerarDatosStockDesdeInventario(Me.optCtrlStock(0).Value)
        
    Else
        B = VentasPeridoConStock
    End If
    If B Then
        Label3(53).Caption = "Ver informe"
        
        'Informe
        InicializarVbles True
             
        'Almacen-
        cadTitulo = "Almacen: " & Me.txtAlma(3).Text & "-" & Me.txtDescAlma(3).Text
                    'Desde hasta fechas
        If Me.optCtrlStock(2).Value Then cadTitulo = cadTitulo & "         Periodo ventas: " & Me.txtFecha(22).Text & " - " & Me.txtFecha(23).Text
        
        'If Me.chkVarios(9).Value Then cadTitulo = cadTitulo & "      (Negativos)"
        
        CadParam = CadParam & "pdh1=""" & Trim(cadTitulo) & """|"
        numParam = numParam + 1
        
        
        'Familia-proveedor
        cadTitulo = ""
        If txtFamia(14).Text <> "" Or txtFamia(15).Text <> "" Then
            miSQL = "Familia: "
            codigo = "{sartic.codfamia}"
            If Not PonerDesdeHasta(codigo, "FAM", 14, 15, miSQL) Then Exit Sub
            cadTitulo = cadTitulo & "    " & miSQL
        End If
        
        
        If txtCodProve(20).Text <> "" Or txtCodProve(21).Text <> "" Then
            miSQL = "Prov: "
            codigo = "{sartic.codprove}"
            If Not PonerDesdeHasta(codigo, "PRO", 20, 21, miSQL) Then Exit Sub
            cadTitulo = cadTitulo & "    " & miSQL
        End If
        CadParam = CadParam & "pdh2=""" & Trim(cadTitulo) & """|"
        numParam = numParam + 1
        
        
        cadTitulo = ""
        If txtArticulo(13).Text <> "" Or txtArticulo(14).Text <> "" Then
            miSQL = "Art.: "
            codigo = "{sartic.codfamia}"
            If Not PonerDesdeHasta(codigo, "ART", 13, 14, miSQL) Then Exit Sub
            cadTitulo = cadTitulo & "    " & miSQL
        End If
        CadParam = CadParam & "pdh3=""" & Trim(cadTitulo) & """|"
        numParam = numParam + 1
        
        
        CadParam = CadParam & "QueOpcion="
        If Me.optCtrlStock(0).Value Then
            CadParam = CadParam & "0|"
        ElseIf Me.optCtrlStock(1).Value Then
            CadParam = CadParam & "1|"
        Else
            CadParam = CadParam & "2|"
        End If
        numParam = numParam + 1
        
       
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadNomRPT = "rAlmCtrStokInven.rpt"
        cadTitulo = "Control stock "
        conSubRPT = True
        vMostrarTree = True
        LlamarImprimir
    End If
    Label3(53).Caption = ""
End Sub

Private Sub cmdStockMes_Click()
    'Campos requeridos
    miSQL = ""
    If Me.txtAlma(1).Text = "" Then miSQL = "-almacen" & vbCrLf
    If Me.txtAnyo(1).Text = "" Then miSQL = miSQL & "-año" & vbCrLf
    If miSQL <> "" Then
        MsgBox "Faltan campos: " & vbCrLf & miSQL, vbExclamation
        Exit Sub
    End If
    
    InicializarVbles True
    
    miSQL = "pdh1=""Año: " & txtAnyo(1).Text & "         Almacén: " & txtAlma(1).Text & " " & Me.txtDescAlma(1).Text
    'Si ha puesto importe minimo
    If txtDecimal(2).Text <> "" Then miSQL = miSQL & "         Importe mínimo mes:  " & txtDecimal(2).Text
    If chkVarios(3).Value = 1 Then miSQL = miSQL & "   (*)"
    
    miSQL = miSQL & """|"
    CadParam = CadParam & miSQL
    numParam = numParam + 1
    
    If txtCodProve(0).Text <> "" Or txtCodProve(1).Text <> "" Then
        miSQL = "pdH2="""
        codigo = "{sartic.codprove}"
        If Not PonerDesdeHasta(codigo, "PRO", 0, 1, miSQL) Then Exit Sub
        
    End If
    
    
    'Ok vamos p'alla
    Screen.MousePointer = vbHourglass
    Set miRsAux = New ADODB.Recordset
    PuedeCerrar = False
    If GeneraStockMeses Then
        'Ha imprimir
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadNomRPT = "rstockmes.rpt"
        cadTitulo = "Stocks por meses"
        conSubRPT = True
        vMostrarTree = True
        LlamarImprimir

        
        
    End If
    PuedeCerrar = True
    Label3(6).Caption = ""
    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
    
End Sub

Private Sub cmdTelefoniaCuotas_Click()

        ListView2(1).Tag = ""
        miSQL = ""
        codigo = ""
        For numParam = 1 To ListView2(1).ListItems.Count
            If ListView2(1).ListItems(numParam).Checked Then
                miSQL = miSQL & "X"
                codigo = codigo & ", " & ListView2(1).ListItems(numParam).Tag
                ListView2(1).Tag = ListView2(1).Tag & " " & UCase(ListView2(1).ListItems(numParam))
            End If
        Next
        If miSQL = "" Then
            MsgBox "Seleccione alguna compañia"
            Exit Sub
        Else
            If Len(miSQL) = ListView2(1).ListItems.Count Then
                ListView2(1).Tag = ""              'Estan todas
                codigo = ""
            Else
                codigo = Mid(codigo, 2)
                codigo = "{sclientfno.operador} IN [" & codigo & "]"
            End If
        End If
        
        
        InicializarVbles True
        
        
        If codigo <> "" Then
            If Not AnyadirAFormula(cadFormula, codigo) Then Exit Sub
    
            If Not AnyadirAFormula(cadSelect, codigo) Then Exit Sub
        End If
        
        
        cadPDFrpt = ""
        If txtCliente(24).Text <> "" Or txtCliente(25).Text <> "" Then
            miSQL = "Cliente: "
            codigo = "{sclientfno.codclien}"
            If Not PonerDesdeHasta(codigo, "CLI", 24, 25, miSQL) Then Exit Sub
            cadPDFrpt = miSQL
        End If
        
        
        
        cadPDFrpt = Trim(ListView2(1).Tag & "    " & cadPDFrpt)
        CadParam = CadParam & "pdh1=""" & cadPDFrpt & """|"
        numParam = numParam + 1
        
        'Grupo
        If Me.chkVarios(19).Value = 1 Then
            codigo = "{sclientfno.codclien}"
        Else
            codigo = "{sclientfno.IdTelefono}"
        End If
        CadParam = CadParam & "grupo2=" & codigo & "|"
        numParam = numParam + 1
        
        Screen.MousePointer = vbHourglass
       
        
        'If HayRegParaInforme("sclientfno", cadSelect, False) Then
            cadTitulo = "Listado cuotas telefonos"
            cadFormula = cadFormula
            
            If Me.optCuotasTf(1).Value Then
                cadNomRPT = "rTel_TelxCuota.rpt"
            Else
                cadNomRPT = "rTel_Cuotxte.rpt"
            End If
            cadPDFrpt = cadNomRPT
            conSubRPT = False
            vMostrarTree = True
            LlamarImprimir

        
        'End If
        Screen.MousePointer = vbDefault
        

End Sub

Private Sub cmdUpdDtosProve_Click()

    miSQL = ""
    If txtFecha(11).Text = "" Then miSQL = miSQL & "     - fecha" & vbCrLf
    If txtDecimal(3).Text = "" Then miSQL = miSQL & "     - descuento" & vbCrLf
    If txtCodProve(13).Text = "" Then
        miSQL = miSQL & "     - proveedor" & vbCrLf
    Else
        codigo = " - Familia"
        For NumRegElim = 1 To Me.lwFam.ListItems.Count
            If Me.lwFam.ListItems(NumRegElim).Checked = True Then
                codigo = ""
                Exit For
            End If
        Next
        miSQL = miSQL & codigo
    End If
    
    If miSQL <> "" Then
        miSQL = "Campos obligados:" & vbCrLf & vbCrLf & miSQL
        MsgBox miSQL, vbInformation
        Exit Sub
    
    End If
    
    If ImporteFormateado(txtDecimal(3).Text) >= 100 Or ImporteFormateado(txtDecimal(3).Text) < 0 Then
        MsgBox "Descuento debe estar entre 0-100", vbExclamation
        PonerFoco txtDecimal(3)
        Exit Sub
    End If
    
    
    miSQL = ""
    cadSelect = ""
    If txtCliente(6).Text <> "" Or txtCliente(7).Text <> "" Then
            miSQL = " Cli: "
            codigo = "codclien"
            If Not PonerDesdeHasta(codigo, "CLI", 6, 7, miSQL) Then Exit Sub
            miSQL = vbCrLf & vbCrLf & miSQL & vbCrLf
    End If
    
    
    If MsgBox("Actualizar descuento en familias. " & miSQL & vbCrLf & "¿Continuar?", vbQuestion + vbYesNo) <> vbYes Then Exit Sub
    
    
    
    Screen.MousePointer = vbHourglass
    Label3(31).Caption = "Incio proceso"
    Label3(31).Refresh
    Set miRsAux = New ADODB.Recordset
    Espera 0.3
    For NumRegElim = 1 To lwFam.ListItems.Count
        If lwFam.ListItems(NumRegElim).Checked Then
            Label3(31).Caption = "Familia: " & lwFam.ListItems(NumRegElim).SubItems(1)
            Label3(31).Refresh
            
            CadenaDesdeOtroForm = CadenaDesdeOtroForm & "," & lwFam.ListItems(NumRegElim).Text
            ActualizarFamiProveedor CInt(lwFam.ListItems(NumRegElim).Text)
        End If
    Next
    Label3(31).Caption = ""
    Set miRsAux = Nothing
    
    CadenaDesdeOtroForm = cadSelect & "|" & CadenaDesdeOtroForm & "|"
    
    
    Screen.MousePointer = vbDefault
    Unload Me
End Sub

Private Sub cmdVentasxTipoPrecio_Click()
       
    
    InicializarVbles True
    
    cadPDFrpt = ""
    For NumRegElim = 0 To Me.optTipoPrecio.Count - 1
        If Me.optTipoPrecio(NumRegElim).Value Then
            cadPDFrpt = Me.optTipoPrecio(NumRegElim).Caption
            cadTitulo = UCase(Mid(cadPDFrpt, 2, 1))  'Empieza en el 2 pq el 1 es el &
            Exit For
        End If
    Next
    If cadPDFrpt = "" Then Exit Sub  'NO deberia pasar
    cadPDFrpt = Replace(cadPDFrpt, "&", "")
    
    CadParam = CadParam & "pPrecio=""" & UCase(cadPDFrpt) & """|"
    numParam = numParam + 1
    cadSelect = "slifac.origpre ='" & cadTitulo & "'"
    
    
    cadTitulo = ""
    If txtFecha(36).Text <> "" Or txtFecha(37).Text <> "" Then
        miSQL = "Fecha: "
        codigo = "{scafac.fecfactu}"
    
        If Not PonerDesdeHasta(codigo, "F", 36, 37, miSQL) Then Exit Sub
        cadTitulo = miSQL
    End If
    '
    miSQL = ""
    codigo = ""
    If Me.txtAlma(7).Text <> "" Then
        miSQL = miSQL & Space(18) & txtAlma(7).Text & " " & txtDescAlma(7).Text
        codigo = codigo & ", " & txtAlma(7).Text
    End If
    If Me.txtAlma(8).Text <> "" Then
        miSQL = miSQL & Space(18) & txtAlma(8).Text & " " & txtDescAlma(8).Text
        codigo = codigo & ", " & txtAlma(8).Text
    End If
    If Me.txtAlma(9).Text <> "" Then
        miSQL = miSQL & Space(18) & txtAlma(9).Text & " " & txtDescAlma(9).Text
        codigo = codigo & ", " & txtAlma(9).Text
    End If
    If miSQL <> "" Then
        miSQL = "Almacen:   " & Trim(miSQL)
        If cadTitulo <> "" Then cadTitulo = cadTitulo & """ + chr(13) + """
        codigo = Mid(codigo, 2)
        If cadSelect <> "" Then cadSelect = cadSelect & " AND "
        cadSelect = cadSelect & " slifac.codalmac  IN (" & codigo & ")"
        
    End If
    cadTitulo = cadTitulo & miSQL
    
    
    'Desde hasta trabajador
    If txtCodTraba(2).Text <> "" Or txtCodTraba(3).Text <> "" Then
        miSQL = "Trabajador: "
        codigo = "{scafac1.codtraba}"
        If Not PonerDesdeHasta(codigo, "TRA", 2, 3, miSQL) Then Exit Sub
        If cadTitulo <> "" Then cadTitulo = cadTitulo & """ + chr(13) + """
        cadTitulo = cadTitulo & miSQL
    End If
    
    
    CadParam = CadParam & "pdh1=""" & cadTitulo & """|"
    numParam = numParam + 1

    
    If txtCliente(16).Text <> "" Or txtCliente(17).Text <> "" Then
        miSQL = "pdh2=""Cliente: "
        codigo = "{scafac.codclien}"
        If Not PonerDesdeHasta(codigo, "CLI", 16, 17, miSQL) Then Exit Sub
    End If
    
    cadTitulo = ""
    If txtFamia(17).Text <> "" Or txtFamia(18).Text <> "" Then
        miSQL = "Familia: "
        codigo = "{sartic.codfamia}"
        If Not PonerDesdeHasta(codigo, "FAM", 17, 18, miSQL) Then Exit Sub
        cadTitulo = miSQL
    End If
    If txtAgente(12).Text <> "" Or txtAgente(13).Text <> "" Then
        miSQL = "Agente: "
        codigo = "{scafac.codagent}"
        If Not PonerDesdeHasta(codigo, "AGT", 12, 13, miSQL) Then Exit Sub
        'Mismo AGENTE
        If txtAgente(12).Text = txtAgente(13).Text Then miSQL = "Agente: " & Me.txtDescAgente(12).Text
        cadTitulo = Trim(cadTitulo & "      " & miSQL)
        If Len(cadTitulo) > 110 Then cadTitulo = Mid(cadTitulo, 1, 110)
    End If
    
    
    
    CadParam = CadParam & "pdh3=""" & cadTitulo & """|"
    numParam = numParam + 1
    
    
    
    
    Screen.MousePointer = vbHourglass
    conn.Execute "DELETE from tmpinformes where codusu = " & vUsu.codigo
    cadNomRPT = Replace(cadSelect, "{", "(")
    cadNomRPT = Replace(cadNomRPT, "}", ")")
    
    'tmpinformes
    miSQL = "Select " & vUsu.codigo & ",sartic.codprove,concat(slifac.codtipom,slifac.numfactu),slifac.fecfactu,"
    miSQL = miSQL & "codfamia,slifac.codartic,slifac.nomartic"
    miSQL = miSQL & ",cantidad,precioar,dtoline1,dtoline2,importel,artvario"
    miSQL = miSQL & " FROM scafac,slifac,sartic,scafac1 WHERE scafac.numfactu = slifac.numfactu and scafac.codtipom = slifac.codtipom"
    miSQL = miSQL & " and scafac.fecfactu = slifac.fecfactu AND slifac.codartic=sartic.codartic AND "
    miSQL = miSQL & " scafac1.Codtipom = scafac.Codtipom And scafac1.NumFactu = scafac.NumFactu And scafac1.FecFactu = scafac.FecFactu"
    miSQL = miSQL & " and scafac1.numalbar=slifac.numalbar and scafac1.codtipoa=slifac.codtipoa AND "
        
    
    miSQL = miSQL & cadNomRPT
    '                                                                                                               artvario
    miSQL = "INSERT INTO tmpinformes(codusu,campo1,nombre1,fecha1,codigo1,nombre2,nombre3,importe1,importe2,porcen1,porcen2,importe3,importeb1) " & miSQL
    If ejecutar(miSQL, False) Then
    
        miSQL = DevuelveDesdeBD(conAri, "count(*)", "tmpinformes", "codusu", CStr(vUsu.codigo))
        If Val(miSQL) > 0 Then
            cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
            cadNomRPT = "rvtasTipoPrecio" & IIf(Me.chkVarios(29).Value = 1, "G", "") & ".rpt"
            cadPDFrpt = cadNomRPT
            cadTitulo = lblTitulo(35).Caption
            conSubRPT = False
            vMostrarTree = True
            LlamarImprimir
    
        Else
            MsgBox "No hay registros para mostrar", vbExclamation
        End If
    End If
    Screen.MousePointer = vbDefault
End Sub

Private Sub cmdVtaAgeTraba_Click()


    
    Set miRsAux = New ADODB.Recordset
    Screen.MousePointer = vbHourglass
    If GenerarDatosVtasAgenteTraba Then
        Me.Label3(63).Caption = "Ver informe"
        
        InicializarVbles True

        cadTitulo = ""
        If txtFecha(34).Text <> "" Or txtFecha(35).Text <> "" Then
            miSQL = "Fecha: "
            codigo = ""
            If Not PonerDesdeHasta(codigo, "F", 34, 35, miSQL) Then Exit Sub
            cadTitulo = miSQL
        End If
        If txtAgente(6).Text <> "" Or txtAgente(7).Text <> "" Then
            miSQL = "Agente: "
            codigo = ""
            If Not PonerDesdeHasta(codigo, "AGT", 6, 7, miSQL) Then Exit Sub
            cadTitulo = Trim(cadTitulo & "      " & miSQL)
            If Len(cadTitulo) > 110 Then cadTitulo = Mid(cadTitulo, 1, 110)
        End If
        If Me.chkVarios(18).Value = 1 Then cadTitulo = cadTitulo & "  [ALBARANES]"
        If Me.chkVarios(21).Value = 1 Then cadTitulo = cadTitulo & "  [PRESU]"
        
        
        CadParam = CadParam & "pdH1=""" & cadTitulo & """|"
        CadParam = CadParam & "detalla=" & Abs(Me.chkVarios(25).Value) & "|"
        numParam = numParam + 2
        
        cadTitulo = ""
        If txtCliente(14).Text <> "" Or txtCliente(15).Text <> "" Then
            miSQL = "Cliente: "
            If txtCliente(14).Text = txtCliente(15).Text Then
                miSQL = miSQL & Me.txtDescClie(14).Text
            Else
                codigo = ""
                If Not PonerDesdeHasta(codigo, "CLI", 14, 15, miSQL) Then Exit Sub
            End If
            cadTitulo = miSQL
        End If

        'Los trabajadores seleccionados
        miSQL = ""
        codigo = ""
        For NumRegElim = 1 To Me.ListView1(5).ListItems.Count
            If Me.ListView1(5).ListItems(NumRegElim).Checked Then
                codigo = codigo & "X"
                miSQL = miSQL & ", " & Me.ListView1(5).ListItems(NumRegElim).Tag
            End If
        Next
        If Len(codigo) = Me.ListView1(5).ListItems.Count Then miSQL = "  TODOS"
        miSQL = "Trabajadores:" & Mid(miSQL, 2)
        cadTitulo = Trim(cadTitulo & "    " & miSQL)
        CadParam = CadParam & "pdH2=""" & cadTitulo & """|"
        numParam = numParam + 1
        
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadNomRPT = "rvtasagentrab.rpt"
        cadTitulo = "Ventas agente - trabajador"
        conSubRPT = True
        vMostrarTree = True
        LlamarImprimir
    
    End If
    Set miRsAux = Nothing
    Me.Label3(63).Caption = ""
    Screen.MousePointer = vbDefault
End Sub

Private Sub cmdVtasCredito_Click()
    
    
    
    
    If GenerarDatosVentasAcredito Then
        Label3(48).Caption = "Ver informe"
        
        'Informe
        
        
        InicializarVbles True
        
        If txtFecha(18).Text <> "" Or txtFecha(19).Text <> "" Then
            miSQL = "pdH1=""Fecha: "
            codigo = "{sartic.codprove}"
            If Not PonerDesdeHasta(codigo, "F", 18, 19, miSQL) Then Exit Sub
        End If
         miSQL = miSQL & cadTitulo
        CadParam = CadParam & "pdh1=""" & Trim(miSQL) & """|"
        numParam = numParam + 1
        

       
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadNomRPT = "rVtasCredito.rpt"
        cadTitulo = "Ventas a crédito"
        conSubRPT = True
        vMostrarTree = False
        LlamarImprimir
    End If
    Label3(48).Caption = ""
    
End Sub

Private Sub cmdVtasForPa_Click()
Dim B As Boolean
    miSQL = ""
    codigo = ""
    For NumRegElim = 1 To lwFact.ListItems.Count
        If lwFact.ListItems(NumRegElim).Checked = True Then
            miSQL = "O"
            Exit For
        End If
    Next
    If miSQL = "" Then
        MsgBox "Selecciona algun tipo factura", vbExclamation
        Exit Sub
    End If
    
       'Vamos p'alla
    Screen.MousePointer = vbHourglass
    Set miRsAux = New ADODB.Recordset
    
    B = CargarDatosVentasxForpa
    Label3(36).Caption = ""
    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
    If B Then
        'Crgamos el report
        
        '-----------------------------------------------
        
        
        InicializarVbles True
        
        
        miSQL = ""
        codigo = "TODOS"
        For NumRegElim = 1 To Me.lwFact.ListItems.Count
            If Me.lwFact.ListItems(NumRegElim).Checked Then
                miSQL = miSQL & ", '" & lwFact.ListItems(NumRegElim).Text & "'"
            Else
                codigo = ""
            End If
        Next
        If codigo <> "" Then
            'Son todos. NO pongo nada en el informe
            cadTitulo = ""
        Else
            miSQL = Mid(miSQL, 2) 'quitol la primera coma
            cadTitulo = Replace(miSQL, "'", "")
            cadTitulo = Replace(cadTitulo, ",", "-")
            cadTitulo = "       Tipo: " & cadTitulo
        End If
        
        miSQL = ""
        If txtFecha(14).Text <> "" Or txtFecha(15).Text <> "" Then
            miSQL = "Fecha: "
            codigo = ""
            If Not PonerDesdeHasta(codigo, "F", 14, 15, miSQL) Then Exit Sub
        End If
        miSQL = miSQL & cadTitulo
        CadParam = CadParam & "pdh1=""" & Trim(miSQL) & """|"
        numParam = numParam + 1
        
        'Cliente
        miSQL = ""
        If txtCliente(8).Text <> "" Or txtCliente(9).Text <> "" Then
            miSQL = "Cliente: "
            codigo = "{}"
            If Not PonerDesdeHasta(codigo, "CLI", 8, 9, miSQL) Then Exit Sub
        End If
            
        CadParam = CadParam & "pdh2=""" & miSQL & """|"
        numParam = numParam + 1
        
        
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadNomRPT = "rVtasForpa.rpt"
        cadTitulo = "Venta por forma de pago"
        conSubRPT = True
        vMostrarTree = True
        LlamarImprimir
    End If
    
    
    
End Sub

Private Sub cmdVtasTraba_Click()
Dim B As Boolean
    miSQL = ""
    codigo = ""
    For NumRegElim = 1 To Me.ListView1(2).ListItems.Count
        If Me.ListView1(2).ListItems(NumRegElim).Checked = True Then
            miSQL = "O"
            Exit For
        End If
    Next
    If miSQL = "" Then
        MsgBox "Selecciona algun trabajador", vbExclamation
        Exit Sub
    End If
    
       'Vamos p'alla
    Screen.MousePointer = vbHourglass
    Set miRsAux = New ADODB.Recordset
    B = CargarDatosVtasDia
    Label3(19).Caption = ""
    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
    If B Then
        'Crgamos el report
        
        '-----------------------------------------------
        InicializarVbles True
        
        If txtFecha(5).Text <> "" Or txtFecha(6).Text <> "" Then
            miSQL = "pdH1=""Fecha: "
            codigo = "{sartic.codprove}"
            If Not PonerDesdeHasta(codigo, "F", 5, 6, miSQL) Then Exit Sub
        End If
        
        miSQL = ""
        For NumRegElim = 1 To Me.ListView1(2).ListItems.Count
            If Me.ListView1(2).ListItems(NumRegElim).Checked Then miSQL = miSQL & " - " & Me.ListView1(2).ListItems(NumRegElim).Text
        Next
        miSQL = "Trabajadores: " & Mid(miSQL, 3)
        CadParam = CadParam & "pdh2=""" & miSQL & """|"
        numParam = numParam + 1
        
        cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
        cadNomRPT = "rTrabVtaDia.rpt"
        cadTitulo = "Venta trabajadores / dia"
        conSubRPT = True
        vMostrarTree = True
        LlamarImprimir
    End If

    
    
    
End Sub

Private Sub Command1_Click()
    
End Sub

Private Sub Form_Activate()
   
   ' AQUI AQUI AQUI   METIENDO EL FRAMEEXPORTACION
    
    If PrimeraVez Then
        PrimeraVez = False
        Select Case Opcion
        Case 0
            
            PonerFoco Text1
        Case 2
            CargaTreePortes
        Case 3, 61
            PonerFoco txtArticulo(0)
        Case 5
            PonerFoco txtAlma(1)
        Case 8
            CargaListAccionesRealizadas
        Case 9
            CargaTrabajadores2 2
        Case 11
            PonerFoco txtFecha(7)
            
        Case 16
            PonerIncidencias
            PonerFoco txtFecha(9)
        Case 19
            CargaTipoMov
        Case 26
            PonerFoco txtFecha(20)
        Case 27
            PonerFoco txtAlma(3)
            
        Case 32
            PonerFoco txtFecha(27)
        Case 35
            PonerFoco txtAlma(4)
        Case 36
            PonerFoco txtBanco(1)
            
        Case 37
            CargaTrabajadores2 5
            PonerFoco txtFecha(34)
        Case 42
            PonerFoco txtFecha(44)
            
        Case 44
            PonerFoco txtCliente(20)
            
        Case 45
            PonerFoco txtFecha(47)
            
        
        End Select
    End If
    Screen.MousePointer = vbDefault
End Sub

Private Sub Form_Load()
Dim H As Integer
Dim W As Integer

    Me.Icon = frmPpal.Icon
    PrimeraVez = True
    Caption = "Informe"
    CargaIconosAyuda
    FramePregunta.visible = False
    FramePrevision.visible = False
    FrameALbConPortes.visible = False
    FrameRectifInven.visible = False
    frmStockMeses.visible = False
    FrameArtEnPromo.visible = False
    FrameRecalPrStan.visible = False
    FramePrevPagos.visible = False
    FrameAccionesRealizadas.visible = False
    FrameListadVtaTraba.visible = False
    FramePrecioCompraProvArt.visible = False
    FrameModEstaVta.visible = False
    FrameListDto.visible = False
    FrameComprDtoActiv.visible = False
    FrameIncValorCoste.visible = False
    FrameCliVar.visible = False
    FrameAnulados.visible = False
    frmaUpdateDtoProve.visible = False
    FrameVtasArticulo.visible = False
    FrameVtasForpa.visible = False
    frameRecalPMP.visible = False
    Me.FrameRecalPrStan.visible = False
    Me.frameRecalUPC.visible = False
    FrameFacturarRenting.visible = False
    FrameVtasCredito.visible = False
    FramePuntoPedido.visible = False
    FrameRevStokInven.visible = False
    FrameAlmaGrupo.visible = False
    FrameExportarAlmagrupo.visible = False
    FrameFlotas.visible = False
    FrameComsionHerbelca.visible = False
    FrameComisionAgente.visible = False
    FrameGenDtoProv.visible = False
    FrameReposcionAlmacen.visible = False
    FrameFrarTelefonia.visible = False
    FrameVtasAgeTraba.visible = False
    frameVtaTipoPrecio.visible = False
    FrameCESCE.visible = False
    FrameTelefonia.visible = False
    FrameRenovacion.visible = False
    FrameVtasAgentePvpMenor.visible = False
    FramePresuFAS.visible = False
    FrameAgeFamMar.visible = False
    FrameControlDirEnvio.visible = False
    FrameCambioFamiliaArticulo.visible = False
    FramePideBanco.visible = False
    FrameAguaFacturar.visible = False
    
    FrameImportarAgua.visible = False
    FrameAguaCuotaVarios.visible = False
    FrameAguaGeneralitat.visible = False
    FrameProveedor.visible = False
    FrameSimularPedidoProveedor.visible = False
    FrameAguaDeclaracion.visible = False
    FrameExportarFAS.visible = False
    FrameAgua2.visible = False
    FramemarjaChipos.visible = False
    FrameIncremPrecioPorcen.visible = False
    FramepedidoSolicitante.visible = False
    FrameListadoManipulador.visible = False
    limpiar Me
    PuedeCerrar = True
    Select Case Opcion
    Case 0
        Caption = "LOG"
        PonerFrameVisible FramePregunta, H, W
        PuedeCerrar = False 'Solo puede cerrar desde aceptar
    
    
        Me.txtNombre(0).Text = vUsu.Nombre
        Me.txtNombre(1).Text = Me.OtrosDatos
        Me.Text1.Text = ""
        
    Case 1
        'Informe prevision
        PonerFrameVisible FramePrevision, H, W
        Label3(4).Caption = "" 'el indicador
        CargaComboMes 0
        
    Case 2
        Caption = "PORTES"
        PonerFrameVisible FrameALbConPortes, H, W
        
    Case 3, 61
        Caption = "Inventario"
        PonerFrameVisible FrameRectifInven, H, W
        InventariarRectificar
    Case 4
        PonerFrameVisible frmStockMeses, H, W
        Label3(6).Caption = "" 'el indicador
        
        
    Case 5, 34  '5-Articulos en promocio
                '34- listado precio especial
        ArreglaFormularioPromoEsp
        chkVarios(28).visible = Opcion = 5
        PonerFrameVisible FrameArtEnPromo, H, W
        Label3(10).Caption = "" 'el indicador
    Case 6
        
        PonerFrameVisible FrameRecalPrStan, H, W
        Label3(15).Caption = "" 'el indicador
    Case 7
       PonerFrameVisible FramePrevPagos, H, W
       Label3(17).Caption = "" 'el indicador
       
    Case 8
       PonerFrameVisible FrameAccionesRealizadas, H, W
       Label3(18).Caption = "" 'el indicador
        
    Case 9
       PonerFrameVisible FrameListadVtaTraba, H, W
       Label3(19).Caption = "" 'el indicador
            
    Case 10
        
       PonerFrameVisible FramePrecioCompraProvArt, H, W
       Label3(20).Caption = "" 'el indicador
       lwPrecUC.Tag = "||"
       
    Case 11
        
       FrameMoDVtaArt(0).BorderStyle = 0
       FrameMoDVtaArt(1).BorderStyle = 0
        
       PonerFrameVisible FrameModEstaVta, H, W
       Label3(23).Caption = ""
       
    Case 12
        
        PonerFrameVisible FrameListDto, H, W
    Case 13
        PonerFrameVisible FrameComprDtoActiv, H, W
        Label3(27).Caption = ""
    Case 14
        PonerFrameVisible FrameIncValorCoste, H, W
        Label3(29).Caption = ""
        
    Case 15
        PonerFrameVisible FrameCliVar, H, W
        
        
    Case 16
        'FrameAnulados
        PonerFrameVisible FrameAnulados, H, W
        
    Case 17
        PonerFrameVisible frmaUpdateDtoProve, H, W
        Label3(31).Caption = "" 'el indicador
    Case 18
        PonerFrameVisible FrameVtasArticulo, H, W
        
    Case 19
        
        PonerFrameVisible FrameVtasForpa, H, W
        Label3(36).Caption = "" 'el indicador
            
        
    Case 20

        PonerFrameVisible frameRecalPMP, H, W
        Label3(41).Caption = "" 'el indicador
        
    Case 21

        PonerFrameVisible frameRecalUPC, H, W
        Label3(46).Caption = "" 'el indicador
        optVarios(10).Value = True
        
        
    Case 22, 23
        Caption = RentingLB & " y servicios"
        imgayuda(2).ToolTipText = "Facturación " & Caption
        lblTitulo(20).Caption = "Facturar "
        PonerFrameVisible FrameFacturarRenting, H, W
        Label3(47).Caption = ""
        Me.FrameDHRenting.visible = OtrosDatos = ""
        If OtrosDatos = "" Then
            txtFecha(17).Text = "01/" & Format(Now, "mm/yyyy")
        Else
            txtFecha(17).Text = Format(Now, "dd/mm/yyyy")
        End If
        CargaComboMes (1)
        
        Me.cboMes(1).ListIndex = Month(CDate(txtFecha(17).Text)) - 1
        Me.txtAnyo(2).Text = Year(CDate(txtFecha(17).Text))
        
        If Opcion = 23 Then lblTitulo(20).Caption = "Previsión factura "
        
        vMostrarTree = Opcion <> 23
        Label4(87).visible = vMostrarTree
        imgBanco(0).visible = vMostrarTree
        txtBanco(0).visible = vMostrarTree
        txtDescBanco(0).visible = vMostrarTree
        imgayuda(2).visible = vMostrarTree
        lblDpto(25).visible = vMostrarTree
        imgFecha(24).visible = vMostrarTree
        txtFecha(24).visible = vMostrarTree
        
        
        
        lblTitulo(20).Caption = lblTitulo(20).Caption & RentingLB & "  y servicios"
        
        
        'Fecha factura es otro campo, ahora para saber que mes vamos a facturar
        'lo seleccionamos de un combo y la fecha del peridod facturacion la tendremos oculta
        imgFecha(17).visible = False
        txtFecha(17).visible = False
        
        
    Case 25
        'Ponemos 1 y ultimo del mes anterior
        FI = DateAdd("m", -1, Now)
        FI = "01/" & Format(FI, "mm/yyyy")
        txtFecha(18).Text = Format(FI, "dd/mm/yyyy")
        FI = DateAdd("m", 1, FI)
        FI = DateAdd("d", -1, FI)
        txtFecha(19).Text = Format(FI, "dd/mm/yyyy")
        PonerFrameVisible FrameVtasCredito, H, W
        Label3(48).Caption = ""
    Case 26
        PonerFrameVisible FramePuntoPedido, H, W
        Label3(50).Caption = ""
    Case 27
        FrameVtasPer.visible = False
        PonerFrameVisible FrameRevStokInven, H, W
        Label3(53).Caption = ""
        
        
    Case 28
        
        PonerFrameVisible FrameAlmaGrupo, H, W
        Label3(54).Caption = ""
        
        ponerPeriodoProximaProcesoAlamgrupo
        
        
        
    Case 29
        PonerFrameVisible FrameExportarAlmagrupo, H, W
        Label3(55).Caption = ""
        

        ponerPeriodoProximaEXPORTACION_Alamgrupo
        
        
    Case 30
        
        PonerFrameVisible FrameFlotas, H, W
        CargaIncidenciasFlotas
        optVarios(13).Value = True
        Label3(56).Caption = "Leyendo datos"
    Case 31
        PonerFrameVisible FrameComsionHerbelca, H, W
        Label3(57).Caption = ""
        miSQL = DevuelveDesdeBD(conAri, "max(fecfactu)", "scomisiones", "1", "1")
        If miSQL = "" Then miSQL = "31/12/2011"
        FI = CDate(miSQL)
        FI = DateAdd("m", 1, FI)
        
        NumRegElim = DiasMes(CByte(Month(FI)), Year(FI))
                
        
        TxtComision.Text = NumRegElim & Format(FI, "/mm/yyyy")
        
    Case 32
        PonerFrameVisible FrameComisionAgente, H, W
        optVarios(15).Value = True
        
    Case 33
        'Generar descuentos proveedor
        PonerFrameVisible FrameGenDtoProv, H, W
        Label3(16).Caption = "" 'Indicador
        
        
    Case 35
        'Reposcion almacen
        PonerFrameVisible FrameReposcionAlmacen, H, W
        Label3(60).Caption = "" 'Indicador
        txtFecha(32).Text = Format(Now, "dd/mm/yyyy")
        txtFecha(33).Text = txtFecha(32).Text
       
        If vParamAplic.NumeroInstalacion = 2 Then
            chkVarios(34).Caption = "Incluir obras"
        Else
            chkVarios(34).Caption = "Incluir departamentos"
        End If
    Case 36
        'Fracion telefonia cooperativas
        PonerFrameVisible FrameFrarTelefonia, H, W
        CadenaDesdeOtroForm = ""
        
    Case 37
        PonerFrameVisible FrameVtasAgeTraba, H, W
        
        Label3(63).Caption = "" 'Indicador
        
    Case 38
        PonerFrameVisible frameVtaTipoPrecio, H, W
    
    Case 39
        PonerFrameVisible Me.FrameArtMasVendido, H, W
    
    Case 40
        PonerFrameVisible FrameCESCE, H, W
        
    Case 41
        PonerFrameVisible Me.FrameTelefonia, H, W
        CargaCboCompañia 0
    Case 42, 44
        'Cliente|telefno|compañia|modelo|puntos|ultrenovacion|codclien|
        For H = 0 To 5
            txtVariosBloqueado(H).Text = RecuperaValor(OtrosDatos, H + 1)
        Next
        miSQL = RecuperaValor(OtrosDatos, 7) 'tendra uno mas que el for
        NumRegElim = Val(miSQL)  'CODCLIEN
        
        PonerFrameVisible FrameRenovacion, H, W
        FrameRenov1(0).visible = Opcion = 42
        FrameRenov1(1).visible = Not FrameRenov1(0).visible
        
        If Opcion = 42 Then
            txtFecha(44).Text = Format(Now, "dd/mm/yyyy")
            lblTitulo(39).Caption = "Renovación de teléfonos"
            FrameRenov1(0).BorderStyle = 0
        Else
            lblTitulo(39).Caption = "Cambio titular"
        End If
    Case 43
        'comisones ECO
        PonerFrameVisible FrameVtasAgentePvpMenor, H, W
        Label3(72).Caption = ""
        
    
    Case 45
        
        PonerFrameVisible FramePresuFAS, H, W
    Case 46
        PonerFrameVisible FrameAgeFamMar, H, W
        Label3(81).Caption = "" 'el indicador
        Me.chkVarios(33).visible = False
        If vParamAplic.NumeroInstalacion = 2 Then
            chkVarios(26).Value = 1
            Me.chkVarios(33).visible = True
        End If
        
    Case 47
        PonerFrameVisible FrameControlDirEnvio, H, W
        Me.txtFecha(52).Text = Format(DateAdd("m", -2, Now), "dd/mm/yyyy")
        
        
    Case 48
        PonerFrameVisible FrameTelefCuotas, H, W
        CargaCboCompañia 1
        
        
    Case 49
        'Updatear familia marca
        PonerFrameVisible FrameCambioFamiliaArticulo, H, W
        
    Case 50
        'Pide un banco.
        ' Para la facturacion de ofertas a FAZ (herbelca)
        PonerFrameVisible FramePideBanco, H, W
        txtFecha(55).Text = CadenaDesdeOtroForm
        CadenaDesdeOtroForm = ""
    Case 51
        'Facturar AGUA POTABLE
        PonerFrameVisible Me.FrameAguaFacturar, H, W
        Me.txtFecha(54).Text = Format(Now, "dd/mm/yyyy")
        PonerDatosFacturacion
        
    Case 52, 53
        conSubRPT = Opcion = 52
        PonerFrameVisible FrameImportarAgua, H, W
        imgayuda(8).visible = conSubRPT
        If conSubRPT Then
            '52
            lblTitulo(48).Caption = "Importar lectura contadores agua"
            Label4(175).Caption = "Fecha lectura"
        Else
            '53
            lblTitulo(48).Caption = "Listado facturas agua"
            Label4(175).Caption = "Fecha fectura"
        End If
        Me.chkVarios(27).visible = conSubRPT
        imgCommonDialog(0).visible = conSubRPT
        Me.TxtFichero(0).visible = conSubRPT
        Label4(176).visible = conSubRPT
        
        
    Case 54
        PonerFrameVisible FrameAguaCuotaVarios, H, W
        
    Case 55
        PonerFrameVisible FrameAguaGeneralitat, H, W

    Case 56
        PonerFrameVisible FrameProveedor, H, W
        Caption = "Seleccionar proveedor"
        
    Case 57
        
        
        txtFecha(59).Text = RecuperaValor(OtrosDatos, 1)
        txtDecimal(10).Text = RecuperaValor(OtrosDatos, 2)
        txtDecimal(11).Text = RecuperaValor(OtrosDatos, 3)
        PonerFrameVisible FrameSimularPedidoProveedor, H, W
        Caption = "Pedido"
        
        
    Case 58
        cbAnyo.Clear
        W = Year(Now)
        For H = 2014 To W
            cbAnyo.AddItem CStr(H)
            If H = Year(Now) - 1 Then cbAnyo.ListIndex = cbAnyo.NewIndex
        Next
        
        
        PonerFrameVisible FrameAguaDeclaracion, H, W
        Caption = "Aguas"
    
    Case 59
        
        PonerFrameVisible FrameExportarFAS, H, W
        
        
    Case 60
        
        PonerFrameVisible FrameAgua2, H, W
    Case 61
        Caption = "Marjal-Chipos"
        PonerFrameVisible FramemarjaChipos, H, W
        Label3(93).Caption = ""
        
    Case 62
        PonerFrameVisible FrameIncremPrecioPorcen, H, W
        
    Case 63
        PonerFrameVisible FramepedidoSolicitante, H, W
        Label3(96).Caption = ""
    Case 64
        PonerFrameVisible FrameListadoManipulador, H, W
        Label3(97).Caption = ""
    End Select
    
    
    Me.Height = H + 150
    Me.Width = W
    
    W = Opcion
    If Opcion = 23 Then W = 22
    If Opcion = 34 Then W = 5
    If Opcion = 44 Then W = 42
    If Opcion = 53 Then W = 52
    If Opcion = 61 Then W = 3

    cmdCancelar(CInt(W)).Cancel = True
    
End Sub


'Dado un FRAME lo pone a true y lo situa en x:120 y:0 y devuelve lo que debe medir el form
Private Sub PonerFrameVisible(ByRef F As Frame, ByRef CH As Integer, CW As Integer)
    F.Top = 0
    F.Left = 120
    F.visible = True
    CH = F.Height + 420
    CW = F.Width + 240
End Sub

Private Sub Form_Unload(Cancel As Integer)
    If Not PuedeCerrar Then Cancel = 1
    If Opcion = 11 Then CadenaDesdeOtroForm = ""
End Sub



Private Sub frmAg_DatoSeleccionado(CadenaSeleccion As String)
    miSQL = CadenaSeleccion
End Sub

Private Sub frmB_Selecionado(CadenaDevuelta As String)
    miSQL = CadenaDevuelta
End Sub

Private Sub frmC_Selec(vFecha As Date)
    miSQL = Format(vFecha, "dd/mm/yyyy")
End Sub

Private Sub frmCli_DatoSeleccionado(CadenaSeleccion As String)
    miSQL = CadenaSeleccion
End Sub

Private Sub frmModeloTel_DatoSeleccionado(CadenaSeleccion As String)
    miSQL = CadenaSeleccion
End Sub

Private Sub frmMtoArticulos_DatoSeleccionado(CadenaSeleccion As String)
    miSQL = CadenaSeleccion
End Sub

Private Sub frmPr_DatoSeleccionado(CadenaSeleccion As String)
    miSQL = CadenaSeleccion
End Sub

Private Sub frmT_DatoSeleccionado(CadenaSeleccion As String)
    miSQL = CadenaSeleccion
End Sub

Private Sub imgActividad_Click(Index As Integer)

    Screen.MousePointer = vbHourglass
    Set frmB = New frmBuscaGrid
    frmB.vTitulo = "Activiadad"
    miSQL = "Codigo|sactiv|codactiv|N||20·"
    miSQL = miSQL & "descripcion|sactiv|nomactiv|T||45·"
    frmB.vCampos = miSQL
    frmB.vCargaFrame = False
    frmB.vDevuelve = "0|1|"
    frmB.vselElem = 1
    frmB.vConexionGrid = 1  'ODBC Ariges
    frmB.vTabla = "sactiv"
    frmB.vSQL = ""
    miSQL = ""
    frmB.Show vbModal
    Set frmB = Nothing
    Screen.MousePointer = vbDefault
    If miSQL <> "" Then
        
        Me.txtcodactiv(Index).Text = RecuperaValor(miSQL, 1)
        Me.txtDescActiv(Index).Text = RecuperaValor(miSQL, 2)
       
    End If

End Sub

Private Sub imgAgente_Click(Index As Integer)
    miSQL = ""
    Set frmAg = New frmFacAgentesCom
    frmAg.DatosADevolverBusqueda = "0|1|"
    frmAg.Show vbModal
    Set frmAg = Nothing
    
     If miSQL <> "" Then
         
        txtAgente(Index).Text = RecuperaValor(miSQL, 1)
        txtDescAgente(Index).Text = RecuperaValor(miSQL, 2)
       
    End If
End Sub

Private Sub imgAlma_Click(Index As Integer)
    
    Screen.MousePointer = vbHourglass
    Set frmB = New frmBuscaGrid
    frmB.vTitulo = "Almacén"
    miSQL = "Codigo|salmpr|codalmac|N||20·"
    miSQL = miSQL & "descripcion|salmpr|nomalmac|T||45·"
    frmB.vCampos = miSQL
    
    miSQL = ""
    frmB.vCargaFrame = False
    frmB.vDevuelve = "0|1|"
    frmB.vselElem = 1
    frmB.vConexionGrid = 1  'ODBC Ariges
    frmB.vTabla = "salmpr"
    frmB.vSQL = ""
    frmB.Show vbModal
    Set frmB = Nothing
    Screen.MousePointer = vbDefault
    If miSQL <> "" Then
        
        Me.txtAlma(Index).Text = RecuperaValor(miSQL, 1)
        Me.txtDescAlma(Index).Text = RecuperaValor(miSQL, 2)
        PonerFoco txtAlma(Index)
        If Index = 0 Then cargarUltimoIventario
    End If
End Sub

Private Sub imgArticulo_Click(Index As Integer)
    
    miSQL = ""
    Set frmMtoArticulos = New frmAlmArticu2
    'frmMtoArticulos.DatosADevolverBusqueda3 = "@1@" 'Abrimos en Modo Busqueda
    frmMtoArticulos.DesdeTPV = False
    frmMtoArticulos.Show vbModal
    Set frmMtoArticulos = Nothing
    If miSQL <> "" Then
        Me.txtArticulo(Index).Text = RecuperaValor(miSQL, 1)
        Me.txtDescArticulo(Index).Text = RecuperaValor(miSQL, 2)
        PonerFoco txtArticulo(Index)
        If Index = 0 Then cargarUltimoIventario
        If Index = 8 Then CargaPrecioCompraProve
        If Index = 6 Then CargaPrecioCosteArticulo
    End If
End Sub


Private Sub imgayuda_Click(Index As Integer)
Dim Ayuda As String

    'Sera las ayuda. Tampoco queiero la biblia, pero,
    'si un "pelin" de ayuda no me vendria mal a mi, imaginemos a el cliente final
    Select Case Index
    Case 0
        'recalculo ultimo precio compra
        Ayuda = vbCrLf & " Fecha:    Fecha a partir de la cual NO se modificará el UPC"
        Ayuda = Ayuda & vbCrLf & vbCrLf & "Incremento: Positivo o negativo, sobre el precio que se escoja"
        Ayuda = Ayuda & vbCrLf & vbCrLf & "No se modificarán artículos con stock 0"
        
        
    Case 1
        Ayuda = vbCrLf & " (*) Regulariza: Si el stock del mes resulta negativo lo pone a cero"
        Ayuda = Ayuda & vbCrLf & " y muestra una pantalla con los articulos regularizados"
        Ayuda = Ayuda & vbCrLf & " (*) Opcion para incluir articulos de varios"
        Ayuda = Ayuda & vbCrLf & " (*) Opcion para coger el precio de la ficha del artículo"
        Ayuda = Ayuda & vbCrLf & vbCrLf & " Stock a una fecha-> Sin regularizar,incluir varios,precio de la ficha"
    Case 2
        Ayuda = vbCrLf & " Fecha:    Ademas de indicar la fecha para la factura, indicara el mes a facturar"
        
    Case 3
        Ayuda = vbCrLf & "-Desde inventario: Diferencia entro sctok actual y calculado"
        Ayuda = Ayuda & vbCrLf & "-Negativos: Stcoks negativos"
        Ayuda = Ayuda & vbCrLf & "-Vtas periodos con stock. Las ventas del articulo y el stock actual"
        
        
    Case 4
        Ayuda = vbCrLf & "Si marca todos, los datos(alb/ped) anteriores a la fecha saldran marcados  "
        Ayuda = Ayuda & vbCrLf & "en el informe y como fecha la de inicio"
    Case 5
        Ayuda = vbCrLf & "Para los proveedores seleccionados creara los descuentos para la familia, marca y fecha  "
        Ayuda = vbCrLf & "con los valores Dto1,Dto2,Rappel1,Rappel2  "
        Ayuda = Ayuda & vbCrLf & "Si marcamos ""Actualizar datos existentes"" acutalizará los valores a estos nuevos"
        
    Case 6
        Ayuda = vbCrLf & "A partir de la seccion de articulos (D/H, varios y control de stock)  "
        Ayuda = Ayuda & vbCrLf & " 1.-Desde ultimo precio de compra:"
        Ayuda = Ayuda & vbCrLf & "      - SI: el UPC de la ficha del artículo "
        Ayuda = Ayuda & vbCrLf & "      - NO: va a la lista de precios de proveedor. SI tiene en cuenta fecha cambio" & vbCrLf & vbCrLf
        Ayuda = Ayuda & vbCrLf & " 2.- Aplica dtos Fam/Prov: Al precio obtenido le aplicará dtos fam/prove"
        Ayuda = Ayuda & vbCrLf & "      Si no hay dto, o el dto es cero, el precio sera UPC del artículo" & vbCrLf & vbCrLf
        Ayuda = Ayuda & vbCrLf & " 3.- Aplica dtos rappel: Al precio obtenido le aplicará dtos rappel"
        Ayuda = Ayuda & vbCrLf & " 4.- Actualizar precio medio: Si lo marca se actualiza tambien. "
    
    Case 7
        Ayuda = vbCrLf & "Si no indica ningún almacen obtendra los datos de todos  "
        
    
    Case 8
        Ayuda = vbCrLf & "Dos listados comprobacion datos: "
        Ayuda = Ayuda & vbCrLf & " 1.- Normal. Mostrará todos los datos de la factura. Consumo. Iva. Cuotas etc"
        Ayuda = Ayuda & vbCrLf & " 2.- Resumen. Saldran datos de consumo(m3).  Al finalizar la impresion, si es correcto, se podrá comenzar la importación"
    
    Case 9
        Ayuda = vbCrLf & "Presupuestos:  O normal o presupuesto  "
    End Select
    
    Ayuda = imgayuda(Index).ToolTipText & vbCrLf & String(40, "=") & vbCrLf & Ayuda
    MsgBox Ayuda, vbInformation

End Sub

Private Sub imgBanco_Click(Index As Integer)
 
    Screen.MousePointer = vbHourglass
    Set frmB = New frmBuscaGrid
    frmB.vTitulo = "Bancos propios"
    miSQL = "Codigo|sbanpr|codbanpr|N||20·"
    miSQL = miSQL & "descripcion|sbanpr|nombanpr|T||45·"
    frmB.vCampos = miSQL
    
    miSQL = ""
    frmB.vCargaFrame = False
    frmB.vDevuelve = "0|1|"
    frmB.vselElem = 1
    frmB.vConexionGrid = 1  'ODBC Ariges
    frmB.vTabla = "sbanpr"
    frmB.vSQL = ""
    frmB.Show vbModal
    Set frmB = Nothing
    Screen.MousePointer = vbDefault
    If miSQL <> "" Then
        
        Me.txtBanco(Index).Text = RecuperaValor(miSQL, 1)
        Me.txtDescBanco(Index).Text = RecuperaValor(miSQL, 2)
        PonerFoco txtBanco(Index)
    End If
End Sub

Private Sub imgCheck_Click(Index As Integer)
Dim Cual As Byte
Dim Chec As Boolean

    If Index < 6 Then
        'trabajadores....
        Cual = Index \ 2
        Chec = True
        If (Index Mod 2) = 0 Then Chec = False
    
        For NumRegElim = 1 To ListView1(Cual).ListItems.Count
            ListView1(Cual).ListItems(NumRegElim).Checked = Chec
        Next
        
    ElseIf Index < 8 Then
        'INCIDENCIAS
        ' 6-7
        Chec = True
        If (Index Mod 2) = 0 Then Chec = False
    
        For NumRegElim = 1 To lwInci.ListItems.Count
            lwInci.ListItems(NumRegElim).Checked = Chec
        Next
        
    ElseIf Index < 10 Then
        'Familias
        ' 8-9
        Chec = True
        If (Index Mod 2) = 1 Then Chec = False
    
        For NumRegElim = 1 To lwFam.ListItems.Count
            lwFam.ListItems(NumRegElim).Checked = Chec
        Next
        
    ElseIf Index < 12 Then
        'Facturas
        '10-11
        Chec = False
        If (Index Mod 2) = 1 Then Chec = True
    
         
        For NumRegElim = 1 To lwFact.ListItems.Count
            lwFact.ListItems(NumRegElim).Checked = Chec
        Next
    
    ElseIf Index < 14 Then
        'Incidencias flotas
        '12-13
        Cual = 4
        Chec = True
        If (Index Mod 2) = 0 Then Chec = False
    
        For NumRegElim = 1 To ListView1(Cual).ListItems.Count
            ListView1(Cual).ListItems(NumRegElim).Checked = Chec
        Next
    Else
        'trabajadore para ventas x traba
        '12-13
        Cual = 5
        Chec = True
        If (Index Mod 2) = 0 Then Chec = False
    
        For NumRegElim = 1 To ListView1(Cual).ListItems.Count
            ListView1(Cual).ListItems(NumRegElim).Checked = Chec
        Next
    End If
End Sub




Private Sub imgCliente_Click(Index As Integer)
    Screen.MousePointer = vbHourglass
    miSQL = ""
    Set frmCli = New frmFacClientes3
    frmCli.DatosADevolverBusqueda = "0|1|"
    frmCli.Show vbModal
    Set frmCli = Nothing
    If miSQL <> "" Then
        Me.txtCliente(Index).Text = RecuperaValor(miSQL, 1)
        Me.txtDescClie(Index).Text = RecuperaValor(miSQL, 2)
    End If
End Sub

Private Sub imgCommonDialog_Click(Index As Integer)
On Error GoTo eDialog
    cd1.CancelError = True
    cd1.DefaultExt = ".csv" 'extension por defecto
    cd1.Filter = "CSV |*.csv|" 'extensiones a mostrar
    cd1.FilterIndex = 1
    cd1.FileName = ""
    
    Me.cd1.ShowOpen
    
eDialog:
    If Err.Number <> 0 Then Err.Clear
    If cd1.FileName <> "" Then Me.TxtFichero(Index).Text = cd1.FileName
End Sub

Private Sub imgFamilia_Click(Index As Integer)
    miSQL = ""
    Screen.MousePointer = vbHourglass
    Set frmB = New frmBuscaGrid
    frmB.vTitulo = "Familia"
    codigo = "Codigo|sfamia|Codfamia|N||20·"
    codigo = codigo & "descripcion|sfamia|nomfamia|T||45·"
    frmB.vCampos = codigo
    frmB.vCargaFrame = False
    frmB.vDevuelve = "0|1|"
    frmB.vselElem = 1
    frmB.vConexionGrid = 1  'ODBC Ariges
    frmB.vTabla = "sfamia"
    frmB.vSQL = ""
    frmB.Show vbModal
    Set frmB = Nothing
    Screen.MousePointer = vbDefault
    If miSQL <> "" Then
        
        Me.txtFamia(Index).Text = RecuperaValor(miSQL, 1)
        Me.txtDescFamia(Index).Text = RecuperaValor(miSQL, 2)
        PonerFoco txtFamia(Index)
        miSQL = ""
    End If
End Sub


Private Sub imgFecha_Click(Index As Integer)
   miSQL = ""
   Set frmC = New frmCal
   frmC.Fecha = Now
   If txtFecha(Index).Text <> "" Then
        If IsDate(txtFecha(Index).Text) Then frmC.Fecha = CDate(txtFecha(Index).Text)
   End If
   frmC.Show vbModal
   Set frmC = Nothing
   If miSQL <> "" Then txtFecha(Index).Text = miSQL
End Sub

Private Sub imgMarca_Click(Index As Integer)
    
    Screen.MousePointer = vbHourglass
    Set frmB = New frmBuscaGrid
    frmB.vTitulo = "Marcas"
    miSQL = "Codigo|smarca|codmarca|N||20·"
    miSQL = miSQL & "descripcion|smarca|nommarca|T||45·"
    frmB.vCampos = miSQL
    miSQL = ""
    frmB.vCargaFrame = False
    frmB.vDevuelve = "0|1|"
    frmB.vselElem = 1
    frmB.vConexionGrid = 1  'ODBC Ariges
    frmB.vTabla = "smarca"
    frmB.vSQL = ""
    frmB.Show vbModal
    Set frmB = Nothing
    Screen.MousePointer = vbDefault
    If miSQL <> "" Then
        
        Me.txtmarca(Index).Text = RecuperaValor(miSQL, 1)
        Me.txtDescmarca(Index).Text = RecuperaValor(miSQL, 2)
        If Index = 0 Then
            'PonerFoco txtmarca(1)
        Else
            'PonerFocoBtn Me.cmdPropuestaPedido
        End If
    End If
End Sub

Private Sub imgModelo_Click(Index As Integer)
    miSQL = ""
    Set frmModeloTel = New frmTelefoniaModelos
    frmModeloTel.DatosADevolverBusqueda = "0|1|"
    frmModeloTel.Show vbModal
    Set frmModeloTel = Nothing
    If miSQL <> "" Then
        Me.txtModelo(Index).Text = RecuperaValor(miSQL, 1)
        Me.txtDescModelo(Index).Text = RecuperaValor(miSQL, 2)
        miSQL = ""
        PonerFoco txtNumEntero(0)
    End If
End Sub

Private Sub imgProveedor_Click(Index As Integer)
    miSQL = ""
    Set frmPr = New frmComProveedores
    frmPr.DatosADevolverBusqueda = "0|1|"
    frmPr.Show vbModal
    Set frmPr = Nothing
    If miSQL <> "" Then
        Me.txtCodProve(Index).Text = RecuperaValor(miSQL, 1)
        Me.txtDescProve(Index).Text = RecuperaValor(miSQL, 2)
        miSQL = ""
        PonerFoco txtCodProve(Index)
        If Index = 8 Then CargaPrecioCompraProve
        If Index = 13 Then CargarFamiliasProveedor
        If Index = 29 Then HacerSimulacionPedidoProveedor
    End If
End Sub


Private Sub imgTraba_Click(Index As Integer)
    miSQL = ""
    Set frmT = New frmAdmTrabajadores
    frmT.DatosADevolverBusqueda = "0|1|"
    frmT.Show vbModal
    Set frmT = Nothing
    If miSQL <> "" Then
        Me.txtCodTraba(Index).Text = RecuperaValor(miSQL, 1)
        Me.txtDescTraba(Index).Text = RecuperaValor(miSQL, 2)
        miSQL = ""
        PonerFoco txtCodTraba(Index)
    End If
End Sub

Private Sub imgVehiculo_Click(Index As Integer)
    miSQL = ""
    Screen.MousePointer = vbHourglass
    Set frmB = New frmBuscaGrid
    frmB.vTitulo = "Vehiculos"
    codigo = "Codigo|sflotas|codflota|T||25·"
    codigo = codigo & "descripcion|sflotas|nomflota|T||45·"
    frmB.vCampos = codigo
    frmB.vCargaFrame = False
    frmB.vDevuelve = "0|1|"
    frmB.vselElem = 1
    frmB.vConexionGrid = 1  'ODBC Ariges
    frmB.vTabla = "sflotas"
    frmB.vSQL = ""
    frmB.Show vbModal
    Set frmB = Nothing
    Screen.MousePointer = vbDefault
    If miSQL <> "" Then
        
        Me.txtVehiculo(Index).Text = RecuperaValor(miSQL, 1)
        Me.txtDescVehiculo(Index).Text = RecuperaValor(miSQL, 2)
        PonerFoco txtVehiculo(Index)
        miSQL = ""
    End If


End Sub

Private Sub ListView1_DblClick(Index As Integer)
    If Index = 3 Then cmdBanco_Click 1
End Sub




Private Sub lwFact_KeyPress(KeyAscii As Integer)
    KEYpressGnral KeyAscii, 3, False
End Sub

Private Sub lwPrecUC_KeyPress(KeyAscii As Integer)
    KEYpressGnral KeyAscii, 3, False
End Sub

Private Sub optArtMasVendidos_KeyPress(Index As Integer, KeyAscii As Integer)
     KEYpressGnral KeyAscii, 3, False
End Sub

Private Sub optCtrlStock_Click(Index As Integer)
    FrameVtasPer.visible = optCtrlStock(2).Value
End Sub

Private Sub optModEstVta_Click(Index As Integer)
    Me.FrameMoDVtaArt(Index).visible = True
    NumRegElim = 0
    If Index = 0 Then NumRegElim = 1
    Me.FrameMoDVtaArt(NumRegElim).visible = False
    PonerFoco txtFecha(7)
End Sub

Private Sub optPrevision_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 3, False
End Sub



Private Sub optTipoPrecio_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 3, False
End Sub

Private Sub optVarios_Click(Index As Integer)
    'Orden 2 visible si orden1 es Poblacion
    If Index = 3 Or Index = 2 Then
        FrameOrden2.visible = Index = 3
    End If
        
 
        
End Sub

Private Sub optVarios_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 3, False
End Sub

Private Sub Text1_KeyPress(KeyAscii As Integer)
    KEYpressGnral KeyAscii, 3, False
End Sub


Private Sub txtAgente_GotFocus(Index As Integer)
    ConseguirFoco txtAgente(Index), 3
End Sub

Private Sub txtAgente_KeyDown(Index As Integer, KeyCode As Integer, Shift As Integer)
    If (Shift And vbCtrlMask) > 0 Then
        'Caption = KeyCode
        If KeyCode = 65 Then imgAgente_Click Index
    End If
End Sub

Private Sub txtAgente_KeyPress(Index As Integer, KeyAscii As Integer)
     KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtAgente_LostFocus(Index As Integer)
    miSQL = ""
    txtAgente(Index).Text = Trim(txtAgente(Index).Text)
    If txtAgente(Index).Text <> "" Then
        If PonerFormatoEntero(txtAgente(Index)) Then
            
            miSQL = DevuelveDesdeBD(conAri, "nomagent", "sagent", "codagent", txtAgente(Index).Text)
            If miSQL = "" Then MsgBox "No existe el agente: " & txtArticulo(Index).Text, vbExclamation
        End If
    End If
    Me.txtDescAgente(Index).Text = miSQL
    miSQL = ""
End Sub

Private Sub txtArticulo_KeyDown(Index As Integer, KeyCode As Integer, Shift As Integer)
    If (Shift And vbCtrlMask) > 0 Then
        'Caption = KeyCode
        If KeyCode = 65 Then imgArticulo_Click Index
    End If
End Sub

Private Sub txtBanco_GotFocus(Index As Integer)
    ConseguirFoco txtBanco(Index), 3
End Sub

Private Sub txtBanco_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtBanco_LostFocus(Index As Integer)
    miSQL = ""
    txtBanco(Index).Text = Trim(txtBanco(Index).Text)
    If txtBanco(Index).Text <> "" Then
        If Not IsNumeric(txtBanco(Index).Text) Then
            MsgBox "Campo codigo banco debe ser numérico", vbExclamation

        Else
            miSQL = DevuelveDesdeBD(conAri, "nombanpr", "sbanpr", "codbanpr", txtBanco(Index).Text, "N")
            If miSQL = "" Then MsgBox "No existe el banco : " & txtBanco(Index).Text, vbExclamation
                
            
        End If
        
    End If
    Me.txtDescBanco(Index).Text = miSQL
    If miSQL = "" Then
        If txtBanco(Index).Text <> "" Then
            txtBanco(Index).Text = ""
            PonerFoco txtBanco(Index)
        End If
    End If
End Sub

Private Sub txtCliente_GotFocus(Index As Integer)
    ConseguirFoco txtCliente(Index), 3
End Sub

Private Sub txtCliente_KeyDown(Index As Integer, KeyCode As Integer, Shift As Integer)
    If (Shift And vbCtrlMask) > 0 Then
        'Caption = KeyCode
        If KeyCode = 65 Then imgCliente_Click Index
    End If
End Sub

Private Sub txtCliente_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtCliente_LostFocus(Index As Integer)
Dim Descri As String
    
    Descri = ""
    txtCliente(Index).Text = Trim(txtCliente(Index).Text)
    If txtCliente(Index).Text <> "" Then
        If Not IsNumeric(txtCliente(Index).Text) Then
            MsgBox "Campo codigo cliente debe ser numérico", vbExclamation
            PonerFoco txtCliente(Index)
        Else
            Descri = DevuelveDesdeBD(conAri, "nomclien", "sclien", "codclien", txtCliente(Index).Text, "N")
            If Descri = "" Then
                MsgBox "No existe el cliente : " & txtCliente(Index).Text, vbExclamation
            End If
        End If
    End If
    Me.txtDescClie(Index).Text = Descri
    
    
    
End Sub



Private Sub txtcodactiv_GotFocus(Index As Integer)
    ConseguirFoco txtcodactiv(Index), 3
End Sub

Private Sub txtcodactiv_KeyDown(Index As Integer, KeyCode As Integer, Shift As Integer)

    If (Shift And vbCtrlMask) > 0 Then
        'Caption = KeyCode
        If KeyCode = 65 Then imgActividad_Click Index
    End If
    
End Sub

Private Sub txtcodactiv_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtcodactiv_LostFocus(Index As Integer)
 txtcodactiv(Index).Text = Trim(txtcodactiv(Index).Text)
    codigo = ""
    miSQL = ""
    If txtcodactiv(Index).Text <> "" Then
        If IsNumeric(txtcodactiv(Index).Text) Then
            codigo = DevuelveDesdeBD(conAri, "nomactiv", "sactiv", "codactiv", txtcodactiv(Index).Text, "N")
        Else
            miSQL = "Campo numerico"
        End If
    End If
    Me.txtDescActiv(Index).Text = codigo
    If miSQL <> "" Then
        MsgBox miSQL, vbExclamation
        txtcodactiv(Index).Text = ""
        PonerFoco txtcodactiv(Index)
    End If
End Sub

Private Sub txtCodProve_KeyDown(Index As Integer, KeyCode As Integer, Shift As Integer)


    If (Shift And vbCtrlMask) > 0 Then
        'Caption = KeyCode
        If KeyCode = 65 Then imgProveedor_Click Index
    End If
    
    
End Sub

Private Sub txtCodTraba_GotFocus(Index As Integer)
    ConseguirFoco txtFamia(Index), 3
End Sub


Private Sub txtCodTraba_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtCodTraba_LostFocus(Index As Integer)
    txtCodTraba(Index).Text = Trim(txtCodTraba(Index).Text)
      
    codigo = ""
    miSQL = ""
    If txtCodTraba(Index).Text <> "" Then
        If IsNumeric(txtCodTraba(Index).Text) Then
            codigo = DevuelveDesdeBD(conAri, "nomtraba", "straba", "codtraba", txtCodTraba(Index).Text, "N")
            If codigo = "" Then MsgBox "El codigo no pertence a ningun trabajador", vbExclamation
        Else
            miSQL = "Campo numerico"
        End If
    End If
     
    Me.txtDescTraba(Index).Text = codigo
    If miSQL <> "" Then
        MsgBox miSQL, vbExclamation
        txtCodTraba(Index).Text = ""
        PonerFoco txtFamia(Index)
    End If
    
End Sub

Private Sub txtDecimal_GotFocus(Index As Integer)
    ConseguirFoco txtDecimal(Index), 3
End Sub

Private Sub txtDecimal_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtDecimal_LostFocus(Index As Integer)
Dim B As Boolean
    txtDecimal(Index).Text = Trim(txtDecimal(Index).Text)
    If txtDecimal(Index).Text <> "" Then
        If Index = 0 Or Index = 9 Or Index = 17 Then
            B = PonerFormatoDecimal(txtDecimal(Index), 2)
        Else
            If Index = 18 Then
                'Decimal
                B = PonerFormatoDecimal(txtDecimal(Index), 4)
            Else
                B = PonerFormatoDecimal(txtDecimal(Index), 3)
            End If
        End If
        If B Then

        Else
            txtDecimal(Index).Text = ""
        End If
    End If
End Sub



Private Sub txtFamia_KeyDown(Index As Integer, KeyCode As Integer, Shift As Integer)
    If (Shift And vbCtrlMask) > 0 Then
        'Caption = KeyCode
        If KeyCode = 65 Then imgFamilia_Click Index
    End If
End Sub



Private Sub txtmarca_GotFocus(Index As Integer)
    ConseguirFoco txtmarca(Index), 3
End Sub

Private Sub txtmarca_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtmarca_LostFocus(Index As Integer)
    txtmarca(Index).Text = Trim(txtmarca(Index).Text)
    codigo = ""
    miSQL = ""

    If txtmarca(Index).Text <> "" Then
        If IsNumeric(txtmarca(Index).Text) Then
            codigo = DevuelveDesdeBD(conAri, "nommarca", "smarca", "codmarca", txtmarca(Index).Text, "N")
            If codigo = "" Then MsgBox "El código no pertence a ninguna marca", vbExclamation
            
        Else
            miSQL = "Campo numerico"
        End If
    End If
    
    Me.txtDescmarca(Index).Text = codigo
    If miSQL <> "" Then
        MsgBox miSQL, vbExclamation
        If Index = 0 Then 'Obligado marca
            txtmarca(Index).Text = ""
            PonerFoco txtmarca(Index)
        End If
    End If
End Sub



Private Sub txtModelo_GotFocus(Index As Integer)
    ConseguirFoco txtModelo(Index), 3
End Sub

Private Sub txtModelo_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtModelo_LostFocus(Index As Integer)
    miSQL = ""
    txtModelo(Index).Text = Trim(txtModelo(Index).Text)
    If txtModelo(Index).Text <> "" Then
        If Not IsNumeric(txtModelo(Index).Text) Then
            MsgBox "Campo codigo modelo debe ser numérico", vbExclamation

        Else
            miSQL = DevuelveDesdeBD(conAri, "descripcion", "stfnomodel", "codmodelo", txtModelo(Index).Text, "N")
            If miSQL = "" Then MsgBox "No existe el modelo : " & txtModelo(Index).Text, vbExclamation
            
        End If
        If miSQL = "" Then
            Me.txtModelo(Index).Text = ""
            PonerFoco txtModelo(Index)
        End If
    End If
    Me.txtDescModelo(Index).Text = miSQL
    
End Sub

Private Sub txtNumEntero_GotFocus(Index As Integer)
    ConseguirFoco txtNumEntero(Index), 3
End Sub

Private Sub txtNumEntero_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtNumEntero_LostFocus(Index As Integer)
    txtNumEntero(Index).Text = Trim(txtNumEntero(Index).Text)
    If txtNumEntero(Index).Text <> "" Then
        If PonerFormatoEntero(txtNumEntero(Index)) Then

        Else
            txtNumEntero(Index).Text = ""
        End If
    End If
End Sub



Private Sub txtAlma_GotFocus(Index As Integer)
    ConseguirFoco txtAlma(Index), 3
End Sub



Private Sub txtAlma_KeyPress(Index As Integer, KeyAscii As Integer)
      KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtAlma_LostFocus(Index As Integer)
    txtAlma(Index).Text = Trim(txtAlma(Index).Text)
    codigo = ""
    miSQL = ""
    If txtAlma(Index).Text <> "" Then
        If IsNumeric(txtAlma(Index).Text) Then
            codigo = DevuelveDesdeBD(conAri, "nomalmac", "salmpr", "codalmac", txtAlma(Index).Text, "N")
            If codigo = "" Then miSQL = "El codigo no pertence a ningun almacén"
        Else
            miSQL = "Campo numerico"
        End If
    End If
     
    Me.txtDescAlma(Index).Text = codigo
    If miSQL <> "" Then
        MsgBox miSQL, vbExclamation
        txtAlma(Index).Text = ""
        PonerFoco txtAlma(Index)
    End If
    
    If Index = 0 Then cargarUltimoIventario
End Sub
Private Sub txtanyo_GotFocus(Index As Integer)
     ConseguirFoco txtAnyo(Index), 3
End Sub

Private Sub txtanyo_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 3, False

End Sub

Private Sub txtanyo_LostFocus(Index As Integer)
    
    txtAnyo(Index).Text = Trim(txtAnyo(Index).Text)
    If txtAnyo(Index).Text <> "" Then
        If PonerFormatoEntero(txtAnyo(Index)) Then
            If Val(txtAnyo(Index).Text) < 1000 Then
                MsgBox "Año incorrecto", vbExclamation
                txtAnyo(Index).Text = ""
            End If
        Else
            txtAnyo(Index).Text = ""
        End If
    End If
    If Index = 0 Then PrecargaSaldosBanco
End Sub



Private Sub CargaComboMes(Kcombo As Integer)
Dim i As Integer

    Me.cboMes(Kcombo).Clear
    For i = 1 To 12
        cboMes(Kcombo).AddItem Format("15/" & i & "/2000", "mmmm")
    Next i
End Sub





Public Function GenerarDatosPrevision() As Boolean

    On Error GoTo EGenerarDatosPrevision
    GenerarDatosPrevision = False

    'Borramos los temporales
    Label3(4).Caption = "Borrando datos temporales"
    Label3(4).Refresh
    BorrarTemporalesPrevision


    'Leer gastos fijos
    Label3(4).Caption = "Leyendo gastos fijos"
    Label3(4).Refresh
    LeyendoGastosFijos
    
    
    'leyendo datos tesoreria
    Label3(4).Caption = "Leyendo tesoreria pagos"
    Label3(4).Refresh
    LeyendoPagosTesoreria
    
    'leyendo datos tesoreria
    Label3(4).Caption = "Leyendo tesoreria cobros"
    Label3(4).Refresh
    LeyendoCobbrosTesoreria
    
    'prevesion facturacion
    Label3(4).Caption = "Prevision facturacion"
    Label3(4).Refresh
    PrevisionFacturacion
    
    Label3(4).Caption = "Saldo bancos"
    Label3(4).Refresh
    'CargaSaldoBanco
    CargaEnPrevisonBancos
    
    
    
    Label3(4).Caption = "Volcando datos"
    Label3(4).Refresh
    CargaSobretmp2


    Label3(4).Caption = "Fin proceso"
    Label3(4).Refresh

    GenerarDatosPrevision = True
    Exit Function
EGenerarDatosPrevision:
    MuestraError Err.Number
End Function



Private Sub BorrarTemporalesPrevision()
    'Deletes
    conn.Execute "DELETE FROM tmpprevision WHERE codusu = " & vUsu.codigo
    conn.Execute "DELETE FROM tmpinformes WHERE codusu =" & vUsu.codigo
    conn.Execute "DELETE FROM tmpprevision2 WHERE codusu =" & vUsu.codigo
    conn.Execute "DELETE FROM tmpslipreu WHERE codusu =" & vUsu.codigo
    conn.Execute "DELETE FROM tmpsliped WHERE codusu =" & vUsu.codigo
    
End Sub


Private Sub FijaFechaIni()
    If Me.optPrevision(0).Value Then
        'Primera quinciena
        FI = CDate("01/" & Me.cboMes(0).ListIndex + 1 & "/" & txtAnyo(0).Text)
        FF = CDate("15/" & Me.cboMes(0).ListIndex + 1 & "/" & txtAnyo(0).Text)
    Else
        FI = CDate("16/" & Me.cboMes(0).ListIndex + 1 & "/" & txtAnyo(0).Text)
        'El fin sera de un mes mas a el uno de ese mes - 1 dia
        FF = CDate("01/" & Me.cboMes(0).ListIndex + 1 & "/" & txtAnyo(0).Text)
        FF = DateAdd("m", 1, FF)
        FF = DateAdd("d", -1, FF)
        
    End If
End Sub

Private Sub SumarQuincena()

    
    If Day(FI) = 1 Then
        FF = DateAdd("m", 1, FI)
        FF = DateAdd("d", -1, FF)
        FI = CDate("16/" & Month(FI) & "/" & Year(FI))
       
        
    Else
        'Auxilia
    
        FI = DateAdd("d", 1, FF)
        FF = CDate("15/" & Month(FI) & "/" & Year(FI))
    End If
    
    
End Sub


Private Sub LeyendoGastosFijos()
Dim i As Integer
Dim Aux As String
Dim Importe As Currency
Dim SQL As String

    'Detalle de la quincena
    FijaFechaIni
    NumRegElim = 0
    miSQL = ""
    For i = 1 To 6
        'Insertaremos en tmpinformes codusu,codigo1,campo1,campo2,  nombre1,importe1
        '                                   secuen   gasto  quinc   desc    imp
        SQL = "SELECT sgastfij.codigo,Descripcion,importe  FROM sgastfij,sgastfijd WHERE sgastfij.codigo=sgastfijd.codigo "
        SQL = SQL & " AND fecha >= " & DBSet(FI, "F") & " AND fecha <= " & DBSet(FF, "F")
        miRsAux.Open SQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        Importe = 0
        While Not miRsAux.EOF
        
            
        
        
            NumRegElim = NumRegElim + 1
            'En tmpinformes SOLO metemos la quincena 1
            If i < 2 Then
                'tmpinformes codusu,codigo1,campo1,campo2,  nombre1,importe1
                miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!codigo & "," & i & ","
                miSQL = miSQL & DBSet(miRsAux!Descripcion, "T") & "," & TransformaComasPuntos(CStr(miRsAux!Importe)) & ")"
            End If
            
            Importe = Importe + miRsAux!Importe
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        
        
        'Lo metemos en el resumen de gastos
        
            Aux = "INSERT INTO tmpprevision(codusu,anyo,mes,quincena,tipo,cobro,pago,descripcion) VALUES (" & vUsu.codigo & ","
            Aux = Aux & Year(FI) & "," & Month(FI) & ","
            If Day(FI) = 1 Then
                Aux = Aux & "1"
            Else
                Aux = Aux & "2"
            End If
            Aux = Aux & ",999,null," & DBSet(Importe, "N") & ",'GASTOS FIJOS')"
            conn.Execute Aux
        
        
        'Siguiente quincena
        SumarQuincena
    Next i
    If miSQL <> "" Then
        miSQL = Mid(miSQL, 2)
        miSQL = "INSERT INTO tmpinformes (codusu,codigo1,campo1,campo2,  nombre1,importe1) VALUES " & miSQL
        conn.Execute miSQL
    End If
    
    

End Sub

Private Sub IncicializaVectorSQL(Pagos As Boolean)
Dim J As Integer
Dim Aux As String

    For J = 0 To 6
        Aux = " (" & vUsu.codigo & "," & Year(FI) & "," & Month(FI) & ","
        If Day(FI) = 1 Then
            Aux = Aux & "1"
        Else
            Aux = Aux & "2"
        End If
        Aux = Aux & "," & J & ","
        If Pagos Then
            Aux = Aux & "null,0"
        Else
            Aux = Aux & "0,null"
        End If
        
        Aux = Aux & ",'')"

        vectorSQL(J) = Aux
    Next J
End Sub


Private Sub LeyendoPagosTesoreria()
Dim i As Integer
Dim J As Integer
Dim Aux As String

    'Detalle de la quincena
   FijaFechaIni
    NumRegElim = 0
    Aux = ""
    For i = 1 To 6
        'Insertaremos en tmpinformes codusu,codigo1,campo1,campo2,  nombre1,importe1
        '                                   secuen   gasto  quinc   desc    imp
        miSQL = "SELECT tipforpa,descformapago,sum(impefect) suma FROM spagop,sforpa,stipoformapago WHERE "
        miSQL = miSQL & "spagop.codforpa=sforpa.codforpa AND tipforpa = tipoformapago  "

        miSQL = miSQL & " AND fecefect >= " & DBSet(FI, "F") & " AND fecefect <= " & DBSet(FF, "F")
        miSQL = miSQL & " GROUP BY tipforpa"
        miRsAux.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        IncicializaVectorSQL True
        While Not miRsAux.EOF
            NumRegElim = NumRegElim + 1
        
            'Lo metemos en el resumen de gastos.
            
            Aux = "(" & vUsu.codigo & "," & Year(FI) & "," & Month(FI) & ","
            If Day(FI) = 1 Then
                Aux = Aux & "1"
            Else
                Aux = Aux & "2"
            End If
            Aux = Aux & "," & miRsAux!tipforpa & ",null," & DBSet(miRsAux!Suma, "N") & "," & DBSet(miRsAux!descformapago, "T") & ")"
            vectorSQL(miRsAux!tipforpa) = Aux
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        
        Aux = ""
        For J = 0 To 6
            Aux = Aux & ", " & vectorSQL(J)
        Next
        Aux = Mid(Aux, 2)
        
        
        miSQL = "INSERT INTO tmpprevision(codusu,anyo,mes,quincena,tipo,cobro,pago,descripcion) VALUES " & Aux
        conn.Execute miSQL
    
        
        
        'Siguiente quincena
        SumarQuincena
    Next i


    
    


End Sub





Private Sub LeyendoCobbrosTesoreria()
Dim i As Integer
'Dim J As Integer
Dim AuxSQL As String
Dim FInicio As Date
Dim Impor As Currency
    'ABRIL 2011
    'Nueva forma.
    'Cargaremos en tmpsliped
    '
    'tmpsliped(codusu,numpedcl,numlinea,codalmac,codartic,nomartic,cantidad,importel)
    'y meteremos UNA unica linea con el total disponible


    'Detalle de la quincena
    FijaFechaIni
    FInicio = FI
    For i = 1 To 6
        SumarQuincena
    Next
    FI = FInicio   'ahora tengo desde fi=feinicio total y  FF que es fecha FIN del bucle
    
    NumRegElim = 0
    AuxSQL = ""
    IncicializaVectorSQL False

    'DISPONIBLE
    '-------------------------------------------------------------
    ' Todo menos lo NO disponible
    '   No disponible:   Trasferencia, pagares,talones que no tengan la marca de documento recibido
      
      
    'Disponible:
    '    Efectivo, tarjeta y recibo bancario  0,4,6
        miSQL = "SELECT tipforpa,descformapago,sum(impvenci+if(gastos is null,0,gastos)-if(impcobro is null,0,impcobro)) suma FROM scobro,sforpa,stipoformapago WHERE "
        miSQL = miSQL & "scobro.codforpa=sforpa.codforpa AND tipforpa = tipoformapago  "
        'miSQL = miSQL & " AND fecvenci >= " & DBSet(FI, "F")
        'If I < 6 Then miSQL = miSQL & " AND fecvenci <= " & DBSet(FF, "F")
        miSQL = miSQL & " AND situacionjuri=0 AND Devuelto=0"
        miSQL = miSQL & " AND tipforpa IN (0,4,6)"
        miSQL = miSQL & " GROUP BY tipforpa"
        miRsAux.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        
        While Not miRsAux.EOF
            NumRegElim = NumRegElim + 1
            
            'tmpsliped(codusu,numpedcl,numlinea,codalmac,codartic,nomartic,cantidad,importel)
            miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & ",0," & miRsAux!tipforpa & ",'D'," & DBSet(miRsAux!descformapago, "T") & ","
            'cantidad importel  -->  disponible  y NO dsiponible
            miSQL = miSQL & DBSet(miRsAux!Suma, "N") & ",0)"
            'resto campos obligados
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        AuxSQL = miSQL
        
        'Disponible tb es:  talon,paga y confirming con la marca de reccedocu y QUE NO este remesado
        miSQL = "SELECT tipforpa,descformapago,sum(impvenci+if(gastos is null,0,gastos)) suma FROM scobro,sforpa,stipoformapago WHERE "
        miSQL = miSQL & "scobro.codforpa=sforpa.codforpa AND tipforpa = tipoformapago  "
        miSQL = miSQL & " AND situacionjuri=0 AND Devuelto=0"
        miSQL = miSQL & " AND recedocu=1"
        miSQL = miSQL & " AND codrem is null"
        miSQL = miSQL & " AND tipforpa IN (2,3,5)"
        miSQL = miSQL & " GROUP BY tipforpa"
        miRsAux.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        
        While Not miRsAux.EOF
            NumRegElim = NumRegElim + 1
            
            'tmpsliped(codusu,numpedcl,numlinea,codalmac,codartic,nomartic,cantidad,importel)
            miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & ",0," & miRsAux!tipforpa & ",'D'," & DBSet(miRsAux!descformapago, "T") & ","
            'cantidad importel  -->  disponible  y NO dsiponible
            miSQL = miSQL & DBSet(miRsAux!Suma, "N") & ",0)"
            'resto campos obligados
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        AuxSQL = AuxSQL & miSQL
        
        'NO DISPONIBLE
        '------------------------------
        
        '  talon,paga y confirming sin la marca de reccedocu
        miSQL = "SELECT tipforpa,descformapago,sum(impvenci+if(gastos is null,0,gastos)-if(impcobro is null,0,impcobro)) suma FROM scobro,sforpa,stipoformapago WHERE "
        miSQL = miSQL & "scobro.codforpa=sforpa.codforpa AND tipforpa = tipoformapago  "
        miSQL = miSQL & " AND situacionjuri=0 AND Devuelto=0"
        miSQL = miSQL & " AND recedocu=0"
        miSQL = miSQL & " AND tipforpa IN (2,3,5)"
        miSQL = miSQL & " GROUP BY tipforpa"
        miRsAux.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        While Not miRsAux.EOF
            NumRegElim = NumRegElim + 1
            
            'tmpsliped(codusu,numpedcl,numlinea,codalmac,codartic,nomartic,cantidad,importel)
            miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & ",0," & miRsAux!tipforpa & ",'D'," & DBSet(miRsAux!descformapago, "T") & ","
            'cantidad importel  -->  disponible  y NO dsiponible
            miSQL = miSQL & "0," & DBSet(miRsAux!Suma, "N") & ")"
            'resto campos obligados
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        AuxSQL = AuxSQL & miSQL
        
        
        'TALONES pageres y confirming con la marca
        
        
        
        'no disponible:  TRANSFERENCIA
        miSQL = "SELECT tipforpa,descformapago,sum(impvenci+if(gastos is null,0,gastos)-if(impcobro is null,0,impcobro)) suma FROM scobro,sforpa,stipoformapago WHERE "
        miSQL = miSQL & "scobro.codforpa=sforpa.codforpa AND tipforpa = tipoformapago  "
        miSQL = miSQL & " AND situacionjuri=0 AND Devuelto=0"
        miSQL = miSQL & " AND tipforpa =1"
        miSQL = miSQL & " GROUP BY tipforpa"
        miRsAux.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        While Not miRsAux.EOF
            NumRegElim = NumRegElim + 1
            
            'tmpsliped(codusu,numpedcl,numlinea,codalmac,codartic,nomartic,cantidad,importel)
            miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & ",0," & miRsAux!tipforpa & ",'D'," & DBSet(miRsAux!descformapago, "T") & ","
            'cantidad importel  -->  disponible  y NO dsiponible
            miSQL = miSQL & "0," & DBSet(miRsAux!Suma, "N") & ")"
            'resto campos obligados
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        AuxSQL = AuxSQL & miSQL
      
        '----------------------------------------------------------------------------------------------------------------
        'Situacion juridica.
        miSQL = "SELECT sum(impvenci+if(gastos is null,0,gastos)-if(impcobro is null,0,impcobro)) suma FROM scobro,sforpa WHERE "
        miSQL = miSQL & "scobro.codforpa=sforpa.codforpa   "
        miSQL = miSQL & " AND  situacionjuri=1 "
        miRsAux.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        If Not miRsAux.EOF Then
            If Not IsNull(miRsAux.Fields(0)) Then
                NumRegElim = NumRegElim + 1
                'tmpsliped(codusu,numpedcl,numlinea,codalmac,codartic,nomartic,cantidad,importel)
                miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & ",0,101,'D','Situación jurídica',"
                'cantidad importel  -->  disponible  y NO dsiponible
                miSQL = miSQL & "0," & DBSet(miRsAux!Suma, "N") & ")"
                
            End If
        End If
        miRsAux.Close
        AuxSQL = AuxSQL & miSQL

    
        miSQL = "SELECT sum(impvenci+if(gastos is null,0,gastos)-if(impcobro is null,0,impcobro)) suma FROM scobro,sforpa WHERE "
        miSQL = miSQL & "scobro.codforpa=sforpa.codforpa   "
        miSQL = miSQL & " AND  situacionjuri=0 AND Devuelto=1"
        miRsAux.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        If Not miRsAux.EOF Then
            If Not IsNull(miRsAux.Fields(0)) Then
                NumRegElim = NumRegElim + 1
                'tmpsliped(codusu,numpedcl,numlinea,codalmac,codartic,nomartic,cantidad,importel)
                miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & ",0,100,'D','Devueltos',"
                'cantidad importel  -->  disponible  y NO dsiponible
                miSQL = miSQL & "0," & DBSet(miRsAux!Suma, "N") & ")"
            
            End If
        End If
        AuxSQL = AuxSQL & miSQL
        miRsAux.Close
    
    If AuxSQL <> "" Then
        miSQL = "INSERT INTO tmpsliped(codusu,numpedcl,numlinea,codalmac,codartic,nomartic,cantidad,importel) VALUES "
        AuxSQL = Mid(AuxSQL, 2)
        AuxSQL = miSQL & AuxSQL
        conn.Execute AuxSQL
        
        
        
        'Ahora reestrucutramos los datos, para ayudar en el report
        NumRegElim = 0
        miSQL = "select codalmac,nomartic,sum(cantidad) s1,sum(importel) s2 from tmpsliped WHERE codusu = " & vUsu.codigo & " group by 1,2 order by codalmac"
        miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        Impor = 0
        While Not miRsAux.EOF
            NumRegElim = NumRegElim + 1
            Impor = Impor + DBLet(miRsAux!s1, "N")
            If DBLet(miRsAux!s1, "N") <> 0 Or DBLet(miRsAux!s2, "N") <> 0 Then
                miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & ",0," & miRsAux!codAlmac & ",'D'," & DBSet(miRsAux!NomArtic, "T")
                'cantidad importel  -->  disponible  y NO dsiponible
                miSQL = miSQL & "," & DBSet(miRsAux!s1, "N") & "," & DBSet(miRsAux!s2, "N") & ")"
            End If
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        If miSQL <> "" Then
            conn.Execute "DELETE FROM tmpsliped WHERE codusu = " & vUsu.codigo
            Espera 1
            AuxSQL = "INSERT INTO tmpsliped(codusu,numpedcl,numlinea,codalmac,codartic,nomartic,cantidad,importel) VALUES "
            miSQL = Mid(miSQL, 2)
            AuxSQL = AuxSQL & miSQL
            conn.Execute AuxSQL
        End If
        
        
        'Metemos la entrada de DISPONIBLE
        If Impor <> 0 Then
            AuxSQL = "(" & vUsu.codigo & "," & Year(FInicio) & "," & Month(FInicio) & ",1"
            AuxSQL = AuxSQL & ",1," & DBSet(Impor, "N") & ",NULL,'Disponible tesoreria')"
            miSQL = "INSERT INTO tmpprevision(codusu,anyo,mes,quincena,tipo,cobro,pago,descripcion) VALUES " & AuxSQL
            conn.Execute miSQL
        End If
        
    End If
End Sub




Private Sub PrevisionFacturacion()
Dim i As Integer
Dim Aux As String
Dim Importe As Currency
Dim Impor2 As Currency 'importe + iVA

    Aux = DevuelveDesdeBD(conAri, "max(codigo1)", "tmpinformes", "codusu", CStr(vUsu.codigo))
    If Aux = "" Then Aux = "0"
    NumRegElim = Val(Aux)
    miSQL = "SELECT stippa.tipforpa,destippa,SUM(importel) suma FROM scaalb,slialb,sforpa,stippa WHERE scaalb.codtipom=slialb.codtipom AND"
    miSQL = miSQL & " scaalb.numalbar=slialb.numalbar "
    miSQL = miSQL & " AND scaalb.codtipom<>'ALZ' AND scaalb.codforpa=sforpa.codforpa AND stippa.tipforpa=sforpa.tipforpa "
    miSQL = miSQL & " GROUP BY 1 ORDER By 1"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    Aux = ""
    While Not miRsAux.EOF
        'Para cada fecha y forpa
        Label3(4).Caption = "Prevision facturación:  " & miRsAux!destippa
        Label3(4).Refresh
        NumRegElim = NumRegElim + 1
        'tmpinformes codusu,codigo1,campo1,campo2,  nombre1,importe1
        Aux = Aux & ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!tipforpa & ",0,"
        Aux = Aux & DBSet(miRsAux!destippa, "T") & ",0," & TransformaComasPuntos(CStr(miRsAux!Suma)) & ")"
        Importe = Importe + miRsAux!Suma


        
        
        
        
        'NOOOOOOOOOOOOOOOOOOOOOO
        'Para esa fecha y forma de pago
        'CalculaVtos miRsAux!FechaAlb, miRsAux!codforpa, miRsAux!Suma
    
        'Sig
        miRsAux.MoveNext
    Wend
    miRsAux.Close


    If Aux <> "" Then
    
        'el iva
        miSQL = DevuelveDesdeBDNew(conConta, "tiposiva", "porceiva", "codigiva", CStr(vParamAplic.TipoIVA1), "N")
        If miSQL = "" Then miSQL = "0"
        Impor2 = CCur(miSQL)
        Impor2 = Round((Importe * Impor2) / 100, 2)
        'Meto la linea del iva
        NumRegElim = NumRegElim + 1
        Aux = Aux & ", (" & vUsu.codigo & "," & NumRegElim & ",'IVA',1,"
        Aux = Aux & "1,0," & TransformaComasPuntos(CStr(Impor2)) & ")"
        
        
        'Le sumo el IVA al importe
        Importe = Importe + Impor2
    
        Aux = Mid(Aux, 2)
        miSQL = "INSERT INTO tmpinformes (codusu,codigo1,campo1,campo2,  nombre1,importe1,importe2) VALUES " & Aux
        conn.Execute miSQL
    End If



    'Lo metemos en el resumen de gastos
    If Importe <> 0 Then
        Aux = "INSERT INTO tmpprevision(codusu,anyo,mes,quincena,tipo,cobro,pago,descripcion) VALUES (" & vUsu.codigo & ","
        Aux = Aux & Year(FI) & "," & Month(FI) & ","
        If Day(FI) = 1 Then
            Aux = Aux & "1"
        Else
            Aux = Aux & "2"
        End If
        Aux = Aux & ",999," & DBSet(Importe, "N") & ",null,'PREVISION FACTURACION')"
        conn.Execute Aux
    End If




End Sub




'
'
'
'
'
'
'Private Sub CalculaVtos(Fecha As Date, Forpa As Integer, Importe As Currency)
'Dim SQL As String
'Dim rsVenci As adodb.Recordset
'Dim FecVenci As Date
'Dim ImpVenci As Currency
'Dim I As Integer
'    'Obtener el Nº de Vencimientos de la forma de pago
'    SQL = "SELECT numerove, primerve, restoven FROM sforpa WHERE codforpa=" & Forpa
'    Set rsVenci = New adodb.Recordset
'    rsVenci.Open SQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
'
'    'No puede ser eOF, NI 0
'
'          'Primer Vencimiento
'          '------------------------------------------------------------
'          I = 1
'          'FECHA VTO
'          FecVenci = Fecha
'          FecVenci = DateAdd("d", DBLet(rsVenci!primerve, "N"), FecVenci)
'
'
'          'IMPORTE del Vencimiento
'          If rsVenci!numerove = 1 Then
'                ImpVenci = Importe
'          Else
'                ImpVenci = Round(Importe / rsVenci!numerove, 2)
'                'Comprobar que la suma de los vencimientos cuadra con el total de la factura
'                If ImpVenci * rsVenci!numerove <> Importe Then
'                    ImpVenci = Round(ImpVenci + (Importe - ImpVenci * rsVenci!numerove), 2)
'                End If
'          End If
'
'
'
'
'
'
'          'Resto Vencimientos
'          '--------------------------------------------------------------------
'          For I = 2 To rsVenci!numerove
'             'FECHA Resto Vencimientos
'              '==== Modificado: Laura 23/01/2007
'              'FecVenci = FecVenci + DBSet(rsVenci!restoven, "N")
'              FecVenci = DateAdd("d", DBLet(rsVenci!restoven, "N"), FecVenci)
'
'
'
'              'IMPORTE Resto de Vendimientos
'              ImpVenci = Round(Importe / rsVenci!numerove, 2)
'
'
'          Next I
'
'
'    rsVenci.Close
'    Set rsVenci = Nothing
'
'End Sub


Private Sub CargaSobretmp2()
Dim Aux As String
Dim J As Integer
Dim i As Integer
Dim TieneDatos As Boolean


    'Fijare los valores de nombre tipo
    For i = 0 To 6
        Aux = DevuelveDesdeBD(conAri, "destippa", "stippa", "tipforpa", CStr(i))
        If Aux = "" Then Aux = "ERror"
        Aux = "UPDATE tmpprevision SET descripcion = " & DBSet(Aux, "T")
        Aux = Aux & " where codusu=" & vUsu.codigo & " AND tipo = " & i & "  AND descripcion="""""
        conn.Execute Aux
    Next



    'Gastos fijos, ees el primero
    Aux = "select * from tmpprevision where codusu=" & vUsu.codigo & " and cobro is null and tipo=999 order by anyo,mes,quincena"
    miRsAux.Open Aux, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    i = 0
    Aux = ""
    While Not miRsAux.EOF
        i = i + 1
        Aux = Aux & "," & DBSet(miRsAux!pago, "N", "N")
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    If i <> 6 Then Err.Raise 513, "Devuelve menios columnas GASTOS FIJOS"
        
    Aux = vUsu.codigo & ",-1,'GASTOS FIJOS'" & Aux & ")"
    
    Aux = "INSERT INTO tmpprevision2(codusu,tipo,descripcion,importe1,importe2,importe3,importe4,importe5,importe6) VALUES (" & Aux
    conn.Execute Aux
    
    
    
    
    'Ahora iremos por pagos de tesoreria
    For J = 1 To 7
        Aux = "select * from tmpprevision where codusu=" & vUsu.codigo & " and cobro is null and tipo=" & J & " order by anyo,mes,quincena"
        miRsAux.Open Aux, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        i = 0
        TieneDatos = False
        miSQL = ""
        Aux = ""
        While Not miRsAux.EOF
              i = i + 1
              Aux = Aux & "," & DBSet(miRsAux!pago, "N", "N")
              If DBLet(miRsAux!pago, "N") <> 0 Then TieneDatos = True
              If miSQL = "" Then
                If DBLet(miRsAux!Descripcion, "T") <> "" Then miSQL = miRsAux!Descripcion
              End If
              miRsAux.MoveNext
              
        Wend
        miRsAux.Close
        If TieneDatos Then
            If i <> 6 Then Err.Raise 513, "Devuelve menios columnas GASTOS FIJOS"
        
            If miSQL = "" Then miSQL = "TIPO no encontrado"
            Aux = vUsu.codigo & "," & J & "," & DBSet(miSQL, "T") & Aux & ")"
            Aux = "INSERT INTO tmpprevision2(codusu,tipo,descripcion,importe1,importe2,importe3,importe4,importe5,importe6) VALUES (" & Aux
            conn.Execute Aux
        End If
   Next J
        
        
        
        
   'haqcemos EL resumen
   FijaFechaIni
   miSQL = "INSERT INTO tmpslipreu(codusu,numofert,numlinea,codalmac,codartic,nomartic,precioar,importel) VALUES "
   Aux = "select sum(pago) from tmpprevision where codusu=" & vUsu.codigo & " and cobro is null and anyo=" & Year(FI)
   Aux = Aux & " AND  mes =" & Month(FI) & " and quincena= "
    If Day(FI) = 1 Then
        Aux = Aux & "1"
    Else
        Aux = Aux & "2"
    End If
   NumRegElim = 0
   miRsAux.Open Aux, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
   If Not miRsAux.EOF Then
        NumRegElim = NumRegElim + 1
        Aux = "(" & vUsu.codigo & ",1," & NumRegElim & ",1,'A','PAGOS'," & TransformaComasPuntos(DBLet(miRsAux.Fields(0), "N")) & ",0)"
        Aux = miSQL & Aux
        conn.Execute Aux
    End If
    miRsAux.Close
    
    '
    Aux = "select sum(cobro) from tmpprevision where codusu=" & vUsu.codigo
    Aux = Aux & " AND tipo<900 and pago is null"
    miRsAux.Open Aux, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then
        NumRegElim = NumRegElim + 1
        Aux = "(" & vUsu.codigo & ",1," & NumRegElim & ",1,'B','COBROS',0," & TransformaComasPuntos(DBLet(miRsAux.Fields(0), "N")) & ")"
        Aux = miSQL & Aux
        conn.Execute Aux
    End If
    miRsAux.Close
    
    
    
    
   Aux = "select cobro from tmpprevision where codusu=" & vUsu.codigo & " and pago is null "
   Aux = Aux & " AND tipo=999"
   miRsAux.Open Aux, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
   If Not miRsAux.EOF Then
        NumRegElim = NumRegElim + 1
        Aux = "(" & vUsu.codigo & ",1," & NumRegElim & ",1,'C','PREVISION',0," & TransformaComasPuntos(DBLet(miRsAux.Fields(0), "N")) & ")"
        Aux = miSQL & Aux
        conn.Execute Aux
    End If
    miRsAux.Close
    
    
   Aux = "select sum(cobro) from tmpprevision where codusu=" & vUsu.codigo
    Aux = Aux & " and pago is null AND tipo = 998"
    Aux = Aux & " AND anyo=" & Year(FI) & " AND  mes =" & Month(FI)   'no pongo la quincena

    miRsAux.Open Aux, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then
        NumRegElim = NumRegElim + 1
        Aux = "(" & vUsu.codigo & ",1," & NumRegElim & ",1,'D','BANCOS',0," & TransformaComasPuntos(DBLet(miRsAux.Fields(0), "N")) & ")"
        Aux = miSQL & Aux
        conn.Execute Aux
    End If
    miRsAux.Close
     
    
    
    
End Sub


Private Sub CargaSaldoBanco2()
Dim Aux As String
Dim i As Integer
Dim Impor As Currency
Dim ColCtasBa As Collection
Dim IT As ListItem
    'Gastos fijos, ees el primero
    Aux = "select ctabancaria.*,nommacta from ctabancaria,cuentas where ctabancaria.codmacta=cuentas.codmacta ORDER BY ctabancaria.codmacta"
    miRsAux.Open Aux, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
    Set ColCtasBa = New Collection
    While Not miRsAux.EOF
        Aux = DBLet(miRsAux!Descripcion, "T")
        If Aux = "" Then Aux = miRsAux!Nommacta
        ColCtasBa.Add CStr(miRsAux!Codmacta) & "|" & Aux & "|"
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    FijaFechaIni
    For i = 1 To ColCtasBa.Count
        'impmesde impmesha anopsald mespsald
        Aux = "Select sum(impmesde),sum(impmesha) from hsaldos where codmacta = '" & RecuperaValor(ColCtasBa.item(i), 1) & "' AND "
        'El perido
        If Month(vEmpresa.FechaIni) = 1 Then
            'Años normales
            Aux = Aux & " anopsald >= " & Year(vEmpresa.FechaIni)
        Else
            Aux = Aux & " anopsald > " & Year(vEmpresa.FechaIni) & " OR (anopsald = " & Year(vEmpresa.FechaIni) & " AND mespsald>= " & Month(vEmpresa.FechaIni) & ")"
        End If
        miRsAux.Open Aux, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        Impor = 0
        
        If Not miRsAux.EOF Then
            Impor = DBLet(miRsAux.Fields(0), "N")
            Impor = Impor - DBLet(miRsAux.Fields(1), "N")
            
        End If
        miRsAux.Close
        
        If Impor <> 0 Then
        '    Aux = "INSERT INTO tmpprevision(codusu,anyo,mes,quincena,tipo,cobro,pago,descripcion) VALUES (" & vUsu.codigo & ","
        '    Aux = Aux & Year(FI) & "," & Month(FI) & ","
        '    'El orden va en la quincena
        '    Aux = Aux & I
        '    Aux = Aux & ",998," & DBSet(Impor, "N") & ",null," & DBSet(RecuperaValor(ColCtasBa.item(I), 2), "T") & ")"
        '    conn.Execute Aux
        
            Set IT = Me.ListView1(3).ListItems.Add()
            IT.Text = RecuperaValor(ColCtasBa.item(i), 1)
            IT.SubItems(1) = RecuperaValor(ColCtasBa.item(i), 2)
            IT.SubItems(2) = Format(Impor, FormatoImporte)
            
        
        End If
        
    Next
    
        
End Sub



Private Sub PasaVariablesReport()
Dim i As Integer

    miSQL = "|pEmpresa=""" & vEmpresa.nomempre & """|"
    NumRegElim = 1
    
    
    FijaFechaIni
    miSQL = miSQL & "pdh=""" & Format(FI, "mmmm") & " " & Year(FI) & "      "
    If Day(FI) = 1 Then
        miSQL = miSQL & "1"
    Else
        miSQL = miSQL & "2"
    End If
    miSQL = miSQL & "ª quincena""|"
    
    
    
    i = 1
    Do
         
        miSQL = miSQL & "L" & i & "=""" & MonthName(Month(FI), True) & " ("
        If Day(FI) = 1 Then
            miSQL = miSQL & "1"
        Else
            miSQL = miSQL & "2"
        End If
        miSQL = miSQL & "ª Quin.)""|"
        i = i + 1
        SumarQuincena
    Loop Until i = 7
    NumRegElim = NumRegElim + 6
    
    
End Sub





Private Sub CargaTreePortes()
Dim Cli As Long
Dim N As Node
    tv1.Nodes.Clear
    miSQL = "Select * from tmpsliped WHERE codusu = " & vUsu.codigo & " ORDER BY codclien,numpedcl"
    
    Set miRsAux = New ADODB.Recordset
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    Cli = -1
    While Not miRsAux.EOF
        If Cli <> miRsAux!codClien Then
            Cli = miRsAux!codClien
            Set N = tv1.Nodes.Add(, , CStr("N" & Cli))
            N.Text = Format(Cli, "00000") & "  " & miRsAux!NomArtic
        End If
        
        
        'metemos el albaran
        Set N = tv1.Nodes.Add(CStr("N" & Cli), tvwChild)
        N.Text = miRsAux!codArtic & Format(miRsAux!numpedcl, "00000") & " Lin: " & miRsAux!numlinea
        
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Set miRsAux = Nothing
End Sub

Private Sub txtArticulo_GotFocus(Index As Integer)
    ConseguirFoco txtArticulo(Index), 3
End Sub

Private Sub txtArticulo_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
    
End Sub


Private Sub txtArticulo_LostFocus(Index As Integer)
Dim T As String
    
    txtArticulo(Index).Text = Trim(txtArticulo(Index).Text)
    If txtArticulo(Index).Text = "" Then
        'EN blanco
        txtDescArticulo(Index).Text = ""
        Exit Sub
    End If
    
    
    T = "codartic"
    codigo = DevuelveDesdeBD(conAri, "nomartic", "sartic", "codartic", txtArticulo(Index).Text, "T", T)
    If codigo = "" Then
        MsgBox "No existe el artículo : " & txtArticulo(Index).Text, vbExclamation
        If Index = 0 Or Index = 5 Then
            txtArticulo(Index).Text = ""
            PonerFoco txtArticulo(Index)
        End If
    Else
    
        txtArticulo(Index).Text = T
    End If
    Me.txtDescArticulo(Index).Text = codigo
    codigo = ""
    If Index = 0 Then cargarUltimoIventario
    If Index = 5 Then CargaPrecioCompraProve
    If Index = 6 Then CargaPrecioCosteArticulo
End Sub


Private Sub cargarUltimoIventario()
    On Error GoTo EcargarUltimoIventario
    Set miRsAux = New ADODB.Recordset
    
    'Cargara ultimo inventario, si estamos rectificando o canstock (y otros datos) si estamos inventariando
    'Admeas si lleva fitosanitarios y lo indicaremos
    
    
    Text2.Text = ""
    If Me.txtAlma(0).Text <> "" And txtArticulo(0).Text <> "" Then
        'OK
        If Opcion = 3 Then
            'RECTIFICAR INVENTARIO
            miSQL = "Select * from salmac where codartic=" & DBSet(txtArticulo(0).Text, "T")
            miSQL = miSQL & " AND codalmac= " & txtAlma(0).Text
            miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
            miSQL = ""
            If miRsAux.EOF Then
                miSQL = "NO existe entrada de almacen"
            Else
                'OK
                'VEamos el iventario
                'select * from salmac stockinv fechainv horainve statusin
                If IsNull(miRsAux!FechaINV) Then
                    miSQL = "   *** No tiene ultimo inventario. "
                Else
                    miSQL = "Fecha: " & Format(miRsAux!FechaINV, "dd/mm/yyyy") & "   " & Format(miRsAux!horainve, "hh:mm")
                    miSQL = miSQL & vbCrLf & "Cantidad inventariada: " & Format(miRsAux!Stockinv, FormatoCantidad)
                    'miSQL = miSQL & vbCrLf & "Estado art: " & Format(miRsAux!CA, FormatoCantidad)
                End If
            End If
            miRsAux.Close
        
        
        Else
            miSQL = "Select salmac.codartic,nomartic,canstock,numserie,fecvigen,FechaINV,horainve,Stockinv from salmac,sartic where salmac.codartic=sartic.codartic and salmac.codartic =" & DBSet(txtArticulo(0).Text, "T")
            miSQL = miSQL & " AND codalmac= " & txtAlma(0).Text
            miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
            miSQL = ""
            If miRsAux.EOF Then
                miSQL = "NO existe entrada de almacen"
                
            Else
                 'OK
                miSQL = ""
                If vParamAplic.ManipuladorFitosanitarios2 Then
                    If DBLet(miRsAux!numSerie, "T") <> "" Then miSQL = "O"
                End If
                If miSQL = "" Then
                    'No es fitosantirio
                    If Not IsNull(miRsAux!FechaINV) Then
                        miSQL = "Inventario anterior: " & Format(miRsAux!FechaINV, "dd/mm/yyyy") & "   " & Format(miRsAux!horainve, "hh:mm")
                        miSQL = miSQL & vbCrLf & "Cantidad inventariada: " & Format(miRsAux!Stockinv, FormatoCantidad)
                    End If
                Else
                    miSQL = "      **** PRODUCTO FITOSANITARIO *****  "
                    
                End If
                miSQL = "Stock actual: " & miRsAux!CanStock & vbCrLf & vbCrLf & miSQL
                
                
            End If
            miRsAux.Close
        End If
        Text2.Text = miSQL
    
    
    
    End If
EcargarUltimoIventario:
    If Err.Number <> 0 Then
        MuestraError Err.Number
        Text2.Text = "NO se han obtenido datos inventario"
    End If
    Set miRsAux = Nothing
End Sub



Private Sub txtcantidad_GotFocus(Index As Integer)
    ConseguirFoco txtcantidad(Index), 3
End Sub

Private Sub txtcantidad_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub




Private Sub txtcantidad_LostFocus(Index As Integer)
    If Not PonerFormatoDecimal(txtcantidad(Index), 3) Then txtcantidad(Index).Text = ""
End Sub



Private Function HacerActualizacion() As Boolean
Dim cantidad As Currency
Dim Fecha_ As Date
Dim CtoEnDFI As Currency
Dim ImporteUd As Currency
Dim CuantoHabia As Currency
Dim FechaInventario As Date
Dim B As Boolean


    On Error GoTo EHacerActualizacion
    HacerActualizacion = False
    miSQL = "Select * from salmac where codartic=" & DBSet(txtArticulo(0).Text, "T")
    miSQL = miSQL & " AND codalmac= " & txtAlma(0).Text
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    'NO PUEDE SER EOF
    '1.- Bajamos a shinven
    '           salmac stockinv fechainv horainve
    
    'Marzo 2011
    'Puede ser que no existiera el inven tario.
    FechaInventario = "01/01/1900"
    
    If miRsAux.EOF Then
        miSQL = vbCrLf & "Articulo: " & txtArticulo(0).Text & " " & txtDescArticulo(0).Text & vbCrLf
        miSQL = miSQL & "Almacen: " & txtAlma(0).Text & " " & Me.txtDescAlma(0).Text
        Err.Raise 513, , "No existe el articulo en el almacen" & miSQL
    End If
    
    If Not IsNull(miRsAux!FechaINV) Then
        FechaInventario = miRsAux!FechaINV
        miSQL = "INSERT INTO shinve(codartic,codalmac,fechainv,horainve,existenc) VALUES ("
        miSQL = miSQL & DBSet(miRsAux!codArtic, "T") & "," & miRsAux!codAlmac & ","
        miSQL = miSQL & DBSet(miRsAux!FechaINV, "F") & "," & DBSet(Now, "FH") & ","
        miSQL = miSQL & DBSet(miRsAux!Stockinv, "N") & ")"
        conn.Execute miSQL
    End If
    
    
    If Opcion = 3 Then
        'RECTIFICAR INVENTARIO
        If Not IsNull(miRsAux!FechaINV) Then
            Fecha_ = miRsAux!FechaINV
            'Cojo la de inventario
            CuantoHabia = DBLet(miRsAux!Stockinv, "N")
        Else
            Fecha_ = Now
            'Cojo la de movimientos
            CuantoHabia = DBLet(miRsAux!CanStock, "N")
        End If
    Else
        Fecha_ = Now
        'Cojo la de movimientos
        CuantoHabia = DBLet(miRsAux!CanStock, "N")
    End If
    cantidad = ImporteFormateado(txtcantidad(0).Text)
    cantidad = cantidad - CuantoHabia  'nueva menos lo que habia
    
    '2.- updatear salmac con la nueva cantidad Cantidad
    miSQL = "UPDATE salmac set stockinv = " & DBSet(txtcantidad(0).Text, "N")
    miSQL = miSQL & " , canstock = "
    
    If Opcion = 3 Then
        B = FechaInventario = "01/01/1900"
    Else
        B = True
    End If
    
    If B Then   'NO existia inventario , o es nuevo
        'Lo que quiero es poner ahora esa cantidad
        'luego NO se la sumo  a la que habia
        miSQL = miSQL & DBSet(txtcantidad(0).Text, "N")
        'Dire que he inventariado ahora
        miSQL = miSQL & " , fechainv = " & DBSet(Fecha_, "F")
        miSQL = miSQL & " , horainve = " & DBSet(Fecha_, "FH")
    Else
        miSQL = miSQL & " canstock "
        If cantidad >= 0 Then miSQL = miSQL & " + "
        miSQL = miSQL & DBSet(cantidad, "N")
        
    End If
  
    
    miSQL = miSQL & " WHERE codartic = " & DBSet(miRsAux!codArtic, "T") & " AND codalmac = " & miRsAux!codAlmac
    conn.Execute miSQL
    miRsAux.Close
    
    'Smoval
    'Buscamos en smoval
    miSQL = "Select * from smoval where codartic=" & DBSet(txtArticulo(0).Text, "T")
    miSQL = miSQL & " AND codalmac= " & txtAlma(0).Text & " AND detamovi = 'DFI' and fechamov = " & DBSet(Fecha_, "F")
    
    
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If miRsAux.EOF Then
        'NO existe entrada
        If cantidad <> 0 Then
        
            CadenaDesdeOtroForm = PonerTrabajadorConectado(miSQL)
            If CadenaDesdeOtroForm = "" Then CadenaDesdeOtroForm = "0"
            'ImporteUd pongo el precioste
            miSQL = DevuelveDesdeBD(conAri, "preciouc", "sartic", "codartic", txtArticulo(0).Text, "T")
            If miSQL = "" Then miSQL = "0"
            ImporteUd = CCur(miSQL)
            ImporteUd = ImporteUd * Abs(cantidad)
            miSQL = "INSERT INTO smoval(codartic,codalmac,fechamov,horamovi,tipomovi,detamovi,cantidad,impormov,codigope,letraser,document,numlinea) VALUES ("
            miSQL = miSQL & DBSet(txtArticulo(0).Text, "T") & "," & txtAlma(0).Text & "," & DBSet(Fecha_, "F") & "," & DBSet(Now, "FH") & ","
            
            If Opcion = 3 Then
                B = cantidad < 0
            Else
                B = cantidad < 0
            End If

            '0-Salida, 1-Entrada
            If B Then
                miSQL = miSQL & "0"
            Else
                miSQL = miSQL & "1"
            End If
            
            miSQL = miSQL & ",'DFI'," & DBSet(Abs(cantidad), "N") & "," & DBSet(ImporteUd, "N") & ","
            
            miSQL = miSQL & CadenaDesdeOtroForm & ",'','" & IIf(Opcion = 3, "RECT", "INV") & "',1)"
            
            
            
          
            
            
            conn.Execute miSQL
            
        End If
    Else
        'Si que existe
        '1-Entrada, 0-Salida
        CtoEnDFI = miRsAux!cantidad
        'Si es salida vamos a ponerlo como entrada
        If miRsAux!tipomovi = 0 Then CtoEnDFI = -CtoEnDFI
        'importe unitario
        ImporteUd = 0
        If CtoEnDFI <> 0 Then ImporteUd = Abs(miRsAux!impormov / CtoEnDFI)
        
        
        CtoEnDFI = CuantoHabia - CtoEnDFI   'Como hemos puesto que sea ENtrada(cambiando signo si es salida)
        cantidad = ImporteFormateado(txtcantidad(0).Text) 'cuanto hay segun lo que han puesto
        cantidad = cantidad - CtoEnDFI
        
        
        miSQL = "UPDATE smoval set cantidad = " & DBSet(Abs(cantidad), "N")
        ImporteUd = ImporteUd * Abs(cantidad)
        miSQL = miSQL & ", impormov = " & DBSet(Abs(ImporteUd), "N") & " , tipomovi = "
        If cantidad >= 0 Then
            miSQL = miSQL & "1"
        Else
             miSQL = miSQL & "0"
        End If
        miSQL = miSQL & " where codartic=" & DBSet(txtArticulo(0).Text, "T")
        miSQL = miSQL & " AND codalmac= " & txtAlma(0).Text & " AND detamovi = 'DFI' and fechamov = " & DBSet(Fecha_, "F")
        conn.Execute miSQL
        
    End If
    
    
    
    
    
    HacerActualizacion = True
    Exit Function
EHacerActualizacion:
    MuestraError Err.Number, , Err.Description

End Function

Private Sub txtCodProve_GotFocus(Index As Integer)
    ConseguirFoco txtCodProve(Index), 3
End Sub

Private Sub txtCodProve_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtCodProve_LostFocus(Index As Integer)
    txtCodProve(Index).Text = Trim(txtCodProve(Index).Text)
    codigo = ""
    miSQL = ""
    If txtCodProve(Index).Text <> "" Then
        If IsNumeric(txtCodProve(Index).Text) Then
            codigo = DevuelveDesdeBD(conAri, "nomprove", "sprove", "codprove", txtCodProve(Index).Text, "N")
            If codigo = "" Then
                If Index < 0 Then   'dE MOMENTO NO ES REQUERIDO PARA NINGUNO
                    'Codprove REQUERIDO
                    miSQL = "No existe proveedor"
                Else
                    MsgBox "El codigo no pertence a ningun proveedor", vbExclamation
                End If
            End If
        Else
            miSQL = "Campo numerico"
        End If
    End If
    Me.txtDescProve(Index).Text = codigo
    If miSQL <> "" Then
        MsgBox miSQL, vbExclamation
        txtCodProve(Index).Text = ""
        PonerFoco txtCodProve(Index)
    End If
    
    If Index = 8 Then CargaPrecioCompraProve
    If Index = 13 Then CargarFamiliasProveedor
    If Index = 29 Then HacerSimulacionPedidoProveedor
End Sub



Private Function GeneraStockMeses() As Boolean
Dim RT As ADODB.Recordset
Dim cantidad As Currency
Dim CantidadDeSalida As Currency
Dim C11 As Currency
Dim F As Date
Dim V(11) As Currency
Dim J As Integer
Dim B As Boolean
Dim T1 As Single
Dim Rap1 As Currency
Dim Rap2 As Currency
Dim impRap As Currency
Dim Fini1 As Date

Dim AlgunValor As Boolean
Dim ValorasConPrecioFichaArticulo As Boolean
Dim EncuentraARPMP As Boolean


    On Error GoTo EGeneraStockMeses
    GeneraStockMeses = False
    
    'Borramos tmps
    Label3(6).Caption = "Preparando datos"
    Label3(6).Refresh
    miSQL = "DELETE FROM tmpinformes WHERE codusu = " & vUsu.codigo
    conn.Execute miSQL

    miSQL = "DELETE FROM tmpstockfec WHERE codusu = " & vUsu.codigo
    conn.Execute miSQL

  

    Fini1 = "01/01/" & txtAnyo(1).Text
    
    
    'Desde salmac con el cadwhere correspondiente vamos andando
    miSQL = "Select sartic.codprove,salmac.codartic,codalmac,canstock,preciouc,preciomp,preciost,nomprove,nomartic,codfamia"
    miSQL = miSQL & " from salmac,sartic,sprove where salmac.codartic=sartic.codartic AND ctrstock=1"
    miSQL = miSQL & " AND sartic.codprove = sprove.codprove"
    'Si hay where
    miSQL = miSQL & " AND codalmac =  " & txtAlma(1).Text
    If Me.txtCodProve(0).Text <> "" Then miSQL = miSQL & " AND sartic.codprove >= " & Me.txtCodProve(0).Text
    If Me.txtCodProve(1).Text <> "" Then miSQL = miSQL & " AND sartic.codprove <= " & Me.txtCodProve(1).Text

    If Me.chkVarios(4).Value = 0 Then miSQL = miSQL & " AND artvario =  0" 'no quiere los varios
    ValorasConPrecioFichaArticulo = Me.chkVarios(5).Value = 1

    miSQL = miSQL & " ORDER BY codprove,codartic"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    Set RT = New ADODB.Recordset
    NumRegElim = 0
    T1 = Timer
    While Not miRsAux.EOF
        
        
        
        
        Label3(6).Caption = miRsAux!Codprove & " / " & miRsAux!codArtic
        Label3(6).Refresh
        
        For J = 0 To 11
            V(J) = 0
        Next
        

        'Enero 2012
        'Todo nuevo.
        'Tumbado. Todo fuera
        'Partimos de canstock actual
        'If miRsAux!codArtic = "010003" Then
  
    
    
        miSQL = "select year(fechamov) anyo ,month(fechamov) mes,sum(if(tipomovi=1,cantidad,-cantidad)) from smoval where codalmac =  "
        miSQL = miSQL & txtAlma(1).Text
        'En stock a una fecha NO esta
        'miSQL = miSQL & " AND detamovi <> 'DFI' "
        
        miSQL = miSQL & " AND codartic = " & DBSet(miRsAux!codArtic, "T")
        miSQL = miSQL & " AND fechamov>=" & DBSet(Fini1, "F")
        CantidadDeSalida = miRsAux!CanStock
        miSQL = miSQL & " GROUP BY 1,2 ORDER BY 1 desc, 2 desc"
        RT.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        
        'Veamos como empiezan
        AlgunValor = CantidadDeSalida <> 0  '
        'If AlgunValor Then
        B = False
        Do
            If RT.EOF Then
                B = True
            Else
                If Val(txtAnyo(1).Text) = RT.Fields(0) Then
                    'OK ya ha llegado a los años que necesitamos
                    B = True
                Else
                    AlgunValor = True
                    CantidadDeSalida = CantidadDeSalida - RT.Fields(2)  '<0 = venta y como va desc se suma a lo que habia el mes antes
                    RT.MoveNext
                End If
            End If
        Loop Until B
        
        For J = 12 To 1 Step -1
             '   Debug.Print J & " " & CantidadDeSalida
                V(J - 1) = CantidadDeSalida  'a final del mes hay ....
                If Not RT.EOF Then
                    
                    If J = RT!mes Then
                        AlgunValor = True
                        CantidadDeSalida = CantidadDeSalida - DBLet(RT.Fields(2), "N")
                        RT.MoveNext
                    End If
                End If
                
        Next
        RT.Close
            
            
        If AlgunValor Then
            'Si tienen alguna valor.... o de stock o de movimiento
                If Me.chkVarios(3).Value = 1 Then  'regulariza los stocks negativos a cero
                    miSQL = ""
                    For J = 0 To 11
                        If V(J) < 0 Then
                            miSQL = miSQL & ", (" & vUsu.codigo & "," & DBSet(miRsAux!codArtic, "T") & "," & J + 1 & "," & TransformaComasPuntos(CStr(V(J))) & ")"
                            V(J) = 0
                        End If
                    Next
                    If miSQL <> "" Then
                        miSQL = Mid(miSQL, 2)
                        miSQL = "insert into `tmpstockfec` (`codusu`,`codartic`,`codalmac`,`stock`) VALUES " & miSQL
                        conn.Execute miSQL
                    End If
                End If
                
                
                'Los rappels
                Rap1 = 0: Rap2 = 0
                miSQL = "Select rap1,rap2 from sdtomp where codprove=" & miRsAux!Codprove & " AND codfamia =" & miRsAux!Codfamia
                RT.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
                If Not RT.EOF Then
                    Rap1 = DBLet(RT!Rap1, "N")
                    Rap2 = DBLet(RT!Rap2, "N")
                End If
                RT.Close
                
                'Los precios
                If Not ValorasConPrecioFichaArticulo Then
                    
                    miSQL = "Select mespreci,preciouc,preciomp,preciost from sarpmp where codartic = " & DBSet(miRsAux!codArtic, "T") & " AND anopreci = " & txtAnyo(1).Text
                    RT.Open miSQL, conn, adOpenKeyset, adLockPessimistic, adCmdText
                
                End If
                    
                codigo = "" 'el insert into tmp
                miSQL = "" 'por si tengo que insertar en sarmp
                For J = 0 To 11
                    If V(J) <> 0 Then
                        'para este mes HAY movimientos
                        If Not ValorasConPrecioFichaArticulo Then RT.Find "mespreci = " & J + 1, , adSearchForward, 1
                        
                        
                        'TRUCO. COMO proveedores puede ser mayor que 10000 y en campo uno SOLO me cabe 32000
                        'Si codprove<10000 campo1 =0
                        'si no campo1=codprove \ 10000
                        'tmpinformes(codusu,codigo1,campo1 campo2,nombre1,nombre2,nombre3,importe1,importeb1,importeb2,importeb3,fecha1)
                        F = CDate("01/" & Format(J + 1, "00") & "/" & txtAnyo(1).Text)
                        
                        B = F <= Now
                        'Es mayor
                        If Not B Then
                            If Year(F) = Year(Now) And Month(F) = Month(Now) Then B = True
                        End If
                        If B Then
                            NumRegElim = NumRegElim + 1
                            codigo = codigo & ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!Codprove \ 10000 & ","
                            codigo = codigo & miRsAux!Codprove Mod 10000 & "," & DBSet(miRsAux!nomprove, "T") & ","
                            codigo = codigo & DBSet(miRsAux!codArtic, "T") & "," & DBSet(miRsAux!NomArtic, "T") & "," & DBSet(V(J), "N")
                            
                            EncuentraARPMP = False
                            If Not ValorasConPrecioFichaArticulo Then EncuentraARPMP = Not RT.EOF
                            If Not EncuentraARPMP Then
                                miSQL = miSQL & ", (" & DBSet(miRsAux!codArtic, "T") & "," & txtAnyo(1).Text & "," & J + 1 & "," & DBSet(DBLet(miRsAux!precioUC, "N"), "N")
                                miSQL = miSQL & "," & DBSet(DBLet(miRsAux!PrecioMP, "N"), "N") & "," & DBSet(DBLet(miRsAux!preciost, "N"), "N") & ")"
                                
                                'Cantidad * preciuc
                                cantidad = V(J) * DBLet(miRsAux!precioUC, "N")
                                codigo = codigo & "," & DBSet(cantidad, "N")
                                'Cantidad * preciomp
                                cantidad = V(J) * DBLet(miRsAux!PrecioMP, "N")
                                codigo = codigo & "," & DBSet(cantidad, "N")
                                'Canitdad * preciost
                                cantidad = V(J) * DBLet(miRsAux!preciost, "N")
                                codigo = codigo & "," & DBSet(cantidad, "N")
                                
                                impRap = DBLet(miRsAux!preciost, "N")
                            Else
                                cantidad = V(J) * RT!precioUC
                                codigo = codigo & "," & DBSet(cantidad, "N")
                                'Cantidad * preciomp
                                cantidad = V(J) * RT!PrecioMP
                                codigo = codigo & "," & DBSet(cantidad, "N")
                                'Canitdad * preciost
                                cantidad = V(J) * RT!preciost
                                codigo = codigo & "," & DBSet(cantidad, "N")
                            
                                impRap = DBLet(RT!preciost, "N")
                                
                            End If
                            
                            'Septiembre 2011
                            'Precio st - rappels
                            If Rap1 <> 0 Or Rap2 <> 0 Then
                                If impRap <> 0 Then
                                    impRap = Round(impRap * (1 - (Rap1 / 100)), 4)
                                    impRap = Round(impRap * (1 - (Rap2 / 100)), 4)
                                End If
                            End If
                            cantidad = V(J) * impRap
                            codigo = codigo & "," & DBSet(cantidad, "N")
                            impRap = 0
                            
                            
                            codigo = codigo & ",'" & txtAnyo(1).Text & "-" & Format(J + 1, "00") & "-01')"
                            
                        End If 'de que la fecha sea menor o igual que hoy
                        
                        
                    End If
                Next
                If Not ValorasConPrecioFichaArticulo Then RT.Close
                'Los datos
                If codigo <> "" Then
                    codigo = Mid(codigo, 2)
                    codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo1 ,campo2,nombre1,nombre2,nombre3,importe1,importeb1,importeb2,importeb3,importeb4,fecha1) VALUES " & codigo
                    conn.Execute codigo
                End If
                If miSQL <> "" Then
                    If Not ValorasConPrecioFichaArticulo Then
                
                        miSQL = Mid(miSQL, 2)
                        miSQL = "INSERT INTO sarpmp(codartic,anopreci,mespreci,preciouc,preciomp,preciost) VALUES " & miSQL
                        conn.Execute miSQL
                    End If
                End If
                
        Else
            'No tienen ningun valor de stock en ningun mes
            '
        End If


        If Timer - T1 > 10 Then
            DoEvents
            Me.Refresh
            T1 = Timer
        End If
        
        'Sigueinte articulo
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    
    
  
    
    
    
    
    If NumRegElim > 0 Then
        If Me.txtDecimal(2).Text <> "" Then
            Label3(6).Caption = "Ajuste importe mínimo"
            Label3(6).Refresh
            codigo = TransformaComasPuntos(ImporteFormateado(txtDecimal(2).Text))
            miSQL = "select month(fecha1),(campo1*10000 + campo2) as provee,sum(importeb3)as im from tmpinformes  where codusu = " & vUsu.codigo & "  group by 1,2 "
            miSQL = miSQL & " Having Im < " & codigo
            miSQL = miSQL & " order by 2,1"
            
            miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
            While Not miRsAux.EOF
                    NumRegElim = miRsAux!provee
                    F = "01/" & miRsAux.Fields(0) & "/" & txtAnyo(1).Text
                    Label3(6).Caption = "Del. " & NumRegElim & " " & F
                    Label3(6).Refresh
                    
                    
                    miSQL = "DELETE FROM tmpinformes WHERE codusu = " & vUsu.codigo & " AND fecha1=" & DBSet(F, "F") & " AND campo1 = "
                    J = NumRegElim Mod 10000
                    miSQL = miSQL & CStr(NumRegElim \ 10000) & " and campo2 =  " & J
                    conn.Execute miSQL
                    miRsAux.MoveNext
            Wend
            miRsAux.Close
            conn.Execute miSQL
            Espera 0.5
            miSQL = "Select count(*) from tmpinformes where codusu = " & vUsu.codigo
            miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
            NumRegElim = 0
            If Not miRsAux.EOF Then NumRegElim = DBLet(miRsAux.Fields(0), "N")
            miRsAux.Close
            
        End If
    End If
    
    If NumRegElim = 0 Then
        MsgBox "No se ha generado ningun datos", vbExclamation
    Else
    
        GeneraStockMeses = True
        
        
        If Me.chkVarios(3).Value = 1 Then
            'Regulariza stocks negativos
            miSQL = DevuelveDesdeBD(conAri, "count(*)", "tmpstockfec", "codusu", vUsu.codigo)
            If miSQL = "" Then miSQL = "0"
            If Val(miSQL) > 0 Then
                'Mostraremos los articulos regularizados
                'Se pone aqui pq en frmvarios utilo numregelim
                Screen.MousePointer = vbHourglass
                frmVarios.Opcion = 10
                frmVarios.Show vbModal
                Me.Refresh
                Espera 0.2
            End If
        End If
    End If
EGeneraStockMeses:
    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description
    Set RT = Nothing
    Set miRsAux = Nothing
End Function

'--------------------------------------------------------------------
'--------------------------------------------------------------------
'--------------------------------------------------------------------
'--------------------------------------------------------------------
'
'   Para la impresion
'
'--------------------------------------------------------------------
'--------------------------------------------------------------------
'--------------------------------------------------------------------
'--------------------------------------------------------------------
Private Sub InicializarVbles(AñadireElDeEmpresa As Boolean)
    cadFormula = ""
    cadSelect = ""
    CadParam = "|"
    numParam = 0
    cadTitulo = ""
    cadNomRPT = ""
    conSubRPT = False
    cadPDFrpt = ""
    
    vMostrarTree = False
    
    If AñadireElDeEmpresa Then
        CadParam = CadParam & "pEmpresa=""" & vEmpresa.nomempre & """|"
        numParam = numParam + 1
    End If
    
End Sub

Private Sub LlamarImprimir()
    With frmImprimir
        .FormulaSeleccion = cadFormula
        .OtrosParametros = CadParam
        .NumeroParametros = numParam

        .SoloImprimir = False
        .EnvioEMail = False
        .Titulo = cadTitulo
        .Opcion = 3000   'VAN TODOS EN ESTE SACO
        .NombrePDF = ""
        .NombrePDF = cadPDFrpt
        .NombreRPT = cadNomRPT
        .ConSubInforme = conSubRPT
        .MostrarTreeDesdeFuera = vMostrarTree
        .Show vbModal
    End With
End Sub



Private Function PonerDesdeHasta(campo As String, Tipo As String, indD As Byte, indH As Byte, param As String) As Boolean
Dim devuelve As String
Dim Cad As String
Dim Subtipo As String 'F: fecha   N: numero   T: texto  H: HORA
Dim TDes As TextBox
Dim THas As TextBox
Dim DesD As TextBox 'Descripcion DESDE
Dim DesH As TextBox '    "       HASTA

    PonerDesdeHasta = False
    
    Select Case Tipo
    Case "F"
        'Campos fecha
        Set TDes = txtFecha(indD)
        Set THas = txtFecha(indH)
        Subtipo = "F"
        'If indD = 27 Or indH = 28 Then Subtipo = "FH"
    Case "CLI"
        'Cliente
        Set TDes = txtCliente(indD)
        Set THas = txtCliente(indH)
        Set DesD = txtDescClie(indD)
        Set DesH = txtDescClie(indH)
        Subtipo = "N"
    Case "DPT"
        'DEpartamento
'        Set TDes = txtDpto(indD)
'        Set THas = txtDpto(indH)
'        Set DesD = txtDescDpto(indD)
'        Set DesH = txtDescDpto(indH)
        Subtipo = "N"
        
    Case "PRO"
        Set TDes = txtCodProve(indD)
        Set THas = txtCodProve(indH)
        Set DesD = txtDescProve(indD)
        Set DesH = txtDescProve(indH)
        Subtipo = "N"
 
    Case "ART"

        Set TDes = txtArticulo(indD)
        Set THas = txtArticulo(indH)
        Set DesD = txtDescArticulo(indD)
        Set DesH = txtDescArticulo(indH)
        Subtipo = "T"
    Case "AGT"
        Set TDes = txtAgente(indD)
        Set THas = txtAgente(indH)
        Set DesD = txtDescAgente(indD)
        Set DesH = txtDescAgente(indH)
        Subtipo = "N"
      
    Case "ALP"
        'Numero albaran proveedores
         
'        Set TDes = txtNumAlbar(indD)
'        Set THas = txtNumAlbar(indH)
        Subtipo = "T"
 
    Case "TRA"
        'TRABAJADOR
         
        Set TDes = txtCodTraba(indD)
        Set THas = txtCodTraba(indH)
        Subtipo = "N"
  
        Set DesD = txtDescTraba(indD)
        Set DesH = txtDescTraba(indH)

        
        
    Case "ZON"
        'ZONA
         
'        Set TDes = Me.txtZona(indD)
'        Set THas = txtZona(indH)
'        Subtipo = "N"
'        Set DesD = txtDescZona(indD)
'        Set DesH = txtDescZona(indH)
    
        
    Case "FAM"
        'FAMILIA
         
        Set TDes = Me.txtFamia(indD)
        Set THas = txtFamia(indH)
        Subtipo = "N"
        Set DesD = txtDescFamia(indD)
        Set DesH = txtDescFamia(indH)
    
        
    Case "MAR"
    
        Set TDes = Me.txtmarca(indD)
        Set THas = txtmarca(indH)
        Subtipo = "N"
        Set DesD = txtDescmarca(indD)
        Set DesH = txtDescmarca(indH)
        
    Case "ACT"
        'ACTIVIADD
         
        Set TDes = Me.txtcodactiv(indD)
        Set THas = txtcodactiv(indH)
        Subtipo = "N"
        If indD = 5 Then
            'llamadas
            Set DesD = txtDescActiv(indD)
            Set DesH = txtDescActiv(indH)
        End If
        
    End Select
    
    devuelve = CadenaDesdeHasta(TDes.Text, THas.Text, campo, Subtipo)
    If devuelve = "Error" Then
        PonerFoco TDes
        Exit Function
    End If
    If Not AnyadirAFormula(cadFormula, devuelve) Then Exit Function
    
    If Subtipo <> "F" And Subtipo <> "FH" Then
        'Fecha para Crystal Report
        If Not AnyadirAFormula(cadSelect, devuelve) Then Exit Function
    Else
        'Fecha para la Base de Datos
        Cad = CadenaDesdeHastaBD(TDes.Text, THas.Text, campo, Subtipo)
        If Not AnyadirAFormula(cadSelect, Cad) Then Exit Function
    End If
    
    If devuelve <> "" Then
        If param <> "" Then
            'Parametro Desde/Hasta
            CadParam = CadParam & AnyadirParametroDH(param, TDes, THas, DesD, DesH) & """|"
            numParam = numParam + 1
        End If
        PonerDesdeHasta = True
    End If
End Function


Private Function AnyadirParametroDH(Cad As String, ByRef TextoDESDE As TextBox, TextoHasta As TextBox, ByRef TD As TextBox, ByRef TH As TextBox) As String
On Error Resume Next
    
     If TextoDESDE.Text <> "" Then
        Cad = Cad & "desde " & TextoDESDE.Text
        If TD.Text <> "" Then Cad = Cad & " - " & TD.Text
    End If
    If TextoHasta.Text <> "" Then
        Cad = Cad & "  hasta " & TextoHasta.Text
        If TH <> "" Then Cad = Cad & " - " & TH.Text
    End If
    
    AnyadirParametroDH = Cad
    If Err.Number <> 0 Then Err.Clear
End Function

Private Sub txtFamia_GotFocus(Index As Integer)
    ConseguirFoco txtFamia(Index), 3
End Sub

Private Sub txtFamia_KeyPress(Index As Integer, KeyAscii As Integer)
     KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtFamia_LostFocus(Index As Integer)
    txtFamia(Index).Text = Trim(txtFamia(Index).Text)
    codigo = ""
    miSQL = ""
    If txtFamia(Index).Text <> "" Then
        If IsNumeric(txtFamia(Index).Text) Then
            codigo = DevuelveDesdeBD(conAri, "nomfamia", "sfamia", "codfamia", txtFamia(Index).Text, "N")
            If codigo = "" Then MsgBox "El codigo no pertence a ningun familia", vbExclamation
        Else
            miSQL = "Campo numerico"
        End If
    End If
     
    Me.txtDescFamia(Index).Text = codigo
    If miSQL <> "" Then
        MsgBox miSQL, vbExclamation
        txtFamia(Index).Text = ""
        PonerFoco txtFamia(Index)
        'If Index = 16 Then
            
    End If
    
    
    If Index = 16 And codigo = "" Then
        If txtFamia(Index).Text <> "" Then
            txtFamia(Index).Text = ""
            PonerFoco txtFamia(Index)
        End If
    End If
End Sub

Private Sub txtFecha_GotFocus(Index As Integer)
    ConseguirFoco txtFecha(Index), 3
End Sub

Private Sub txtFecha_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtFecha_LostFocus(Index As Integer)
Dim T As String
    txtFecha(Index).Text = Trim(txtFecha(Index).Text)
    If txtFecha(Index).Text <> "" Then
        T = txtFecha(Index).Text
        If EsFechaOK(T) Then
            txtFecha(Index).Text = T
        Else
            MsgBox "Fecha con formato incorrecto: " & txtFecha(Index).Text, vbExclamation
            txtFecha(Index).Text = ""
            PonerFoco txtFecha(Index)
        End If
    End If
    
End Sub


'-----------------------------------------------------------------------------------
Private Function HacerRecalculoPrecio() As Boolean
Dim RL As ADODB.Recordset
Dim Importe As Currency
Dim DtoPerm As Boolean
Dim DePromocion As Boolean
Dim AplicoDtoNormal As Boolean
Dim AplicoDtoRap As Boolean
Dim Abierto As Boolean
Dim precioUC As Currency  'Para guardar el importe de ultco
 

    On Error GoTo eHacerRecalculoPrecio
    HacerRecalculoPrecio = False
    Label3(15).Caption = "Obteniendo registros"
    Label3(15).Refresh
    
    miSQL = " WHERE sartic.codprove = sprove.codprove "
    'Si ha puesto desde hasta proveedor
    If Me.txtCodProve(4).Text <> "" Then miSQL = miSQL & " AND sartic.codprove >= " & Me.txtCodProve(4).Text
    If Me.txtCodProve(5).Text <> "" Then miSQL = miSQL & " AND sartic.codprove <= " & Me.txtCodProve(5).Text
    'Si ha puesto desde hasta familia
    If Me.txtFamia(2).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia >= " & Me.txtFamia(2).Text
    If Me.txtFamia(3).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia <= " & Me.txtFamia(3).Text
    'Si ha puesto desde hasta codartic
    If Me.txtArticulo(3).Text <> "" Then miSQL = miSQL & " AND sartic.codartic >= " & DBSet(Me.txtArticulo(3).Text, "T")
    If Me.txtArticulo(4).Text <> "" Then miSQL = miSQL & " AND sartic.codartic <= " & DBSet(Me.txtArticulo(4).Text, "T")
    
    'Con articulo de varios
    If chkRecalPrStd(5).Value = 0 Then miSQL = miSQL & " AND sartic.artvario = 0"
    'Solo control stock
    If chkRecalPrStd(4).Value = 1 Then miSQL = miSQL & " AND sartic.ctrstock = 1"
    
    
    codigo = "Select count(*) from sartic,sprove " & miSQL
    NumRegElim = 0
    Set RL = New ADODB.Recordset
    RL.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not RL.EOF Then NumRegElim = DBLet(RL.Fields(0), "N")
    RL.Close
    
    If NumRegElim = 0 Then
        MsgBox "No existen datos con esos parámetros", vbExclamation
        Exit Function
    End If


    If MsgBox("Va a realizar el calculo para: " & NumRegElim & " articulo(s)" & vbCrLf & vbCrLf & "¿Continuar?", vbQuestion + vbYesNo) = vbNo Then
        Exit Function
    End If

    DoEvents
    miSQL = "Select codartic,codfamia,preciouc,nomartic,sprove.* from sartic,sprove " & miSQL
    RL.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not RL.EOF
        Label3(15).Caption = RL!NomArtic
        Label3(15).Refresh
        precioUC = DBLet(RL!precioUC, "N")
        AplicoDtoNormal = False
        AplicoDtoRap = False
        
        
        If Me.chkRecalPrStd(0).Value = 1 Then
            'Desde el precioUC
            DtoPerm = True
            Importe = DBLet(RL!precioUC, "N")
            
        Else
            codigo = "select * from slispr where codartic= " & DBSet(RL!codArtic, "T") & " AND codprove = " & RL!Codprove
            miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
            DePromocion = False
            If miRsAux.EOF Then
                'No tienen entrada en slipspr
                DtoPerm = True
                Importe = DBLet(RL!precioUC, "N")
            Else
                '-------------------------------------------------------------
                'Si que tiene valor
                'Coje de
            
                 If Not (IsNull(miRsAux!FechaIni)) Then
                     If miRsAux!FechaIni <= Now Then
                         'Fecha menor que hoy. Veremos la mayor
                         DePromocion = True
                         If Not (IsNull(miRsAux!FechaFin)) Then
                             If miRsAux!FechaFin < Now Then DePromocion = False  'fecha fin menor que hoy
                         End If
                     End If
                 End If
                 
                 'De promocion
                 If DePromocion Then
                     Importe = DBLet(miRsAux!preciopr, "N")
                     DtoPerm = DBLet(miRsAux!dtoperm1, "N") = 1
                 Else
                     DtoPerm = DBLet(miRsAux!dtopermi, "N") = 1
                     'Cojera el precio actual o el otro
                     Importe = miRsAux!precioac
                     'hay precionuevo
                     If Not IsNull(miRsAux!precionu) Then
                         If Not IsNull(miRsAux!fechanue) Then
                             If miRsAux!fechanue <= Now Then Importe = miRsAux!precionu
                         End If
                     End If
                 End If
             End If
    
            miRsAux.Close
        End If
        'por un lado, u por otro, ya tengo el importe y si permite dtos
        Abierto = False

        
        If DtoPerm Or Me.chkRecalPrStd(1).Value = 1 Then
            If Me.chkRecalPrStd(3).Value = 1 Or Me.chkRecalPrStd(1).Value = 1 Then
                
                'Va a aplicar alguno de los dos dtos
                miSQL = "Select * from sdtomp where codfamia= " & RL!Codfamia & " AND codprove = " & RL!Codprove
                ' ? y codmarca....?
                miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
                If miRsAux.EOF Then
                    'Belarte, Manolo
                    'Si no hay descuento coje el UPC del articulo
                    Importe = precioUC
                    
                Else
                    'NO tiene dtos. Significa que es va con el NETO
                    If Me.chkRecalPrStd(1).Value = 1 Then AplicoDtoRap = True
                    If DBLet(miRsAux!dtoline1, "N") + DBLet(miRsAux!dtoline2, "N") = 0 Then
                        'Belarte, Manolo
                        'Si no hay descuento coje el UPC del articulo
                        Importe = precioUC
                    Else
                        AplicoDtoNormal = True
                    End If
                End If
                Abierto = True
            End If
        End If
        

                    
        'Aplicamos dtos al pie
        If AplicoDtoNormal Then
            If vParamAplic.TipoDtos = 0 Then
                'aditivo
                Importe = Importe - ((Importe * DBLet(miRsAux!dtoline1, "N") / 100) - ((Importe * DBLet(miRsAux!dtoline2, "N") / 100)))
            Else
                Importe = Importe - ((Importe * DBLet(miRsAux!dtoline1, "N") / 100))
                Importe = Importe - ((Importe * DBLet(miRsAux!dtoline2, "N") / 100))
            End If
        End If
            
        If AplicoDtoRap Then
                If vParamAplic.TipoDtos = 0 Then
                    'aditivo
                    Importe = Importe - ((Importe * DBLet(miRsAux!Rap1, "N") / 100) - ((Importe * DBLet(miRsAux!Rap2, "N") / 100)))
                Else
                    Importe = Importe - ((Importe * DBLet(miRsAux!Rap1, "N") / 100))
                    Importe = Importe - ((Importe * DBLet(miRsAux!Rap2, "N") / 100))
                End If
        End If
        
        If Importe <> 0 Then
            'UPDATEAMOS
            miSQL = "UPDATE sartic SET preciost = " & DBSet(Importe, "N")
            If Me.chkRecalPrStd(2).Value = 1 Then miSQL = miSQL & ", preciomp =" & DBSet(Importe, "N")
            miSQL = miSQL & " WHERE codartic = " & DBSet(RL!codArtic, "T")
            conn.Execute miSQL
        End If
        
        'Siguiente
        If Abierto Then miRsAux.Close
        RL.MoveNext
    Wend
    RL.Close
    HacerRecalculoPrecio = True
eHacerRecalculoPrecio:
    If Err.Number <> 0 Then
        MuestraError Err.Number
    Else
        MsgBox "Proceso finalizado", vbInformation
    End If
    Set RL = Nothing
End Function




Private Sub GenerarPrevisionPagosCompras()
Dim i As Integer
Dim Importe As Currency
Dim IVA As Currency


    On Error GoTo eGenerarPrevisionPagosCompras
    
    Label3(17).Caption = "Prepara datos"
    Label3(17).Refresh
    NumRegElim = 0
    conn.Execute "DELETE from tmpinformes where codusu = " & vUsu.codigo
        
        
    miSQL = "Select porceiva from tiposiva where codigiva = " & vParamAplic.TipoIVA1
    miRsAux.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = ""
    If Not miRsAux.EOF Then
        If Not IsNull(miRsAux!PorceIVA) Then miSQL = miRsAux!PorceIVA
    End If
    miRsAux.Close
    If miSQL = "" Then
        MsgBox "Error obteniendo valor del iva: " & vParamAplic.TipoIVA1, vbExclamation
        Exit Sub
    End If
    IVA = CCur(miSQL)
    IVA = Round2(IVA / 100, 2)
    IVA = IVA + 1  '1.18 pejmplo
    
        
    'En pedidos
    Label3(17).Caption = "Pedidos"
    Label3(17).Refresh
    miSQL = "select scappr.numpedpr,codprove,nomprove,fecpedpr,scappr.codforpa,nomforpa,primerve,sum(importel) suma from"
    miSQL = miSQL & " scappr,slippr,sforpa where scappr.numpedpr=slippr.numpedpr and scappr.codforpa=sforpa.codforpa"

    'Si ha puesto desde hasta proveedor
    If Me.txtCodProve(6).Text <> "" Then miSQL = miSQL & " AND scappr.codprove >= " & Me.txtCodProve(6).Text
    If Me.txtCodProve(7).Text <> "" Then miSQL = miSQL & " AND scappr.codprove <= " & Me.txtCodProve(7).Text
    'fecha
    If Me.txtFecha(0).Text <> "" Then miSQL = miSQL & " AND scappr.fecpedpr >= " & DBSet(Me.txtFecha(0).Text, "F")
    If Me.txtFecha(1).Text <> "" Then miSQL = miSQL & " AND scappr.fecpedpr <= " & DBSet(Me.txtFecha(1).Text, "F")
    miSQL = miSQL & " group by 1"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = ""
    While Not miRsAux.EOF
        NumRegElim = NumRegElim + 1
        'codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,campo2,nombre3
        i = Val(Me.txtcantidad(0).Text) + DBLet(miRsAux!primerve, "N")
        FI = DateAdd("d", i, miRsAux!fecpedpr)
        Importe = DBLet(miRsAux!Suma, "N")
        Importe = Round2(Importe * IVA, 2)
        
        miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!Codprove & "," & DBSet(miRsAux!nomprove, "T")
        miSQL = miSQL & ",'PED   " & Format(miRsAux!numpedpr, "000000") & "'," & DBSet(miRsAux!fecpedpr, "F") & ","
        miSQL = miSQL & DBSet(FI, "F") & "," & DBSet(Importe, "N") & "," & DBSet(Importe, "N") & "," & miRsAux!codforpa
        miSQL = miSQL & "," & DBSet(miRsAux!nomforpa, "T") & ",0)"
        
        
        If (NumRegElim Mod 50) = 0 Then
            miSQL = Mid(miSQL, 2)
            miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,importe2,campo2,nombre3,porcen1) VALUES " & miSQL
            conn.Execute miSQL
            miSQL = ""
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    If miSQL <> "" Then
        miSQL = Mid(miSQL, 2)
        miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,importe2,campo2,nombre3,porcen1) VALUES " & miSQL
        conn.Execute miSQL
    End If
    
    
    
    
    
    
    'Los albaranes
      'En pedidos
    Label3(17).Caption = "Albaranes"
    Label3(17).Refresh
    miSQL = " select scaalp.codprove,scaalp.numalbar,scaalp.fechaalb,nomprove,scaalp.codforpa,nomforpa,primerve,"
    miSQL = miSQL & " sum(importel) suma from scaalp,slialp,sforpa where scaalp.numalbar=slialp.numalbar"
    miSQL = miSQL & " and scaalp.fechaalb=slialp.fechaalb and scaalp.codprove=slialp.codprove"
    miSQL = miSQL & " and scaalp.codforpa=Sforpa.codforpa "
    'Si ha puesto desde hasta proveedor
    If Me.txtCodProve(6).Text <> "" Then miSQL = miSQL & " AND scaalp.codprove >= " & Me.txtCodProve(6).Text
    If Me.txtCodProve(7).Text <> "" Then miSQL = miSQL & " AND scaalp.codprove <= " & Me.txtCodProve(7).Text
    'fecha
    If Me.txtFecha(0).Text <> "" Then miSQL = miSQL & " AND scaalp.fechaalb >= " & DBSet(Me.txtFecha(0).Text, "F")
    If Me.txtFecha(1).Text <> "" Then miSQL = miSQL & " AND scaalp.fechaalb <= " & DBSet(Me.txtFecha(1).Text, "F")
    
    miSQL = miSQL & " and scaalp.codforpa=Sforpa.codforpa  group by 1,2,3"
    
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = ""
    While Not miRsAux.EOF
        NumRegElim = NumRegElim + 1
        'codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,campo2,nombre3
        'En importe 2 tendre los importes de pedido, en el 3 de albaranes
        i = DBLet(miRsAux!primerve, "N")
        FI = DateAdd("d", i, miRsAux!FechaAlb)
        Importe = DBLet(miRsAux!Suma, "N")
        Importe = Round2(Importe * IVA, 2)
        
        miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!Codprove & "," & DBSet(miRsAux!nomprove, "T")
        miSQL = miSQL & ",'ALB   " & miRsAux!NumAlbar & "'," & DBSet(miRsAux!FechaAlb, "F") & ","
        miSQL = miSQL & DBSet(FI, "F") & "," & DBSet(Importe, "N") & "," & DBSet(Importe, "N") & "," & miRsAux!codforpa
        miSQL = miSQL & "," & DBSet(miRsAux!nomforpa, "T") & ",0)"
        
        
        If (NumRegElim Mod 50) = 0 Then
            miSQL = Mid(miSQL, 2)
            miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,importe3,campo2,nombre3,porcen1) VALUES " & miSQL
            conn.Execute miSQL
            miSQL = ""
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    If miSQL <> "" Then
        miSQL = Mid(miSQL, 2)
        miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,importe3,campo2,nombre3,porcen1) VALUES " & miSQL
        conn.Execute miSQL
    End If
    
    
    
    'Abril 2014
    'Ira a la tesoreria y devolvera los datos igual que haria en el arimoney

    Label3(17).Caption = "Pagos pendientes"
    Label3(17).Refresh
    
    i = InStr(1, conn.ConnectionString, "DATABASE=")
    If i > 0 Then
        miSQL = Mid(conn.ConnectionString, i + 9)
        i = InStr(1, miSQL, ";")
        If i > 0 Then miSQL = Mid(miSQL, 1, i - 1)
    End If
    If i = 0 Then miSQL = "Ariges" & vEmpresa.codempre
    
    miSQL = " ctaprove in (select codmacta from " & miSQL & ".sprove WHERE 1=1 "
    miSQL = " select spagop.*,nomforpa from spagop,sforpa where spagop.codforpa=sforpa.codforpa and " & miSQL
    'Si ha puesto desde hasta proveedor
    If Me.txtCodProve(6).Text <> "" Then miSQL = miSQL & " AND sprove.codprove >= " & Me.txtCodProve(6).Text
    If Me.txtCodProve(7).Text <> "" Then miSQL = miSQL & " AND sprove.codprove <= " & Me.txtCodProve(7).Text
    
    miSQL = miSQL & ")"
    miRsAux.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = ""
    While Not miRsAux.EOF
        NumRegElim = NumRegElim + 1
        'codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,campo2,nombre3
        'En importe 2 tendre los importes de pedido, en el 3 de albaranes, en el 4 las facturas
        
        Importe = miRsAux!impefect - DBLet(miRsAux!imppagad, "N")
        miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & ",0," & DBSet(miRsAux!CtaProve, "T")
        miSQL = miSQL & "," & DBSet("FAC   " & miRsAux!NumFactu, "T") & "," & DBSet(miRsAux!FecFactu, "F") & ","
        miSQL = miSQL & DBSet(miRsAux!fecefect, "F") & "," & DBSet(Importe, "N") & "," & DBSet(Importe, "N") & "," & miRsAux!codforpa
        '                       en porcen1 grabo un 4 para hacer despues el select por codmacta mas rapido
        miSQL = miSQL & "," & DBSet(miRsAux!nomforpa, "T") & ",4," & miRsAux!emitdocum & ")"
        
        
        If (NumRegElim Mod 50) = 0 Then
            miSQL = Mid(miSQL, 2)
            miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,importe4,campo2,nombre3,porcen1,porcen2) VALUES " & miSQL
            conn.Execute miSQL
            miSQL = ""
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
        
    If miSQL <> "" Then
        miSQL = Mid(miSQL, 2)
        miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,importe4,campo2,nombre3,porcen1,porcen2) VALUES " & miSQL
        conn.Execute miSQL
    End If
    
    'Ajustamos el valor de codmacta
    Label3(17).Caption = "Ajuste codigo proveedor"
    Label3(17).Refresh
    Espera 0.5
    miSQL = "Select distinct(nombre1) from tmpinformes where codusu =" & vUsu.codigo & " AND porcen1=4"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        codigo = "nomprove"
        miSQL = DevuelveDesdeBD(conAri, "codprove", "sprove", "codmacta", miRsAux!nombre1, "T", codigo)
        If miSQL = "" Then
            miSQL = "0"
            codigo = "N/D"
        End If
        
        miSQL = "UPDATE tmpinformes SET campo1=" & miSQL & ", nombre1=" & DBSet(codigo, "T") & ", porcen1=0"
        miSQL = miSQL & " WHERE codusu = " & vUsu.codigo & " AND nombre1=" & DBSet(miRsAux!nombre1, "T")
        conn.Execute miSQL
        
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    If Me.chkVarios(10).Value = 1 Then
    
    
        
        'En pedidos
        Label3(17).Caption = "PED. anterior"
        Label3(17).Refresh
        miSQL = "select scappr.numpedpr,codprove,nomprove,'" & Format(txtFecha(0).Text, FormatoFecha) & "'  fecpedpr,scappr.codforpa,nomforpa,primerve,sum(importel) suma from"
        miSQL = miSQL & " scappr,slippr,sforpa where scappr.numpedpr=slippr.numpedpr and scappr.codforpa=sforpa.codforpa"
    
        'Si ha puesto desde hasta proveedor
        If Me.txtCodProve(6).Text <> "" Then miSQL = miSQL & " AND scappr.codprove >= " & Me.txtCodProve(6).Text
        If Me.txtCodProve(7).Text <> "" Then miSQL = miSQL & " AND scappr.codprove <= " & Me.txtCodProve(7).Text
        'fecha
        miSQL = miSQL & " AND scappr.fecpedpr < " & DBSet(Me.txtFecha(0).Text, "F")
        
        miSQL = miSQL & " group by 1"
        miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        While Not miRsAux.EOF
            NumRegElim = NumRegElim + 1
            'codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,campo2,nombre3
            i = Val(Me.txtcantidad(0).Text) + DBLet(miRsAux!primerve, "N")
            FI = DateAdd("d", i, miRsAux!fecpedpr)
            Importe = DBLet(miRsAux!Suma, "N")
            Importe = Round2(Importe * IVA, 2)
            
            miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!Codprove & "," & DBSet(miRsAux!nomprove, "T")
            miSQL = miSQL & ",'PED   " & Format(miRsAux!numpedpr, "000000") & "'," & DBSet(txtFecha(0).Text, "F") & ","
            miSQL = miSQL & DBSet(FI, "F") & "," & DBSet(Importe, "N") & "," & DBSet(Importe, "N") & "," & miRsAux!codforpa
            miSQL = miSQL & "," & DBSet(miRsAux!nomforpa, "T") & ",1)"
            
            
            If (NumRegElim Mod 50) = 0 Then
                miSQL = Mid(miSQL, 2)
                miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,importe2,campo2,nombre3,porcen1) VALUES " & miSQL
                conn.Execute miSQL
                miSQL = ""
            End If
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        
        If miSQL <> "" Then
            miSQL = Mid(miSQL, 2)
            miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,importe2,campo2,nombre3,porcen1) VALUES " & miSQL
            conn.Execute miSQL
        End If
        
        
        
        
        'Los albaranes
          'En pedidos
        Label3(17).Caption = "ALB.  Anterior"
        Label3(17).Refresh
        miSQL = " select scaalp.codprove,scaalp.numalbar,'" & Format(txtFecha(0).Text, FormatoFecha) & "' fechaalb,nomprove,scaalp.codforpa,nomforpa,primerve,"
        miSQL = miSQL & " sum(importel) suma from scaalp,slialp,sforpa where scaalp.numalbar=slialp.numalbar"
        miSQL = miSQL & " and scaalp.fechaalb=slialp.fechaalb and scaalp.codprove=slialp.codprove"
        miSQL = miSQL & " and scaalp.codforpa=Sforpa.codforpa "
        'Si ha puesto desde hasta proveedor
        If Me.txtCodProve(6).Text <> "" Then miSQL = miSQL & " AND scaalp.codprove >= " & Me.txtCodProve(6).Text
        If Me.txtCodProve(7).Text <> "" Then miSQL = miSQL & " AND scaalp.codprove <= " & Me.txtCodProve(7).Text
        'fecha
        miSQL = miSQL & " AND scaalp.fechaalb < " & DBSet(Me.txtFecha(0).Text, "F")
        
        
        miSQL = miSQL & " and scaalp.codforpa=Sforpa.codforpa  group by 1,2,3"
        
        miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        While Not miRsAux.EOF
            NumRegElim = NumRegElim + 1
            'codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,campo2,nombre3
            'En importe 2 tendre los importes de pedido, en el 3 de albaranes
            i = DBLet(miRsAux!primerve, "N")
            FI = DateAdd("d", i, miRsAux!FechaAlb)
            Importe = DBLet(miRsAux!Suma, "N")
            Importe = Round2(Importe * IVA, 2)
            
            miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!Codprove & "," & DBSet(miRsAux!nomprove, "T")
            miSQL = miSQL & ",'ALB   " & miRsAux!NumAlbar & "'," & DBSet(miRsAux!FechaAlb, "F") & ","
            miSQL = miSQL & DBSet(FI, "F") & "," & DBSet(Importe, "N") & "," & DBSet(Importe, "N") & "," & miRsAux!codforpa
            miSQL = miSQL & "," & DBSet(miRsAux!nomforpa, "T") & ",1)"
            
            
            If (NumRegElim Mod 50) = 0 Then
                miSQL = Mid(miSQL, 2)
                miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,importe3,campo2,nombre3,porcen1) VALUES " & miSQL
                conn.Execute miSQL
                miSQL = ""
            End If
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        
        If miSQL <> "" Then
            miSQL = Mid(miSQL, 2)
            miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,     nombre1,nombre2,fecha1,fecha2,importe1,importe3,campo2,nombre3,porcen1) VALUES " & miSQL
            conn.Execute miSQL
        End If
        
        
    End If 'De TOOOODO
    
    
    
    
    miSQL = "UPDATE tmpinformes SET porcen2=0 WHERE codusu = " & vUsu.codigo & " AND porcen2 is null"
    conn.Execute miSQL


    Exit Sub
eGenerarPrevisionPagosCompras:
    MuestraError Err.Number, Err.Description
    NumRegElim = 0 'Error no sigue
    
End Sub



Private Sub CargaListAccionesRealizadas()
Dim L As Collection
Dim i As Integer
Dim IT As ListItem
    Set L = New Collection
    Set LOG = New cLOG
    If LOG.DevuelveAcciones(L) Then
        For NumRegElim = 1 To L.Count
            miSQL = L.item(NumRegElim)
            i = RecuperaValor(miSQL, 1)
            'Acciones que no van a entrar en el log
            If i = 10 Or i = 6 Or i = 5 Or i = 3 Or i = 2 Then
                'acciones que no mostrare
                'son facturacion, hco....
                    
            Else
                Set IT = Me.ListView1(0).ListItems.Add(, "K" & i)
                IT.Text = RecuperaValor(miSQL, 2)
            End If
        Next
    End If
    Set LOG = Nothing
        
        
    'Los usuarios
    miSQL = "select distinct(usuario) from slog order by 1"
    Set miRsAux = New ADODB.Recordset
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        If miRsAux.Fields(0) <> "root" Then
            Set IT = Me.ListView1(1).ListItems.Add()
            IT.Text = miRsAux.Fields(0)
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Set miRsAux = Nothing
End Sub



Private Sub CargarDatosAcciones()
Dim i As Integer

    On Error GoTo ECargarDatosAcciones
    NumRegElim = 0
    
    Label3(18).Caption = "Inicio proceso"
    Label3(18).Refresh
    
    conn.Execute "DELETE FROM tmpinformes WHERE codusu = " & vUsu.codigo
    
    
    miSQL = ""
    For NumRegElim = 1 To Me.ListView1(0).ListItems.Count
        If Me.ListView1(0).ListItems(NumRegElim).Checked = True Then miSQL = miSQL & ", " & Mid(ListView1(0).ListItems(NumRegElim).Key, 2)
    Next
    codigo = " accion IN (" & Mid(miSQL, 2) & ")"
    
    
    miSQL = ""
    For NumRegElim = 1 To Me.ListView1(1).ListItems.Count
        If Me.ListView1(1).ListItems(NumRegElim).Checked = True Then miSQL = miSQL & ", " & DBSet((ListView1(1).ListItems(NumRegElim).Text), "T")
    Next
    codigo = codigo & " AND usuario IN (" & Mid(miSQL, 2) & ")"
    miSQL = codigo
    If Me.txtFecha(3).Text <> "" Then miSQL = miSQL & " AND slog.fecha >= " & DBSet(Me.txtFecha(3).Text & " 00:00:00", "FH")
    If Me.txtFecha(4).Text <> "" Then miSQL = miSQL & " AND slog.fecha <= " & DBSet(Me.txtFecha(4).Text & " 23:59:59", "FH")
    

    miSQL = "Select * from slog WHERE " & miSQL
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    NumRegElim = 0
    miSQL = ""
    codigo = "INSERT INTO tmpinformes( codusu,codigo1,campo1,nombre2,nombre3,fecha1, obser) VALUES "
    While Not miRsAux.EOF
        NumRegElim = NumRegElim + 1
        Label3(18).Caption = NumRegElim
        Label3(18).Refresh
        'tmpinformes codusu,codigo1,campo1,nombre2, obser
        miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!Accion & ","
        miSQL = miSQL & DBSet(miRsAux!Usuario, "T") & ",'" & Format(miRsAux!Fecha, "hh:mm:ss")
        miSQL = miSQL & "'," & DBSet(miRsAux!Fecha, "F") & ","
        If Val(miRsAux!Accion) = 14 Then
                'CAMBIO DE PRECIO. Voy a añadir el codartic codartic
            i = InStr(1, miRsAux!Descripcion, "culo ")
            If i > 0 Then
                cadSelect = Mid(miRsAux!Descripcion, 1, i + 4)
                CadParam = Mid(miRsAux!Descripcion, i + 5)
                i = InStr(1, CadParam, vbCrLf)
                If i > 0 Then
                    OtrosDatos = Mid(CadParam, 1, i - 1)
                    cadSelect = cadSelect & OtrosDatos 'voy concatenando para luego devolver los textos
                    OtrosDatos = DevuelveDesdeBD(conAri, "nomartic", "sartic", "codartic", OtrosDatos, "T")
                    If OtrosDatos <> "" Then cadSelect = cadSelect & vbCrLf & " [" & OtrosDatos & "]"
                    cadSelect = cadSelect & Mid(CadParam, i)
                Else
                   '
                End If
            Else
                '
            End If
        Else
            '
            i = 0 'para que ponga ahi bajo la descripcion
        End If
        If i = 0 Then cadSelect = miRsAux!Descripcion
        miSQL = miSQL & DBSet(cadSelect, "T") & ")"
        
        If (NumRegElim Mod 100) = 0 Then
            miSQL = Mid(miSQL, 2)
            miSQL = codigo & miSQL
            conn.Execute miSQL
            miSQL = ""
        End If
        
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    If miSQL <> "" Then
        miSQL = Mid(miSQL, 2)
        miSQL = codigo & miSQL
        conn.Execute miSQL
        miSQL = ""
    End If
    OtrosDatos = ""
    
    
    'Ya tengo todos metidos, updateare el nombre del login
    Label3(10).Caption = "Usuarios"
    Label3(10).Refresh
        
    miSQL = "Select nombre2 from tmpinformes where codusu = " & vUsu.codigo & " GROUP BY 1"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        
        Label3(18).Caption = miRsAux.Fields(0)
        Label3(18).Refresh
        
        miSQL = DevuelveDesdeBD(conAri, "nomtraba", "straba", "login", miRsAux.Fields(0), "T")
        If miSQL <> "" Then
            miSQL = "UPDATE tmpinformes SET nombre2 = " & DBSet(miSQL, "T")
            miSQL = miSQL & " WHERE codusu = " & vUsu.codigo & " AND nombre2 = " & DBSet(miRsAux.Fields(0), "T")
            conn.Execute miSQL
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    For i = 1 To Me.ListView1(0).ListItems.Count
        If ListView1(0).ListItems(i).Checked Then
            Label3(18).Caption = ListView1(0).ListItems(i).Text
            Label3(18).Refresh
            
            
            
            
                miSQL = "UPDATE tmpinformes SET nombre1 = " & DBSet(ListView1(0).ListItems(i).Text, "T")
                miSQL = miSQL & " WHERE codusu = " & vUsu.codigo & " AND campo1 = " & Mid(ListView1(0).ListItems(i).Key, 2)
                conn.Execute miSQL
            
            
        End If
    Next
    
    
    
    If NumRegElim = 0 Then MsgBox "No existen datos con esos valores", vbExclamation
    
    
    Exit Sub
ECargarDatosAcciones:
    MuestraError Err.Number, Err.Description
    NumRegElim = 0
End Sub


Private Sub VariablesReportLog()
Dim Cuantos As Integer
    InicializarVbles True
    
    
    'Desde hasta 1
    '------------------
    miSQL = ""
    Cuantos = 0
    
    For NumRegElim = 1 To Me.ListView1(1).ListItems.Count
        If Me.ListView1(1).ListItems(NumRegElim).Checked = True Then Cuantos = Cuantos + 1
    Next
    For NumRegElim = 1 To Me.ListView1(1).ListItems.Count
        If Me.ListView1(1).ListItems(NumRegElim).Checked = True Then
            codigo = ListView1(1).ListItems(NumRegElim).Text
            If Cuantos > 4 Then
                'SON MUCHOS. Ponemos el login
                
            Else
                 codigo = DevuelveDesdeBD(conAri, "nomtraba", "straba", "login", codigo, "T")
                 If codigo = "" Then codigo = ListView1(1).ListItems(NumRegElim).Text
            End If
            miSQL = miSQL & ", " & codigo
        End If
    Next
    miSQL = "Trab: " & Mid(miSQL, 2)
    
    codigo = ""
    If Me.txtFecha(3).Text <> "" Then codigo = "desde " & Me.txtFecha(3).Text
    If Me.txtFecha(4).Text <> "" Then codigo = codigo & " hasta " & txtFecha(4).Text
    If codigo <> "" Then codigo = "Fecha: " & codigo
    miSQL = Trim(codigo & "   " & miSQL)
    
    miSQL = "pdh1=""" & miSQL & """|"
    CadParam = CadParam & miSQL
    numParam = numParam + 1
        
    'Desde hasta 1
    '------------------
    miSQL = ""
    Cuantos = 0
    For NumRegElim = 1 To Me.ListView1(1).ListItems.Count
        If Me.ListView1(1).ListItems(NumRegElim).Checked = True Then Cuantos = Cuantos + 1
    Next
    For NumRegElim = 1 To Me.ListView1(0).ListItems.Count
        If Me.ListView1(0).ListItems(NumRegElim).Checked = True Then
            
            If Cuantos > 6 Then
                'SON MUCHOS. Ponemos los codigos
                codigo = Mid(ListView1(0).ListItems(NumRegElim).Key, 2)
            Else
                codigo = ListView1(0).ListItems(NumRegElim).Text
            End If
            miSQL = miSQL & ", " & codigo
        End If
    Next
    miSQL = "Acc: " & Mid(miSQL, 2)
    miSQL = "pdh2=""" & miSQL & """|"
    CadParam = CadParam & miSQL
    numParam = numParam + 1
        
    cadTitulo = "Listado LOG "
    cadNomRPT = "rListLog"
    If Me.optVarios(0).Value Then
        miSQL = "Fecha"
        codigo = ""
    Else
        miSQL = "Trabajador"
        codigo = "Tr"
    End If
    cadTitulo = cadTitulo & "(" & miSQL & ")"
    cadNomRPT = cadNomRPT & codigo & ".rpt"
End Sub


Private Sub CargaTrabajadores2(IndiceListview As Integer)
Dim IT As ListItem



    miSQL = "select codtraba,nomtraba from straba where login<>"""" order by nomtraba"
    Set miRsAux = New ADODB.Recordset
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        Set IT = Me.ListView1(IndiceListview).ListItems.Add()
        IT.Text = miRsAux.Fields(1)
        IT.ToolTipText = "Codigo: " & miRsAux.Fields(0)
        IT.Tag = miRsAux.Fields(0)
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Set miRsAux = Nothing
End Sub




Private Function CargarDatosVtasDia() As Boolean

On Error GoTo ECargarDatosVtasDia
    CargarDatosVtasDia = False
    
    Label3(19).Caption = "Prepara datos"
    Label3(19).Refresh
    
    conn.Execute "DELETE FROM tmpinformes WHERE codusu = " & vUsu.codigo
    
    
    miSQL = ""
    For NumRegElim = 1 To Me.ListView1(2).ListItems.Count
        If Me.ListView1(2).ListItems(NumRegElim).Checked Then miSQL = miSQL & ", " & ListView1(2).ListItems(NumRegElim).Tag
    Next
    codigo = "(" & Mid(miSQL, 2) & ")"
    
    
    'codusu,fecha1,codigo1,campo1,importe1,campo2

    
    miSQL = "select " & vUsu.codigo & ",scaalb.fechaalb,0,count(*) lineas ,sum(importel) importe,scaalb.codtraba,sum(cantidad*preciouc) coste from "
    miSQL = miSQL & " scaalb,slialb,sartic where scaalb.numalbar = slialb.numalbar and scaalb.codtipom = slialb.codtipom AND sartic.codartic=slialb.codartic"
    If Me.txtFecha(5).Text <> "" Then miSQL = miSQL & " AND scaalb.fechaalb >= " & DBSet(Me.txtFecha(5).Text, "F")
    If Me.txtFecha(6).Text <> "" Then miSQL = miSQL & " AND scaalb.fechaalb <= " & DBSet(Me.txtFecha(6).Text, "F")
    miSQL = miSQL & " AND scaalb.codtraba in " & codigo
    miSQL = miSQL & " group by scaalb.fechaalb,scaalb.numalbar,scaalb.codtipom"
    miSQL = "INSERT INTO tmpinformes(codusu,fecha1,codigo1,campo1,importe1,campo2,importe2) " & miSQL
    conn.Execute miSQL
    

    
    
    
    'Insertamos de facturas
    Label3(19).Caption = "Facturas"
    Label3(19).Refresh
    miSQL = "select " & vUsu.codigo & ",scafac1.fecfactu,1,count(*) lineas ,sum(importel) importe,scafac1.codtraba,sum(cantidad*preciouc) "
    miSQL = miSQL & " from scafac1,slifac where scafac1.numfactu = slifac.numfactu and scafac1.codtipom = slifac.codtipom"
    miSQL = miSQL & " and scafac1.fecfactu = slifac.fecfactu and scafac1.numalbar = slifac.numalbar "
    miSQL = miSQL & " and scafac1.codtipoa = slifac.codtipoa"
    If Me.txtFecha(5).Text <> "" Then miSQL = miSQL & " AND scafac1.fecfactu >= " & DBSet(Me.txtFecha(5).Text, "F")
    If Me.txtFecha(6).Text <> "" Then miSQL = miSQL & " AND scafac1.fecfactu <= " & DBSet(Me.txtFecha(6).Text, "F")
    miSQL = miSQL & " AND scafac1.codtraba in " & codigo
    miSQL = miSQL & " group by scafac1.fecfactu,scafac1.numfactu,scafac1.codtipom"
    miSQL = "INSERT INTO tmpinformes(codusu,fecha1,codigo1,campo1,importe1,campo2,importe2) " & miSQL
    conn.Execute miSQL
    



    miSQL = DevuelveDesdeBD(conAri, "count(*)", "tmpinformes", "codusu", CStr(vUsu.codigo))
    If miSQL = "" Then miSQL = "0"
    If Val(miSQL) = 0 Then
        MsgBox "No exiten datos con esos valores", vbExclamation
        Exit Function
    End If
    
    
    'Actualizare los nombres del trajador
    Label3(19).Caption = "Trabajadores"
    Label3(19).Refresh
    miSQL = "Select distinct(campo2) from tmpinformes where codusu = " & vUsu.codigo & " ORDER BY 1"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        Label3(19).Caption = miRsAux.Fields(0)
        Label3(19).Refresh
    
        miSQL = DevuelveDesdeBD(conAri, "nomtraba", "straba", "codtraba", CStr(miRsAux.Fields(0)))
        miSQL = "UPDATE tmpinformes SET nombre1 = " & DBSet(miSQL, "T")
        miSQL = miSQL & " WHERE codusu = " & vUsu.codigo & " AND campo2 =" & miRsAux.Fields(0)
        conn.Execute miSQL
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    CargarDatosVtasDia = True
ECargarDatosVtasDia:
    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description
    
End Function


Private Sub CargaPrecioCompraProve()
Dim IT As ListItem

    On Error GoTo Ecargaprov

    If Me.txtCodProve(8).Text = "" Or Me.txtArticulo(5).Text = "" Then
        lwPrecUC.ListItems.Clear
        Exit Sub
    End If
    
    miSQL = Me.txtCodProve(8).Text & "|" & Me.txtArticulo(5).Text & "|"
    If lwPrecUC.Tag = miSQL Then Exit Sub  'es lo que estaba
    
    lwPrecUC.ListItems.Clear
    lwPrecUC.Tag = miSQL
    
    Screen.MousePointer = vbHourglass
    
    Set miRsAux = New ADODB.Recordset
    '------------ OFERTAS NO
    'misql = "select * from scappr,slippr where scappr.numpedpr=slippr.numpedpr and "
    'misql = misql & " codprove=" & txtCodProve(8).Text & " and codartic=" & DBSet(txtArticulo(5).Text, "T")
    Label3(20).Caption = "Albaranes"
    Label3(20).Refresh

    
    
    
    miSQL = "select 'ALV',scaalp.numalbar,scaalp.fechaalb,cantidad,precioar from scaalp,slialp where"
    miSQL = miSQL & " scaalp.numalbar=slialp.numalbar and scaalp.fechaalb=slialp.fechaalb and scaalp.codprove=slialp.codprove"
    miSQL = miSQL & " AND slialp.codprove=" & txtCodProve(8).Text & " and codartic=" & DBSet(txtArticulo(5).Text, "T")
    
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        
        Set IT = lwPrecUC.ListItems.Add()
        IT.Text = miRsAux.Fields(0)
        IT.SubItems(1) = miRsAux.Fields(1)
        IT.SubItems(2) = miRsAux.Fields(2)
        IT.SubItems(3) = Format(miRsAux.Fields(3), "#,##0")
        IT.SubItems(4) = Format(miRsAux.Fields(4), FormatoPrecio)
        IT.SubItems(5) = Format(miRsAux.Fields(2), "yyyymmdd")
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    Label3(20).Caption = "Facturas"
    Label3(20).Refresh

    miSQL = "select 'FRA',scafpc.numfactu,scafpc.fecfactu,cantidad,precioar from scafpc,slifpc where scafpc.numfactu=slifpc.numfactu and"
    miSQL = miSQL & " scafpc.fecfactu=slifpc.fecfactu and scafpc.codprove=slifpc.codprove"
    miSQL = miSQL & " AND slifpc.codprove=" & txtCodProve(8).Text & " and codartic=" & DBSet(txtArticulo(5).Text, "T")
    
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        
        Set IT = lwPrecUC.ListItems.Add()
        IT.Text = miRsAux.Fields(0)
        IT.SubItems(1) = miRsAux.Fields(1)
        IT.SubItems(2) = miRsAux.Fields(2)
        IT.SubItems(3) = Format(miRsAux.Fields(3), "#,##0")
        IT.SubItems(4) = Format(miRsAux.Fields(4), FormatoPrecio)
        IT.SubItems(5) = Format(miRsAux.Fields(2), "yyyymmdd")
        miRsAux.MoveNext

    Wend
    miRsAux.Close
    

    
Ecargaprov:
    If Err.Number <> 0 Then MuestraError Err.Number
    Label3(20).Caption = ""
    Set miRsAux = Nothing
    CadenaDesdeOtroForm = "" 'por si acaso
    Screen.MousePointer = vbDefault
    
End Sub

Private Sub CargaPrecioCosteArticulo()
Dim C As String
    C = DevuelveDesdeBD(conAri, "preciouc", "sartic", "codartic", txtArticulo(6).Text, "T")
    If C = "" Then C = "0"
    txtDecimal(0).Text = Format(C, FormatoPrecio)
End Sub




Private Function CargarDatosFamiliasDtoEnTmp() As Boolean

    On Error GoTo eCargarDatosFamiliasDtoEnTmp
    CargarDatosFamiliasDtoEnTmp = False
    
    conn.Execute "DELETE from tmpinformes where codusu = " & vUsu.codigo
    conn.Execute "DELETE from tmpcommand where codusu = " & vUsu.codigo
    
    miSQL = "select sfamia.*, sfamiadtos.clasifica,nombre,dtoline1,nomprove "
    miSQL = miSQL & " From sfamiadtos, sfamiatipodto, sfamia left join sprove on sfamia.codprove=sprove.codprove"

    miSQL = miSQL & " Where sfamiadtos.clasifica = sfamiatipodto.clasifica"
    miSQL = miSQL & " AND  sfamia.codfamia=sfamiadtos.codfamia"
    'JUL 2013
    miSQL = miSQL & " AND sprove.OcultarEnListDto = 0"
    If cadSelect <> "" Then
        codigo = Replace(cadSelect, "{", "(")
        codigo = Replace(codigo, "}", ")")
        miSQL = miSQL & " AND " & codigo
    End If
    miSQL = miSQL & " order by codfamia,clasifica"

    Set miRsAux = New ADODB.Recordset
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    NumRegElim = 0
    miSQL = ""
    While Not miRsAux.EOF
     
        'tmpinformes(codusu,codigo1,campo1,campo2,nombre1,nombre2,importe1,importe2,importe3)
        NumRegElim = NumRegElim + 1
        miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & "," & DBLet(miRsAux!Codprove, "N") & "," & miRsAux!Codfamia & ","
        miSQL = miSQL & DBSet(miRsAux!nomprove, "T", "N") & "," & DBSet(miRsAux!nomfamia, "T", "N") & ","
        
        'CERO O DOS
        If miRsAux!clasifica = 0 Then
            miSQL = miSQL & DBSet(miRsAux!dtoline1, "N") & ",0"
        Else
            miSQL = miSQL & "0," & DBSet(miRsAux!dtoline1, "N")
        End If
        miSQL = miSQL & "," & DBSet(miRsAux!maxdtopar, "N")
        miSQL = miSQL & ")"
        
        If (NumRegElim Mod 50) = 0 Then
            miSQL = Mid(miSQL, 2)
            miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,nombre1,nombre2,importe1,importe2,importe3) VALUES " & miSQL
            conn.Execute miSQL
            miSQL = ""
        End If
            
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    If miSQL <> "" Then
        miSQL = Mid(miSQL, 2)
        miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,nombre1,nombre2,importe1,importe2,importe3) VALUES " & miSQL
        conn.Execute miSQL
    End If
    
    
    
    'Ahora cargaremos tmpcommand
    miSQL = "insert into tmpcommand(codusu,codprove,codfamia,nomprove,nomfamia,importel,rap1,rap2) "
    miSQL = miSQL & " select codusu,campo1,campo2,nombre1,nombre2,importe3,sum(importe1),sum(importe2) from tmpinformes"
    miSQL = miSQL & " WHERE codusu = " & vUsu.codigo & " group by 1,2,3"
    conn.Execute miSQL
    
    If NumRegElim > 0 Then
        CargarDatosFamiliasDtoEnTmp = True
    Else
        MsgBox "Ningun dato generado", vbExclamation
    End If
eCargarDatosFamiliasDtoEnTmp:
    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description
    Set miRsAux = Nothing
End Function



Private Function ComprobacionDtosActiv() As Boolean
Dim Col As Collection
Dim Dif As Currency
Dim RA As ADODB.Recordset
Dim Abre As Boolean

    On Error GoTo eComprobacionDtosActiv
    ComprobacionDtosActiv = False
    
    'tmpgendtos(codusu,codfamia,codmarca,clasifica,dtoline1)
    Label3(27).Caption = "Preparando datos"
    Label3(27).Refresh
    
    conn.Execute "Delete from tmpinformes where codusu = " & vUsu.codigo


    'AHora mezclo las dos
    Label3(27).Caption = "Leyendo clientes "
    Label3(27).Refresh
    
    Set Col = New Collection
    'Cada linea del codclien sera...
    '  codactiv|codcli1,codcli2,codclie3....|
    miSQL = "Select codactiv,codclien from sclien"
    If cadSelect <> "" Then
        codigo = Replace(cadSelect, "{", "(")
        codigo = Replace(codigo, "}", ")")
        miSQL = miSQL & " WHERE " & codigo
    End If
    miSQL = miSQL & " ORDER BY codactiv,codclien"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = ""
    NumRegElim = -1
    While Not miRsAux.EOF
        If NumRegElim <> miRsAux!codactiv Then
            If NumRegElim >= 0 And miSQL <> "" Then
                miSQL = Mid(miSQL, 2)
                miSQL = NumRegElim & "|" & miSQL & "|"
                Col.Add miSQL
                miSQL = ""
            End If
            NumRegElim = miRsAux!codactiv
        End If
        miSQL = miSQL & ", " & miRsAux!codClien
        If Len(miSQL) > 300 Then
            miSQL = Mid(miSQL, 2)
            miSQL = NumRegElim & "|" & miSQL & "|"
            Col.Add miSQL
            miSQL = ""
        End If
        miRsAux.MoveNext
        
    Wend
    miRsAux.Close
    
    If miSQL <> "" Then
        miSQL = Mid(miSQL, 2)
        miSQL = NumRegElim & "|" & miSQL & "|"
        Col.Add miSQL
        miSQL = ""
    End If

    
    
    If Col.Count = 0 Then
        Set Col = Nothing
        MsgBox "No existen datos"
        Exit Function
    End If
    
    'Hare los clientes agrupados por actividad
    Set RA = New ADODB.Recordset
    
    For NumRegElim = 1 To Col.Count
        Screen.MousePointer = vbHourglass
        DoEvents
        miSQL = RecuperaValor(Col.item(NumRegElim), 1)
        Label3(27).Caption = "Actividad:  " & miSQL & "    Reg: " & NumRegElim & " de " & Col.Count
        Label3(27).Refresh
        Abre = False
        If NumRegElim = 1 Then
            Abre = True
        Else
            miSQL = RecuperaValor(Col.item(NumRegElim), 1)
            If Not EsMismaActividad(RA, miSQL) Then Abre = True
        End If
        miSQL = "SELECT sactivdtos.codfamia,sactivdtos.codmarca,dtoline1,codactiv  "
        miSQL = miSQL & " FROM sactivdtos,sfamiadtos,sfamiatipodto  WHERE  sfamiadtos.codfamia=sactivdtos.codfamia "
        miSQL = miSQL & " AND sfamiadtos.clasifica=sactivdtos.clasifica AND"
        miSQL = miSQL & " sfamiatipodto.clasifica=sactivdtos.clasifica "
        miSQL = miSQL & " AND sactivdtos.codactiv=" & RecuperaValor(Col.item(NumRegElim), 1)
        miSQL = miSQL & " ORDER BY codfamia,codmarca   "
        If Abre Then RA.Open miSQL, conn, adOpenKeyset, adLockPessimistic, adCmdText
        
        'AHora veo en sdtofm los dtos para los clientes
        'Es decir vere si los valores de sdtofm para los clientes corresponden con los que hay en sactivdtos
        miSQL = RecuperaValor(Col.item(NumRegElim), 2)
        miSQL = "select codclien,codfamia,codmarca,dtoline1 from sdtofm where codclien in (" & miSQL & ")"
        miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        codigo = ""
        While Not miRsAux.EOF
            'Tengo un cliente, fam, marca. Buscare en RA para ver si encuetro
            BuscarENsactivdtos RA
            
            'En tmpinformes gravare
            'codusu,codigo,campo1,importe1,importe2
            'que seran
            '       codclien,famia,dtoen1,dtoenra
            miSQL = ""
            Dif = 0
            If RA.EOF Then
                miSQL = "NULL"
            Else
                If RA!dtoline1 <> miRsAux!dtoline1 Then
                    miSQL = DBSet(RA!dtoline1, "N")
                    Dif = RA!dtoline1 - miRsAux!dtoline1
                            'Le aplico menos descuentos que el maximo. NO hay problema
                    If Dif > 0 Then
                        Dif = 0
                    Else
                        'Absoluto
                        Dif = Abs(Dif)
                    End If
                End If
            End If
            If miSQL <> "" Then
                miSQL = "(" & vUsu.codigo & "," & miRsAux!codClien & "," & miRsAux!Codfamia & "," & DBSet(miRsAux!dtoline1, "N") & "," & miSQL & "," & DBSet(Dif, "N", "S") & ")"
                codigo = codigo & ", " & miSQL
                If Len(codigo) > 1000 Then
                    codigo = Mid(codigo, 2)
                    miSQL = "INSERT INTO tmpinformes (codusu,codigo1,campo1,importe1,importe2,importe3) VALUES " & codigo
                    conn.Execute miSQL
                    codigo = ""
                End If
            End If
            
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        

        If codigo <> "" Then
            codigo = Mid(codigo, 2)
            miSQL = "INSERT INTO tmpinformes (codusu,codigo1,campo1,importe1,importe2,importe3) VALUES " & codigo
            conn.Execute miSQL
            codigo = ""
        End If
        
        
    Next NumRegElim
    
    DoEvents
    Label3(27).Caption = "Leyendo familia"
    Label3(27).Refresh
    
    
    miSQL = "UPDATE tmpinformes,sfamia SET nombre1=nomfamia where codusu = " & vUsu.codigo & " AND campo1=codfamia"
    conn.Execute miSQL
    
    Label3(27).Caption = "Comprobando tmp"
    Label3(27).Refresh
    miSQL = DevuelveDesdeBD(conAri, "count(*)", "tmpinformes", "codusu", CStr(vUsu.codigo))
    If miSQL = "" Then miSQL = "0"
    If Val(miSQL) = 0 Then
        MsgBox "No existen datos", vbExclamation
    Else
        ComprobacionDtosActiv = True
    End If
    
eComprobacionDtosActiv:
    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description
    Set RA = Nothing
    Set Col = Nothing
End Function

Private Function EsMismaActividad(ByRef R As ADODB.Recordset, Activ As String) As Boolean

    On Error GoTo eEsMismaActividad
    
    EsMismaActividad = False
    R.MoveFirst
    If Val(R!codactiv) <> Val(Activ) Then
        R.Close
    Else
        EsMismaActividad = True
    End If
eEsMismaActividad:
    If Err.Number <> 0 Then Err.Clear
End Function

Private Function BuscarENsactivdtos(ByRef RA1 As ADODB.Recordset)
    
    'De momento solo cruzo con codfamia, si cruzaramos con codmarca tendriamos que hace run bucle
    RA1.Find "codfamia = " & miRsAux!Codfamia, , adSearchForward, 1
    
End Function

Private Sub PrecargaSaldosBanco()
    On Error GoTo eCargaSaldoBanco2
    
   
    If Me.txtAnyo(0).Text = "" Or Me.cboMes(0).ListIndex = -1 Then Exit Sub
    If Me.ListView1(3).ListItems.Count > 0 Then Exit Sub
    Screen.MousePointer = vbHourglass
    Label3(4).Caption = "Precarga saldos banco"
    Label3(4).Refresh
    
    Set miRsAux = New ADODB.Recordset
    CargaSaldoBanco2
    
    
eCargaSaldoBanco2:
    If Err.Number <> 0 Then MuestraError Err.Number, "CargaSaldoBanco2"
    Label3(4).Caption = ""
    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
End Sub


Private Sub CargaEnPrevisonBancos()
Dim i As Integer


    FijaFechaIni
    For i = 1 To ListView1(3).ListItems.Count
            miSQL = "INSERT INTO tmpprevision(codusu,anyo,mes,quincena,tipo,cobro,pago,descripcion) VALUES (" & vUsu.codigo & ","
            miSQL = miSQL & Year(FI) & "," & Month(FI) & ","
            'El orden va en la quincena
            miSQL = miSQL & i
            miSQL = miSQL & ",998," & DBSet(ListView1(3).ListItems(i).SubItems(2), "N") & ",null," & DBSet(ListView1(3).ListItems(i).SubItems(1), "T") & ")"
            conn.Execute miSQL
    Next i
End Sub



Private Sub PonerIncidencias()
Dim IT As ListItem
 'Los usuarios
    'Label3(19).Caption = miRsAux.Fields(0)
    'Label3(19).Refresh

    'QUE HAYAN FACTURADO

    lwInci.ListItems.Clear
    miSQL = "select codincid,nomincid from sincid order by codincid"
    Set miRsAux = New ADODB.Recordset
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = ","
    While Not miRsAux.EOF
        Set IT = Me.lwInci.ListItems.Add()
        miSQL = miSQL & "'" & miRsAux.Fields(0) & "',"
        IT.Text = miRsAux.Fields(0)
        IT.SubItems(1) = miRsAux.Fields(1)
        IT.ToolTipText = "Codigo: " & miRsAux.Fields(0)
        IT.Tag = miRsAux.Fields(0)
        IT.Checked = True
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Set miRsAux = Nothing
    lwInci.Tag = miSQL
    lwInci.SortKey = 1
    lwInci.SortOrder = lvwAscending
    lwInci.Sorted = True
End Sub


Private Sub CargarFamiliasProveedor()
Dim IT As ListItem

    lwFam.ListItems.Clear
    miSQL = "select codfamia,nomfamia from sfamia where codprove=" & Val(txtCodProve(13).Text) & " order by codfamia"
    Set miRsAux = New ADODB.Recordset
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = ","
    While Not miRsAux.EOF
        Set IT = Me.lwFam.ListItems.Add()
        miSQL = miSQL & "'" & miRsAux.Fields(0) & "',"
        IT.Text = miRsAux.Fields(0)
        IT.SubItems(1) = miRsAux.Fields(1)
        IT.ToolTipText = "Codigo: " & miRsAux.Fields(0)
        IT.Tag = miRsAux.Fields(0)
        IT.Checked = True
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Set miRsAux = Nothing

    

End Sub



Private Sub ActualizarFamiProveedor(Familia As Integer)


    On Error GoTo eActualizarFamiProveedor:
    miSQL = "UPDATE sdtofm SET dtoline1=" & DBSet(txtDecimal(3).Text, "N")
    miSQL = miSQL & ", fechadto=" & DBSet(txtFecha(11).Text, "F")
    If Me.cboDtoEsp.ListIndex > 0 Then
        miSQL = miSQL & ", dtoEsp="
        If Me.cboDtoEsp.ListIndex = 1 Then
            miSQL = miSQL & "1"
        Else
            miSQL = miSQL & "0"
        End If
    End If
        
    miSQL = miSQL & " WHERE codfamia = " & Familia
    If cadSelect <> "" Then miSQL = miSQL & " AND " & cadSelect
    conn.Execute miSQL
    
    
    
    
    Exit Sub
eActualizarFamiProveedor:
    MuestraError Err.Number, Err.Description
    Set miRsAux = Nothing
    Set miRsAux = New ADODB.Recordset
End Sub


Private Sub CargaTipoMov()
Dim IT As ListItem

    lwFact.ListItems.Clear
    
    
    miSQL = "SELECT codtipom,nomtipom FROM stipom WHERE codtipom LIKE 'F%'"
    'Para cualquiera menos root
    If (vUsu.codigo Mod 1000) > 0 Then
        miSQL = miSQL & " AND codtipom"
        If Val(vUsu.AlmacenPorDefecto) = vParamAplic.AlmacenB Then
            miSQL = miSQL & " = "
        Else
            miSQL = miSQL & "<>"
        End If
        miSQL = miSQL & "'FAZ'"
    End If
        
    'FTG y FLQ NO SALEN
    miSQL = miSQL & " AND codtipom <> 'FTG' AND codtipom <> 'FLQ'"
    
    Set miRsAux = New ADODB.Recordset
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        Set IT = Me.lwFact.ListItems.Add()
        IT.Text = miRsAux!codtipom
        IT.SubItems(1) = miRsAux!nomtipom
        IT.Checked = True
        

        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Set miRsAux = Nothing
End Sub




Private Function CargarDatosVentasxForpa() As Boolean

On Error GoTo ECargarDatosVentasxForpa
    CargarDatosVentasxForpa = False
    
    Label3(36).Caption = "Prepara datos"
    Label3(36).Refresh
    
    conn.Execute "DELETE FROM tmpinformes WHERE codusu = " & vUsu.codigo
    
    
    miSQL = ""
    For NumRegElim = 1 To Me.lwFact.ListItems.Count
        If Me.lwFact.ListItems(NumRegElim).Checked Then miSQL = miSQL & ", '" & lwFact.ListItems(NumRegElim).Text & "'"
    Next
    codigo = "(" & Mid(miSQL, 2) & ")"
    
    
    'codusu,codigo1,campo1,campo2,nombre1,nombre2,importe1
    miSQL = " select " & vUsu.codigo & ",codclien,codforpa,nomclien,sum(brutofac-if(impdtopp<>0,impdtopp,0)-if(impdtogr<>0,impdtogr,0)) from scafac  WHERE"
    miSQL = miSQL & " codtipom IN " & codigo
    If Me.txtFecha(14).Text <> "" Then miSQL = miSQL & " AND scafac.fecfactu >=" & DBSet(txtFecha(14).Text, "F")
    If Me.txtFecha(15).Text <> "" Then miSQL = miSQL & " AND scafac.fecfactu <=" & DBSet(txtFecha(15).Text, "F")
    
    'Cliente
    If Me.txtCliente(8).Text <> "" Then miSQL = miSQL & " AND scafac.codclien >=" & DBSet(txtCliente(8).Text, "N")
    If Me.txtCliente(9).Text <> "" Then miSQL = miSQL & " AND scafac.codclien <=" & DBSet(txtCliente(9).Text, "N")
    
    
    miSQL = miSQL & " GROUP BY 1,2,3"
    
    
    
    miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,nombre1,importe1) " & miSQL
    conn.Execute miSQL
    

    miSQL = DevuelveDesdeBD(conAri, "count(*)", "tmpinformes", "codusu", CStr(vUsu.codigo))
    If miSQL = "" Then miSQL = "0"
    If Val(miSQL) = 0 Then
        MsgBox "No exiten datos con esos valores", vbExclamation
        Exit Function
    End If
    
    
    'Actualizare los nombres del trajador
    Label3(36).Caption = "Formas de pago"
    Label3(36).Refresh
    miSQL = "Select distinct(campo1) from tmpinformes where codusu = " & vUsu.codigo & " ORDER BY 1"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        Label3(36).Caption = "Forpa: " & miRsAux.Fields(0)
        Label3(36).Refresh
        codigo = "tipforpa"
        miSQL = DevuelveDesdeBD(conAri, "nomforpa", "sforpa", "codforpa", CStr(miRsAux.Fields(0)), "N", codigo)
       
                
        miSQL = "UPDATE tmpinformes SET nombre2 = " & DBSet(miSQL, "T") & ",campo2=" & codigo
        miSQL = miSQL & " WHERE codusu = " & vUsu.codigo & " AND campo1 =" & miRsAux.Fields(0)
        conn.Execute miSQL
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    Label3(36).Caption = "Tipo de pago"
    Label3(36).Refresh
    miSQL = "Select distinct(campo2) from tmpinformes where codusu = " & vUsu.codigo & " ORDER BY 1"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        Label3(36).Caption = "Tipo de pago: " & miRsAux.Fields(0)
        Label3(36).Refresh
        
        miSQL = DevuelveDesdeBD(conAri, "destippa", "stippa", "tipforpa", CStr(miRsAux.Fields(0)))
       
                
        miSQL = "UPDATE tmpinformes SET nombre3 = " & DBSet(miSQL, "T")
        miSQL = miSQL & " WHERE codusu = " & vUsu.codigo & " AND campo2 =" & miRsAux.Fields(0)
        conn.Execute miSQL
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    
    
    
    CargarDatosVentasxForpa = True
ECargarDatosVentasxForpa:
    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description
    
End Function




Private Function RecalculoPrecioMedioPonderado() As Boolean
Dim codArtic As String
Dim existencia As Currency
Dim PrecioMP As Currency
Dim Aux As Currency
Dim YaEstaFijadoPrecio As Boolean


    On Error GoTo eRecalculoPrecioMedioPonderado
    RecalculoPrecioMedioPonderado = False
    
    Label3(41).Caption = "Preparando datos"
    Label3(41).Refresh
    
    conn.Execute "Delete from tmpinformes where codusu = " & vUsu.codigo
    
    Set miRsAux = New ADODB.Recordset
    miSQL = "Select sartic.codartic,preciomp,nomartic,codprove,codfamia,smoval.* from sartic,smoval WHERE " & cadSelect
    miSQL = miSQL & " ORDER BY sartic.codartic,fechamov,horamovi"
    
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    
    codArtic = "@DABIZ"
    CadParam = "INSERT INTO tmpInformes(codusu,codigo1,campo1,campo2,nombre1,nombre2,importeb1,importeb2) VALUES "  'LOS ISNERTS
    cadTitulo = ""
    NumRegElim = 0
    cadNomRPT = ""
    While Not miRsAux.EOF
        If codArtic <> miRsAux!codArtic Then
            Label3(41).Caption = miRsAux!NomArtic
            Label3(41).Refresh
            
            
           ' If miRsAux!codArtic = "106980" Then
            
            If codArtic <> "@DABIZ" Then
                'Metemos en tmp
                If YaEstaFijadoPrecio Then
                    cadNomRPT = cadNomRPT & DBSet(PrecioMP, "N") & ")" 'metemos el calulado
                    cadTitulo = cadTitulo & ", " & cadNomRPT
                
                    If Len(cadTitulo) > 3000 Then
                        'INSERTO TMP
                        cadTitulo = Mid(cadTitulo, 2) 'quito la coma
                        cadTitulo = CadParam & cadTitulo
                        conn.Execute cadTitulo
                        cadTitulo = ""
                    End If
                End If
            End If
            
            YaEstaFijadoPrecio = False
            
            '(codusu,codigo1,campo1,nombre1,nombre2,importeb1,importeb2
            '                 codpro artic   nomart   preciopmp  calculado
            NumRegElim = NumRegElim + 1
            cadNomRPT = "(" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!Codprove & "," & miRsAux!Codfamia & "," & DBSet(miRsAux!codArtic, "T")
            cadNomRPT = cadNomRPT & "," & DBSet(miRsAux!NomArtic, "T") & "," & DBSet(miRsAux!PrecioMP, "N") & ","
            
            
            'NUEVO ARTICULO

            If miRsAux!detamovi = "ALC" Then
                'If miRsAux!Cantidad = 0 Then
                existencia = miRsAux!cantidad
                PrecioMP = miRsAux!impormov / existencia
                YaEstaFijadoPrecio = True
            Else
                'El primer movimiento NO es una venta
                
            End If
        
        
            codArtic = miRsAux!codArtic
        
        Else
            If miRsAux!detamovi = "ALC" Then
                'NO es nuevo. otra linea
                If existencia < 0 Then
                    'No habia nada
                    existencia = existencia + miRsAux!cantidad
                    PrecioMP = miRsAux!impormov / miRsAux!cantidad
    
                
                Else
                    If (existencia + miRsAux!cantidad) <> 0 Then
                        PrecioMP = Round2(((existencia * PrecioMP) + miRsAux!impormov) / (existencia + miRsAux!cantidad), 4)
                        
                    Else
                        '
                    End If
                End If
                YaEstaFijadoPrecio = True
            Else
                'Es otro tipo de moviemiento
                If YaEstaFijadoPrecio Then
                    'Si no esta fijado el precio NO hago nada
                    Aux = miRsAux!cantidad
                    If miRsAux!tipomovi = 0 Then Aux = -Aux
                    existencia = existencia + Aux
                Else
                    
                    
                End If
                
            End If
        
        End If
        
        miRsAux.MoveNext
        
    Wend
    miRsAux.Close
    
    
    If cadNomRPT <> "" Then
        If YaEstaFijadoPrecio Then
            cadNomRPT = cadNomRPT & DBSet(PrecioMP, "N") & ")" 'metemos el calulado
            cadTitulo = cadTitulo & ", " & cadNomRPT
        End If
        
        'INSERTO TMP
        If cadTitulo <> "" Then
            cadTitulo = Mid(cadTitulo, 2) 'quito la coma
            cadTitulo = CadParam & cadTitulo
            conn.Execute cadTitulo
        End If
    End If


    'Ajuste final. Borro los que el precio sea igual
    Label3(41).Caption = "Ajuste datos"
    Label3(41).Refresh
    miSQL = "DELETE from tmpinformes WHERE codusu = " & vUsu.codigo & " AND importeb1 = importeb2 "
    conn.Execute miSQL
    
    miSQL = "Select count(*) from tmpinformes WHERE codusu = " & vUsu.codigo
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then
        If DBLet(miRsAux.Fields(0), "N") > 0 Then RecalculoPrecioMedioPonderado = True
    End If
    miRsAux.Close

eRecalculoPrecioMedioPonderado:
    If Err.Number <> 0 Then MuestraError Err.Number
    Set miRsAux = Nothing
    Label3(41).Caption = ""
End Function



Private Function RecalculoUltimoPrecioCompra() As Boolean
Dim Real As Currency
Dim precioUC As Currency
Dim Aux As Currency



    On Error GoTo eRecalculoUltimoPrecioCompra
    RecalculoUltimoPrecioCompra = False
    
    Label3(46).Caption = "Preparando datos"
    Label3(46).Refresh
    
    conn.Execute "Delete from tmpinformes where codusu = " & vUsu.codigo
    
    Set miRsAux = New ADODB.Recordset
    If Me.optVarios(11).Value Then
        miSQL = "preciost"
    ElseIf Me.optVarios(12).Value Then
        miSQL = "preciomp"
    Else
        miSQL = "preciove"
    End If
    miSQL = "Select " & miSQL & ",sartic.codartic,preciouc,nomartic,codprove,codfamia from sartic WHERE " & cadSelect
    
    miSQL = miSQL & " ORDER BY sartic.codartic"
    
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    
    
    CadParam = "INSERT INTO tmpInformes(codusu,codigo1,campo1,campo2,nombre1,nombre2,importeb1,importeb2) VALUES "  'LOS ISNERTS
    cadTitulo = ""
    NumRegElim = 0
    cadNomRPT = ""
    Aux = ImporteFormateado(Me.txtDecimal(4).Text) / 100
    While Not miRsAux.EOF

            Label3(41).Caption = miRsAux!NomArtic
            Label3(41).Refresh
            
            NumRegElim = NumRegElim + 1
            cadNomRPT = "(" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!Codprove & "," & miRsAux!Codfamia & "," & DBSet(miRsAux!codArtic, "T")
            cadNomRPT = cadNomRPT & "," & DBSet(miRsAux!NomArtic, "T") & "," & DBSet(miRsAux!precioUC, "N") & ","
            
            precioUC = DBLet(miRsAux.Fields(0), "N")
            precioUC = Round2(precioUC * Aux, 2) + DBLet(miRsAux.Fields(0), "N")
            Real = DBLet(miRsAux!precioUC, "N")
            
                
            cadNomRPT = cadNomRPT & DBSet(precioUC, "N") & ")" 'metemos el calulado
            
            If Real <> precioUC Then
                cadTitulo = cadTitulo & ", " & cadNomRPT
        
                If Len(cadTitulo) > 3000 Then
                    'INSERTO TMP
                    cadTitulo = Mid(cadTitulo, 2) 'quito la coma
                    cadTitulo = CadParam & cadTitulo
                    conn.Execute cadTitulo
                    cadTitulo = ""
                End If
            End If
        
   
        
            miRsAux.MoveNext
            
    Wend
    miRsAux.Close
    
   
    If cadTitulo <> "" Then
        cadTitulo = Mid(cadTitulo, 2) 'quito la coma
        cadTitulo = CadParam & cadTitulo
        conn.Execute cadTitulo
    End If



    'Ajuste final. Borro los que el precio sea igual
    Label3(46).Caption = "Ajuste datos stock"
    Label3(46).Refresh
    
    miSQL = "Select nombre1 from tmpinformes where codusu =" & vUsu.codigo
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    cadTitulo = ""
    cadNomRPT = ""
    Aux = 0
    While Not miRsAux.EOF
        cadNomRPT = cadNomRPT & ", " & DBSet(miRsAux!nombre1, "T")
        If Len(cadNomRPT) > 300 Then
            cadTitulo = cadTitulo & cadNomRPT & "|"
            Aux = Aux + 1
            cadNomRPT = ""
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    If cadNomRPT <> "" Then
        cadTitulo = cadTitulo & cadNomRPT & "|"
        Aux = Aux + 1
    End If
    Real = 0
    While cadTitulo <> ""   'tengo empipados grupos de codartics
        DoEvents
        Real = Real + 1
        Label3(46).Caption = "Ajuste stock: " & Val(Real) & " de " & Val(Aux)
        Label3(46).Refresh
    
        NumRegElim = InStr(1, cadTitulo, "|")
        If NumRegElim = 0 Then
            cadTitulo = ""
        Else
            cadNomRPT = Mid(cadTitulo, 1, NumRegElim - 1)
            cadTitulo = Mid(cadTitulo, NumRegElim + 1)
        
            cadNomRPT = "(" & Mid(cadNomRPT, 2) & ")"  'quito la primera coma y parentizo
            
            'Veamos cuantos de ellos tienen stock 0
            cadNomRPT = "select codartic,sum(canstock) from salmac where codartic In " & cadNomRPT & " GROUP BY codartic having sum(canstock)=0"
            miRsAux.Open cadNomRPT, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
            cadNomRPT = ""
            While Not miRsAux.EOF
                cadNomRPT = cadNomRPT & ", " & DBSet(miRsAux.Fields(0), "T")
                miRsAux.MoveNext
            Wend
            miRsAux.Close
            If cadNomRPT <> "" Then
                cadNomRPT = Mid(cadNomRPT, 2) 'quito la coma
                miSQL = "DELETE from tmpinformes WHERE codusu = " & vUsu.codigo & " AND nombre1 in (" & cadNomRPT & ")"
                conn.Execute miSQL
            End If
            
        End If
    Wend
    
    
    
    
    miSQL = "Select count(*) from tmpinformes WHERE codusu = " & vUsu.codigo
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then
        If DBLet(miRsAux.Fields(0), "N") > 0 Then
            RecalculoUltimoPrecioCompra = True
        Else
            MsgBox "No hay datos ", vbExclamation
        End If
    End If
    miRsAux.Close

eRecalculoUltimoPrecioCompra:
    If Err.Number <> 0 Then MuestraError Err.Number
    Set miRsAux = Nothing
    Label3(46).Caption = ""
End Function



Private Sub CargaIconosAyuda()
Dim Ima As Image
    On Error Resume Next 'mejor que no diera errores, pero bien, tampoco vamos a enfadarnos
    For Each Ima In Me.imgayuda
        Ima.Picture = frmPpal.imgListComun.ListImages(46).Picture
    Next
    Err.Clear
End Sub





'******************************************************************************
'******************************************************************************
'******************************************************************************
'
'
'   INFORME VENTAS A CREDITO
'
'
'
'******************************************************************************
'******************************************************************************
'******************************************************************************
Private Function GenerarDatosVentasAcredito() As Boolean
Dim CCl As Collection
Dim Importe As Currency
Dim i As Integer


    On Error GoTo eGenerarDatosVentasAcredito
    GenerarDatosVentasAcredito = False
    
    Label3(48).Caption = "Prepara datos"
    Label3(48).Refresh
    miSQL = "DELETE FROM tmpinformes where codusu = " & vUsu.codigo
    conn.Execute miSQL
    
    
    miSQL = " codtipom <> 'FAZ' "
    If Me.txtFecha(18).Text <> "" Then miSQL = miSQL & " AND scafac.fecfactu >=" & DBSet(txtFecha(18).Text, "F")
    If Me.txtFecha(19).Text <> "" Then miSQL = miSQL & " AND scafac.fecfactu <=" & DBSet(txtFecha(19).Text, "F")
    miSQL = miSQL & " AND tipforpa<>0 and tipforpa<>6"  'quitamos los efectivos y tarjetas
    
    'Cargamos los clientes que vamos a tratar
    Label3(48).Caption = "Carga clientes"
    Label3(48).Refresh
    
    codigo = "select * from sclien where codaseg<>'' and codclien IN ("
    codigo = codigo & " select codclien from scafac,sforpa where scafac.codforpa=sforpa.codforpa AND " & miSQL & ") "

    Set miRsAux = New ADODB.Recordset
    Set CCl = New Collection
    
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        codigo = miRsAux!codClien & "|" & miRsAux!Nomclien & "|" & miRsAux!pobclien & "|" & miRsAux!codpobla & "|" & DBLet(miRsAux!nifClien, "T") & "|"
        CCl.Add codigo
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    

    If CCl.Count = 0 Then
    
        MsgBox "Ningun dato generado", vbExclamation
        GoTo eGenerarDatosVentasAcredito  'la primera vez que pongo un GOTO
        
    End If

   
    
    
    'Vamos cliente a cliente
    'Insertaremos
    '   tmpinformes(codusu,codigo1,nombre1,nombre2,campo1,importe1)
    '                       codclien,nombr,pobl,dias,importe
    
    For NumRegElim = 1 To CCl.Count
        codigo = CCl.item(NumRegElim)
        Label3(48).Caption = RecuperaValor(codigo, 2)
        Label3(48).Refresh
        
        CadParam = RecuperaValor(codigo, 1)
        codigo = "select totalfac,sforpa.* from scafac,sforpa where scafac.codforpa=sforpa.codforpa"
        codigo = codigo & " AND codclien =" & CadParam & " AND " & miSQL & " GROUP BY 1"
        
        CadParam = ""
        miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        While Not miRsAux.EOF

            'tmpinformes(codusu,codigo1,nombre1,nombre2,campo2,nombre3,campo1,importe1)
            If miRsAux!numerove = 1 Then
                'UN unico vencimiento
                'Todo el importe va a la linea
                CadParam = CadParam & ", (" & vUsu.codigo & "," & RecuperaValor(CCl.item(NumRegElim), 1)
                CadParam = CadParam & "," & DBSet(RecuperaValor(CCl.item(NumRegElim), 2), "T")
                CadParam = CadParam & "," & DBSet(RecuperaValor(CCl.item(NumRegElim), 3), "T") 'poblacion
                'codpostal,nif
                CadParam = CadParam & "," & RecuperaValor(CCl.item(NumRegElim), 4) & "," & DBSet(RecuperaValor(CCl.item(NumRegElim), 5), "T")
                CadParam = CadParam & "," & miRsAux!primerve & "," & DBSet(miRsAux!TotalFac, "N") & ")"
            Else
                'MAS DE UN VENCIMIENTO
                Importe = miRsAux!TotalFac / miRsAux!numerove
                
                'Primer vto
                i = miRsAux!primerve
                CadParam = CadParam & ", (" & vUsu.codigo & "," & RecuperaValor(CCl.item(NumRegElim), 1)
                CadParam = CadParam & "," & DBSet(RecuperaValor(CCl.item(NumRegElim), 2), "T")
                CadParam = CadParam & "," & DBSet(RecuperaValor(CCl.item(NumRegElim), 3), "T") 'poblacion
                CadParam = CadParam & "," & RecuperaValor(CCl.item(NumRegElim), 4) & "," & DBSet(RecuperaValor(CCl.item(NumRegElim), 5), "T")
                CadParam = CadParam & "," & i & "," & DBSet(Importe, "N") & ")"
                
                For numParam = 2 To miRsAux!numerove
                    i = i + miRsAux!restoven
                    CadParam = CadParam & ", (" & vUsu.codigo & "," & RecuperaValor(CCl.item(NumRegElim), 1)
                    CadParam = CadParam & "," & DBSet(RecuperaValor(CCl.item(NumRegElim), 2), "T")
                    CadParam = CadParam & "," & DBSet(RecuperaValor(CCl.item(NumRegElim), 3), "T") 'poblacion
                    CadParam = CadParam & "," & RecuperaValor(CCl.item(NumRegElim), 4) & "," & DBSet(RecuperaValor(CCl.item(NumRegElim), 5), "T")
                    CadParam = CadParam & "," & i & "," & DBSet(Importe, "N") & ")"

                Next numParam
            End If
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        
        'INSERTAMOS
        CadParam = Mid(CadParam, 2)
        
        CadParam = "INSERT INTO tmpinformes(codusu,codigo1,nombre1,nombre2,campo2,nombre3,campo1,importe1) VALUES " & CadParam
        conn.Execute CadParam
    Next NumRegElim

    GenerarDatosVentasAcredito = True

eGenerarDatosVentasAcredito:
    If Err.Number <> 0 Then
        MuestraError Err.Number, Err.Description
    End If
    Set CCl = Nothing
    Set miRsAux = Nothing
   
End Function







'******************************************************************************
'******************************************************************************
'******************************************************************************
'
'
'   Disparador punto pedido
'
'
'
'******************************************************************************
'******************************************************************************
'******************************************************************************
Private Function GenerarDatosPuntoPedido() As Boolean
Dim i As Integer

    On Error GoTo eGenerarDatosPuntoPedido
    GenerarDatosPuntoPedido = False
    
    Label3(50).Caption = "Prepara datos"
    Label3(50).Refresh
    miSQL = "DELETE FROM tmpinformes where codusu = " & vUsu.codigo
    conn.Execute miSQL
    
    Set miRsAux = New ADODB.Recordset
    miSQL = "select fechahora,codusu mod 1000 traba1,spedidos.codartic, nomartic,proceso"
    miSQL = miSQL & " from spedidos left join sartic on spedidos.codartic=sartic.codartic"
    codigo = ""
    If Me.txtFecha(20).Text <> "" Then codigo = codigo & " AND fechahora >=" & DBSet(txtFecha(20).Text, "F")
    If Me.txtFecha(21).Text <> "" Then codigo = codigo & " AND fechahora <=" & DBSet(txtFecha(21).Text, "F")
    If codigo <> "" Then
        codigo = Mid(codigo, 5) 'quito el prmier AND
        miSQL = miSQL & " WHERE " & codigo
    End If
    
    codigo = ""
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    NumRegElim = 0
    cadTitulo = "|" 'Aqui ire guardando tuplas |codtraba·nomtraba|
    While Not miRsAux.EOF
        NumRegElim = NumRegElim + 1
        
        
        
        'Proceso: ALM: 1005175  lin1
        'cadSelect = Mid(miRsAux!proceso, 3) 'quito la primera E
        
        
        'codusu,codigo1,campo1,nombre1,nombre2,nombre3,fecha1
        codigo = codigo & ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!traba1
        codigo = codigo & "," & DBSet(miRsAux!codArtic, "T") & "," & DBSet(miRsAux!NomArtic, "T") & ","
        
        miSQL = "|" & miRsAux!traba1 & "·"
        i = InStr(1, cadTitulo, miSQL)
        If i = 0 Then
            miSQL = DevuelveDesdeBD(conAri, "login", "usuarios.usuarios", "codusu", CStr(miRsAux!traba1))
            If miSQL = "" Then
                'No encuientra el login
                miSQL = "Error Login-usuario"
            Else
                miSQL = DevuelveDesdeBD(conAri, "nomtraba", "straba", "login", miSQL, "T")
                If miSQL = "" Then miSQL = "Error login-trabajador"
            End If
            cadNomRPT = miSQL
            
            'Lo meto con el resto
            miSQL = miRsAux!traba1 & "·" & miSQL & "|"
            cadTitulo = cadTitulo & miSQL
        Else
            
            miSQL = Mid(cadTitulo, i + Len(miSQL))
            miSQL = RecuperaValor(miSQL, 1)
            cadNomRPT = miSQL
        End If
        
        codigo = codigo & DBSet(cadNomRPT, "T") & "," & DBSet(miRsAux!fechahora, "F") & ")"
        
        
        If Len(codigo) > 2000 Then
            Label3(50).Caption = "Registros: " & NumRegElim
            Label3(50).Refresh
             codigo = Mid(codigo, 2)
            codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo1,nombre1,nombre2,nombre3,fecha1) VALUES " & codigo
            conn.Execute codigo
            codigo = ""
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    If codigo <> "" Then
        codigo = Mid(codigo, 2)
        codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo1,nombre1,nombre2,nombre3,fecha1) VALUES " & codigo
        conn.Execute codigo
        
    End If
    
    
    'Reestablecer variables
    cadFormula = ""
    cadSelect = ""
    numParam = 0
    cadTitulo = ""
    
    If NumRegElim = 0 Then
        MsgBox "Ningun dato generado", vbExclamation
    Else
        GenerarDatosPuntoPedido = True
        
    End If
    
eGenerarDatosPuntoPedido:
    If Err.Number <> 0 Then MuestraError Err.Number
End Function





'******************************************************************************
'******************************************************************************
'******************************************************************************
'
'
'   STOCK DESDE INVENTARIO
'
'
'
'******************************************************************************
'******************************************************************************
'******************************************************************************
Private Function GenerarDatosStockDesdeInventario(DesdeInventario As Boolean) As Boolean
Dim i As Integer
Dim RN As ADODB.Recordset
Dim StCalculado As Currency
Dim F As Date
Dim Insertar As Boolean

    On Error GoTo eGenerarDatosStockDesdeInventario
    GenerarDatosStockDesdeInventario = False
    
    Label3(53).Caption = "Prepara datos"
    Label3(53).Refresh
    miSQL = "DELETE FROM tmpinformes where codusu = " & vUsu.codigo
    conn.Execute miSQL
    
    
    miSQL = "Select sartic.codartic,codalmac,canstock,nomartic,fechainv,stockinv,codfamia"
    miSQL = miSQL & " from salmac,sartic,sprove where salmac.codartic=sartic.codartic AND ctrstock=1"
    miSQL = miSQL & " AND sartic.codprove = sprove.codprove"
    'Si hay where
    miSQL = miSQL & " AND codalmac =  " & txtAlma(3).Text
    
    If DesdeInventario Then
        miSQL = miSQL & "  AND not fechainv is null"
    Else
        miSQL = miSQL & "  AND canstock < 0"
    End If
    AnyadeDHStcokCalculado
'''    If Me.txtCodProve(20).Text <> "" Then miSQL = miSQL & " AND sartic.codprove >= " & Me.txtCodProve(20).Text
'''    If Me.txtCodProve(21).Text <> "" Then miSQL = miSQL & " AND sartic.codprove <= " & Me.txtCodProve(21).Text
'''    If Me.txtFamia(14).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia >= " & Me.txtFamia(14).Text
'''    If Me.txtFamia(15).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia <= " & Me.txtFamia(15).Text
'''    If Me.txtArticulo(13).Text <> "" Then miSQL = miSQL & " AND sartic.codartic >= '" & Me.txtArticulo(13).Text & "'"
'''    If Me.txtArticulo(14).Text <> "" Then miSQL = miSQL & " AND sartic.codartic <= '" & Me.txtArticulo(14).Text & "'"
'''
'''
    'Tmpinformes
    'codusu,codigo1,campo2,nombre1,nombre2,nombre3,fecha1,importe1,importe2
    '               codfamia codart nomart  nomfam  fecinv  stk     calculado
    Set RN = New ADODB.Recordset
    RN.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    Set miRsAux = New ADODB.Recordset
    codigo = ""
    NumRegElim = 0
    While Not RN.EOF
        Label3(53).Caption = RN!NomArtic
        Label3(53).Refresh
        
        
        
         
        
        
        miSQL = RN!codArtic
        
        
        If DesdeInventario Then
            StCalculado = DBLet(RN!Stockinv, "N")
            If IsNull(RN!FechaINV) Then
                F = "12/04/1972"
            Else
                F = RN!FechaINV
            End If
            
            MoviArticuloDesdeInven StCalculado, F
            
            If StCalculado <> RN!CanStock Then
                Insertar = True
            Else
                Insertar = False
            End If
            
            
        Else
            'Como es negativo
            Insertar = True
        End If
        'codusu,codigo1,campo1,campo2,nombre1,nombre2,nombre3,fecha1,importe1,importe2
        '               codfamia codart nomart  nomfam  fecinv  stk     calculado
        
        If Insertar Then
            'Diferencias entre stcok calculado y el real
            NumRegElim = NumRegElim + 1
            codigo = codigo & ", (" & vUsu.codigo & "," & NumRegElim & "," & RN!Codfamia & ","
            codigo = codigo & DBSet(RN!codArtic, "T") & "," & DBSet(RN!NomArtic, "T") & ",''," & DBSet(RN!FechaINV, "F")
            codigo = codigo & "," & DBSet(RN!CanStock, "N") & "," & DBSet(StCalculado, "N") & ",0)"
            
            
            If Len(codigo) > 50000 Then
                Label3(53).Caption = "Actualizar....."
                Label3(53).Refresh
        
                codigo = Mid(codigo, 2)
                codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo2,nombre1,nombre2,nombre3,fecha1,importe1,importe2,importe3) VALUES " & codigo
                conn.Execute codigo
                codigo = ""
                DoEvents
                Espera 0.2
                
            End If
   
            
            
        End If
        
        
        
        RN.MoveNext
        
        
    Wend
        
    RN.Close
        
   
    
    If codigo <> "" Then
        codigo = Mid(codigo, 2)
        codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo2,nombre1,nombre2,nombre3,fecha1,importe1,importe2,importe3) VALUES " & codigo
        conn.Execute codigo
        
    End If
    
    
    If NumRegElim > 0 Then
        Label3(53).Caption = "Leyendo familias"
        Label3(53).Refresh
        miSQL = "Select campo2 from tmpinformes where codusu = " & vUsu.codigo & " GROUP BY campo2"
        RN.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        While Not RN.EOF
            
            miSQL = DevuelveDesdeBD(conAri, "nomfamia", "sfamia", "codfamia", CStr(RN!campo2))
            Label3(53).Caption = "Familia: " & miSQL
            Label3(53).Refresh
            codigo = "UPDATE tmpinformes SET nombre3 =" & DBSet(miSQL, "T")
            codigo = codigo & " WHERE codusu = " & vUsu.codigo & " AND campo2=" & RN!campo2
            conn.Execute codigo
            RN.MoveNext
        Wend
        RN.Close
    End If
    'Reestablecer variables
    cadFormula = ""
    cadSelect = ""
    numParam = 0
    cadTitulo = ""
    
    If NumRegElim = 0 Then
        MsgBox "Ningun dato generado", vbExclamation
    Else
        GenerarDatosStockDesdeInventario = True
        
    End If
    
eGenerarDatosStockDesdeInventario:
    If Err.Number <> 0 Then MuestraError Err.Number
    Set RN = Nothing
    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
End Function

'Articulo  ---> MiSQL
'FechaInve ---> FI
Private Sub MoviArticuloDesdeInven(ByRef vStock As Currency, Fecha As Date)
Dim cantidad As Currency



    
    cadFormula = "SELECT smoval.codartic, smoval.codalmac, fechamov, horamovi, tipomovi, detamovi, "
    cadFormula = cadFormula & " cantidad,  detamovi"
    'cadFormula = cadFormula & " cantidad,  codigope, letraser, document, numlinea "
    cadFormula = cadFormula & " FROM  smoval WHERE codartic =" & DBSet(miSQL, "T")
    cadFormula = cadFormula & " AND codalmac =" & Me.txtAlma(3).Text
    cadFormula = cadFormula & " AND fechamov > " & DBSet(Fecha, "F")
    cadFormula = cadFormula & " order by Fechamov , horamovi "
    miRsAux.Open cadFormula, conn, adOpenForwardOnly, adLockPessimistic, adCmdText

    While Not miRsAux.EOF
        
        'smoval.tipomovi=0,""S""
        '   0: SALIDA
        '   1: ENTRADA
        cantidad = miRsAux!cantidad
        If miRsAux!tipomovi = 1 Then

            
        Else

            cantidad = -cantidad
        End If
        
        vStock = vStock + cantidad
        
       miRsAux.MoveNext
        
        
    
    Wend
    miRsAux.Close

End Sub


Private Sub AnyadeDHStcokCalculado()
    If Me.txtCodProve(20).Text <> "" Then miSQL = miSQL & " AND sartic.codprove >= " & Me.txtCodProve(20).Text
    If Me.txtCodProve(21).Text <> "" Then miSQL = miSQL & " AND sartic.codprove <= " & Me.txtCodProve(21).Text
    If Me.txtFamia(14).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia >= " & Me.txtFamia(14).Text
    If Me.txtFamia(15).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia <= " & Me.txtFamia(15).Text
    If Me.txtArticulo(13).Text <> "" Then miSQL = miSQL & " AND sartic.codartic >= '" & Me.txtArticulo(13).Text & "'"
    If Me.txtArticulo(14).Text <> "" Then miSQL = miSQL & " AND sartic.codartic <= '" & Me.txtArticulo(14).Text & "'"
End Sub




Private Function VentasPeridoConStock() As Boolean
Dim i As Integer
Dim RN As ADODB.Recordset
Dim StCalculado As Currency
Dim F As Date


    On Error GoTo eGenerarDatosStockDesdeInventario
    VentasPeridoConStock = False
    
    Label3(53).Caption = "Prepara datos"
    Label3(53).Refresh
    miSQL = "DELETE FROM tmpinformes where codusu = " & vUsu.codigo
    conn.Execute miSQL
    
    
    miSQL = "select slifac.codartic,sartic.nomartic,canstock,codfamia,sum(cantidad) ventas from slifac,sartic,salmac "
    miSQL = miSQL & " where ctrstock=1  AND slifac.codartic=sartic.codartic"
    
    'Si hay where
    miSQL = miSQL & " AND salmac.codartic=sartic.codartic  AND slifac.codalmac =  " & txtAlma(3).Text
    
    'Las fechas
    miSQL = miSQL & " and fecfactu>=" & DBSet(txtFecha(22).Text, "F") & " AND fecfactu <= " & DBSet(txtFecha(23).Text, "F")
    
    AnyadeDHStcokCalculado
'''    If Me.txtCodProve(20).Text <> "" Then miSQL = miSQL & " AND sartic.codprove >= " & Me.txtCodProve(20).Text
'''    If Me.txtCodProve(21).Text <> "" Then miSQL = miSQL & " AND sartic.codprove <= " & Me.txtCodProve(21).Text
'''    If Me.txtFamia(14).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia >= " & Me.txtFamia(14).Text
'''    If Me.txtFamia(15).Text <> "" Then miSQL = miSQL & " AND sartic.codfamia <= " & Me.txtFamia(15).Text
'''    If Me.txtArticulo(13).Text <> "" Then miSQL = miSQL & " AND sartic.codartic >= '" & Me.txtArticulo(13).Text & "'"
'''    If Me.txtArticulo(14).Text <> "" Then miSQL = miSQL & " AND sartic.codartic <= '" & Me.txtArticulo(14).Text & "'"
'''
'''
    
    
    miSQL = miSQL & " GROUP BY 1"
    
    
    
    'Tmpinformes
    'codusu,codigo1,campo2,nombre1,nombre2,nombre3,fecha1,importe1,importe2
    '               codfamia codart nomart  nomfam  fecinv  stk     calculado
    Set RN = New ADODB.Recordset
    RN.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    Set miRsAux = New ADODB.Recordset
    codigo = ""
    NumRegElim = 0
    While Not RN.EOF
        Label3(53).Caption = RN!NomArtic
        Label3(53).Refresh
        
        
        
         
        
        
        miSQL = RN!codArtic
        
        
        'codusu,codigo1,campo1,campo2,nombre1,nombre2,nombre3,fecha1,importe1,importe2
        '               codfamia codart nomart  nomfam  fecinv  stk     calculado
        
        
            'Diferencias entre stcok calculado y el real
            NumRegElim = NumRegElim + 1
            codigo = codigo & ", (" & vUsu.codigo & "," & NumRegElim & "," & RN!Codfamia & ","
            codigo = codigo & DBSet(RN!codArtic, "T") & "," & DBSet(RN!NomArtic, "T") & ",'',null"
            codigo = codigo & "," & DBSet(RN!CanStock, "N") & "," & DBSet(RN!Ventas, "N") & ",0)"
            
            
            If Len(codigo) > 50000 Then
                Label3(53).Caption = "Actualizar....."
                Label3(53).Refresh
        
                codigo = Mid(codigo, 2)
                codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo2,nombre1,nombre2,nombre3,fecha1,importe1,importe2,importe3) VALUES " & codigo
                conn.Execute codigo
                codigo = ""
                DoEvents
                Espera 0.2
                
            End If
   
        
        
        
        RN.MoveNext
        
        
    Wend
        
    RN.Close
        
   
    
    If codigo <> "" Then
        codigo = Mid(codigo, 2)
        codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo2,nombre1,nombre2,nombre3,fecha1,importe1,importe2,importe3) VALUES " & codigo
        conn.Execute codigo
        
    End If
    
    
    If NumRegElim > 0 Then
        Label3(53).Caption = "Leyendo familias"
        Label3(53).Refresh
        miSQL = "Select campo2 from tmpinformes where codusu = " & vUsu.codigo & " GROUP BY campo2"
        RN.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        While Not RN.EOF
            
            miSQL = DevuelveDesdeBD(conAri, "nomfamia", "sfamia", "codfamia", CStr(RN!campo2))
            Label3(53).Caption = "Familia: " & miSQL
            Label3(53).Refresh
            codigo = "UPDATE tmpinformes SET nombre3 =" & DBSet(miSQL, "T")
            codigo = codigo & " WHERE codusu = " & vUsu.codigo & " AND campo2=" & RN!campo2
            conn.Execute codigo
            RN.MoveNext
        Wend
        RN.Close
    End If
    'Reestablecer variables
    cadFormula = ""
    cadSelect = ""
    numParam = 0
    cadTitulo = ""
    
    If NumRegElim = 0 Then
        MsgBox "Ningun dato generado", vbExclamation
    Else
        VentasPeridoConStock = True
        
    End If
    
eGenerarDatosStockDesdeInventario:
    If Err.Number <> 0 Then MuestraError Err.Number
    Set RN = Nothing
    Set miRsAux = Nothing
    Screen.MousePointer = vbDefault
End Function



'******************************************************************************
'******************************************************************************
'******************************************************************************
'
'
'   COMUNICACION DATOS ALMAGRUPO
'
'
'
'******************************************************************************
'******************************************************************************
'******************************************************************************



Private Sub ponerPeriodoProximaProcesoAlamgrupo()
    
        
'        FI = CDate(OtrosDatos)
        FI = Now 'hoy
        txtAlmaGrupo(0).Text = Day(FI) & "  " & Format(FI, "mmmm") & " - " & Year(FI)
        txtAlmaGrupo(0).Tag = FI
        CadenaDesdeOtroForm = ""
        OtrosDatos = ""
        
End Sub



'IREMOS MES A MES



Private Sub ponerPeriodoProximaEXPORTACION_Alamgrupo()
        
        'Tiene grabad stoicks
        codigo = DevuelveDesdeBD(conAri, "count(*)", "salmagrupo", "cifproveedor", "S", "T")
        Me.chkVarios(9).Value = 0
        If codigo = "" Then codigo = "0"
        If Val(codigo) > 0 Then Me.chkVarios(9).Value = 1
        
        'Tiene grabad consumos
        codigo = DevuelveDesdeBD(conAri, "count(*)", "salmagrupo", " not cifproveedor", "S", "T")
        Me.chkVarios(9).Value = 0
        If codigo = "" Then codigo = "0"
        If Val(codigo) > 0 Then Me.chkVarios(9).Value = 1
        
        
        
End Sub









'---------------------------  FIN almagrupo



Private Sub CargaIncidenciasFlotas()
Dim IT
    Set miRsAux = New ADODB.Recordset
    ListView1(4).ListItems.Clear
    miSQL = "Select * from sflotasconce ORDER BY nomconcef"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        Set IT = Me.ListView1(4).ListItems.Add()
        IT.Text = miRsAux!nomconcef
        IT.Tag = miRsAux!codconcef
        'It.SubItems(1) = RecuperaValor(ColCtasBa.Item(I), 2)
        'It.SubItems(2) = Format(Impor, FormatoImporte)
        
        IT.Checked = True
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Set miRsAux = Nothing
End Sub


Private Function CargaDatosListadoIncidenciasFlotas() As Boolean

    On Error GoTo eCargaDatosListadoIncidenciasFlotas
    CargaDatosListadoIncidenciasFlotas = False
    
    Label3(56).Caption = "Prepara datos"
    Label3(56).Refresh
    
    conn.Execute "DELETE from tmpinformes where codusu = " & vUsu.codigo
        
        
    miSQL = ""
    codigo = "TODAS"
    For NumRegElim = 1 To Me.ListView1(4).ListItems.Count
        If Me.ListView1(4).ListItems(NumRegElim).Checked Then
            miSQL = miSQL & ", " & ListView1(4).ListItems(NumRegElim).Tag
        Else
            codigo = ""
        End If
    Next
        
    If codigo = "" Then
        codigo = Mid(miSQL, 2) 'quito la 1ª coma
    Else
        codigo = ""  'Para que no lo ponga en el selec. Ha pedido TODAS
    End If
        
    NumRegElim = 0
    
    miSQL = "select fecha,sflotasregistro.codflota,nomflota,nomconcef,baseimp,codprove from sflotasregistro,"
    miSQL = miSQL & " sflotasconce,sflotas  "
    miSQL = miSQL & " Where sflotasregistro.codconcef = sflotasconce.codconcef And sflotas.codflota = sflotasregistro.codflota"
    
    'Algun WHERE mas
    If codigo <> "" Then miSQL = miSQL & " AND sflotasconce.codconcef IN (" & codigo & ")"
    
    
    
    'D/H fecha
    If txtFecha(25).Text <> "" Then miSQL = miSQL & " AND sflotasregistro.fecha >= " & DBSet(txtFecha(25).Text, "F")
    If txtFecha(26).Text <> "" Then miSQL = miSQL & " AND sflotasregistro.fecha <= " & DBSet(txtFecha(26).Text, "F")
        
    'Vehiuclo
    If txtVehiculo(0).Text <> "" Then miSQL = miSQL & " AND sflotasregistro.codflota = " & DBSet(txtVehiculo(0).Text, "T")
    
        
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = ""
    codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo2,nombre1,nombre2,nombre3,importe1,fecha1) VALUES "
    While Not miRsAux.EOF
        
        NumRegElim = NumRegElim + 1
        Label3(56).Caption = NumRegElim & " - " & miRsAux!nomflota
        Label3(56).Refresh
        miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & "," & DBSet(miRsAux!Codprove, "N", "S") & ","
        miSQL = miSQL & DBSet(miRsAux!codflota, "T") & "," & DBSet(miRsAux!nomflota, "T") & ","
        miSQL = miSQL & DBSet(miRsAux!nomconcef, "T") & "," & DBSet(miRsAux!BaseImp, "N") & "," & DBSet(miRsAux!Fecha, "F") & ")"
        
        
        
        If Len(miSQL) > 10000 Then
            miSQL = Mid(miSQL, 2)
            miSQL = codigo & miSQL
            conn.Execute miSQL
            miSQL = ""
            DoEvents
            Me.Refresh
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    

    If miSQL <> "" Then
            miSQL = Mid(miSQL, 2)
            miSQL = codigo & miSQL
            conn.Execute miSQL
            DoEvents
            Me.Refresh
    End If
    
    CargaDatosListadoIncidenciasFlotas = NumRegElim > 0
    
    
eCargaDatosListadoIncidenciasFlotas:
    If Err.Number <> 0 Then MuestraError Err.Number
    
End Function




Private Function GeneraComisionesMes() As Boolean
Dim RT As ADODB.Recordset
Dim i As Integer
Dim Hoy As Date 'pq en las pruebas necesito simular la fecha
Dim Devueltos As Currency
Dim ColAgentes As Collection
Dim J As Integer
Dim Dias As Long
Dim Porcentaje2 As Currency
Dim PonerPdteCobro As Boolean

'LOG
Dim NF As Integer
Dim LogC As String

    On Error GoTo eGeneraComisionesMes
    GeneraComisionesMes = False
    
    'LOG
    NF = FreeFile
    miSQL = App.Path & "\COM" & Format(Now, "yyyymmdd_hhnnss") & ".txt"
    Open miSQL For Output As #NF
    Print #NF, vUsu.Nombre
    Print #NF, "Equipo: " & vUsu.PC
    Print #NF, "Fecha: " & Now
    Print #NF, "PeriTxtComision.Text"
    
    Label3(57).Caption = "Insertando facturas comision"
    Label3(57).Refresh
    
    'NO SE PUEDE REPETIR FECHA
    Hoy = Now
    Porcentaje2 = vParamAplic.PorcenPagoAgentTalPag
    If Porcentaje2 = 0 Then Porcentaje2 = 75
    
    FI = CDate("01" & Format(Me.TxtComision.Text, "/mm/yyyy"))
    FF = CDate(Me.TxtComision.Text)
    
    miSQL = "select " & DBSet(Hoy, "F") & ",codtipom,numfactu,fecfactu,scafac.codforpa,scafac.codagent,"
    miSQL = miSQL & " baseimp1+coalesce(baseimp2,0)+coalesce(baseimp3,0) as totalfac"
    miSQL = miSQL & " ,round(((baseimp1+coalesce(baseimp2,0)+coalesce(baseimp3,0)*comision)/100),2),'" & Format(FI, FormatoFecha) & "',NULL"
    'El talon pagare entra como -1 hasta que tengamos el documento en nuestro poder
    miSQL = miSQL & ",0 situacion,if (tipforpa in (2,3,5),1,0) estalpag ,if (tipforpa in (2,3,5),0,1) pagado, tipforpa"
    miSQL = miSQL & " from scafac,sagent,sforpa where scafac.codagent=sagent.codagent and scafac.codforpa=sforpa.codforpa and"
    miSQL = miSQL & " fecfactu>=" & DBSet(FI, "F") & " and fecfactu <=" & DBSet(FF, "F")
    'Demas selects


    codigo = "INSERT INTO scomisiones(fecha,codtipom,numfactu,fecfactu,codforpa,codagent,totalfac,comision,mesanyo,observa,situacion,tal_pag,pagado,tipforpa)   "
    codigo = codigo & miSQL
    conn.Execute codigo
    
    
    Set RT = New ADODB.Recordset
    
    'Fechas de vto
    Label3(57).Caption = "Fechas vtos"
    Label3(57).Refresh
    miSQL = "select  codtipom,numfactu,fecfactu,min(fecefect) from svenci "
    miSQL = miSQL & " where  fecfactu>=" & DBSet(FI, "F") & " and fecfactu <=" & DBSet(FF, "F")
    miSQL = miSQL & " group by 1,2,3"
    RT.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not RT.EOF
        miSQL = "UPDATE scomisiones set fechavto=" & DBSet(RT.Fields(3), "F")
        miSQL = miSQL & " WHERE codtipom='" & RT!codtipom & "' AND numfactu=" & RT!NumFactu & " AND fecfactu=" & DBSet(RT!FecFactu, "F")
        conn.Execute miSQL
        RT.MoveNext
    Wend
    RT.Close
    
    'TALONES PAGARES DE ESTE PERIODO
    Label3(57).Caption = "Comprobar Talon/pagare ACTUAL"
    Label3(57).Refresh
    Espera 0.5
    'situacion=-1
    miSQL = "Select * from scomisiones where mesanyo=" & DBSet(FI, "F") & "  and tal_pag=1 ORDER BY codtipom"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    CadParam = "" 'codtipom
    cadFormula = "" 'tendre el numserie
    i = 0
    LogC = "TAL/PAG   actual" & vbCrLf & String(40, "=") 'para el log
    While Not miRsAux.EOF
        
        
        If CStr(miRsAux!codtipom) <> CadParam Then
            CadParam = miRsAux!codtipom
            cadFormula = DevuelveDesdeBD(conAri, "letraser", "stipom", "codtipom", CadParam, "T")
        End If
    
    
        miSQL = "Select * from scobro where numserie= '" & cadFormula & "' AND fecfaccl=" & DBSet(miRsAux!FecFactu, "F")
        miSQL = miSQL & " AND codfaccl=" & miRsAux!NumFactu
        RT.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        codigo = "0"  'Si rt.eof signiifca que ya NO esta en la tesoreria. Es decir, ha sido cobrado. Situacion=0
        If Not RT.EOF Then
            
            If RT!Devuelto = 1 Then
                MsgBox "Agente: " & miRsAux!CodAgent & "      Devuelto  TALON/PAGARE el mismo mes!!!!!", vbCritical
                codigo = "1"
    
            Else
                If DBLet(RT!recedocu, "N") = 1 Then
                    'YA ha sido recepcionado
                    codigo = "0"
                Else
                    'ESTA PENDIENTE.
                    'Se dara por cobrado si aun no ha pasado un porcentae de dias para recibirlo
                    Dias = DateDiff("d", RT!fecfaccl, RT!FecVenci)
                    NumRegElim = DateDiff("d", Hoy, RT!FecVenci)
                    'Debug.Print RT!FecVenci
                    'Dias: Dias desde fechafac a fecha vto
                    'Numregelim: dias que quedan para fecha vto
                    
                    If NumRegElim > Dias Then
                        codigo = 0 '"LO doy por cobrado
                        
                    Else
                        If NumRegElim < 0 Then
                            'YA ha vencido y no esta cobrado
                            codigo = ""
                        Else
                            If (NumRegElim \ Dias) * 100 > Porcentaje2 Then
                                'Han pasado ya el procenta de dias para considerarlo como devuelto
                                codigo = "" 'Lo dejo pendiente de cobro
                            Else
                                codigo = "0" 'Lo doy por cobrado
                            End If
                        End If
                    End If
                End If
            End If
            
        End If
        RT.Close


        LogC = LogC & vbCrLf & miRsAux!codtipom & Format(miRsAux!NumFactu, "000000")
        If codigo <> "" Then
        
            miSQL = "UPDATE scomisiones SET situacion = " & codigo
            If codigo = "0" Then miSQL = miSQL & ", pagado= 1"
            miSQL = miSQL & " WHERE codtipom='" & miRsAux!codtipom & "' AND numfactu=" & miRsAux!NumFactu
            miSQL = miSQL & " AND fecfactu = " & DBSet(miRsAux!FecFactu, "F")
            conn.Execute miSQL
            
            'Para el LGO
            If codigo = "0" Then
                LogC = LogC & " cobrado" 'Pendiente de cobbro
            Else
                LogC = LogC & " devuelto" 'Pendiente de cobbro
            End If
        Else
            'Para el LOG
            LogC = LogC & " pendiente" 'Pendiente de cobbro
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Print #NF, LogC
    
    
    
    
    'TALONES PAGARES ANTERIORES
    '-------------------------------------------------------------------------------------------------
    'Los talon/pag anteoriores, que habian sido dado como cobrados, veremos si tenemos que quitarles
    'la marca

    Label3(57).Caption = "Comprobar Talon/pagare anterior "
    Label3(57).Refresh
    LogC = vbCrLf & vbCrLf & "TAL/PAG   anterior" & vbCrLf & String(40, "=") 'para el log
    Espera 0.5
    'situacion=-1
    miSQL = "Select * from scomisiones where mesanyo<" & DBSet(FI, "F") & "   and tal_pag=1"
    miSQL = miSQL & " AND fechavto >=" & DBSet(FI, "F")
    miSQL = miSQL & " ORDER BY codtipom"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    CadParam = "" 'codtipom
    cadFormula = "" 'tendre el numserie
    i = 0
    While Not miRsAux.EOF
        
        
        If CStr(miRsAux!codtipom) <> CadParam Then
            CadParam = miRsAux!codtipom
            cadFormula = DevuelveDesdeBD(conAri, "letraser", "stipom", "codtipom", CadParam, "T")
        End If
    
        
        miSQL = "Select * from scobro where numserie= '" & cadFormula & "' AND fecfaccl=" & DBSet(miRsAux!FecFactu, "F")
        miSQL = miSQL & " AND codfaccl=" & miRsAux!NumFactu
        RT.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        codigo = ""  'Si rt.eof signiifca que ya NO esta en la tesoreria. Es decir, ha sido cobrado. Situacion=0
        If Not RT.EOF Then
            
            If RT!Devuelto = 1 Then
                'MsgBox "Agente: " & miRsAux!codagent & "      Devuelto  TALON/PAGARE el mismo mes!!!!!", vbCritical
                
                'Si NO estaba pagado se lo desmarco, si no lo dejo como esta
                'If Val(miRsAux!pagado) = 0 Then Codigo = "1"
                codigo = "PON"
            Else
                If DBLet(RT!recedocu, "N") = 1 Then
                    'YA ha sido recepcionado
                    If Val(miRsAux!pagado) = 0 Then codigo = "0"
                Else
                   'ESTA PENDIENTE. No lo tocamos
                   'Se dara por cobrado si aun no ha pasado un porcentae de dias para recibirlo
                    Dias = DateDiff("d", RT!fecfaccl, RT!FecVenci)
                    NumRegElim = DateDiff("d", Hoy, RT!FecVenci)
                                       
                    'Dias: Dias desde fechafac a fecha vto
                    'Numregelim: dias desde proceso a fecha vto
 
                    If NumRegElim > Dias Then
                        codigo = 0 '"LO doy por cobrado
                    Else
                        If NumRegElim < 0 Then
                            'YA ha vencido y no esta cobrado
                            codigo = "PON" 'ponerpdte
                        Else
                    
                            If (NumRegElim / Dias) * 100 > Porcentaje2 Then
                                'Han pasado ya el procenta de dias para considerarlo como devuelto
                                'Codigo = "1" 'Lo dejo pendiente de cobro
                                codigo = "PON"
                            Else
                                codigo = "" 'Lo dejo como estaba
                            End If
                        End If
                    End If
                   
                   
                   
                   
                End If
            End If
            
            
        Else
            'Si ya no esta es que HA sido pagado
            If Val(miRsAux!pagado) = 0 Then codigo = "0" 'Ha sido pagado
        End If
        RT.Close


        LogC = LogC & vbCrLf & miRsAux!codtipom & Format(miRsAux!NumFactu, "000000")
        If codigo <> "" Then
            If codigo = "PON" Then
                miSQL = "UPDATE scomisiones SET situacion = 1,mesanyo= " & DBSet(FI, "F")
                miSQL = miSQL & ", pagado=0"
                LogC = LogC & " pendiente"
            Else
                'Antiguo
                miSQL = "UPDATE scomisiones SET situacion = " & codigo & ",mesanyo= " & DBSet(FI, "F")
                If codigo = "0" Then miSQL = miSQL & ", pagado=1"
                LogC = LogC & " cobrado (" & codigo & ")"
            End If
            
            miSQL = miSQL & " WHERE codtipom='" & miRsAux!codtipom & "' AND numfactu=" & miRsAux!NumFactu
            miSQL = miSQL & " AND fecfactu = " & DBSet(miRsAux!FecFactu, "F")
            conn.Execute miSQL
        Else
            LogC = LogC & "    igual"
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Print NF, LogC
    
    
    
    'Sept 2012   [1]
    ' Los CONTADOS si no se pagan, se quitan POR EL TOTAL
    '
    Label3(57).Caption = "Contados del periodo"
    Label3(57).Refresh
    Espera 0.2
    LogC = vbCrLf & vbCrLf & "Contados del periodo" & vbCrLf & String(40, "=") 'para el log
    
    miSQL = "select * from scomisiones where tipforpa=0 AND mesanyo=" & DBSet(FI, "F") & " ORDER BY codtipom"
    
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    CadParam = "" 'codtipom
    cadFormula = "" 'tendre el numserie
    i = 0
    While Not miRsAux.EOF
        
        
        If CStr(miRsAux!codtipom) <> CadParam Then
            CadParam = miRsAux!codtipom
            cadFormula = DevuelveDesdeBD(conAri, "letraser", "stipom", "codtipom", CadParam, "T")
        End If
    
    
        miSQL = "Select * from scobro where numserie= '" & cadFormula & "' AND fecfaccl=" & DBSet(miRsAux!FecFactu, "F")
        miSQL = miSQL & " AND codfaccl=" & miRsAux!NumFactu
        RT.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        codigo = "0"  'Si rt.eof signiifca que ya NO esta en la tesoreria. Es decir, ha sido cobrado. Situacion=0
        If Not RT.EOF Then
            
            
            LogC = LogC & vbCrLf & miRsAux!codtipom & Format(miRsAux!NumFactu, "000000") & "   Pdte"
    
        
        
            miSQL = "UPDATE scomisiones SET situacion = 1 , pagado= 0"
            miSQL = miSQL & " WHERE codtipom='" & miRsAux!codtipom & "' AND numfactu=" & miRsAux!NumFactu
            miSQL = miSQL & " AND fecfactu = " & DBSet(miRsAux!FecFactu, "F")
            conn.Execute miSQL
        
        End If
        RT.Close
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Print #NF, LogC
    
    
    
    Label3(57).Caption = "Contados anterior periodo"
    Label3(57).Refresh
    LogC = vbCrLf & vbCrLf & "Contados anterior" & vbCrLf & String(40, "=") 'para el log
    Espera 0.2
    
    miSQL = "select * from scomisiones where tipforpa=0 AND mesanyo<" & DBSet(FI, "F")
    miSQL = miSQL & " AND mod(situacion,2)=1 " & " ORDER BY codtipom"  '
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    CadParam = "" 'codtipom
    cadFormula = "" 'tendre el numserie
    i = 0
    While Not miRsAux.EOF
        '
        
        If CStr(miRsAux!codtipom) <> CadParam Then
            CadParam = miRsAux!codtipom
            cadFormula = DevuelveDesdeBD(conAri, "letraser", "stipom", "codtipom", CadParam, "T")
        End If
    
    
        miSQL = "Select * from scobro where numserie= '" & cadFormula & "' AND fecfaccl=" & DBSet(miRsAux!FecFactu, "F")
        miSQL = miSQL & " AND codfaccl=" & miRsAux!NumFactu
        RT.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        codigo = "0"  'Si rt.eof signiifca que ya NO esta en la tesoreria. Es decir, ha sido cobrado. Situacion=0
        If RT.EOF Then
            
            
            Debug.Print miRsAux!NumFactu
            LogC = LogC & vbCrLf & miRsAux!codtipom & Format(miRsAux!NumFactu, "000000") & "   Pdte"
        
            miSQL = "UPDATE scomisiones SET situacion = situacion +1 , pagado= 1"
            miSQL = miSQL & " WHERE codtipom='" & miRsAux!codtipom & "' AND numfactu=" & miRsAux!NumFactu
            miSQL = miSQL & " AND fecfactu = " & DBSet(miRsAux!FecFactu, "F")
            conn.Execute miSQL
        
        End If
        RT.Close
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Print #NF, LogC
    'Sept 2012   [1] FIN
    
    
    
    'Ahora veremos si hay devueltos
    Label3(57).Caption = "Comprobar impagados anterior"
    Label3(57).Refresh
    LogC = vbCrLf & vbCrLf & "Impagados" & vbCrLf & String(40, "=") 'para el log
    NumRegElim = 0
    codigo = " from scobro where devuelto=1 AND fecfaccl>=" & DBSet(InicioComisionesHerbelca, "F")
    miSQL = "Select count(*)" & codigo
    
    miRsAux.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then NumRegElim = DBLet(miRsAux.Fields(0), "N")
    miRsAux.Close
    
    
    
        
    
    miSQL = "Select numserie,codfaccl,fecfaccl,numorden,fecvenci,impvenci,impcobro,fecultco,gastos" & codigo
    miSQL = miSQL & " ORDER  BY numserie,codfaccl"
    miRsAux.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
    
    'cadFormula  cadParam
    CadParam = "" 'tendre LA LETRA
    cadFormula = "" 'tendre el codtipom
    
    i = 0
    While Not miRsAux.EOF
        i = i + 1
        Label3(57).Caption = i & " de " & NumRegElim
        Label3(57).Refresh
        
        If CStr(miRsAux!numSerie) <> CadParam Then
            CadParam = miRsAux!numSerie
            cadFormula = DevuelveDesdeBD(conAri, "codtipom", "stipom", "letraser", CadParam, "T")
        End If
        'Comprobaremos si la situacion  no es devuelta
        miSQL = "Select * from scomisiones where codtipom='" & cadFormula & "' AND numfactu=" & miRsAux!Codfaccl
        miSQL = miSQL & " AND fecfactu = " & DBSet(miRsAux!fecfaccl, "F") & " AND mesanyo<=" & DBSet(FI, "F")
        RT.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        If Not RT.EOF Then
        
            LogC = LogC & vbCrLf & cadFormula & Format(miRsAux!Codfaccl, "000000") & "   Pdte"
        
            If (RT!Situacion Mod 2) = 1 Then
                'YA ESTABA marcado como devuelto
                LogC = LogC & "   YA marcado"
            Else
                LogC = LogC & "   Marcar"
                
                'Lo marcaremos
                miSQL = "UPDATE scomisiones SET situacion=situacion +1,mesanyo= " & DBSet(FI, "F")
                'loS contatdos pondremos pagado=0
                If RT!tipforpa = 0 Then miSQL = miSQL & " ,pagado =0"
                
                miSQL = miSQL & " WHERE codtipom='" & cadFormula & "' AND numfactu=" & miRsAux!Codfaccl
                miSQL = miSQL & " AND fecfactu = " & DBSet(miRsAux!fecfaccl, "F")
                conn.Execute miSQL
            End If
        End If
        RT.Close
        
        
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Print #NF, LogC
    
    'Ahora veremos si
    Label3(57).Caption = "Comprobar vueltos a girar"
    Label3(57).Refresh
     LogC = vbCrLf & vbCrLf & "Vueltos a girar" & vbCrLf & String(40, "=") 'para el log
    'Cogerenmos todos los campos que situacion sea impar y ultmesanyo menor que ahora y veremos si se le ha quitado
    'la marca de devueltos a impar y ult. movimiento menor que la fecha de trabajo
    miSQL = "from scomisiones where mesanyo<" & DBSet(FI, "F") & "  and mod(situacion,2)=1 AND tal_pag=0 AND tipforpa>0"
    NumRegElim = 0
    miRsAux.Open "Select count(*) " & miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then NumRegElim = DBLet(miRsAux.Fields(0), "N")
    miRsAux.Close
    
    miSQL = "Select * " & miSQL
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    'cadFormula  cadParam
    CadParam = "" 'codtipom
    cadFormula = "" 'tendre el numserie
    i = 0
    While Not miRsAux.EOF
        i = i + 1
        Label3(57).Caption = i & " de " & NumRegElim
        Label3(57).Refresh
        
        If CStr(miRsAux!codtipom) <> CadParam Then
            CadParam = miRsAux!codtipom
            cadFormula = DevuelveDesdeBD(conAri, "letraser", "stipom", "codtipom", CadParam, "T")
        End If
    
    
        miSQL = "Select * from scobro where numserie= '" & cadFormula & "' AND fecfaccl=" & DBSet(miRsAux!FecFactu, "F")
        miSQL = miSQL & " AND codfaccl=" & miRsAux!NumFactu
        RT.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
        codigo = "1"  'Si rt.eof signiifca que ya NO esta en la tesoreria. Es decir, ha sido cobrado
        If Not RT.EOF Then
            If RT!Devuelto = 0 Then
                codigo = "2"
    
            Else
                codigo = "NO"
    
            End If
            
        End If
        RT.Close
        LogC = LogC & vbCrLf & miRsAux!codtipom & Format(miRsAux!NumFactu, "000000") & "   Pdte"
        If codigo = "NO" Then
            'Esta devuelto NO lo toco
            LogC = LogC & "   Esta devuelto. No lo tocamos"
        Else
                miSQL = "UPDATE scomisiones SET situacion=situacion +1,mesanyo= " & DBSet(FI, "F")
                'Por si no estaban pagados Los vuelvo a poner aqui
                miSQL = miSQL & ",pagado =1"
                miSQL = miSQL & " WHERE codtipom='" & miRsAux!codtipom & "' AND numfactu=" & miRsAux!NumFactu
                miSQL = miSQL & " AND fecfactu = " & DBSet(miRsAux!FecFactu, "F")
                conn.Execute miSQL
                
                If codigo = "1" Then
                    LogC = LogC & "   YA no esta"
                Else
                    LogC = LogC & "   Sin marca devuelto"
                End If
        End If
        
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Print #NF, LogC
    
    
    
    
    
    
    
    Print #NF, "*********** FIN **************"
    Close #NF
    
    
    
    
    'Ahora guardaremos los datos en una tabla para poder reimprimir, saber que se genero en cada momento...
    'Las tablas son;
    '
    ' Cabcera: insert into `scomisionhco` (`codigo`,`fecha`,`codagent`,`facturado`,`comision`,NumVentas )
    ' Lineas   insert into `scomisionhcol` (`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`)
    '           suma: indcara si el vto se suma o no
    
    miSQL = DevuelveDesdeBD(conAri, "max(codigo)", "scomisionhco", "1", "1")
    NumRegElim = Val(miSQL)
    
    
    'Metemos los agentes que vamos a tratar
    Set ColAgentes = New Collection
    
    Label3(57).Caption = "Prepara datos agentes"
    Label3(57).Refresh
    
    miSQL = "DELETE FROM tmpstockfec WHERE codusu = " & vUsu.codigo
    conn.Execute miSQL
    
    
    miSQL = "INSERT INTO tmpstockfec(codusu,codartic,codalmac,stock)"
    miSQL = miSQL & " SELECT " & vUsu.codigo & ",'',codagent,0 FROM scomisiones where"
    miSQL = miSQL & " fecha=" & DBSet(Hoy, "F")
    miSQL = miSQL & " GROUP BY codagent"
    conn.Execute miSQL
    
    miSQL = "INSERT IGNORE INTO tmpstockfec(codusu,codartic,codalmac,stock)"
    miSQL = miSQL & " SELECT " & vUsu.codigo & ",'',codagent,0 FROM scomisiones where"
    miSQL = miSQL & "  mesanyo=" & DBSet(FI, "F")
    miSQL = miSQL & " GROUP BY codagent"
    conn.Execute miSQL
    
    
    miSQL = "Select * from tmpstockfec WHERE codusu = " & vUsu.codigo
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        ColAgentes.Add CStr(miRsAux!codAlmac)
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    
    For J = 1 To ColAgentes.Count
            Label3(57).Caption = J & " de " & ColAgentes.Count
            Label3(57).Refresh
    
            'If ColAgentes.Item(J) = "3" Then
            
            miSQL = "select sum(totalfac) facturado,sum(comision) comision,count(*) NumVentas from scomisiones where"
            miSQL = miSQL & " fecha=" & DBSet(Hoy, "F")    '& " AND situacion = 0"
            miSQL = miSQL & " AND codagent = " & ColAgentes.item(J)
            miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
            
            NumRegElim = NumRegElim + 1
            Devueltos = 0
            i = 0
            If Not miRsAux.EOF Then
                
                '(`codigo`,`fecha`,`codagent`,`facturado`,`comision`)
                miSQL = "(" & NumRegElim & "," & DBSet(FI, "F") & "," & ColAgentes.item(J) & ","
                miSQL = miSQL & DBSet(DBLet(miRsAux!facturado, "N"), "N") & "," & DBSet(DBLet(miRsAux!Comision, "N"), "N") & "," & DBSet(DBLet(miRsAux!NumVentas, "N"), "N") & ")"
            Else
                miSQL = "(" & NumRegElim & "," & DBSet(FI, "F") & "," & ColAgentes.item(J) & ","
                miSQL = miSQL & DBSet(0, "N") & "," & DBSet(0, "N") & "," & DBSet(0, "N") & ")"
            End If
            miRsAux.Close
            
            miSQL = "insert into `scomisionhco` (`codigo`,`fecha`,`codagent`,`facturado`,`comision`,NumVentas ) VALUES " & miSQL
            conn.Execute miSQL

            
                'AND codtipom<>'FRT'   Octubre 2012.  Se lo he añadido a todos los select de abajo
                '       las rectificativas NO entran en estas sumas(restas)
                
            
                'Suma de las lineas:
                '   0.-  Devoluciones anteriores
                '   1.-  Vuelto a girar
                '   2.-  TAL/PAG de este peridodo
        
                '
                'Restaremos las facturas que NO se han cobrado todavia por ser TALON/PAGARE/CONFIR
                miSQL = "Select * FROM scomisiones WHERE situacion=0 AND mesanyo=" & DBSet(FI, "F") & " AND tal_pag=1 AND pagado=0"
                miSQL = miSQL & " AND codagent=" & ColAgentes.item(J)
                miSQL = miSQL & " AND codtipom<>'FRT'"
                
                RT.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
                miSQL = ""
                While Not RT.EOF
                    i = i + 1
                    '(`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`)
                    miSQL = miSQL & ", (" & NumRegElim & "," & DBSet(FI, "F") & "," & i & ",'" & RT!codtipom & "'," & RT!NumFactu
                    miSQL = miSQL & "," & DBSet(RT!FecFactu, "F") & "," & DBSet(RT!Comision, "N") & ",2" 'resta
                    AñadeEnComisionesCodclienNomclien RT
                    Devueltos = Devueltos + DBLet(RT!Comision, "N")
                    RT.MoveNext
                Wend
                RT.Close
                If miSQL <> "" Then
                    'insert into `scomisionhcol` (`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`)
                    miSQL = Mid(miSQL, 2)
                    miSQL = "insert into `scomisionhcol` (`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`,codclien,nomclien,fechavto) VALUES " & miSQL
                    conn.Execute miSQL
                End If
            
            
                'Sumaremos los talones de otros periodos que se han cobrado en este
                miSQL = "Select * FROM scomisiones WHERE  mesanyo=" & DBSet(FI, "F")
                miSQL = miSQL & " AND situacion=0 AND tal_pag=1 AND pagado=1 AND codagent=" & ColAgentes.item(J)
                miSQL = miSQL & " AND fecha<" & DBSet(Hoy, "F")
                miSQL = miSQL & " AND codtipom<>'FRT'"
                RT.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
                miSQL = ""
                While Not RT.EOF
                    i = i + 1
                    '(`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`)
                    miSQL = miSQL & ", (" & NumRegElim & "," & DBSet(FI, "F") & "," & i & ",'" & RT!codtipom & "'," & RT!NumFactu
                    miSQL = miSQL & "," & DBSet(RT!FecFactu, "F") & "," & DBSet(RT!Comision, "N") & ",3" '
                    AñadeEnComisionesCodclienNomclien RT
                    Devueltos = Devueltos - DBLet(RT!Comision, "N")
                    RT.MoveNext
                Wend
                RT.Close
                If miSQL <> "" Then
                    'insert into `scomisionhcol` (`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`)
                    miSQL = Mid(miSQL, 2)
                    miSQL = "insert into `scomisionhcol` (`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`,codclien,nomclien,fechavto) VALUES " & miSQL
                    conn.Execute miSQL
                End If
    
                
                '--------------------------------------------
                'Veremos las lineas de devueltos.....
                miSQL = "Select * FROM scomisiones WHERE mod(situacion,2)=1 AND mesanyo=" & DBSet(FI, "F")
                'SEPT 2012 Añado tipforpa >0 para los devueltos de forma de pago que no sea y quito fecha<hoy
                miSQL = miSQL & " AND tipforpa >0 AND pagado=1 AND codagent=" & ColAgentes.item(J)
                miSQL = miSQL & " AND  codagent=" & ColAgentes.item(J)
                miSQL = miSQL & " AND codtipom<>'FRT'"
                'miSQL = miSQL & " AND fecha<" & DBSet(Hoy, "F") & " AND pagado=1 AND codagent=" & ColAgentes.item(J)
                RT.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
                miSQL = ""
                While Not RT.EOF
                    i = i + 1
                    '(`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`)
                    miSQL = miSQL & ", (" & NumRegElim & "," & DBSet(FI, "F") & "," & i & ",'" & RT!codtipom & "'," & RT!NumFactu
                    miSQL = miSQL & "," & DBSet(RT!FecFactu, "F") & "," & DBSet(RT!Comision, "N") & ",0" 'resta
                    AñadeEnComisionesCodclienNomclien RT
                    Devueltos = Devueltos + DBLet(RT!Comision, "N")
                    RT.MoveNext
                Wend
                RT.Close
                
                If miSQL <> "" Then
                    'insert into `scomisionhcol` (`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`)
                    miSQL = Mid(miSQL, 2)
                    miSQL = "insert into `scomisionhcol` (`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`,codclien,nomclien,fechavto) VALUES " & miSQL
                    conn.Execute miSQL
                End If
            
            
            
            
                'Veremos los "re-girados". Fueron devueltos y se han vuelto a girar este periodo
                'Sep 2012. Añado tipforpa
                miSQL = "Select * FROM scomisiones WHERE situacion>0 and mod(situacion,2)=0 AND mesanyo=" & DBSet(FI, "F")
                miSQL = miSQL & " AND tipforpa >0 AND fecha<" & DBSet(Hoy, "F") & " AND codagent=" & ColAgentes.item(J)
                miSQL = miSQL & " AND codtipom<>'FRT'"
                RT.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
                miSQL = ""
                While Not RT.EOF
                    i = i + 1
                    '(`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`)
                    miSQL = miSQL & ", (" & NumRegElim & "," & DBSet(FI, "F") & "," & i & ",'" & RT!codtipom & "'," & RT!NumFactu
                    miSQL = miSQL & "," & DBSet(RT!FecFactu, "F") & "," & DBSet(RT!Comision, "N") & ",1" 'se sumara a la cabecera
                    AñadeEnComisionesCodclienNomclien RT
                    Devueltos = Devueltos - DBLet(RT!Comision, "N")
                    RT.MoveNext
                Wend
                RT.Close
                If miSQL <> "" Then
                    
                    miSQL = Mid(miSQL, 2)
                    miSQL = "insert into `scomisionhcol` (`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`,codclien,nomclien,fechavto) VALUES " & miSQL
                    conn.Execute miSQL
                End If
                
                
                         
                'CONTADOS**************************   VAN POR EL TOTAL   **** [2]
                'Sep 2012
                'MEteremos los VTOS de contado que no se han pagado de este periodo
                                
                miSQL = "Select * FROM scomisiones WHERE  mesanyo=" & DBSet(FI, "F")
                miSQL = miSQL & " AND situacion >0 and mod(situacion,2)=1 AND tipforpa=0  AND codagent=" & ColAgentes.item(J)
                miSQL = miSQL & " AND fecha=" & DBSet(Hoy, "F")
                miSQL = miSQL & " AND codtipom<>'FRT'"
                RT.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
                miSQL = ""
                While Not RT.EOF
                    i = i + 1
                    '(`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`)
                    miSQL = miSQL & ", (" & NumRegElim & "," & DBSet(FI, "F") & "," & i & ",'" & RT!codtipom & "'," & RT!NumFactu
                    miSQL = miSQL & "," & DBSet(RT!FecFactu, "F") & "," & DBSet(RT!TotalFac, "N") & ",4" '
                    AñadeEnComisionesCodclienNomclien RT
                    Devueltos = Devueltos + DBLet(RT!TotalFac, "N")
                    RT.MoveNext
                Wend
                RT.Close
                If miSQL <> "" Then
                    'insert into `scomisionhcol` (`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`)
                    miSQL = Mid(miSQL, 2)
                    miSQL = "insert into `scomisionhcol` (`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`,codclien,nomclien,fechavto) VALUES " & miSQL
                    conn.Execute miSQL
                End If
                            
                'Contados anterirores que se restaron, que ahora se suman
                miSQL = "Select * FROM scomisiones WHERE  mesanyo=" & DBSet(FI, "F")
                miSQL = miSQL & " AND mod(situacion,2)=0"
                miSQL = miSQL & " AND tipforpa=0 and pagado=1 AND codagent=" & ColAgentes.item(J)
                miSQL = miSQL & " AND fecha<" & DBSet(Hoy, "F")
                miSQL = miSQL & " AND codtipom<>'FRT'"
                RT.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
                miSQL = ""
                While Not RT.EOF
                    i = i + 1
                    '(`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`)
                    miSQL = miSQL & ", (" & NumRegElim & "," & DBSet(FI, "F") & "," & i & ",'" & RT!codtipom & "'," & RT!NumFactu
                    miSQL = miSQL & "," & DBSet(RT!FecFactu, "F") & "," & DBSet(RT!TotalFac, "N") & ",5" '
                    AñadeEnComisionesCodclienNomclien RT
                    Devueltos = Devueltos - DBLet(RT!TotalFac, "N")
                    RT.MoveNext
                Wend
                RT.Close
                If miSQL <> "" Then
                    'insert into `scomisionhcol` (`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`)
                    miSQL = Mid(miSQL, 2)
                    miSQL = "insert into `scomisionhcol` (`codigo`,`fecha`,`linea`,`codtipom`,`numfactu`,`fecfactu`,`comision`,`suma`,codclien,nomclien,fechavto) VALUES " & miSQL
                    conn.Execute miSQL
                End If
                
                
                
                
                
                
                
                
            
            
            
        
            
            
            
            
            
            
            
            
            
            
            
            
            
            
                If Devueltos <> 0 Then
                    Espera 0.2
                    miSQL = "UPDATE scomisionhco SET devueltos=" & DBSet(Devueltos, "N") & " WHERE codigo =" & NumRegElim
                    conn.Execute miSQL
                End If
            
            
      
            
            
    Next J
    
    
    GeneraComisionesMes = True
    
    
eGeneraComisionesMes:
    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description
    Set RT = Nothing
    Set ColAgentes = Nothing
End Function

'Llevara un RS en lazando a la tabla comisiones
Private Function AñadeEnComisionesCodclienNomclien(ByRef RS As ADODB.Recordset) As String
Dim RB As ADODB.Recordset
Dim Aux As String

    Aux = "scafac.codtipom = " & DBSet(RS!codtipom, "T") & " AND scafac.fecfactu = " & DBSet(RS!FecFactu, "F") & " AND scafac.numfactu=" & RS!NumFactu
    'Agosto 2012
    'Añadimos la fecha de vto
    Aux = "scafac.codtipom=svenci.codtipom   and scafac.numfactu=svenci.numfactu and scafac.fecfactu =svenci.fecfactu WHERE " & Aux
    Aux = "Select codclien,nomclien,fecefect  FROM scafac left join svenci on " & Aux
    Set RB = New ADODB.Recordset
    
    RB.Open Aux, conn, adOpenForwardOnly, adLockOptimistic, adCmdText
    Aux = ",0,'',NULL"
    If Not RB.EOF Then
        If Not IsNull(RB.Fields(0)) Then
            Aux = "," & RB!codClien & "," & DBSet(RB!Nomclien, "T") & ","
            If IsNull(RB!fecefect) Then
                Aux = Aux & "NULL"
            Else
                Aux = Aux & DBSet(RB!fecefect, "F")
            End If
        End If
        
    End If
    RB.Close
    Set RB = Nothing

    miSQL = miSQL & Aux & ")"   'esto lo añade
    
End Function

Private Sub txtVehiculo_GotFocus(Index As Integer)
    ConseguirFoco txtFecha(Index), 3
End Sub

Private Sub txtVehiculo_KeyPress(Index As Integer, KeyAscii As Integer)
    KEYpressGnral KeyAscii, 2, True
End Sub

Private Sub txtVehiculo_LostFocus(Index As Integer)
    miSQL = ""
    txtVehiculo(Index).Text = Trim(txtVehiculo(Index).Text)
    If txtVehiculo(Index).Text <> "" Then
            miSQL = DevuelveDesdeBD(conAri, "nomflota", "sflotas", "codflota", txtVehiculo(Index).Text, "T")
            If miSQL = "" Then MsgBox "No existe el vehiculo: " & txtVehiculo(Index).Text, vbExclamation
    End If
    Me.txtDescVehiculo(Index).Text = miSQL
    miSQL = ""
End Sub


Private Sub GenerarDescuentosProveedor(ByVal Actualizar As Boolean)
Dim C As Collection


        
    Label3(16).Caption = "Preparando datos" 'indicador
    Label3(16).Refresh
    'Como NO tienen clvae primaria tenemos que borrar los registros
    miSQL = "Select * from sprove WHERE 1=1"
    If cadSelect <> "" Then miSQL = miSQL & cadSelect
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    Set C = New Collection
    While Not miRsAux.EOF
        C.Add CStr(miRsAux!Codprove) & "|" & miRsAux!nomprove & "|"
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    
    'Preparamos los inserts/updates
    miSQL = "Insert into sdtomp(codprove,codfamia,codmarca,fechadto,dtoline1,dtoline2,rap1,rap2) VALUES ("
    
    codigo = "," & Me.txtFamia(16).Text & "," & DBSet(Me.txtmarca(0).Text, "N", "S") & "," & DBSet(Me.txtFecha(29).Text, "F")
    codigo = codigo & "," & DBSet(Me.txtDecimal(5).Text, "N", "S") & "," & DBSet(Me.txtDecimal(6).Text, "N", "S")
    codigo = codigo & "," & DBSet(Me.txtDecimal(7).Text, "N", "S") & "," & DBSet(Me.txtDecimal(8).Text, "N", "S") & ")"
    
    
     
    CadParam = "UPDATE sdtomp SET dtoline1=" & DBSet(Me.txtDecimal(5).Text, "N", "N")
    CadParam = CadParam & ", dtoline2=" & DBSet(Me.txtDecimal(6).Text, "N", "S")
    CadParam = CadParam & ", rap1=" & DBSet(Me.txtDecimal(7).Text, "N", "S")
    CadParam = CadParam & ", Rap2=" & DBSet(Me.txtDecimal(8).Text, "N", "S")
    CadParam = CadParam & ", fechadto=" & DBSet(Me.txtFecha(29).Text, "F")
    CadParam = CadParam & " WHERE codfamia = " & txtFamia(16).Text & " AND codmarca "
    If txtmarca(0).Text = "" Then
        CadParam = CadParam & " is null"
    Else
        CadParam = CadParam & " = " & txtmarca(0).Text
    End If
    CadParam = CadParam & " AND codprove = "
    
    
    'Para el select de la dtopm
    cadFormula = "Select * from sdtomp WHERE codfamia = " & Me.txtFamia(16).Text & " AND codmarca "
    If txtmarca(0).Text = "" Then
        cadFormula = cadFormula & " is null"
    Else
        cadFormula = cadFormula & " = " & txtmarca(0).Text
    End If
    cadFormula = cadFormula & " AND codprove = "
    
    
    
    For NumRegElim = 1 To C.Count
        Label3(16).Caption = RecuperaValor(C.item(NumRegElim), 2) & " (" & NumRegElim & "/" & C.Count & ")"
        Label3(16).Refresh
        
        cadNomRPT = RecuperaValor(C.item(NumRegElim), 1)
        cadTitulo = cadFormula & cadNomRPT
        miRsAux.Open cadTitulo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        cadTitulo = ""
        If Not miRsAux.EOF Then
            'Ya existe
            If Actualizar Then cadTitulo = CadParam & cadNomRPT
                
        Else
            'No existe. Lo creamos
            'Montamos el insert
            cadTitulo = miSQL & cadNomRPT & codigo
        End If
        miRsAux.Close
        
        If cadTitulo <> "" Then conn.Execute cadTitulo
        
    Next
     
    Set C = Nothing

    'Para que carge los decuentos recien creados
    CadenaDesdeOtroForm = " Codfamia = " & Me.txtFamia(16).Text
    If cadSelect <> "" Then CadenaDesdeOtroForm = CadenaDesdeOtroForm & cadSelect

End Sub




'*******************************************************************************************
'*******************************************************************************************
'*******************************************************************************************
'
'   Articulos con dto especial.
'
'*******************************************************************************************
'*******************************************************************************************
'*******************************************************************************************
Private Function GeneraDatosDotEspecial() As Boolean

Dim J As Integer
Dim ColCli As Collection


    On Error GoTo EGeneraDatosPromociones
    GeneraDatosDotEspecial = False
    

    'Leer gastos fijos
    Label3(10).Caption = "Leyendo datos dtoesp"
    Label3(10).Refresh
    
    'Lo metere en : tmpnseries
    miSQL = "DELETE FROM tmpinformes where codusu =" & vUsu.codigo
    conn.Execute miSQL
    
   ' sdtofm dtoEsp

    miSQL = " select codclien,codfamia  from sdtofm where dtoesp=1 "
    'Enero 2013. Fecha dto <= fecha hasta
    'miSQL = miSQL & " and fechadto>=" & DBSet(txtFecha(30).Text, "F")
    miSQL = miSQL & " and fechadto<=" & DBSet(txtFecha(31).Text, "F")
    
    'Si ha puesto desde hasta familia
    If Me.txtFamia(0).Text <> "" Then miSQL = miSQL & " AND sdtofm.codfamia >= " & Me.txtFamia(0).Text
    If Me.txtFamia(1).Text <> "" Then miSQL = miSQL & " AND sdtofm.codfamia <= " & Me.txtFamia(1).Text
    
    If Me.txtCliente(12).Text <> "" Then miSQL = miSQL & " AND codClien >= " & Me.txtCliente(12).Text
    If Me.txtCliente(13).Text <> "" Then miSQL = miSQL & " AND codClien <= " & Me.txtCliente(13).Text
    miSQL = miSQL & " AND sdtofm.codfamia>=0"
    
    miSQL = miSQL & " ORDER BY codclien,codfamia"
    
    
    miRsAux.Open miSQL, conn, adOpenKeyset, adLockPessimistic, adCmdText
    miSQL = ""
    
    Set ColCli = New Collection
    NumRegElim = -1
    miSQL = ""
    While Not miRsAux.EOF
        If NumRegElim <> miRsAux!codClien Then
            If NumRegElim > 0 Then ColCli.Add miSQL & "|"
            miSQL = miRsAux!codClien & "|"
            NumRegElim = miRsAux!codClien
        End If
        miSQL = miSQL & "," & miRsAux!Codfamia
   
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    
    If miSQL = "" Then
        MsgBox "Ninugn dato", vbExclamation
        Exit Function
    Else
        'Añado el ultimo
        ColCli.Add miSQL & "|"
    End If
    
    
    NumRegElim = 0
    'Ahora ya tengo para buscar los articulos
    For J = 1 To ColCli.Count
        CadParam = RecuperaValor(ColCli.item(J), 1)
        Label3(10).Caption = "Datos: " & CadParam
        Label3(10).Refresh
    
        miSQL = " select slifac.codartic,CodProve,codfamia,sartic.NomArtic,codclien,nomclien,sum(cantidad) cantid,sum(importel) implin ,codagent from scafac,scafac1,slifac,sartic  WHERE"
        miSQL = miSQL & " scafac1.Codtipom = scafac.Codtipom And scafac1.NumFactu = scafac.NumFactu And scafac1.FecFactu = scafac.FecFactu"
        miSQL = miSQL & " AND scafac1.Codtipom = slifac.Codtipom And scafac1.NumFactu = slifac.NumFactu And scafac1.FecFactu = slifac.FecFactu"
        miSQL = miSQL & " and scafac1.numalbar=slifac.numalbar and scafac1.codtipoa=slifac.codtipoa AND slifac.codartic=sartic.codartic"
        miSQL = miSQL & " AND codalmac = " & txtAlma(2).Text
        miSQL = miSQL & " AND scafac.fecfactu >=" & DBSet(txtFecha(30).Text, "F")
        miSQL = miSQL & " AND scafac.fecfactu <=" & DBSet(txtFecha(31).Text, "F")
        
                
        If Me.txtCodProve(2).Text <> "" Then miSQL = miSQL & " AND sartic.codprove >= " & Me.txtCodProve(2).Text
        If Me.txtCodProve(3).Text <> "" Then miSQL = miSQL & " AND sartic.codprove <= " & Me.txtCodProve(3).Text
        
        'Si ha puesto desde hasta codartic
        If Me.txtArticulo(1).Text <> "" Then miSQL = miSQL & " AND sartic.codartic >= " & DBSet(Me.txtArticulo(1).Text, "T")
        If Me.txtArticulo(2).Text <> "" Then miSQL = miSQL & " AND sartic.codartic <= " & DBSet(Me.txtArticulo(2).Text, "T")
        
        'Si ha puesto D/H agente
        If Me.txtAgente(4).Text <> "" Then miSQL = miSQL & " AND scafac.CODAGENT >= " & Me.txtAgente(4).Text
        If Me.txtAgente(5).Text <> "" Then miSQL = miSQL & " AND scafac.codagent <= " & Me.txtAgente(5).Text
        
        CadParam = RecuperaValor(ColCli.item(J), 1)
        miSQL = miSQL & " AND codclien = " & CadParam
        
        CadParam = RecuperaValor(ColCli.item(J), 2)
        CadParam = Mid(CadParam, 2)
        miSQL = miSQL & " AND codfamia IN (" & CadParam & ") GROUP BY 1,2"
        
        miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        
        
        Label3(10).Caption = J & " de " & ColCli.Count
        Label3(10).Refresh
        
        
        miSQL = ""
        While Not miRsAux.EOF
        
    
                '
                'tmpinformes(codusu,codigo1,campo1,nombre1,nombre2nombre3importe1ifecha1fecha2,campo2,importe2,importe4)
                '                            prove  nomcli  codartic nomart  cantidad fini ffin  famia  codclien agente
                
        
            If DBSet(miRsAux!cantid, "N") <> 0 Then
                NumRegElim = NumRegElim + 1
                miSQL = miSQL & ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!codClien & "," & miRsAux!Codfamia
                miSQL = miSQL & "," & DBSet(miRsAux!Nomclien, "T")
                miSQL = miSQL & "," & DBSet(miRsAux!codArtic, "T") & "," & DBSet(miRsAux!NomArtic, "T") & "," & DBSet(miRsAux!cantid, "N")
                miSQL = miSQL & "," & DBSet(Now, "F") & "," & DBSet(Now, "F") & "," & miRsAux!Codprove & "," & DBSet(miRsAux!implin, "N") & "," & miRsAux!CodAgent & ")"
            End If
            miRsAux.MoveNext
                
      
           

            'Debug.Print RT!codArtic
            
          
            
            
        
        Wend
        miRsAux.Close
        
        If miSQL <> "" Then
            miSQL = Mid(miSQL, 2)
            miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,nombre1,nombre2,nombre3,importe1,fecha1,fecha2,importe2,importe3,importe4) VALUES " & miSQL
            conn.Execute miSQL
            miSQL = ""
        End If
        
    Next
    
    
    
    'Estableceremos los valores de dto1,dto2
    If NumRegElim > 0 Then
    
     Label3(10).Caption = "Estableciendo valores dtos."
     Label3(10).Refresh
     miSQL = "select campo1,campo2 from tmpinformes where codusu=" & vUsu.codigo & "  group by 1,2"
     Set ColCli = Nothing
     Set ColCli = New Collection
     miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
     miSQL = ""
     NumRegElim = 0
     While Not miRsAux.EOF
         If NumRegElim <> miRsAux!campo1 Then
             If NumRegElim > 0 Then ColCli.Add miSQL & "|"
             miSQL = miRsAux!campo1 & "|"
             NumRegElim = miRsAux!campo1
         End If
         miSQL = miSQL & "," & miRsAux!campo2
    
         miRsAux.MoveNext
     Wend
     miRsAux.Close
     
     
     
     'Añado el ultimo
     ColCli.Add miSQL & "|"
     
     
     
         
         
         
      For J = 1 To ColCli.Count
     
         Label3(10).Caption = "Update dtos: " & J & " de " & ColCli.Count
         Label3(10).Refresh
     
         miSQL = " select codclien,codfamia,dtoline1,dtoline2 FROM sdtofm WHERE dtoesp=1"
         CadParam = RecuperaValor(ColCli.item(J), 1)
         miSQL = miSQL & " AND codclien = " & CadParam
         
         CadParam = RecuperaValor(ColCli.item(J), 2)
         CadParam = Mid(CadParam, 2)
         miSQL = miSQL & " AND codfamia IN (" & CadParam & ") "
         
         miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
         While Not miRsAux.EOF
             miSQL = "UPDATE tmpinformes SET porcen1=" & DBSet(miRsAux!dtoline1, "N")
             miSQL = miSQL & ", porcen2=" & DBSet(miRsAux!dtoline2, "N")
             miSQL = miSQL & " WHERE codusu = " & vUsu.codigo & " AND campo1 = " & miRsAux!codClien
             miSQL = miSQL & " AND campo2 = " & miRsAux!Codfamia
             conn.Execute miSQL
             
             miRsAux.MoveNext
         Wend
         miRsAux.Close
     Next
    End If
    
    If NumRegElim = 0 Then
        MsgBox "No hay datos con estos valores", vbExclamation
    Else
        GeneraDatosDotEspecial = True
    End If
EGeneraDatosPromociones:
    If Err.Number <> 0 Then MuestraError Err.Number

End Function

Private Sub ArreglaFormularioPromoEsp()

        vMostrarTree = Opcion = 5
    
        'Solo para opcion =5
'        chkVarios(0).Visible = vMostrarTree
        PonerDesdehastaVisible vMostrarTree, Nothing, imgFecha(2), txtFecha(2), Nothing

        chkVarios(12).visible = Not vMostrarTree
        
        'Para la 34
        Me.lblDpto(34).visible = Not vMostrarTree
        PonerDesdehastaVisible Not vMostrarTree, Label3(58), imgFecha(30), txtFecha(30), Nothing
        PonerDesdehastaVisible Not vMostrarTree, Label3(59), imgFecha(31), txtFecha(31), Nothing
        PonerDesdehastaVisible Not vMostrarTree, Label3(59), imgFecha(31), txtFecha(31), Nothing
        PonerDesdehastaVisible Not vMostrarTree, Label4(126), imgCliente(12), txtCliente(12), txtDescClie(12)
        PonerDesdehastaVisible Not vMostrarTree, Label4(127), imgCliente(13), txtCliente(13), txtDescClie(13)
    
    
        Me.lblDpto(35).visible = Not vMostrarTree
        PonerDesdehastaVisible Not vMostrarTree, Label4(128), imgAgente(4), txtAgente(4), txtDescAgente(4)
        PonerDesdehastaVisible Not vMostrarTree, Label4(129), imgAgente(5), txtAgente(5), txtDescAgente(5)
            
        FrameConsolidado.BorderStyle = 0
        FrameConsolidado.Top = 5190
        FrameConsolidado.visible = vMostrarTree
        
        
        
        If vMostrarTree Then
            Me.lblDpto(0).Caption = " Fecha  promoción"
            Me.lblDpto(0).Top = 4700
            chkVarios(0).Caption = "Detalla cliente"
            lblTitulo(3).Caption = "Artículos en promoción"
        Else
            Me.lblDpto(0).Top = 5640
            Me.lblDpto(0).Caption = " Fecha ventas"
            chkVarios(0).Caption = "Detalla articulos"
            lblTitulo(3).Caption = "Artículos con dto. especial"
        End If
End Sub



Private Sub PonerDesdehastaVisible(EsVisible As Boolean, ByRef Lbl As Label, img As Image, txtCod As TextBox, txtDesc As TextBox)
    If Not Lbl Is Nothing Then Lbl.visible = EsVisible
    If Not img Is Nothing Then img.visible = EsVisible
    If Not txtCod Is Nothing Then txtCod.visible = EsVisible
    If Not txtDesc Is Nothing Then txtDesc.visible = EsVisible

End Sub







'*******************************************************************************************
'*******************************************************************************************
'*******************************************************************************************
'
'   Reposcion almacen
'
'*******************************************************************************************
'*******************************************************************************************
'*******************************************************************************************
'Private Function ReposcionAlmacen() As Boolean
'Dim I As Integer
'Dim RT As ADODB.Recordset
'
'    On Error GoTo eReposcionAlmacen
'    ReposcionAlmacen = False
'
'    Me.Label3(60).Caption = "Preparando datos"
'    Me.Label3(60).Refresh
'
'    miSQL = "DELETE FROM tmpinformes where codusu =" & vUsu.Codigo
'    conn.Execute miSQL
'    miSQL = "DELETE FROM tmpprevision2 where codusu =" & vUsu.Codigo
'    conn.Execute miSQL
'    miSQL = "DELETE FROM tmpstockfec where codusu =" & vUsu.Codigo
'    conn.Execute miSQL
'
'    Me.Label3(60).Caption = "Facturas"
'    Me.Label3(60).Refresh
'    miSQL = "INSERT INTO tmpprevision2(codusu,tipo,descripcion,importe1,importe2)"
'
'        Codigo = " select " & vUsu.Codigo & ",0,codartic,sum(cantidad),0 from scafac1,slifac  WHERE"
'        Codigo = Codigo & " scafac1.Codtipom = slifac.Codtipom And scafac1.NumFactu = slifac.NumFactu And scafac1.FecFactu = slifac.FecFactu"
'        Codigo = Codigo & " and scafac1.numalbar=slifac.numalbar and scafac1.codtipoa=slifac.codtipoa"
'
'        Codigo = Codigo & " AND codalmac = " & Me.txtAlma(4).Text
'        'La fecha
'        If Me.txtFecha(32).Text <> "" Then Codigo = Codigo & " AND fechaalb >= " & DBSet(Me.txtFecha(32).Text, "F")
'        If Me.txtFecha(33).Text <> "" Then Codigo = Codigo & " AND fechaalb <= " & DBSet(Me.txtFecha(33).Text, "F")
'        Codigo = Codigo & " group by codartic    "
'    Codigo = miSQL & Codigo
'    conn.Execute Codigo
'
'
'
'
'
'    Me.Label3(60).Caption = "Albaranes"
'    Me.Label3(60).Refresh
'    miSQL = "INSERT INTO tmpprevision2(codusu,tipo,descripcion,importe1,importe2)"
'
'        Codigo = " select " & vUsu.Codigo & ",1,codartic,0,sum(cantidad) from scaalb,slialb  WHERE"
'        Codigo = Codigo & " scaalb.Codtipom = slialb.Codtipom And scaalb.numalbar = slialb.numalbar "
'        Codigo = Codigo & " AND codalmac = " & Me.txtAlma(4).Text
'        'La fecha
'        If Me.txtFecha(32).Text <> "" Then Codigo = Codigo & " AND fechaalb >= " & DBSet(Me.txtFecha(32).Text, "F")
'        If Me.txtFecha(33).Text <> "" Then Codigo = Codigo & " AND fechaalb <= " & DBSet(Me.txtFecha(33).Text, "F")
'        Codigo = Codigo & " group by codartic    "
'    Codigo = miSQL & Codigo
'    conn.Execute Codigo
'
'
'    'Añadiremos el resto de articulos
'    Me.Label3(60).Caption = "Resto articulos"
'    Me.Label3(60).Refresh
'
'    'Añado los articulos con
'    miSQL = "INSERT INTO tmpprevision2(codusu,tipo,descripcion,importe1,importe2)"
'
'    Codigo = " select " & vUsu.Codigo & ",2,codartic,0,0 from salmac  WHERE codalmac = " & Me.txtAlma(4).Text
'    If chkVarios(13).Value = 1 Then Codigo = Codigo & " AND stockmin>0"
'    Codigo = miSQL & Codigo
'    conn.Execute Codigo
'
'
'
'
'    'YA tengo total cosas vendidas en las fechas para el almacen. Ahora cruzaremos con la salmac
'    If chkVarios(13).Value = 1 Then
'        'SOLO QUIERE los que tengan minimo
'        Me.Label3(60).Caption = "Ajuste stock minimo"
'        Me.Label3(60).Refresh
'        Codigo = "DELETE from tmpprevision2 where codusu = " & vUsu.Codigo & " AND not descripcion IN ("
'        Codigo = Codigo & " Select codartic from salmac where codalmac =" & Me.txtAlma(4).Text
'        Codigo = Codigo & " AND stockmin>0 )"
'        conn.Execute Codigo
'
'    End If
'
'    Me.Label3(60).Caption = "Ajustando datos"
'    Me.Label3(60).Refresh
'
'
'
'    'Me cargo los articulos de varios
'    Codigo = "DELETE from tmpprevision2 where codusu = " & vUsu.Codigo & " AND descripcion IN ("
'    Codigo = Codigo & " Select codartic from sartic where artvario = 1)"
'    conn.Execute Codigo
'
'    'Cargo la tabla con los consumos
'    Codigo = "INSERT INTO tmpstockfec(codusu,codalmac,codartic,stock)"
'    Codigo = Codigo & "select codusu,0,descripcion,sum(importe1+importe2) from tmpprevision2"
'    Codigo = Codigo & " WHERE codusu = " & vUsu.Codigo & "  group by descripcion "
'    conn.Execute Codigo
'
'    'Cargo los stocks
'
'    Me.Label3(60).Caption = "Leyendo stocks"
'    Me.Label3(60).Refresh
'
'    Codigo = "select codartic,sum(if(codalmac=1,canstock,0)) ppal,sum(if(codalmac=" & Me.txtAlma(4).Text & ",canstock,0)) canstock"
'    Codigo = Codigo & ",sum(if(codalmac=" & Me.txtAlma(4).Text & ",stockmin,0)) stockmin "
'    Codigo = Codigo & "  from salmac where codartic IN ("
'    Codigo = Codigo & " Select codartic from tmpstockfec where codusu = " & vUsu.Codigo & ") GROUP  BY codartic ORDER BY codartic"
'    Set RT = New ADODB.Recordset
'    RT.Open Codigo, conn, adOpenKeyset, adLockPessimistic, adCmdText
'
'
'
'
'
'    Codigo = "Select count(*) from tmpstockfec WHERE codusu = " & vUsu.Codigo
'    miRsAux.Open Codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
'    cadTitulo = "N/D"
'    If Not miRsAux.EOF Then
'        If Not IsNull(miRsAux.Fields(0)) Then cadTitulo = Format(miRsAux.Fields(0), "0000")
'    End If
'    miRsAux.Close
'
'    If Val(cadTitulo) > 5000 Then
'        If MsgBox("El proceso puede costar mucho tiempo.  ¿Continuar?", vbQuestion + vbYesNo) = vbNo Then Exit Function
'    End If
'
'
'    Codigo = "select tmpstockfec.*,nomartic,rotacion,codfamia from tmpstockfec,sartic WHERE codusu = " & vUsu.Codigo
'    Codigo = Codigo & " AND tmpstockfec.codartic=sartic.codartic ORDER BY codartic "
'    miRsAux.Open Codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
'
'
'    Codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,porcen1,nombre1,nombre2,importe1,importe2,importe3,importe5,importe4) VALUES "
'    miSQL = ""
'    NumRegElim = 0
'    While Not miRsAux.EOF
'        NumRegElim = NumRegElim + 1
'
'        Me.Label3(60).Caption = Format(NumRegElim, "0000") & " / " & cadTitulo
'        Me.Label3(60).Refresh
'
'        miSQL = miSQL & ", (" & vUsu.Codigo & "," & NumRegElim & ",0," & miRsAux!Codfamia & "," & miRsAux!Rotacion & "," & DBSet(miRsAux!codArtic, "T")
'        miSQL = miSQL & "," & DBSet(miRsAux!NomArtic, "T") & "," & DBLet(miRsAux!stock, "N") & ","
'
'        RT.Find "codartic = " & DBSet(miRsAux!codArtic, "T"), , adSearchForward, 1
'
'        If RT.EOF Then
'            miSQL = miSQL & "0,0,0)"
'        Else
'            miSQL = miSQL & DBSet(RT!CanStock, "N") & "," & DBSet(RT!stockmin, "N") & "," & DBSet(RT!ppal, "N") & ",0)"
'        End If
'
'        If (NumRegElim Mod 30) = 0 Then
'            miSQL = Mid(miSQL, 2)
'            miSQL = Codigo & miSQL
'            conn.Execute miSQL
'            miSQL = ""
'
'            If (NumRegElim Mod 200) = 0 Then DoEvents
'        End If
'
'        miRsAux.MoveNext
'    Wend
'    miRsAux.Close
'    RT.Close
'    cadTitulo = ""
'    If miSQL <> "" Then
'        miSQL = Mid(miSQL, 2)
'        miSQL = Codigo & miSQL
'        conn.Execute miSQL
'    End If
'
'
'    Me.Label3(60).Caption = "Pedidos"
'    Me.Label3(60).Refresh
'    miSQL = "select codartic,sum(cantidad) totped from sliped where codalmac = " & Me.txtAlma(4).Text
'    miSQL = miSQL & " and codartic in ( Select codartic from tmpstockfec where codusu=" & vUsu.Codigo & ") group by codartic"
'    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockOptimistic, adCmdText
'    While Not miRsAux.EOF
'        Me.Label3(60).Caption = "Ped: " & miRsAux!codArtic
'        Me.Label3(60).Refresh
'
'        miSQL = "UPDATE tmpinformes SET importe4 = " & DBLet(miRsAux!totped, "N")
'        miSQL = miSQL & " where codusu = " & vUsu.Codigo & " and nombre1 = " & DBSet(miRsAux!codArtic, "T")
'        conn.Execute miSQL
'
'        miRsAux.MoveNext
'    Wend
'    miRsAux.Close
'
'
'
'
'
'    Me.Label3(60).Caption = "Pedidos resto articulos"
'    Me.Label3(60).Refresh
'
'
'
'    miSQL = "select sliped.codartic,sartic.nomartic,artvario,codfamia ,sum(cantidad) totped from sliped,sartic where codalmac = " & Me.txtAlma(4).Text
'    miSQL = miSQL & " and sartic.codartic=sliped.codartic and not sliped.codartic in ( Select codartic from tmpstockfec where codusu=" & vUsu.Codigo & ") group by sliped.codartic"
'    miRsAux.Open miSQL, conn, adOpenKeyset, adLockOptimistic, adCmdText
'    'Vamos a cargar
'    '
'    Codigo = ""
'    If Not miRsAux.EOF Then
'        While Not miRsAux.EOF
'            Codigo = Codigo & ", " & DBSet(miRsAux!codArtic, "T")
'            miRsAux.MoveNext
'        Wend
'        miRsAux.MoveFirst
'    End If
'
'    'Cargo los stocks
'    If Codigo <> "" Then
'        miSQL = Mid(Codigo, 2)
'        'codigo = "select codartic,sum(canstock) total,sum(if(codalmac=" & Me.txtAlma(4).Text & ",canstock,0)) totalma from salmac where codalmac =" & Me.txtAlma(4).Text & " AND "
'        Codigo = "select codartic,sum(if(codalmac=1,canstock,0)) ppal,sum(if(codalmac=" & Me.txtAlma(4).Text & ",canstock,0)) totalma from salmac where "
'        Codigo = Codigo & " codartic IN (" & miSQL & ") GROUP BY codartic"
'    Else
'        Codigo = "Select codartic,canstock from salmac where codalmac=-1" 'VACIO
'    End If
'    RT.Open Codigo, conn, adOpenKeyset, adLockPessimistic, adCmdText
'
'
'
'
'
'    Codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,porcen1,nombre1,nombre2,importe1,importe2,importe3,importe4) VALUES "
'    miSQL = ""
'
'    While Not miRsAux.EOF
'
'        Me.Label3(60).Caption = "Ped no min: " & miRsAux!codArtic
'        Me.Label3(60).Refresh
'        NumRegElim = NumRegElim + 1
'        miSQL = miSQL & ", (" & vUsu.Codigo & "," & NumRegElim & ",1," & miRsAux!Codfamia & "," & miRsAux!artvario & "," & DBSet(miRsAux!codArtic, "T")
'        miSQL = miSQL & "," & DBSet(miRsAux!NomArtic, "T") & "," & DBLet(miRsAux!totped, "N") & ","
'
'        RT.Find "codartic = " & DBSet(miRsAux!codArtic, "T"), , adSearchForward, 1
'
'        If RT.EOF Then
'            miSQL = miSQL & "0,0,0)"
'        Else
'            miSQL = miSQL & DBSet(RT!totalma, "N") & "," & DBSet(RT!ppal, "N") & ",0)"
'        End If
'
'        If (NumRegElim Mod 30) = 0 Then
'            miSQL = Mid(miSQL, 2)
'            miSQL = Codigo & miSQL
'            conn.Execute miSQL
'            miSQL = ""
'        End If
'
'        miRsAux.MoveNext
'
'    Wend
'    miRsAux.Close
'    If miSQL <> "" Then
'        miSQL = Mid(miSQL, 2)
'        miSQL = Codigo & miSQL
'        conn.Execute miSQL
'    End If
'
'
'    'Como el campo 3 lo tengo libre lo voy a actualizar
'    'En un futuro pdira utlizarlo para otra cosa y en el rpt lincar campo2 con sfamia
'    Me.Label3(60).Caption = "Ajuste familia"
'    Me.Label3(60).Refresh
'    miSQL = "Select campo2,nomfamia from tmpinformes,sfamia WHERE tmpinformes.campo2=sfamia.codfamia AND codusu = " & vUsu.Codigo & " GROUP BY campo2"
'    miRsAux.Open miSQL, conn, adOpenKeyset, adLockPessimistic, adCmdText
'    While Not miRsAux.EOF
'        Me.Label3(60).Caption = miRsAux!nomfamia
'        Me.Label3(60).Refresh
'
'        miSQL = "UPDATE tmpinformes set nombre3=" & DBSet(miRsAux!nomfamia, "T") & " WHERE codusu = " & vUsu.Codigo & " AND campo2= " & miRsAux!campo2
'        conn.Execute miSQL
'
'        miRsAux.MoveNext
'    Wend
'    miRsAux.Close
'
'    cadFormula = ""
'    cadParam = ""
'    ReposcionAlmacen = NumRegElim > 0
'
'eReposcionAlmacen:
'    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description
'    Set RT = Nothing
'End Function




Private Function ReposcionAlmacen2() As Boolean
Dim i As Integer
Dim RT As ADODB.Recordset
Dim ColArt As Collection

    On Error GoTo eReposcionAlmacen
    ReposcionAlmacen2 = False

    Me.Label3(60).Caption = "Preparando datos"
    Me.Label3(60).Refresh
    
    miSQL = "DELETE FROM tmpinformes where codusu =" & vUsu.codigo
    conn.Execute miSQL
    miSQL = "DELETE FROM tmpprevision2 where codusu =" & vUsu.codigo
    conn.Execute miSQL
    miSQL = "DELETE FROM tmpstockfec where codusu =" & vUsu.codigo
    conn.Execute miSQL
    miSQL = "DELETE FROM tmpprevision2 where codusu =" & vUsu.codigo * 1000  'lo utulizo para unas coasas
    conn.Execute miSQL
    miSQL = "DELETE FROM tmpcrmclien where codusu =" & vUsu.codigo   'stock componentes
    conn.Execute miSQL
    miSQL = "DELETE FROM tmpstockfec where codusu =" & vUsu.codigo   'stock componentes
    conn.Execute miSQL
    
    
    Me.Label3(60).Caption = "Facturas"
    Me.Label3(60).Refresh
    DoEvents
    
    'NO TOCAR HASTA FINALIZAR LOS INSERTS               'Ventas alb - fra  - pedidos)
    miSQL = "INSERT INTO tmpprevision2(codusu,tipo,descripcion,importe1,importe2,importe3,importe4,importe5,importe6)"
        
    codigo = " select " & vUsu.codigo & ",0,codartic,sum(cantidad),0,0,0,0,0 from scafac,scafac1,slifac  WHERE"
    codigo = codigo & " scafac1.Codtipom = scafac.Codtipom And scafac1.NumFactu = scafac.NumFactu And scafac1.FecFactu = scafac.FecFactu AND "
    codigo = codigo & " scafac1.Codtipom = slifac.Codtipom And scafac1.NumFactu = slifac.NumFactu And scafac1.FecFactu = slifac.FecFactu"
    codigo = codigo & " and scafac1.numalbar=slifac.numalbar and scafac1.codtipoa=slifac.codtipoa"
    
    codigo = codigo & " AND codalmac = " & Me.txtAlma(4).Text
    'La fecha
    If Me.txtFecha(32).Text <> "" Then codigo = codigo & " AND fechaalb >= " & DBSet(Me.txtFecha(32).Text, "F")
    If Me.txtFecha(33).Text <> "" Then codigo = codigo & " AND fechaalb <= " & DBSet(Me.txtFecha(33).Text, "F")
    
    
    
    

    'Lo que teienen OBRA no deben aparecer
    If Me.chkVarios(34).Value = 0 Then codigo = codigo & " AND coddirec is null"
    
    codigo = codigo & " group by codartic    "
    codigo = miSQL & codigo
    conn.Execute codigo
    
    
    
    

    Me.Label3(60).Caption = "Albaranes"
    Me.Label3(60).Refresh
    DoEvents
        
    codigo = " select " & vUsu.codigo & ",1,codartic,0,sum(cantidad),0,0,0,0 from scaalb,slialb  WHERE"
    codigo = codigo & " scaalb.Codtipom = slialb.Codtipom And scaalb.numalbar = slialb.numalbar "
    codigo = codigo & " AND codalmac = " & Me.txtAlma(4).Text
    'La fecha
    If Me.txtFecha(32).Text <> "" Then codigo = codigo & " AND fechaalb >= " & DBSet(Me.txtFecha(32).Text, "F")
    If Me.txtFecha(33).Text <> "" Then codigo = codigo & " AND fechaalb <= " & DBSet(Me.txtFecha(33).Text, "F")
    
    
    'Lo que teienen OBRA no deben aparecer
    If Me.chkVarios(34).Value = 0 Then codigo = codigo & " AND coddirec is null"
    
    codigo = codigo & " group by codartic    "
    codigo = miSQL & codigo
    conn.Execute codigo
    
    
    
    Me.Label3(60).Caption = "Pedidos"
    Me.Label3(60).Refresh
    
    codigo = " select " & vUsu.codigo & ",2,codartic,0,0,sum(cantidad),0,0,0 from scaped,sliped  WHERE"
    codigo = codigo & " scaped.numpedcl=sliped.numpedcl AND codalmac = " & Me.txtAlma(4).Text



    If Me.chkVarios(34).Value = 0 Then codigo = codigo & " AND coddirec is null"

    codigo = codigo & " group by codartic    "
    codigo = miSQL & codigo
    conn.Execute codigo
    
    
    DoEvents
    
    
    
    Me.Label3(60).Caption = "Stock"
    Me.Label3(60).Refresh
    

    
    codigo = " select " & vUsu.codigo & ",3,salmac.codartic,0,0,0,canstock ,if(stockmin is null,0,stockmin),0 from salmac,sartic  WHERE "
    codigo = codigo & " salmac.codartic=sartic.codartic AND codalmac = " & Me.txtAlma(4).Text
    'con stock NO de varios y situacion normal(abril 2014 ... u Obsoleta
    codigo = codigo & " AND ctrstock=1 AND artvario=0 AND codstatu <=1 "
    codigo = miSQL & codigo
    conn.Execute codigo
    
    
    codigo = " select " & vUsu.codigo & ",4,salmac.codartic,0,0,0,0,0,canstock from salmac  WHERE codalmac = 1 " 'stok del ppal
    codigo = codigo & " AND salmac.codartic in (select codartic from salmac where codalmac = " & Me.txtAlma(4).Text & ")"
    codigo = miSQL & codigo
    conn.Execute codigo
    
    
    
    DoEvents
    Me.Label3(60).Caption = "Agrupar articulos"
    Me.Label3(60).Refresh
    

    NumRegElim = vUsu.codigo * 1000
    codigo = "INSERT INTO tmpprevision2(codusu,tipo,descripcion,importe1,importe2,importe3,importe4,importe5,importe6)"
    codigo = codigo & " select " & NumRegElim & ",0,descripcion,sum(importe1),sum(importe2),sum(importe3),sum(importe4),sum(importe5),sum(importe6) from tmpprevision2   WHERE codusu = " & vUsu.codigo & " group by descripcion"
    conn.Execute codigo
    miSQL = "DELETE FROM tmpprevision2 where codusu =" & vUsu.codigo
    conn.Execute miSQL
    DoEvents
    conn.Execute "commit"
    Espera 1
    

    Me.Label3(60).Caption = "Quitar articulos "
    Me.Label3(60).Refresh
    miSQL = "DELETE FROM tmpprevision2 where codusu =" & NumRegElim
    miSQL = miSQL & " AND importe3 =0 AND importe5=0" 'NO TIENEN pedidos y no tiene stock minimo
    conn.Execute miSQL

    miSQL = "DELETE FROM tmpprevision2 where codusu =" & NumRegElim
    miSQL = miSQL & " AND importe3 = 0 And importe4>=importe5 "  'sin pedidos y no hay que reponer
    conn.Execute miSQL
    
    
    
    'Octubre 2013.
    'Añadiremos pedidos proveedor  Sera la colunma importeb1 (entra con UN cero)
    'Diciembre 2014
    ' Uds caja y uds bolsa (embalaje grande y emblaje pequeño)
    'OK ya tengo los articulos. Vamos a pasarlos a
    Me.Label3(60).Caption = "Cargando datos temporal "
    Me.Label3(60).Refresh
    codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,porcen1,nombre1,nombre2,importe1,importe2,importe3,importe4,importe5,importeb1,importeb2,importeb3)  "
    miSQL = "Select " & vUsu.codigo & ", @rownum:=@rownum+1 AS rownum ,1,codprove,artvario,codartic,nomartic,(importe1+importe2)"
    miSQL = miSQL & ",importe4,importe5,importe3,importe6,0,unicajas,if(unicajas2 is null,0,unicajas2) FROM tmpprevision2,sartic,(SELECT @rownum:=0) r "
    miSQL = miSQL & " WHERE tmpprevision2.codusu=" & NumRegElim & " AND tmpprevision2.descripcion=sartic.codartic "
    
    'Febrero 2016
    If Me.txtCodProve(32).Text <> "" Then miSQL = miSQL & " AND sartic.codprove = " & txtCodProve(32).Text
    
    conn.Execute codigo & miSQL
    
    
    'MAYO. Acelero el proceso
    Me.Label3(60).Caption = "Pedidos proveedor"
    Me.Label3(60).Refresh
    Espera 0.2
    
    
    Set ColArt = New Collection
    miSQL = "select nombre1 from tmpinformes where codusu=" & vUsu.codigo & " GROUP BY 1"
    miRsAux.Open miSQL, conn, adOpenKeyset, adLockPessimistic, adCmdText
    i = 0
    miSQL = ""
    While Not miRsAux.EOF
        i = i + 1
        miSQL = miSQL & ", " & DBSet(miRsAux!nombre1, "T")
        miRsAux.MoveNext
        
        If i > 10 Then
             ColArt.Add CStr(Mid(miSQL, 2))
             i = 0
             miSQL = ""
        End If
    Wend
    miRsAux.Close
        
    If miSQL <> "" Then ColArt.Add CStr(Mid(miSQL, 2))
        
    'Diciembre 2014
    'Llevara el punto de pedido tb
    For i = 1 To ColArt.Count
        Me.Label3(60).Caption = "Ped. prov " & i & " / " & ColArt.Count
        Me.Label3(60).Refresh
        DoEvents
        miSQL = "Select codartic,sum(cantidad) canti from slippr where codartic IN (" & ColArt.item(i) & ") GROUP BY 1"
        miRsAux.Open miSQL, conn, adOpenKeyset, adLockPessimistic, adCmdText
        While Not miRsAux.EOF
            Me.Label3(60).Caption = "Pedido prov: " & miRsAux!codArtic
            Me.Label3(60).Refresh
        
            miSQL = "UPDATE tmpinformes set importeb1=" & DBSet(miRsAux!canti, "N") & " WHERE codusu = " & vUsu.codigo & " AND nombre1= " & DBSet(miRsAux!codArtic, "T")
            conn.Execute miSQL
            
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        
        
        Me.Label3(60).Caption = "Punto pedido " & i & " / " & ColArt.Count
        Me.Label3(60).Refresh
        
        'miSQL = "Select codartic,puntoped from salmac where codalmac=1 and puntoped >0 and codartic IN (" & ColArt.item(I) & ") "
        miSQL = "Select codartic,puntoped from salmac where codalmac=" & Me.txtAlma(4).Text & " and puntoped >0 and codartic IN (" & ColArt.item(i) & ") "
        miRsAux.Open miSQL, conn, adOpenKeyset, adLockPessimistic, adCmdText
        While Not miRsAux.EOF
            Me.Label3(60).Caption = "Punto pedido: " & miRsAux!codArtic
            Me.Label3(60).Refresh
        
            miSQL = "UPDATE tmpinformes set importeb4=" & DBSet(miRsAux!puntoped, "N") & " WHERE codusu = " & vUsu.codigo & " AND nombre1= " & DBSet(miRsAux!codArtic, "T")
            conn.Execute miSQL
            
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        
        
    Next
    Set ColArt = Nothing
        
        
    
    'Vacio los datos
    conn.Execute "DELETE FROM tmpprevision2 where codusu =" & NumRegElim
    
    'Como el campo 3 lo tengo libre lo voy a actualizar
    'En un futuro pdira utlizarlo para otra cosa y en el rpt lincar campo2 con sfamia
    Me.Label3(60).Caption = "Ajuste proveedor"
    Me.Label3(60).Refresh
    DoEvents
    miSQL = "Select campo2,nomprove from tmpinformes,sprove WHERE tmpinformes.campo2=sprove.codprove AND codusu = " & vUsu.codigo & " GROUP BY campo2"
    miRsAux.Open miSQL, conn, adOpenKeyset, adLockPessimistic, adCmdText
    NumRegElim = 0
    While Not miRsAux.EOF
        NumRegElim = NumRegElim + 1
        Me.Label3(60).Caption = "Ped. prov. " & miRsAux!nomprove
        Me.Label3(60).Refresh
        
        miSQL = "UPDATE tmpinformes set nombre3=" & DBSet(miRsAux!nomprove, "T") & " WHERE codusu = " & vUsu.codigo & " AND campo2= " & miRsAux!campo2
        conn.Execute miSQL
        
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    
    Me.Label3(60).Caption = "Ajuste stock varios"
    Me.Label3(60).Refresh
    miSQL = "UPDATE tmpinformes set importe5=0 WHERE codusu = " & vUsu.codigo & " AND porcen1>0 "
    conn.Execute miSQL
    
    
    'Junio 2014
    'Check para que imprima solo los que tengan algo para reponer
    If chkVarios(24).Value = 1 Then
         Me.Label3(60).Caption = "Solo reponer"
         Me.Label3(60).Refresh
         miSQL = "DELETE FROM tmpinformes where codusu =" & vUsu.codigo
         miSQL = miSQL & " AND (importe3 - importe2 + importe4)<=0"
         conn.Execute miSQL
    End If
    
    
    
    
    'Abril 2014
    '-----------------------------------------------------
    'Componentes
    '
    '
    ''tmpcrmclien(codusu,codclien,nomforpa,saldopdte,saldototal)
    Me.Label3(60).Caption = "Componentes"
    Me.Label3(60).Refresh
    DoEvents
    conn.Execute "update tmpinformes set porcen2=0 where codusu= " & vUsu.codigo
    conn.Execute "update tmpinformes set porcen2=1 where codusu= " & vUsu.codigo & " and nombre1 in (select distinct(codartic) from sarti1)"

    'ACeleramos el proceso
    'miSQL = "select " & vUsu.Codigo & ",codarti1 from sarti1 where codartic in (select nombre1 from tmpinformes where porcen2>0 and codusu = " & vUsu.Codigo & ") group by codarti1"
    'miSQL = "INSERT INTO tmpstockfec(codusu,codartic) " & miSQL
    'conn.Execute miSQL
    Set ColArt = New Collection
    miSQL = "select nombre1 from tmpinformes where porcen2=1 AND codusu=" & vUsu.codigo & " GROUP BY 1"
    miRsAux.Open miSQL, conn, adOpenKeyset, adLockPessimistic, adCmdText
    i = 0
    miSQL = ""
    While Not miRsAux.EOF
        i = i + 1
        miSQL = miSQL & ", " & DBSet(miRsAux!nombre1, "T")
        miRsAux.MoveNext
        
        If i > 10 Then
             ColArt.Add CStr(Mid(miSQL, 2))
             miSQL = ""
             i = 0
        End If
    Wend
    miRsAux.Close
        
    If miSQL <> "" Then ColArt.Add CStr(Mid(miSQL, 2))
        
    For i = 1 To ColArt.Count
        Me.Label3(60).Caption = "Componentes " & i & " / " & ColArt.Count
        Me.Label3(60).Refresh
        miSQL = "INSERT IGNORE INTO tmpstockfec(codusu,codartic) select " & vUsu.codigo & ",codarti1 from sarti1 where codartic in (" & ColArt.item(i)
        miSQL = miSQL & ") group by codarti1"
        conn.Execute miSQL
    Next
    Set ColArt = Nothing



    Me.Label3(60).Caption = "lecturas stocks"
    Me.Label3(60).Refresh
    DoEvents

    miSQL = "select " & vUsu.codigo & ",@rownum:=@rownum+1 AS rownum ,codartic,sum(if(codalmac=" & Me.txtAlma(4).Text & ",canstock,0)),sum(if(codalmac=1,canstock,0)) from salmac,(SELECT @rownum:=0) r"
    miSQL = miSQL & " where codartic in (select codartic from tmpstockfec where codusu =" & vUsu.codigo & ") group by codartic"
    miSQL = "INSERT INTO tmpcrmclien(codusu,codclien,nomforpa,saldopdte,saldototal) " & miSQL
    conn.Execute miSQL
         
    miSQL = "Select nomforpa from tmpcrmclien WHERE  codusu = " & vUsu.codigo & " GROUP BY nomforpa"
    miRsAux.Open miSQL, conn, adOpenKeyset, adLockPessimistic, adCmdText
    
    While Not miRsAux.EOF
        
        Me.Label3(60).Caption = miRsAux!nomforpa
        Me.Label3(60).Refresh
        'En txtauxiliar de tmpcrclien, grabaraemos 8 posciones para unicajas y 8 para unicajas2
        CadParam = "concat(right(concat('        ',unicajas),8),right(concat('        ',if(unicajas2 is null,'',unicajas2)),8))"
        miSQL = DevuelveDesdeBD(conAri, "nomartic", "sartic", "codartic", miRsAux!nomforpa, "T", CadParam)
        miSQL = "UPDATE tmpcrmclien set nomactiv=" & DBSet(miSQL, "T") & ", auxiliar = '" & CadParam & "'"
        miSQL = miSQL & " WHERE codusu = " & vUsu.codigo & " AND nomforpa= " & DBSet(miRsAux!nomforpa, "T")
        conn.Execute miSQL
        
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    
    
    
    
    
    
    
    
    
    cadFormula = ""
    CadParam = ""
    
    If NumRegElim > 0 Then
        ReposcionAlmacen2 = True
    Else
        MsgBox "Ningun dato generado", vbExclamation
    End If
    
    
    
eReposcionAlmacen:
    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description
    Set RT = Nothing
End Function


Private Sub MontaSQLVtaasGenteTrabajador()
    
    miSQL = miSQL & " from scafac,scafac1,slifac where "
    miSQL = miSQL & " scafac.codtipom=scafac1.codtipom and scafac.numfactu=scafac1.numfactu"
    miSQL = miSQL & " and scafac.fecfactu=scafac1.fecfactu"
    miSQL = miSQL & " and slifac.numfactu=scafac1.numfactu and slifac.codtipom=scafac1.codtipom"
    miSQL = miSQL & " and slifac.fecfactu=scafac1.fecfactu"
    miSQL = miSQL & " and slifac.codtipoa=scafac1.codtipoa and slifac.numalbar=scafac1.numalbar"
    
    If Me.txtFecha(34).Text <> "" Then miSQL = miSQL & " AND scafac.fecfactu >= " & DBSet(Me.txtFecha(34).Text, "F")
    If Me.txtFecha(35).Text <> "" Then miSQL = miSQL & " AND scafac.fecfactu <= " & DBSet(Me.txtFecha(35).Text, "F")
    
    If cadSelect <> "" Then miSQL = miSQL & " AND scafac1.codtraba IN (" & cadSelect & ")"
         
    If Me.txtAgente(6).Text <> "" Then miSQL = miSQL & " AND scafac.codagent >= " & txtAgente(6).Text
    If Me.txtAgente(7).Text <> "" Then miSQL = miSQL & " AND scafac.codagent <= " & txtAgente(7).Text
    
    If Me.txtCliente(14).Text <> "" Then miSQL = miSQL & " AND scafac.codclien >= " & txtCliente(14).Text
    If Me.txtCliente(15).Text <> "" Then miSQL = miSQL & " AND scafac.codclien <= " & txtCliente(15).Text
    
    
    If chkVarios(21).Value = 0 Then miSQL = miSQL & " and scafac.codtipom<>'FAZ'"
    
    


End Sub




Private Function GenerarDatosVtasAgenteTraba() As Boolean
Dim Importe As Currency
    
    GenerarDatosVtasAgenteTraba = False
    

    
    
    
    
    'Comprobamos si hay algun traba
    miSQL = ""
    ResultadoFuncion = True 'estan todos
    For NumRegElim = 1 To Me.ListView1(5).ListItems.Count
        If Me.ListView1(5).ListItems(NumRegElim).Checked Then
            miSQL = miSQL & ", " & Me.ListView1(5).ListItems(NumRegElim).Tag
        Else
            ResultadoFuncion = False
        End If
    Next
    If miSQL = "" Then
        MsgBox "Seleccione algun trabajador", vbExclamation
        Exit Function
    Else
        cadSelect = Mid(miSQL, 2)
    End If
    If ResultadoFuncion Then cadSelect = ""  'Estan todos, no vamos a poner where codtraba in
    
    
        
    FI = "01/01/1900"
    If Me.txtFecha(34).Text <> "" Then FI = CDate(Me.txtFecha(34).Text)
    
    FF = Now
    If Me.txtFecha(35).Text <> "" Then FF = CDate(Me.txtFecha(35).Text)
    
    If DateDiff("d", FI, FF) > 120 Then
        If MsgBox("El proceso puede llevar mucho tiempo. ¿Continuar?", vbQuestion + vbYesNo) <> vbYes Then Exit Function
    End If
    
    
    
    
    
    Me.Label3(63).Caption = "Preparando datos"
    Me.Label3(63).Refresh
    
    miSQL = "DELETE FROM tmpinformes where codusu =" & vUsu.codigo
    conn.Execute miSQL
    
    miSQL = "DELETE FROM tmpslipreu where codusu =" & vUsu.codigo
    conn.Execute miSQL
    
    
    Espera 0.2
    
    
    Me.Label3(63).Caption = "Leyendo registros"
    Me.Label3(63).Refresh


    miSQL = " SELECT scafac.codtipom,scafac.numfactu,scafac.fecfactu,scafac1.codtipoa,scafac1.numalbar,scafac1.codtraba,"
    miSQL = miSQL & " codagent,(1 - ((dtoppago+dtognral)/100)) factor,sum(if(pvpinferior=0,importel,0)) normal,"
    miSQL = miSQL & " sum(if(pvpinferior=1,importel,0)) eco,sum(if(pvpinferior>=2,importel,0)) supereco"
    miSQL = miSQL & " ,codclien,nomclien,if (comisionagente is null,0,comisionagente) comisionagente"
    
    MontaSQLVtaasGenteTrabajador
    
    If vParamAplic.NumeroInstalacion = 2 Then
        miSQL = miSQL & " AND not slifac.codartic IN (select codartic from sartic where codprove = 5000)"
    End If
    
    
    miSQL = miSQL & " group by scafac.codtipom,scafac.numfactu,scafac.fecfactu,scafac1.codtipoa,scafac1.numalbar"
    
    Set miRsAux = New ADODB.Recordset
    
    
    
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = ""

    While Not miRsAux.EOF
        Me.Label3(63).Caption = miRsAux!codtipom & " " & miRsAux!NumFactu
        Me.Label3(63).Refresh
        
        'tmpinformes(codusu,codigo1,campo1,campo2,importe1,importe2,nombre1,observa,fecha1)
        miSQL = miSQL & ", (" & vUsu.codigo & "," & miRsAux!CodAgent & "," & miRsAux!codClien & "," & miRsAux!CodTraba
        Importe = DBLet(miRsAux!Normal, "N") * miRsAux!factor
        'Van importes, NO comisiones
        'Importe = miRsAux!factor * Importe
        'Importe = Round2((miRsAux!comisionagente * Importe) / 100, 2)
        miSQL = miSQL & "," & TransformaComasPuntos(CStr(Importe))
        Importe = DBLet(miRsAux!eco, "N") * miRsAux!factor
        'If Importe <> 0 Then
        '    Importe = miRsAux!factor * Importe
        '    Importe = Round2((miRsAux!comisionagente * Importe) / 100, 2)
        'End If
        miSQL = miSQL & "," & TransformaComasPuntos(CStr(Importe))
        Importe = DBLet(miRsAux!supereco, "N") * miRsAux!factor
        'If Importe <> 0 Then
        '    Importe = miRsAux!factor * Importe
        '    Importe = Round2((miRsAux!comisionagente * Importe) / 100, 2)
        'End If
        
        miSQL = miSQL & "," & TransformaComasPuntos(CStr(Importe))
        
        miSQL = miSQL & "," & DBSet(miRsAux!Nomclien, "T") & ",'" & miRsAux!codtipom & Format(miRsAux!NumFactu, "000000")
        miSQL = miSQL & "','" & Format(miRsAux!FecFactu, FormatoFecha) & "')"
        
    
        If Len(miSQL) > 4000 Then
            DoEvents
            miSQL = Mid(miSQL, 2)
            miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,importe1,importe2,importe3,nombre1,obser,fecha1) VALUES " & miSQL
            conn.Execute miSQL
            miSQL = ""
        End If
    
    
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    If miSQL <> "" Then
            miSQL = Mid(miSQL, 2)
            miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,importe1,importe2,importe3,nombre1,obser,fecha1) VALUES " & miSQL
            conn.Execute miSQL
    End If
    
    
    
    'Herbelca JUNIO 2015
    'sumatorio de importes de lineas de PORTES y  articulos reciclado.
    'Iran AL PIE del rpt en un subreport
    miSQL = ""
    If vParamAplic.NumeroInstalacion = 2 Then miSQL = "O"
    
        
    If miSQL <> "" Then
    
        'Solo para HERBELCA
        miSQL = "SELECT codagent,codartic,nomartic,sum(importel) sumaimporte"
        
        MontaSQLVtaasGenteTrabajador
        
        miSQL = miSQL & " AND codartic IN ("
        'If vParamAplic.ArtReciclado <> "" Then miSQL = miSQL & DBSet(vParamAplic.ArtReciclado, "T")
        'If vParamAplic.ArtPortesN <> "" Then
        '    If vParamAplic.ArtReciclado <> "" Then miSQL = miSQL & ","
        '    miSQL = miSQL & DBSet(vParamAplic.ArtPortesN, "T")
        'End If
        miSQL = miSQL & " select codartic from sartic where codprove=5000 "
        miSQL = miSQL & ") "
        miSQL = miSQL & " group by codagent,codartic"
        miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        NumRegElim = 0
        While Not miRsAux.EOF
            Me.Label3(63).Caption = " Agente " & miRsAux!CodAgent
            Me.Label3(63).Refresh
            NumRegElim = NumRegElim + 1
            'tmpslipreu(codusu,numofert,numlinea,codartic,nomartic,cantidad,precioar,importel)
            miSQL = miSQL & ", (" & vUsu.codigo & "," & miRsAux!CodAgent & "," & NumRegElim & "," & DBSet(miRsAux!codArtic, "T") & ",'FACTURA'," & DBSet(miRsAux!NomArtic, "T") & ","
            'Importe = DBLet(miRsAux!Normal, "N")
            'Van importes, NO comisiones
            'Importe = miRsAux!factor * Importe
            'Importe = Round2((miRsAux!comisionagente * Importe) / 100, 2)
            'miSQL = miSQL & "," & TransformaComasPuntos(CStr(Importe))
            'Importe = DBLet(miRsAux!eco, "N")
            'If Importe <> 0 Then
            '    Importe = miRsAux!factor * Importe
            '    Importe = Round2((miRsAux!comisionagente * Importe) / 100, 2)
            'End If
            'miSQL = miSQL & "," & TransformaComasPuntos(CStr(Importe))
            'Importe = DBLet(miRsAux!supereco, "N")
            'If Importe <> 0 Then
            '    Importe = miRsAux!factor * Importe
            '    Importe = Round2((miRsAux!comisionagente * Importe) / 100, 2)
            'End If
            'miSQL = miSQL & "," & TransformaComasPuntos(CStr(Importe)) & ")"
            Importe = DBLet(miRsAux!SumaImporte, "N")
            miSQL = miSQL & TransformaComasPuntos(CStr(Importe)) & ")"
            
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        
        If miSQL <> "" Then
            Me.Label3(63).Caption = " Insertar portes y  rae"
            Me.Label3(63).Refresh
            
            miSQL = Mid(miSQL, 2)
            'miSQL = "INSERT INTO tmpslipreu(codusu,numofert,numlinea,codartic,nomartic,cantidad,precioar,importel) VALUES " & miSQL
            miSQL = "INSERT INTO tmpslipreu(codusu,numofert,numlinea,codartic,ampliaci,nomartic,importel) VALUES " & miSQL
            conn.Execute miSQL
        End If
    End If
        
        
    If Me.chkVarios(18).Value = 1 Then
        Me.Label3(63).Caption = "Albaranes"
        Me.Label3(63).Refresh

        miSQL = "SELECT scaalb.codtipom,scaalb.numalbar, fechaalb,scaalb.codtraba,"
        miSQL = miSQL & " codagent,(1 - ((dtoppago+dtognral)/100)) factor,sum(if(pvpinferior=0,importel,0)) normal,"
        miSQL = miSQL & " sum(if(pvpinferior=1,importel,0)) eco,"
        miSQL = miSQL & " sum(if(pvpinferior=2,importel,0)) supereco,codclien,nomclien,if (comisionagente is null,0,comisionagente) comisionagente"
        miSQL = miSQL & " From scaalb, slialb Where scaalb.codtipom = slialb.codtipom"
        miSQL = miSQL & " and  scaalb.numalbar=slialb.numalbar "

        'Las fecha sNO las pongo. Todo lo que haya
        'Febrero 2014. Pongo el desde hasta fechas en albaranes  (tarea Jira)
        If Me.txtFecha(34).Text <> "" Then miSQL = miSQL & " AND scaalb.fechaalb >= " & DBSet(Me.txtFecha(34).Text, "F")
        If Me.txtFecha(35).Text <> "" Then miSQL = miSQL & " AND scaalb.fechaalb <= " & DBSet(Me.txtFecha(35).Text, "F")
        If cadSelect <> "" Then miSQL = miSQL & " AND scaalb.codtraba IN (" & cadSelect & ")"
             
        If Me.txtAgente(6).Text <> "" Then miSQL = miSQL & " AND scaalb.codagent >= " & txtAgente(6).Text
        If Me.txtAgente(7).Text <> "" Then miSQL = miSQL & " AND scaalb.codagent <= " & txtAgente(7).Text
        
        If Me.txtCliente(14).Text <> "" Then miSQL = miSQL & " AND scaalb.codclien >= " & txtCliente(14).Text
        If Me.txtCliente(15).Text <> "" Then miSQL = miSQL & " AND scaalb.codclien <= " & txtCliente(15).Text
        
        
        'Abril 2014
        'Si incluimos los FAZ
        If chkVarios(21).Value = 0 Then miSQL = miSQL & " and scaalb.codtipom<>'ALZ'"
        
        'Abril 2016
        If vParamAplic.NumeroInstalacion = 2 Then miSQL = miSQL & " AND not slialb.codartic IN (select codartic from sartic where codprove = 5000)"
        miSQL = miSQL & " group by 1,2"
        
        miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        While Not miRsAux.EOF
            Me.Label3(63).Caption = miRsAux!codtipom & " " & miRsAux!NumAlbar
            Me.Label3(63).Refresh
            
            'tmpinformes(codusu,codigo1,campo1,campo2,importe1,importe2,nombre1,observa,fecha1)
            miSQL = miSQL & ", (" & vUsu.codigo & "," & miRsAux!CodAgent & "," & miRsAux!codClien & "," & miRsAux!CodTraba
            Importe = DBLet(miRsAux!Normal, "N")
            'If Importe <> 0 Then
            '    Importe = miRsAux!factor * Importe
            '    Importe = Round2((miRsAux!comisionagente * Importe) / 100, 2)
            'End If
            miSQL = miSQL & "," & TransformaComasPuntos(CStr(Importe))
            Importe = DBLet(miRsAux!eco, "N")
            'If Importe <> 0 Then
            '    Importe = miRsAux!factor * Importe
            '    Importe = Round2((miRsAux!comisionagente * Importe) / 100, 2)
            'End If
            miSQL = miSQL & "," & TransformaComasPuntos(CStr(Importe))
            Importe = DBLet(miRsAux!supereco, "N")
            'If Importe <> 0 Then
            '    Importe = miRsAux!factor * Importe
            '    Importe = Round2((miRsAux!comisionagente * Importe) / 100, 2)
            'End If
            miSQL = miSQL & "," & TransformaComasPuntos(CStr(Importe))
            miSQL = miSQL & "," & DBSet(miRsAux!Nomclien, "T") & ",'" & miRsAux!codtipom & Format(miRsAux!NumAlbar, "000000")
            miSQL = miSQL & "','" & Format(miRsAux!FechaAlb, FormatoFecha) & "')"
            
        
            If Len(miSQL) > 4000 Then
                DoEvents
                miSQL = Mid(miSQL, 2)
                miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,importe1,importe2,importe3,nombre1,obser,fecha1) VALUES " & miSQL
                conn.Execute miSQL
                miSQL = ""
            End If
        
        
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        
        If miSQL <> "" Then
                miSQL = Mid(miSQL, 2)
                miSQL = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,importe1,importe2,importe3,nombre1,obser,fecha1) VALUES " & miSQL
                conn.Execute miSQL
        End If



        'Herbelca JUNIO 2015
        'sumatorio de importes de lineas de PORTES y  articulos reciclado.
        'Iran AL PIE del rpt en un subreport
        miSQL = ""
        If vParamAplic.NumeroInstalacion = 2 Then miSQL = "O"
        

        If miSQL <> "" Then
            
            miSQL = "SELECT codagent,codartic,nomartic,sum(importel) sumaimporte"
            
            miSQL = miSQL & " From scaalb, slialb Where scaalb.codtipom = slialb.codtipom"
            miSQL = miSQL & " and  scaalb.numalbar=slialb.numalbar "
    
            'Las fecha sNO las pongo. Todo lo que haya
            'Febrero 2014. Pongo el desde hasta fechas en albaranes  (tarea Jira)
            If Me.txtFecha(34).Text <> "" Then miSQL = miSQL & " AND scaalb.fechaalb >= " & DBSet(Me.txtFecha(34).Text, "F")
            If Me.txtFecha(35).Text <> "" Then miSQL = miSQL & " AND scaalb.fechaalb <= " & DBSet(Me.txtFecha(35).Text, "F")
            If cadSelect <> "" Then miSQL = miSQL & " AND scaalb.codtraba IN (" & cadSelect & ")"
                 
            If Me.txtAgente(6).Text <> "" Then miSQL = miSQL & " AND scaalb.codagent >= " & txtAgente(6).Text
            If Me.txtAgente(7).Text <> "" Then miSQL = miSQL & " AND scaalb.codagent <= " & txtAgente(7).Text
            
            If Me.txtCliente(14).Text <> "" Then miSQL = miSQL & " AND scaalb.codclien >= " & txtCliente(14).Text
            If Me.txtCliente(15).Text <> "" Then miSQL = miSQL & " AND scaalb.codclien <= " & txtCliente(15).Text
            
            'Abril 2014
            'Si incluimos los FAZ
            If chkVarios(21).Value = 0 Then miSQL = miSQL & " and scaalb.codtipom<>'ALZ'"
            
            
            miSQL = miSQL & " AND codartic IN ("
            miSQL = miSQL & " SELECT codartic from sartic where codprove=5000"
            miSQL = miSQL & ") group by codagent,codartic"
            miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
            miSQL = ""
            NumRegElim = 0
            While Not miRsAux.EOF
                Me.Label3(63).Caption = " Agente " & miRsAux!CodAgent
                Me.Label3(63).Refresh
                NumRegElim = NumRegElim + 1
                'tmpslipreu(codusu,numofert,numlinea,codartic,nomartic,cantidad,precioar,importel)
                miSQL = miSQL & ", (" & vUsu.codigo & "," & miRsAux!CodAgent & "," & NumRegElim & "," & DBSet(miRsAux!codArtic, "T") & ",'ALBARAN'," & DBSet(miRsAux!NomArtic, "T")
                'Importe = DBLet(miRsAux!Normal, "N")
                'Van importes, NO comisiones
                'Importe = miRsAux!factor * Importe
                'Importe = Round2((miRsAux!comisionagente * Importe) / 100, 2)
                'miSQL = miSQL & "," & TransformaComasPuntos(CStr(Importe))
                'Importe = DBLet(miRsAux!eco, "N")
                'If Importe <> 0 Then
                '    Importe = miRsAux!factor * Importe
                '    Importe = Round2((miRsAux!comisionagente * Importe) / 100, 2)
                'End If
                'miSQL = miSQL & "," & TransformaComasPuntos(CStr(Importe))
                'Importe = DBLet(miRsAux!supereco, "N")
                'If Importe <> 0 Then
                '    Importe = miRsAux!factor * Importe
                '    Importe = Round2((miRsAux!comisionagente * Importe) / 100, 2)
                'End If
                'miSQL = miSQL & "," & TransformaComasPuntos(CStr(Importe)) & ")"
                Importe = DBLet(miRsAux!SumaImporte, "N")
                miSQL = miSQL & "," & TransformaComasPuntos(CStr(Importe)) & ")"
                
                
                miRsAux.MoveNext
            Wend
            miRsAux.Close
            
            If miSQL <> "" Then
                Me.Label3(63).Caption = " Insertar portes y  rae"
                Me.Label3(63).Refresh
                
                miSQL = Mid(miSQL, 2)
                'miSQL = "INSERT INTO tmpslipreu(codusu,numofert,numlinea,codartic,nomartic,cantidad,precioar,importel) VALUES " & miSQL
                miSQL = "INSERT INTO tmpslipreu(codusu,numofert,numlinea,codartic,ampliaci,nomartic,importel) VALUES " & miSQL
                conn.Execute miSQL
            End If
        End If




    End If
    
    'Vamos a poner
    NumRegElim = 0

    For numParam = 1 To 2
        cadFormula = RecuperaValor("codigo1|campo2|", CInt(numParam))
        miSQL = "Select " & cadFormula & " from tmpinformes WHERE codusu = " & vUsu.codigo & " GROUP BY " & cadFormula

        miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        While Not miRsAux.EOF
                NumRegElim = NumRegElim + 1
                Me.Label3(63).Caption = "Agrupando datos " & numParam & " - -" & miRsAux.Fields(0)
                Me.Label3(63).Refresh
                If numParam = 1 Then
                    miSQL = DevuelveDesdeBD(conAri, "nomagent", "sagent", "codagent", miRsAux.Fields(0))
                Else
                    miSQL = DevuelveDesdeBD(conAri, "nomtraba", "straba", "codtraba", miRsAux.Fields(0))
                End If
                miSQL = "UPDATE tmpinformes set nombre" & numParam + 1 & " = " & DBSet(miSQL, "T") & " WHERE codusu =" & vUsu.codigo & " AND " & cadFormula & " = " & miRsAux.Fields(0)
                
                miRsAux.MoveNext
                conn.Execute miSQL
                
                If (NumRegElim Mod 10) = 0 Then DoEvents
        Wend
        miRsAux.Close
    Next
    If NumRegElim = 0 Then
        MsgBox "Ningun dato devuelto", vbExclamation
        Exit Function
    Else
        'El campo TOTAL
        miSQL = "UPDATE tmpinformes set importe4=importe1 + importe2 +importe3  WHERE codusu =" & vUsu.codigo
        conn.Execute miSQL
        
        GenerarDatosVtasAgenteTraba = True
    End If
    
    
    
End Function

















'----------------------------------------------------------------------------------------

Private Function GenerarArticulosMasVendidos() As Boolean

    On Error GoTo eGenerarArticulosMasVendidos
    GenerarArticulosMasVendidos = False
    
    conn.Execute "DELETE FROM tmpinformes where codusu=" & vUsu.codigo
    
    
    miSQL = " insert into tmpinformes(codusu,codigo1,nombre1,nombre2,importe1,importe2,importe3)"
    miSQL = miSQL & " select " & vUsu.codigo & ",@rownum:=@rownum+1 AS rownum,slifac.codartic,"
    miSQL = miSQL & " sartic.nomartic,sum(cantidad),sum(importel),count(scafac1.numalbar) from scafac1,slifac,sartic ,(SELECT @rownum:=0) r"
    miSQL = miSQL & " where scafac1.codtipom = slifac.codtipom And scafac1.NumFactu = slifac.NumFactu"
    miSQL = miSQL & " And scafac1.FecFactu = slifac.FecFactu and scafac1.numalbar=slifac.numalbar"
    miSQL = miSQL & " and scafac1.codtipoa=slifac.codtipoa and sartic.codartic=slifac.codartic"
    If cadSelect <> "" Then
        codigo = Replace(cadSelect, "{", "")
        codigo = Replace(codigo, "}", "")
        miSQL = miSQL & " AND " & codigo
    End If
    miSQL = miSQL & " group by slifac.codartic"
    conn.Execute miSQL
    
    miSQL = DevuelveDesdeBD(conAri, "count(*)", "tmpinformes", "codusu", CStr(vUsu.codigo))
    If miSQL <> "" Then
        If miSQL = "0" Then miSQL = ""
    End If
    If miSQL = "" Then
        MsgBox "Ningun dato devuelto", vbExclamation
    Else
        GenerarArticulosMasVendidos = True
    End If
    
eGenerarArticulosMasVendidos:
    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description
End Function


'---------------------------------------------------------------------------
'---------------------------------------------------------------------------
'---------------------------------------------------------------------------
' GENERACION FICHERO CESCE
'---------------------------------------------------------------------------
'---------------------------------------------------------------------------
'---------------------------------------------------------------------------
Private Function GeneracionFicheroCESCE() As Boolean
Dim NF As Integer
    
    On Error GoTo eGeneracionFicheroCESCE
    NF = -1
    cadNomRPT = App.Path & "\cesce.dat"
    If Dir(cadNomRPT, vbArchive) <> "" Then Kill cadNomRPT
    

    miSQL = "select scafac.codtipom,scafac.numfactu,scafac.fecfactu,codaseg,sclien.nifclien,scafac.fecfactu,"
    miSQL = miSQL & " totalfac,letraser,scafac.numfactu,min(fecefect) fecven,sclien.nomclien from scafac,sclien,svenci"
    miSQL = miSQL & ",stipom,sforpa where stipom.codtipom=scafac.codtipom and sforpa.codforpa=scafac.codforpa AND "
    miSQL = miSQL & " scafac.codtipom=svenci.codtipom and scafac.numfactu=svenci.numfactu and"
    miSQL = miSQL & " scafac.fecfactu=svenci.fecfactu and"
    miSQL = miSQL & " scafac.codclien=sclien.codclien and CliVario = 0 And credisol > 0 And codaseg <> ''"
    If Me.txtFecha(40).Text <> "" Then miSQL = miSQL & " AND scafac.fecfactu >= " & DBSet(Me.txtFecha(40).Text, "F")
    If Me.txtFecha(41).Text <> "" Then miSQL = miSQL & " AND scafac.fecfactu <= " & DBSet(Me.txtFecha(41).Text, "F")
    'No psara las de B
    miSQL = miSQL & " AND scafac.codtipom<>'FAZ' "
    
    'NO ESTA INCLIDAS LOS ABONOS
    If chkVarios(13).Value = 0 Then miSQL = miSQL & " AND totalfac >0"
        
    'Efectivo  ni tarjeta
    If chkVarios(14).Value = 0 Then miSQL = miSQL & " AND NOT tipforpa IN (0,6)"
        
    'Junio2013
    'No salen credito privado
    miSQL = miSQL & " AND credipriv =0"
    'NI si el limite del credito es cero
    miSQL = miSQL & " AND limcredi >0"
    
    
    
    
    miSQL = miSQL & " group by 1,2,3 ORDER BY sclien.nomclien,letraser,scafac.numfactu"
    
    Set miRsAux = New ADODB.Recordset
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = ""
    If Not miRsAux.EOF Then
        NF = FreeFile
        Open cadNomRPT For Output As #NF
        
        While Not miRsAux.EOF
            'CODIGO ASEGURADO, NIF CLIENTE, FECHA FRA., IMPORTE VTO., FECHA VTO., Nº FACTURA.
            miSQL = """" & miRsAux!Nomclien & """;"
            miSQL = miSQL & """" & miRsAux!codaseg & """;""" & miRsAux!nifClien & """;" & Format(miRsAux!FecFactu, "dd/mm/yyyy")
            miSQL = miSQL & ";" & CStr(miRsAux!TotalFac) & ";" & Format(miRsAux!FecVen, "dd/mm/yyyy")
            miSQL = miSQL & ";""" & DBLet(miRsAux!LetraSer, "T") & Format(miRsAux!NumFactu, "000000") & """"
            Print #NF, miSQL
            'Sig
            miRsAux.MoveNext
        Wend
        GeneracionFicheroCESCE = True
    Else
        MsgBox "Ningun dato generado", vbExclamation
    End If
    miRsAux.Close
    
    
    
eGeneracionFicheroCESCE:
    If Err.Number <> 0 Then MuestraError Err.Number
    If NF > 0 Then Close #NF
    Set miRsAux = Nothing
End Function



Private Sub CopiarEnDisco(EsCesce As Boolean)
    On Error GoTo eCopiarEnDiscoCESCE
    
    '- abrir el dialog "Guardar como" con valores por defecto
    numParam = 0
    cd1.CancelError = True
    If EsCesce Then
        cd1.DefaultExt = ".txt" 'extension por defecto
        cd1.Filter = "CSV |*.csv|" 'extensiones a mostrar
        cd1.FilterIndex = 1
    End If
    
    cd1.FileName = ""
    
    Me.cd1.ShowSave

   
    
    numParam = 1
    cadTitulo = cd1.FileName
    If Dir(cadTitulo, vbArchive) <> "" Then
        If MsgBox("El fichero ya existe. Reemplazar?", vbQuestion + vbYesNo) = vbNo Then Exit Sub
    End If
    numParam = 2
    FileCopy cadNomRPT, cadTitulo
    MsgBox "Fichero guardado con exito: " & cadTitulo, vbInformation
    
    Exit Sub
    
eCopiarEnDiscoCESCE:
    If numParam > 0 Then
        MuestraError Err.Number, Err.Description
        numParam = 0
    End If
    
End Sub



Private Function HazComisionesEco() As Boolean

    Label3(72).Caption = "Leyendo BD"
    Label3(72).Refresh

    miSQL = "select " & vUsu.codigo & ", codagent,slifac.numfactu,slifac.codtipom,slifac.fecfactu,sum(if(pvpinferior=0,importel,0)),"
    miSQL = miSQL & " sum(if(pvpinferior=1,importel,0)),brutofac,sum(if(pvpinferior=2,importel,0)),comisionagente "
    miSQL = miSQL & " from slifac,scafac"
    miSQL = miSQL & " where slifac.NumFactu = scafac.NumFactu And slifac.codtipom = scafac.codtipom"
    miSQL = miSQL & " And slifac.FecFactu = scafac.FecFactu"
    If cadSelect <> "" Then
        codigo = Replace(cadSelect, "{", "")
        codigo = Replace(codigo, "}", "")
        
        miSQL = miSQL & " AND " & codigo
    End If
    
    'Sept 2015
    miSQL = miSQL & " AND scafac.codtipom "
    If Me.chkVarios(30).Value = 1 Then
        'Presu
        miSQL = miSQL & " = "
    Else
        miSQL = miSQL & " <> "
    End If
    
    miSQL = miSQL & " 'FAZ' group by 1,2,3,4,5"

    codigo = "insert into tmpinformes(codusu,codigo1,campo1,nombre1,fecha1,importe1,importe2,importe3,importe4,importeb1) " & miSQL
    conn.Execute codigo


    Label3(72).Caption = "Articulos portes - RAE"
    Label3(72).Refresh
    
    codigo = "DELETE FROM tmpslipreu WHERE codusu =" & vUsu.codigo
    conn.Execute codigo
    
    If vParamAplic.NumeroInstalacion = 2 Then
        miSQL = Mid(miSQL, InStr(1, miSQL, " from slifac,scafac"))
        miSQL = Mid(miSQL, 1, InStr(1, miSQL, " group by "))
        
        
        codigo = ""
        'If vParamAplic.ArtReciclado <> "" Then codigo = codigo & ", " & DBSet(vParamAplic.ArtReciclado, "T")
        'If vParamAplic.ArtPortesN <> "" Then codigo = codigo & ", " & DBSet(vParamAplic.ArtPortesN, "T")
        'If codigo <> "" Then codigo = " AND slifac.codartic IN (" & Mid(codigo, 2) & ")"
        If vParamAplic.NumeroInstalacion = 2 Then codigo = " AND slifac.codartic IN (select codartic from sartic where codprove=5000)"
        miSQL = miSQL & codigo
        
        'tmpslipreu(codusu,numofert,numlinea,codartic,importel)
        
        miSQL = miSQL & " group by codartic,codagent"
        miSQL = "SELECT " & vUsu.codigo & ",codagent,count(*),codartic,nomartic,sum(importel)  " & miSQL
        miSQL = "INSERT INTO tmpslipreu(codusu,numofert,numlinea,codartic,nomartic,importel) " & miSQL
        conn.Execute miSQL
    End If
        
    'NUevo, ajustando dtos al pie
    Label3(72).Caption = "Leyendo descuentos"
    Label3(72).Refresh

    miSQL = Replace(cadSelect, "slifac", "scafac")
    If miSQL <> "" Then
        miSQL = Replace(miSQL, "{", "")
        miSQL = Replace(miSQL, "}", "")
        miSQL = miSQL & " AND "
    End If
    miSQL = miSQL & " dtoppago+dtognral>0"  'dtoppago dtognral
    
    'Sept 2015
    miSQL = miSQL & " AND scafac.codtipom "
    If Me.chkVarios(30).Value = 1 Then
        'Presu
        miSQL = miSQL & " = "
    Else
        miSQL = miSQL & " <> "
    End If
    
    miSQL = miSQL & " 'FAZ' "
    
    miSQL = "FROM scafac WHERE " & miSQL
    miSQL = "Select codtipom,numfactu,fecfactu,dtoppago,dtognral " & miSQL
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    
    While Not miRsAux.EOF
        'Para cada linea le aplicaremos los decuentos
        'Los calculamos igual que en el mlistado agentes
        Label3(72).Caption = "Dto: " & miRsAux!codtipom & " " & miRsAux!NumFactu
        Label3(72).Refresh

        codigo = CStr(Round((1 - (miRsAux!DtoPPago / 100)), 2) * Round((1 - (miRsAux!DtoGnral / 100)), 2))
        codigo = TransformaComasPuntos(codigo)
        miSQL = "UPDATE tmpinformes SET importe1=round(importe1 * " & codigo & ",2)"
        miSQL = miSQL & ", importe2=round(importe2 * " & codigo & ",2) "
        miSQL = miSQL & ", importe4=round(importe4 * " & codigo & ",2) , campo2=1 WHERE "  '1: para saber que henmos modificado
        miSQL = miSQL & " nombre1='" & miRsAux!codtipom & "' ANd campo1=" & miRsAux!NumFactu
        miSQL = miSQL & " AND fecha1=" & DBSet(miRsAux!FecFactu, "F") & " AND codusu = " & vUsu.codigo
        conn.Execute miSQL

        
        miRsAux.MoveNext
    Wend
    miRsAux.Close

    
    Label3(72).Caption = "Ajustando valores"
    Label3(72).Refresh
    DoEvents
    Espera 0.23
    codigo = "UPDATE tmpinformes set importe3=importe1 + importe2 WHERE codusu = " & vUsu.codigo & " AND campo2=1"
    conn.Execute codigo

    codigo = "Select codigo1 from tmpinformes where codusu = " & vUsu.codigo & " GROUP BY codigo1"
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    codigo = ""
    While Not miRsAux.EOF
        
        codigo = CStr(miRsAux!Codigo1) 'para abajo
        miSQL = DevuelveDesdeBD(conAri, "nomagent", "sagent", "codagent", codigo)
        If miSQL = "" Then miSQL = "N/D"
        Label3(72).Caption = "Agente: " & miSQL
        Label3(72).Refresh
        If miSQL <> "" Then
            miSQL = DBSet(miSQL, "T")
            miSQL = "update tmpinformes set nombre2=" & miSQL & " WHERE codusu = " & vUsu.codigo
            miSQL = miSQL & " AND codigo1 = " & codigo
            conn.Execute miSQL
        End If
        miRsAux.MoveNext



    Wend
    miRsAux.Close
    
    
    
    
    
    
    
    
    
    Label3(72).Caption = "Abrir informe"
    Label3(72).Refresh
    
    If codigo = "" Then
        MsgBox "No hay datos ", vbExclamation
        HazComisionesEco = False 'NO ha datos
    Else
        HazComisionesEco = True
    End If
    
End Function



'---------------------------------------------------------------------------
'---------------------------------------------------------------------------
'---------------------------------------------------------------------------
' Lisatado agente  familia   marca
'---------------------------------------------------------------------------
'---------------------------------------------------------------------------
'---------------------------------------------------------------------------

Private Function AgenteFamiliaMarca() As Boolean
Dim Impo1 As Currency: Dim Impo2 As Currency: Dim Impo3 As Currency

    AgenteFamiliaMarca = False
    
    miSQL = "DELETE FROM tmpinformes where codusu = " & vUsu.codigo
    conn.Execute miSQL
    
    InicializarVbles True
    
    Label3(81).Caption = "Leyendo registros"
    Label3(81).Refresh

    
    If txtAgente(10).Text <> "" Or txtAgente(11).Text <> "" Then
        miSQL = "pdH1=""Agente: "
        codigo = "{scafac.codagent}"

        If Not PonerDesdeHasta(codigo, "AGT", 10, 11, miSQL) Then Exit Function
    End If
     
    cadNomRPT = ""
    If txtFecha(50).Text <> "" Or txtFecha(51).Text <> "" Then
        miSQL = " Fecha: "
        codigo = "{scafac.fecfactu}"
        If Not PonerDesdeHasta(codigo, "F", 50, 51, miSQL) Then Exit Function
        cadNomRPT = miSQL
    End If
    
    If Me.chkVarios(22).Value = 1 Then cadNomRPT = Trim(cadNomRPT & "    [Presu]")
    
    If txtmarca(1).Text <> "" Or txtmarca(2).Text <> "" Then
        miSQL = "Marca: "
        codigo = "{sartic.codmarca}"
    
        If Not PonerDesdeHasta(codigo, "MAR", 1, 2, miSQL) Then Exit Function
        cadNomRPT = Trim(cadNomRPT & "   " & miSQL)
    End If
    CadParam = CadParam & "pdH3=""" & cadNomRPT & """|"
    numParam = numParam + 1
      
    If txtFamia(21).Text <> "" Or txtFamia(22).Text <> "" Then
        miSQL = "pdH3="""
        codigo = "{sartic.codfamia}"
        If Not PonerDesdeHasta(codigo, "FAM", 21, 22, miSQL) Then Exit Function
        If cadPDFrpt <> "" Then cadPDFrpt = cadPDFrpt & "              "
        cadPDFrpt = cadPDFrpt & miSQL
    End If
    
    'marzo 2014.
    'Posibilidad de que vayan detalladas las facturas
    '
'    miSQL = "select " & vUsu.codigo & ", codagent,sartic.codfamia,codmarca,nomfamia,sum(importel) from scafac,slifac,sartic,sfamia where"
'    miSQL = miSQL & " scafac.codtipom=slifac.codtipom and scafac.numfactu=slifac.numfactu and scafac.fecfactu=slifac.fecfactu and"
'    miSQL = miSQL & " slifac.codArtic = sartic.codArtic And sfamia.Codfamia = sartic.Codfamia AND scafac.codtipom<>'FAZ'"
'    If cadSelect <> "" Then
'        cadSelect = Replace(cadSelect, "{", "")
'        cadSelect = Replace(cadSelect, "}", "")
'        miSQL = miSQL & " AND " & cadSelect
'    End If
'    miSQL = miSQL & " group by 1,2,3"


    'Enero 2015
    'Llevaremos las ECO
    miSQL = "select " & vUsu.codigo & ", codagent,sartic.codfamia,codmarca,nomfamia,"    'sum(importel)"
    If Me.chkVarios(26).Value = 0 Then
        'Lo que habia. Sin descglosar proveedor
        miSQL = miSQL & " round(sum( ((1 - (dtoppago+dtognral)/100))*importel),4),0,0"
    Else
        miSQL = miSQL & " if(pvpinferior=0,round(sum( ((1 - (dtoppago+dtognral)/100))*importel),4),0),"
        miSQL = miSQL & " if(pvpinferior=1,round(sum( ((1 - (dtoppago+dtognral)/100))*importel),4),0),"
        miSQL = miSQL & " if(pvpinferior>1,round(sum( ((1 - (dtoppago+dtognral)/100))*importel),4),0)"
    End If
    miSQL = miSQL & ",scafac.fecfactu,concat("
    miSQL = miSQL & "concat(scafac.codtipom,right(concat('0000000',scafac.numfactu),7))"  'Campo 1 del observa
    miSQL = miSQL & ",nomclien),pvpinferior"
    miSQL = miSQL & " from scafac,slifac,sartic,sfamia where"
    miSQL = miSQL & " scafac.codtipom=slifac.codtipom and scafac.numfactu=slifac.numfactu and scafac.fecfactu=slifac.fecfactu and"
    miSQL = miSQL & " slifac.codArtic = sartic.codArtic And sfamia.Codfamia = sartic.Codfamia "
    If Me.chkVarios(22).Value = 0 Then miSQL = miSQL & " AND scafac.codtipom<>'FAZ'"
    
    
    'FALTA
    
    
    
    If cadSelect <> "" Then
        cadSelect = Replace(cadSelect, "{", "")
        cadSelect = Replace(cadSelect, "}", "")
        miSQL = miSQL & " AND " & cadSelect
    End If
    miSQL = miSQL & " group by 1,2,3,10,11"
    miSQL = miSQL & " ORDER by 10,11"

    
    'codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,nombre2,fecha1,obser,importe1,importe2,importe3) " & miSQL
    'conn.Execute codigo
    
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockOptimistic, adCmdText
    codigo = ""
    cadPDFrpt = ""
    miSQL = ""
    'codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,nombre2,fecha1,obser,importe1,importe2,importe3) "
    While Not miRsAux.EOF
        If miRsAux.Fields(9) <> cadPDFrpt Then
            If cadPDFrpt <> "" Then
            
                Label3(81).Caption = cadPDFrpt
                Label3(81).Refresh
            
                
                codigo = codigo & miSQL & DBSet(Impo1, "N") & "," & DBSet(Impo2, "N") & "," & DBSet(Impo3, "N") & ")"
                
                If Len(miSQL) > 10000 Then
                    codigo = Mid(codigo, 2)
                    codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,nombre2,fecha1,obser,importe1,importe2,importe3) VALUES " & codigo
                    conn.Execute codigo
                    codigo = ""
                End If
            End If
            'ASignamos la nueva
            cadPDFrpt = miRsAux.Fields(9)
            Impo1 = 0: Impo2 = 0: Impo3 = 0
            
            'para el insert a falta de los importes
            miSQL = ", (" & miRsAux.Fields(0) & "," & miRsAux.Fields(1) & "," & miRsAux.Fields(2)
            miSQL = miSQL & "," & miRsAux.Fields(3) & "," & DBSet(miRsAux.Fields(4), "T") & ","
            miSQL = miSQL & DBSet(miRsAux.Fields(8), "F") & "," & DBSet(miRsAux.Fields(9), "T") & ","
            
        End If
        If miRsAux!PVPInferior = 2 Then
            Impo3 = Impo3 + miRsAux.Fields(7)
        ElseIf miRsAux!PVPInferior = 1 Then
            Impo2 = Impo2 + miRsAux.Fields(6)
        Else
            Impo1 = Impo1 + miRsAux.Fields(5)
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    cadPDFrpt = ""
    
    'Completamos el ultimo
    If miSQL <> "" Then codigo = codigo & miSQL & DBSet(Impo1, "N") & "," & DBSet(Impo2, "N") & "," & DBSet(Impo3, "N") & ")"
    
    If codigo <> "" Then

        codigo = Mid(codigo, 2)
        codigo = "INSERT INTO tmpinformes(codusu,codigo1,campo1,campo2,nombre2,fecha1,obser,importe1,importe2,importe3) VALUES " & codigo
        conn.Execute codigo
        

    End If
    Label3(81).Caption = "Ajuste agentes"
    Label3(81).Refresh
    codigo = "select codigo1,nomagent from tmpinformes,sagent where codigo1=codagent AND codusu=" & vUsu.codigo & " GROUP BY 1"
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockOptimistic, adCmdText
    codigo = ""
    While Not miRsAux.EOF
            
        Label3(81).Caption = miRsAux!NomAgent
        Label3(81).Refresh
        codigo = "UPDATE tmpinformes set nombre1= " & DBSet(miRsAux!NomAgent, "T") & " WHERE codusu =" & vUsu.codigo & " AND codigo1=" & miRsAux!Codigo1
        conn.Execute codigo
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    If codigo = "" Then
        MsgBox "Ningun dato generado", vbExclamation
        Exit Function
    End If
    
    Label3(81).Caption = "Sumatorios"
    Label3(81).Refresh
    
    codigo = "UPDATE tmpinformes SET importe4=importe1 + importe2 + importe3  WHERE tmpinformes.codusu = " & vUsu.codigo
    conn.Execute codigo
    
    
    Label3(81).Caption = "Ajuste marca"
    Label3(81).Refresh
    codigo = "select campo2,nommarca from tmpinformes,smarca where campo2=codmarca AND codusu=" & vUsu.codigo & " GROUP BY 1"
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockOptimistic, adCmdText
    While Not miRsAux.EOF
            
        Label3(81).Caption = miRsAux!nommarca
        Label3(81).Refresh
        codigo = "UPDATE tmpinformes set nombre3= " & DBSet(miRsAux!nommarca, "T") & " WHERE codusu =" & vUsu.codigo & " AND campo2=" & miRsAux!campo2
        conn.Execute codigo
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    Label3(81).Caption = ""
    AgenteFamiliaMarca = True
    
End Function


Private Sub CargaCboCompañia(Cual As Integer)
    
    ListView2(Cual).ListItems.Clear
        
        
        Set miRsAux = New ADODB.Recordset
        miSQL = "Select * from stfnooperador ORDER BY codoperador "
        miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        numParam = 0
        While Not miRsAux.EOF
            numParam = numParam + 1
            ListView2(Cual).ListItems.Add , , miRsAux!Nombre
            ListView2(Cual).ListItems(numParam).Checked = True
            ListView2(Cual).ListItems(numParam).Tag = miRsAux!codoperador
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        Set miRsAux = Nothing
End Sub


'**************************************************************************************
'**************************************************************************************
'**************************************************************************************
'
'       Aguas potables
'
'**************************************************************************************
'**************************************************************************************
'**************************************************************************************

Private Function PonerDatosFacturacion() As Boolean
Dim Periodo As Byte
    On Error GoTo ePonerDatosFacturacion
    PonerDatosFacturacion = False
    Set miRsAux = New ADODB.Recordset
    miSQL = "Select UtimoPeridoLiquidado,UltimoAnyoLiquidado,bloque1D , bloque1I,periodoFac from sparamagua"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    
    'NO PUEDE SER EOF, ni valores NULL
    numParam = miRsAux!periodoFac
    Periodo = miRsAux!UtimoPeridoLiquidado
    NumRegElim = miRsAux!UltimoAnyoLiquidado
    cadNomRPT = miRsAux!bloque1D
    cadTitulo = miRsAux!bloque1I
    
    
    'Si llega aqui es que ha ido bien
    'Calculamos el periodo a liquidar
    
    'vMostrarTree Sera que el periodo ha superado el año y vamos a por el año siguiente
    vMostrarTree = False
    If numParam > 0 Then Periodo = Periodo + 1
    Select Case numParam
    Case 0
        cadFormula = "Anual"
        NumRegElim = NumRegElim + 1
        
    Case 1
        cadFormula = "Mes"
        If Periodo > 12 Then vMostrarTree = True
    Case 2
        cadFormula = "Bimestre"
        If Periodo > 6 Then vMostrarTree = True
    
    Case 3
        cadFormula = "Trimestre"
        If Periodo > 4 Then vMostrarTree = True
        
    Case 4
        cadFormula = "Cuatrimestre"
        If Periodo > 3 Then vMostrarTree = True
    
    Case 6
        cadFormula = "Semestre"
        If Periodo > 2 Then vMostrarTree = True
        
    
    Case Else
        cadFormula = miRsAux!NoexisteElTipoFacturacion
        
    End Select
    
    'Ha superado los periodos del año, cambiamos del año
    CadParam = "º"
    If vMostrarTree Then
        Periodo = 1
        NumRegElim = NumRegElim + 1
        CadParam = "er"
    End If
    'Este campo ira a la observacion 4, indicando el periodo facturado
    
    Me.TxtNoEscribible(0).Text = "Periodo: " & Periodo & CadParam & " " & cadFormula & " " & NumRegElim
    
    CadParam = ""
    PonerDatosFacturacion = True
    miRsAux.Close
    
ePonerDatosFacturacion:
    If Err.Number <> 0 Then MuestraError Err.Number, "Leyendo parametros"
    Set miRsAux = Nothing
End Function



Private Function ComprobacionesAgua() As Boolean

    On Error GoTo eComprobacionesAgua

    numParam = FreeFile
    ComprobacionesAgua = False
    cadTitulo = App.Path & "\agua.txt"
    Open cadTitulo For Output As #numParam
    
    
    Set miRsAux = New ADODB.Recordset
    
    Label3(84).Caption = "Comprobar contadores"
    Label3(84).Refresh
    conSubRPT = False 'Tiene errores
    
    cadSelect = "select contador from aguacontadores WHERE aguacontadores.facturar=1 AND not codclien IN ("
    cadSelect = cadSelect & " select codclien from sclien )"
    miRsAux.Open cadSelect, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then
        Print #numParam, "Cliente erroneo en contador" & vbCrLf & String(40, "=") & vbCrLf
        conSubRPT = True
    
        While Not miRsAux.EOF
            Print #numParam, " -" & Mid(miRsAux!Contador & Space(20), 1, 20)
        
            miRsAux.MoveNext
        Wend
        Print #numParam, vbCrLf & vbCrLf
    End If
    miRsAux.Close
    
    cadSelect = "select contador,aguacontadores.codclien,nomclien,domconta from aguacontadores left join sclien "
    cadSelect = cadSelect & "  on aguacontadores.codclien=sclien.codclien WHERE aguacontadores.facturar=1  "
    'Los aforos NO tienen lectura
    cadSelect = cadSelect & " AND TipoFacturacion = 0 AND "
    codigo = cadSelect & " lec_actual Is Null"
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then
        Print #numParam, "Lectura actual VACIA" & vbCrLf & String(40, "=") & vbCrLf
        conSubRPT = True
            
        While Not miRsAux.EOF
            Print #numParam, " -" & Mid(miRsAux!Contador & Space(20), 1, 20) & Mid(miRsAux!Nomclien & Space(40), 1, 40) & _
                Format(miRsAux!codClien, "000000") & " " & Mid(miRsAux!domconta & Space(40), 1, 40)

            miRsAux.MoveNext
        Wend
        Print #numParam, vbCrLf & vbCrLf
    End If
    miRsAux.Close
    
    codigo = cadSelect & "lec_anterior > lec_actual"
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then
        Print #numParam, "Lectura anterior mayor que lectura actual" & vbCrLf & String(40, "=") & vbCrLf
        conSubRPT = True
            
        While Not miRsAux.EOF
            Print #numParam, " -" & Mid(miRsAux!Contador & Space(20), 1, 20) & Mid(DBLet(miRsAux!Nomclien, "T") & Space(40), 1, 40) & _
                Format(miRsAux!codClien, "000000") & " " & Mid(miRsAux!domconta & Space(40), 1, 40)

            miRsAux.MoveNext
        Wend
        Print #numParam, vbCrLf & vbCrLf
    End If
    miRsAux.Close


    
    
    codigo = "aguacontadores.codforpa in (select codforpa from sforpa where numerove>1)"
    codigo = cadSelect & codigo
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then
        Print #numParam, "Error en numero vencimientos forma de pago" & vbCrLf & String(40, "=") & vbCrLf
        conSubRPT = True
            
        While Not miRsAux.EOF
            Print #numParam, " -" & Mid(miRsAux!Contador & Space(20), 1, 20) & Mid(DBLet(miRsAux!Nomclien, "T") & Space(40), 1, 40) & _
                Format(miRsAux!codClien, "000000") & " " & Mid(miRsAux!domconta & Space(40), 1, 40)

            miRsAux.MoveNext
        Wend
        Print #numParam, vbCrLf & vbCrLf
    End If
    miRsAux.Close




    'Mas comprobaciones. De la tabla de parametros de agua.
    'Los articulos
    
    Label3(84).Caption = "Parametros facturacion"
    Label3(84).Refresh
    
    'Todos los articulos en parametros deben estar
    
    'Copiado de paramtros aguua
    codigo = "artCuotaConD|artCuotaConI|artCuotaServD|artCuotaServI|artAlcanConD|artAlcanConI|artAlcanServD|artAlcanServI|artContadorD|"
    codigo = codigo & "artContadorI|artAmortD|artAmortI|artVarios|artCuotaConGenD|artCuotaConGenI|artCuotaServGenD|artCuotaServGenI"
    codigo = Replace(codigo, "|", ",")
    
    
    codigo = "select " & codigo & " from sparamagua "
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If miRsAux.EOF Then
        conSubRPT = True
        Print #numParam, "Parametros incorrectos (I)" & vbCrLf & String(40, "=") & vbCrLf
    Else
        cadNomRPT = ""
        For NumRegElim = 0 To 5
            cadSelect = ""
            If IsNull(miRsAux.Fields(NumRegElim)) Then
                cadSelect = miRsAux.Fields(NumRegElim).Name & " Nulo"
            Else
                cadFormula = DevuelveDesdeBD(conAri, "nomartic", "sartic", "codartic", miRsAux.Fields(NumRegElim), "T")
                If cadFormula = "" Then cadSelect = miRsAux.Fields(NumRegElim).Name & " No existe el articulo"
            End If
            If cadSelect <> "" Then cadNomRPT = cadNomRPT & "-" & cadSelect & vbCrLf
            
        Next NumRegElim
        If cadNomRPT <> "" Then
            Print #numParam, "Articulos en parametros incorrectos (II)" & vbCrLf & String(40, "=") & vbCrLf & cadNomRPT
            conSubRPT = True
        End If
    End If
    miRsAux.Close
    
    
    'Qu todos los contadores tienen el calibre eb la tabla calibres
    codigo = "Select contador,codclien from aguacontadores where not codcalibre in (select codcalibre from aguacalibre)"
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then
        Print #numParam, "Calibre incorrecto" & vbCrLf & String(40, "=") & vbCrLf
        conSubRPT = True
        While Not miRsAux.EOF
            Print #numParam, "Contador  " & miRsAux!Contador & "   Cliente " & miRsAux!codClien
            miRsAux.MoveNext
        Wend
        conSubRPT = True
    End If
    miRsAux.Close
    
    
    'Que todos los calibres tienen puesto valor a las cuotas
    'Copiado de frmcalibres
    codigo = "CuotaSerD|CuotaSerI|SerAlcanD|SerAlcanI|ContadD|ContadI|SerTranAmorD|SerTranAmorI|CuotaCanonGenD|CuotaCanonGenI"
    codigo = Replace(codigo, "|", ",")
    codigo = "select codcalibre,nomcalibre," & codigo & " from aguacalibre WHERE codcalibre in "
    codigo = codigo & "(select codcalibre from aguacontadores where Facturar=1 )" 'FALTA### and lec_actual>=0
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If miRsAux.EOF Then
       
    Else
        cadNomRPT = ""
        For NumRegElim = 2 To miRsAux.Fields.Count - 1
            If IsNull(miRsAux.Fields(NumRegElim)) Then cadNomRPT = cadNomRPT & miRsAux!nomcalibre & " " & miRsAux.Fields(NumRegElim).Name & vbCrLf
        Next
        If cadNomRPT <> "" Then
            Print #numParam, "Precios calibre" & vbCrLf & String(40, "=") & vbCrLf & cadNomRPT
            conSubRPT = True
        End If
    End If
    miRsAux.Close
    
    'QUE NO existan albaranes ALG , de agua , pendientes de facturar
    codigo = "Select numalbar,fechaalb,codclien,nomclien from scaalb where codtipom = 'ALG'"
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then
        Print #numParam, "Albaranes pendientes" & vbCrLf & String(40, "=") & vbCrLf
        conSubRPT = True
            
        While Not miRsAux.EOF
            Print #numParam, " -" & Mid(miRsAux!NumAlbar & " " & miRsAux!FechaAlb & Space(20), 1, 20) & Mid(miRsAux!Nomclien & Space(40), 1, 40) & _
                Format(miRsAux!codClien, "000000")

            miRsAux.MoveNext
        Wend
        Print #numParam, vbCrLf & vbCrLf
    End If
    miRsAux.Close
    
    
    
        
        
    
      
    Close #numParam

    If conSubRPT Then
        MsgBox "Hay errores para facturar periodo", vbExclamation
        LanzaVisorMimeDocumento Me.hwnd, cadTitulo
    Else
        ComprobacionesAgua = True
    End If
    
eComprobacionesAgua:
    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description
    Set miRsAux = Nothing
    Label3(84).Caption = ""
    
End Function


'Proceso de facturacion
'

'   Para cada contador, generara una factura.
'   scafac      REFERENC   nºContador
'               obs1    lectura anterior
'               obs2    lectura actual
'       obs3    calibre caudal

'
'  slifac      linea
'               1..5   cuota consumo (aunque solo se utilizaran 3,de momento)
'               6..19  cutoas servicio Como maximo 15, de momento por parametros 5,
'           las del canon de saneamiento
'               20..25 cuota consumo (aunque solo se utilizaran 3,de momento)
'               26..    cutos servicio

Private Function procesoFacturacionAgua_() As Boolean

    procesoFacturacionAgua_ = False
    
    
    'Crearemos albaranes
    Set miRsAux = New ADODB.Recordset
    
    
    If Not procesoFacturacionAgua_InserALB Then Exit Function
    
    
    

    
    'contador,fecha_factura,lec_anterior,fecha_anterior,lec_actual,fecha_actual
        '2º paso.
    '
    'pasamos a aguahcolecturas
    
    'aqui aqui aqui  FALTA###
    
    miSQL = "Contador ,  lec_anterior, fecha_anterior, lec_actual, fecha_actual"
    codigo = "select " & miSQL & "," & DBSet(Me.txtFecha(54).Text, "F") & " from aguacontadores WHERE aguacontadores.facturar=1 "
    codigo = "INSERT INTO aguahcolecturas(" & miSQL & ",fecha_factura) " & codigo
    

    If Not ejecutar(codigo, False) Then
        MsgBox "Avise soporte técnico. Insertando hco lecturas contadores", vbCritical
        Exit Function
    End If
    
    'Incrementaremos el contador
    miSQL = DevuelveDesdeBD(conAri, "max(numalbar)", "scaalb", "codtipom", "ALG", "T")
    'No puede ser ""
    miSQL = "UPDATE stipom set contador=" & miSQL & " WHERE codtipom = 'ALG'"
    conn.Execute miSQL
    
    FacturarContadoresAgua txtFecha(54).Text, txtBanco(4).Text, Label3(84), ""
    
    'Proceso final. Contador   Datos actual --> Datos anterior
    '                           "     "     -->  NULL
    Label3(84).Caption = "Actualizar datos contadores"
    Label3(84).Refresh
    Espera 0.5
    cadTitulo = ""
    miSQL = "Actualizar contadores "
    codigo = "UPDATE aguacontadores Set lec_anterior= lec_actual ,  fecha_anterior=fecha_actual WHERE aguacontadores.facturar=1 "
    If Not ejecutar(codigo, False) Then cadTitulo = cadTitulo & vbCrLf & " - Actualizar lec.anterior"
    codigo = "UPDATE aguacontadores Set  lec_actual =null,  fecha_actual=null,consumo=null WHERE aguacontadores.facturar=1 "
    If Not ejecutar(codigo, False) Then cadTitulo = cadTitulo & vbCrLf & " - Actualizar lec. actual"
    If cadTitulo <> "" Then MsgBox "Avise soporte técnico. " & cadTitulo, vbCritical
            
    If cadTitulo = "" Then
        procesoFacturacionAgua_ = True
        If Me.chkVarios(23).Value = 1 Then
            'Actualizamos el periodo de facturacion
            'Como lo sabemos?
            '1:er  Resto: "º"
            
            
            numParam = InStr(1, Me.TxtNoEscribible(0).Text, ":")
            codigo = Mid(Me.TxtNoEscribible(0).Text, numParam + 1)
            
            numParam = InStr(1, codigo, "º")
            If numParam = 0 Then numParam = InStr(1, codigo, "er")
            'no puede ser 0
            miSQL = Trim(Mid(codigo, 1, numParam - 1))
            codigo = Right(codigo, 4)  'los 4 ultimos el año
            
            miSQL = "UPDATE sparamagua set UtimoPeridoLiquidado =" & miSQL
            miSQL = miSQL & ", UltimoAnyoLiquidado=" & codigo
            ejecutar miSQL, False
            
        End If
            
     
   
        
        
        
    End If
            
    
End Function


Private Function procesoFacturacionAgua_InserALB() As Boolean
Dim linea As Byte
'De aqui cogera el aticulo
Dim RsParametros As ADODB.Recordset
Dim rsConcep As ADODB.Recordset
Dim J As Integer
Dim ARti2 As String
Dim canti As Integer
Dim Precio2 As Currency
Dim mesesPeriodo As Integer
Dim FInicioPeriodo As Date
Dim FF As Date
Dim ConsumoM3 As Integer

    On Error GoTo eprocesoFacturacionAgua_Inser
    
    procesoFacturacionAgua_InserALB = False
    
    Label3(84).Caption = "Leyendo valores facturacion"
    Label3(84).Refresh
    
    CadParam = codigo 'Numero de registros a insertar
    cadPDFrpt = PonerTrabajadorConectado(codigo)   'codtraba
    
    
    
    'Obtengo contador de albaranes
    NumRegElim = Val(DevuelveDesdeBD(conAri, "contador", "stipom", "codtipom", "ALG", "T"))
    NumRegElim = NumRegElim + 1

    Set rsConcep = New ADODB.Recordset
    Set RsParametros = New ADODB.Recordset
    
    RsParametros.Open "Select * from sparamagua", conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    
    Select Case RsParametros!periodoFac
    Case 0
        'cadFormula = "Anual"
        'NumRegElim = NumRegElim + 1
        mesesPeriodo = 12
        
    Case 1
        'cadFormula = "Mes"
        'If Periodo > 12 Then vMostrarTree = True
        mesesPeriodo = 1
    Case 2
        'cadFormula = "Bimestre"
        'If Periodo > 6 Then vMostrarTree = True
        mesesPeriodo = 2
    Case 3
        'cadFormula = "Trimestre"
        'If Periodo > 4 Then vMostrarTree = True
        mesesPeriodo = 3
    Case 4
        'cadFormula = "Cuatrimestre"
        'If Periodo > 3 Then vMostrarTree = True
        mesesPeriodo = 4
    Case 6
        'cadFormula = "Semestre"
        'If Periodo > 2 Then vMostrarTree = True
        mesesPeriodo = 6
    
    Case Else
        'cadFormula = miRsAux!NoexisteElTipoFacturacion
         Err.Raise 513, , "Parametros periodo facturacion incorrecto"
    End Select
    
    
    'Fecha incio periodo

    
    If RsParametros!periodoFac = 0 Then
        'Anual
        'J = DiasMes(RS!UtimoPeridoLiquidado, RS!UltimoAnyoLiquidado)
        FInicioPeriodo = CDate("01/" & RsParametros!UtimoPeridoLiquidado & "/" & RsParametros!UltimoAnyoLiquidado)
        FInicioPeriodo = DateAdd("yyyy", 1, FInicioPeriodo)
    Else
        'Periodos
        
        J = mesesPeriodo * RsParametros!UtimoPeridoLiquidado
        FInicioPeriodo = CDate("01/" & J & "/" & RsParametros!UltimoAnyoLiquidado)
        FInicioPeriodo = DateAdd("m", 1, FInicioPeriodo)
        
    End If
    
    
    
   
    
    
    
    cadFormula = "INSERT INTO scaalb(codtipom,numalbar,fechaalb,factursn,codclien,nomclien,domclien,codpobla,pobclien,"
    cadFormula = cadFormula & "proclien,nifclien,telclien,referenc,facturkm,codtraba,codtrab1,codtrab2,codagent,"
    cadFormula = cadFormula & "codforpa,codenvio,dtoppago,dtognral,tipofact,numpedcl,observa01,observa02,observa03,observa04,"
    cadFormula = cadFormula & "observa05,esticket) VALUES ("
    
    cadSelect = "INSERT INTO slialb (codtipom,numalbar,numlinea,codalmac,codartic,nomartic,"
    cadSelect = cadSelect & "ampliaci,cantidad,numbultos,precioar , dtoline1, dtoline2, ImporteL, origpre, codproveX) VALUES "
    
    
    codigo = "Select count(*) from aguacontadores where facturar=1"
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    'no puede ser eof
    CadParam = miRsAux.Fields(0)
    miRsAux.Close
    
    codigo = "select aguacontadores.*,aguacalibre.*"
    codigo = codigo & ",nomclien,domclien,codpobla,pobclien,proclien,nifclien,telclie1,CodEnvio"
    codigo = codigo & " from aguacontadores left join sclien on aguacontadores.codclien=sclien.codclien"
    codigo = codigo & "  left join aguacalibre on aguacontadores.codcalibre=aguacalibre.codcalibre "
    codigo = codigo & " WHERE aguacontadores.facturar=1   ORDER BY codclien,contador"
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    Label3(84).Tag = 0
    While Not miRsAux.EOF
    
        
    
        Label3(84).Tag = Val(Label3(84).Tag) + 1
        Label3(84).Caption = Label3(84).Tag & " / " & CadParam & " - " & miRsAux!Nomclien
        Label3(84).Refresh
        If (NumRegElim Mod 25) = 0 Then
            DoEvents
            Me.Refresh
            Screen.MousePointer = vbHourglass
        End If
    
    
        'If miRsAux!Contador = "08AC001621" Then
    
    
        'Para ver cuantos conceptos se facturan
        codigo = "Select * from aguacontadoresconce where contador =" & DBSet(miRsAux!Contador, "T") & " ORDER BY codconceAg"
        rsConcep.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        
        'LA CABECERA
        '------------------------------------------------------------------------------------------------------
        'codtipom,numalbar,fechaalb,factursn,codclien
        codigo = "'ALG'," & NumRegElim & " ," & DBSet(Me.txtFecha(54).Text, "F") & ",1," & DBSet(miRsAux!codClien, "T") & ","
        'nomclien,domclien,codpobla,pobclien,proclien,nifclien
        codigo = codigo & DBSet(miRsAux!Nomclien, "T") & "," & DBSet(miRsAux!domclien, "T") & "," & DBSet(miRsAux!codpobla, "T")
        codigo = codigo & "," & DBSet(miRsAux!pobclien, "T", "N") & "," & DBSet(miRsAux!proclien, "T", "N") & "," & DBSet(miRsAux!nifClien, "T", "N")
        'telclien,referenc,facturkm codtraba,codtrab1,codtrab2,codagent,
        codigo = codigo & "," & DBSet(miRsAux!telclie1, "T") & "," & DBSet(miRsAux!Contador, "T") & ",0," & cadPDFrpt & "," & cadPDFrpt & "," & cadPDFrpt & "," & vParamAplic.PorDefecto_Agente
        'codforpa,codenvio,dtoppago,dtognral,tipofact,numpedcl
        codigo = codigo & "," & miRsAux!codforpa & "," & miRsAux!CodEnvio & ",0,0,1,null,"  'factura x albaran
        'observa01,observa02
        cadNomRPT = ""
        If IsNull(miRsAux!fecha_anterior) Then
            cadNomRPT = "--/--/----"
        Else
            cadNomRPT = Format(miRsAux!fecha_anterior, "dd/mm/yyyy")
        End If
        cadNomRPT = cadNomRPT & "  " & Format(DBLet(miRsAux!lec_anterior, "N"), "0000")
        
        codigo = codigo & DBSet(cadNomRPT, "T") & ",'" & Format(miRsAux!fecha_actual, "dd/mm/yyyy") & " " & Format(miRsAux!lec_actual, "0000") & "',"
        
        'observa03,observa04,
        J = InStr(1, TxtNoEscribible(0).Text, ":") + 1
        codigo = codigo & DBSet(miRsAux!nomcalibre, "T") & "," & DBSet(Trim(Mid(TxtNoEscribible(0).Text, J)), "T")
        'observa05,esticket
        ' obs05 llevara los textos del DOGV y el tfno de averias
        ' con lo cual sera
        ' Dogv1(30)   Dogv3(30)  Tefono averias (20
        cadNomRPT = Mid(DBLet(RsParametros!TextoDOGV1, "T") & Space(40), 1, 30) & Mid(DBLet(RsParametros!TextoDOGV2, "T") & Space(40), 1, 30)
        cadNomRPT = cadNomRPT & Mid(DBLet(RsParametros!TfnoAverias, "T") & Space(30), 1, 20)
        codigo = codigo & "," & DBSet(cadNomRPT, "T") & ",0)"
         

        
        conn.Execute cadFormula & codigo
        
        codigo = ""

        
        
        'DATO  rsconcep NO puede ser eof
        
        '------------------------------------------------------------------------------------------------------
        
        'ME guardo el consumo
        If CByte(miRsAux!TipoFacturacion) = 2 Then
            'ANEXO. Consumo 0
            ConsumoM3 = 0
        
        ElseIf CByte(miRsAux!TipoFacturacion) = 0 Then
            'CONTADOR
            ConsumoM3 = miRsAux!lec_actual - DBLet(miRsAux!lec_anterior, "N")
        
        Else
            'AFORO
            'Se le factura el valor del aforo de la linea de prametros
            If miRsAux!TipoUso = 0 Then
                ConsumoM3 = RsParametros!AforoMaxDom
            Else
                ConsumoM3 = RsParametros!AforoMaxind
            End If
        End If
    
        '########
        'Si cambiamos cualquier cosa hay que tener en cuenta esas modificaciones en
        ' .- Prefacturacion
        ' .- Hco Facturas. Modificar consumo
        
        'Consumos
        linea = 1
        rsConcep.Find "codconceAg = 1", , adSearchForward, 1 'Facturamos consumo
        If Val(rsConcep!facturar) = 1 Then codigo = codigo & AguaConsumo_o_Alcantarillado(0, linea, RsParametros)
        
        'cuota servicio consumo
        linea = 5
        rsConcep.Find "codconceAg = 2", , adSearchForward, 1 'Facturamos cuota servicio consumo
        If Val(rsConcep!facturar) = 1 Then
                'ARiculo artCuotaServD artCuotaServI
                'Precio  CuotaSerD CuotaSerI
                If miRsAux!TipoUso = 0 Then
                    ARti2 = RsParametros!artCuotaServD
                    Precio2 = miRsAux!CuotaSerD
                Else
                    ARti2 = RsParametros!artCuotaServi
                    Precio2 = miRsAux!CuotaSerI
                End If
                canti = mesesPeriodo
                
                codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & ",'Cuota servicio agua potable'"
                codigo = codigo & ",NULL," & canti & "," & canti & "," & DBSet(Precio2, "N")
                codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        End If
        
        
        'Consumo alcantarillado
        linea = 6
        rsConcep.Find "codconceAg = 3", , adSearchForward, 1 'Facturamos consumo
        If Val(rsConcep!facturar) = 1 Then codigo = codigo & AguaConsumo_o_Alcantarillado(1, linea, RsParametros)
        
        'cuota servicio alcantarillado
        linea = 10
        rsConcep.Find "codconceAg = 4", , adSearchForward, 1 'Facturamos cuota servicio consumo
        If Val(rsConcep!facturar) = 1 Then
                'ARiculo artAlcanServD  artAlcanServI
                'Precio  SerAlcanD SerAlcanI
                If miRsAux!TipoUso = 0 Then
                    ARti2 = RsParametros!artAlcanServD
                    Precio2 = miRsAux!SerAlcanD
                Else
                    ARti2 = RsParametros!artAlcanServI
                    Precio2 = miRsAux!SerAlcanI
                End If
                canti = mesesPeriodo
                codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & ",'Cuota servicio alcantarillado'"
                codigo = codigo & ",NULL," & canti & "," & canti & "," & DBSet(Precio2, "N")
                codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        End If
        
        '*******************************************************************************
        '// Separador para mostrar el valor 'hasta el momento del IVA
        '--------------------------------------------------------------------------------
        'En cantidad llevara los dias traanscurridos entre las lecturas.
        'Si no hubiera fecha anterior cogeria fecha fin periodo anterior +1
        'Si fuera negativo o cero, pondremos 1
        linea = 11
        ARti2 = RsParametros!artVarios
        Precio2 = 0
        cadTitulo = "IVA"
        
        
        If miRsAux!TipoFacturacion > 0 Then
            'AFORO O anexo
            canti = mesesPeriodo * 30
        Else
            If IsNull(miRsAux!fecha_anterior) Then
                FF = FInicioPeriodo
            Else
                FF = miRsAux!fecha_anterior
            End If
            canti = DateDiff("d", FF, miRsAux!fecha_actual)
        
            If canti <= 0 Then canti = 1
        End If
    
    
    
        cadTitulo = ""
        codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
        codigo = codigo & ",null," & canti & "," & canti & "," & DBSet(Precio2, "N")
        codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        
        
        
        'Cuota mto contador
        linea = 12
        rsConcep.Find "codconceAg = 5", , adSearchForward, 1
        If Val(rsConcep!facturar) = 1 Then
                'artContadorD artContadorI
                'ContadD  ContadI
                If miRsAux!TipoUso = 0 Then
                    ARti2 = RsParametros!artContadorD
                    Precio2 = miRsAux!ContadD
                Else
                    ARti2 = RsParametros!artContadorI
                    Precio2 = miRsAux!ContadI
                End If
                canti = mesesPeriodo
                
                cadTitulo = "Cuota mantenimiento contador"
                codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
                codigo = codigo & ",null," & canti & "," & canti & "," & DBSet(Precio2, "N")
                codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        End If
        'Cuot servicio transitoira amortizaciones
        linea = 13
        rsConcep.Find "codconceAg = 6", , adSearchForward, 1 'Facturamos cuota servicio consumo
        If Val(rsConcep!facturar) = 1 Then
                'artAmortD  artAmortI
                'SerTranAmorD   SerTranAmorI
                If miRsAux!TipoUso = 0 Then
                    ARti2 = RsParametros!artAmortD
                    Precio2 = miRsAux!SerTranAmorD
                Else
                    ARti2 = RsParametros!artAmortI
                    Precio2 = miRsAux!SerTranAmorI
                End If
                canti = mesesPeriodo
                cadTitulo = "Cuota de servicio transitoria-amortizaciones"
                codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
                codigo = codigo & ",null," & canti & "," & canti & "," & DBSet(Precio2, "N")
                codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        End If
        
        
        
        'Cuota VARIOS
        linea = 14
        rsConcep.Find "codconceAg = 7", , adSearchForward, 1 'Facturamos cuota servicio consumo
        If Val(rsConcep!facturar) = 1 Then
                'Esta es la rara.
                'Articulo unico, y el precio lo coje de la tabla
                ARti2 = RsParametros!artVarios
                Precio2 = rsConcep!importeconcepto
                cadTitulo = rsConcep!Descripcion
                codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
                codigo = codigo & ",null,1,1," & DBSet(Precio2, "N")
                codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * 1, 2), "N") & ",'M',1)"
        End If
        
        
        '-------------------------------- sEGUNDO SEPARADOR
        linea = 20
        ARti2 = RsParametros!artVarios
        Precio2 = 0
        cadTitulo = "IVA"
        canti = ConsumoM3   'En cantidad llevara los m3 facturados
    
        cadTitulo = ""
        codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
        codigo = codigo & ",null," & canti & "," & canti & "," & DBSet(Precio2, "N")
        codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        
        
        
        
        
        'GENERALITAT
        '-------------------------------------------------------
        'Consumo
        linea = 22
        rsConcep.Find "codconceAg = 11", , adSearchForward, 1 'Facturamos cuota consumo
        If Val(rsConcep!facturar) = 1 Then codigo = codigo & AguaConsumo_o_Alcantarillado(2, linea, RsParametros)
        'Reservo la 23 para las facturaciones que lleven dos BOEs de precios
        
        linea = 25
        rsConcep.Find "codconceAg = 12", , adSearchForward, 1 'Facturamos cuota servicio generalitat
        If Val(rsConcep!facturar) = 1 Then
               
                
                ' artCuotaServGenD artCuotaServGenI
                'precios: CuotaCanonGenD CuotaCanonGenI
                If miRsAux!TipoUso = 0 Then
                    ARti2 = RsParametros!artCuotaServGenD
                    Precio2 = DBLet(miRsAux!CuotaCanonGenD, "N")
                Else
                    ARti2 = RsParametros!artCuotaServGenI
                    Precio2 = DBLet(miRsAux!CuotaCanonGenI, "N")
                End If
                
                canti = mesesPeriodo
                cadTitulo = "Cuota de servicio"
                
                codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
                codigo = codigo & ",null," & canti & "," & canti & "," & DBSet(Precio2, "N")
                codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        End If
        
       
                
        If codigo = "" Then
            'Meteremos UNA LINEA a cero para que no de error
            ' Con la cuto de varios y el codigo linea =100
            linea = 100
            rsConcep.Find "codconceAg = 7", , adSearchForward, 1 'Facturamos cuota servicio consumo
        
            ARti2 = RsParametros!artVarios
            Precio2 = 0
            cadTitulo = "Sin facturacion"
            codigo = " ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
            codigo = codigo & ",null,1,1," & DBSet(Precio2, "N")
            codigo = codigo & ",0,0,0,'M',1)"
        
        Else
            'Hacemos el insert
            codigo = Mid(codigo, 2)
            
            
            
        End If
        codigo = cadSelect & codigo
        conn.Execute codigo
        
        
        'incemetamos eel contador
        NumRegElim = NumRegElim + 1
        rsConcep.Close  'cerramos los conceptos por contador
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    procesoFacturacionAgua_InserALB = True
    
    
eprocesoFacturacionAgua_Inser:
    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description
    Set RsParametros = Nothing

    Set miRsAux = Nothing
End Function


'Opcion
' 0 Consumo
' 1 Alcantarillado
' 2 Consumo generalitat valenciana
Private Function AguaConsumo_o_Alcantarillado(vOpcion As Byte, ByRef linea As Byte, ByRef RP As ADODB.Recordset) As String
Dim Aux As String
Dim EsDomestico As Boolean
Dim Consumo As Integer
Dim cantidad As Integer
Dim Precio As Currency
Dim Bloque1 As Integer
Dim Bloque2 As Integer
Dim L As String  'llevara los insert into lineas
Dim Articulo As String
Dim jj As Integer
Dim TipoFacturacion As Byte
Dim ParaTextoBloque1 As Integer
Dim ParaTextoBloque2 As Integer

'Domestico todo mes. Industrial: Alcantarillado si, consumo NO
'Es para cuando pone
'   -Bloque II ( entre 10 y 15 m3 MES
'   o que ponga
'   -Bloque II ( entre 30 y 45 m3
Dim PintaTextosConsumosMeses As Boolean
Dim InsertarLinea As Boolean
    'Se insertan todas las lineas(aunque sea cero), pero para consumo industrial
    ' Hay dos bloques solo, con lo cual , el tercer bloque NO se imprime . En consumo. En alcantarillado SI

    '0. Normal
    '1. Aforo
    '2- Anexo  . Solo se le facturan los servicios. El consumo es 0



    'aqui va "el berenjenal"
    ' Si es domestico o industrial
    ' si por bloques o aforados (para ambos casos)
    '------------------------------------------------------------------------------------------------------
    TipoFacturacion = CByte(miRsAux!TipoFacturacion)
    EsDomestico = miRsAux!TipoUso = 0
    PintaTextosConsumosMeses = True
    
    If vOpcion = 1 Then
        'JULIO Alcantarillado lleva sus propios bloques
        Bloque1 = RP!BloqueAlc1
        Bloque2 = RP!BloqueAlc2
        ParaTextoBloque1 = Bloque1 \ RP!periodoFac
        ParaTextoBloque2 = Bloque2 \ RP!periodoFac
    Else
        If EsDomestico Then
            Bloque1 = RP!bloque1D
            Bloque2 = RP!bloque2D
            ParaTextoBloque1 = Bloque1 \ RP!periodoFac
            ParaTextoBloque2 = Bloque2 \ RP!periodoFac
        Else
            Bloque1 = RP!bloque1I
            Bloque2 = RP!bloque2I
            'INDUSTRIAL
            PintaTextosConsumosMeses = False  'Es el unico que no pintara "por mes"
            ParaTextoBloque1 = Bloque1
            'ParaTextoBloque2 = Bloque2 \ miRsAux!TipoFactu
        End If
    End If
    
    'LAS LINEAS
    '------------------------------------------------------------------------------------------------------
    'codtipom,numalbar,numlinea,codalmac,codartic,nomartic,ampliaci,cantidad,numbultos,precioar ,
    'dtoline1, dtoline2, ImporteL, origpre, codproveX)
    
    L = ""
    AguaConsumo_o_Alcantarillado = ""
    
    
    'Si es por aforo el consumo será el de parametros agua, pero el precio es el que le toque
    'Si es anexo el consumo es 0
    'Si es contador el consumo es la diferencia
    If TipoFacturacion = 2 Then
        'ANEXO. Consumo 0
        Consumo = 0
        
    ElseIf TipoFacturacion = 0 Then
        'CONTADOR
        Consumo = miRsAux!lec_actual - DBLet(miRsAux!lec_anterior, "N")
        
    Else
        'AFORO
        'Se le factura el valor del aforo de la linea de aprametros
        'AforoMaxDom,AforoMaxInd,PrecioAfoMaxD,PrecioAfoMaxI   artCuotaConD  artCuotaConI
        'artCuotaConGenD artCuotaConGenI
        If EsDomestico Then
            Consumo = RP!AforoMaxDom
            If vOpcion = 0 Then
                Articulo = RP!artAforoD
            ElseIf vOpcion = 1 Then
                'Alcantarillado
                Articulo = RP!artAforoD
            Else
                'Cuota generalitat valenciana
                Articulo = RP!artCuotaConGenD
            End If
        Else
            Consumo = RP!AforoMaxind
            If vOpcion = 0 Then
                Articulo = RP!artAforoI
            ElseIf vOpcion = 1 Then
                'Alcantarillado
                Articulo = RP!artAlcanConI
            Else
                'generalitat valenciana
                Articulo = RP!artCuotaConGenI
            End If
        End If
        
    End If
    
    'VAMOS A facturar
    'NORMAL. Va por bloques
    'TRES BLOQUES DE CONSUMO
    If vOpcion < 2 Then
        'FActuracion consumo y alcantarillado
        For jj = 1 To 3
            InsertarLinea = True
            Select Case jj
            Case 1
                If Consumo > Bloque1 Then
                    cantidad = Bloque1
                    Consumo = Consumo - Bloque1
                Else
                    cantidad = Consumo
                    Consumo = 0
                End If
                'Label
                If PintaTextosConsumosMeses Then
                    cadTitulo = "(Hasta " & ParaTextoBloque1 & " m3Mes)"
                Else
                    cadTitulo = "(Hasta " & ParaTextoBloque1 & "m3)"
                End If
                cadNomRPT = "Bloque I"
            Case 2
                'Si es mayor que el bloque hasta, en este segundo bloque va consuo la diferencia de bloques
                If Consumo = 0 Then
                    cantidad = 0
                Else
                
                    If Consumo + Bloque1 > Bloque2 Then
                        cantidad = Bloque2 - Bloque1
                        Consumo = Consumo - cantidad
                    Else
                        cantidad = Consumo
                        Consumo = 0
                    End If
                    
                End If
                If PintaTextosConsumosMeses Then
                    cadTitulo = "(Entre " & ParaTextoBloque1 & " y " & ParaTextoBloque2 & " m3Mes)"
                Else
                    cadTitulo = "(Más de " & Bloque1 & " m3)"
                End If
                cadNomRPT = "Bloque II"
            Case 3
                If Consumo = 0 Then
                    cantidad = 0
                Else
                    cantidad = Consumo
                End If
                
                
                
                
                
                If PintaTextosConsumosMeses Then
                    cadTitulo = "(Más de " & ParaTextoBloque2 & " m3Mes)"
                Else
                    If cantidad > 0 Then
                        cadTitulo = "Consumo erroneo. Industrial con consumo superior a " & Bloque2
                        cadTitulo = miRsAux!Contador & " en " & miRsAux!domconta & "  Cliente: " & miRsAux!codClien & vbCrLf & vbCrLf & cadTitulo
                        MsgBox cadTitulo, vbCritical
                    End If
                    InsertarLinea = False
                    
                    
                
                    cadTitulo = "(Más de " & Bloque2 & " m3)"
                    
                    
                        
                    
                End If
                
                cadNomRPT = "Bloque III"
            End Select
        
            
        
             'artCuotaConD artCuotaConI artAlcanConD artAlcanConI  artCuotaConGenD  artCuotaConGenI
             
             'PreConDomB1  PreConDomB2 PreConDomB3 PreConIndB1 PreConIndB2 PreConIndB3
             If EsDomestico Then
                 'CONSUNMO    ConsumoD SerAlcanD
                 'ALCANTARILLADO preAlcIndB1 preAlcDomB1
                 If vOpcion = 0 Then
                    Aux = "PreConDomB" & jj
                 Else
                    Aux = "preAlcDomB" & jj
                 End If
                 Precio = RP.Fields(Aux)
                 
                 'Si el tipo es AFORO ya tiene fijado el articulo
                 If TipoFacturacion <> 1 Then
                    If vOpcion = 0 Then
                        Articulo = RP!artCuotaConD
                    Else
                        'Alcantarillado
                        Articulo = RP!artAlcanConD
                    End If
                End If
             Else
                 
                 If vOpcion = 0 Then
                    Aux = "PreConIndB" & jj
                 Else
                    Aux = "preAlcIndB" & jj
                 End If
                 Precio = RP.Fields(Aux)
                 If TipoFacturacion <> 1 Then
                    If vOpcion = 0 Then
                        Articulo = RP!artCuotaConI
                    Else
                        'Alcantarillado
                        Articulo = RP!artCuotaConD
                    End If
                 End If
             End If
         
            If vOpcion = 1 Then
                cadNomRPT = "Consumo alcantarillado " & cadNomRPT
            Else
                If vOpcion = 2 Then
                    cadNomRPT = "Consumo " & cadNomRPT
                Else
                    cadNomRPT = "Consumo agua " & cadNomRPT
                End If
            End If
            
            If InsertarLinea Then
                L = L & ", ('ALG'," & NumRegElim & "," & (linea - 1 + jj) & ",1," & DBSet(Articulo, "T") & "," & DBSet(cadNomRPT, "T")
                L = L & ",'" & cadTitulo & "'," & cantidad & "," & cantidad & "," & DBSet(Precio, "N")
                L = L & ",0,0," & DBSet(Round2(Precio * cantidad, 2), "N") & ",'M',1)"
                
            End If
        
        Next jj
    Else
        'GENERALITAT VALENCIANA
        
        'Cuota consumo generalitat valenciana
        'PrecioServGenD PrecioServGenI artCuotaConGenD artCuotaConGenI
        
        If EsDomestico Then
            Precio = RP!PrecioServGenD
            Articulo = RP!artCuotaConGenD
        Else
            Articulo = RP!artCuotaConGenI
            Precio = RP!PrecioServGenI
        End If
        cadTitulo = ""
        
        cantidad = Consumo
        L = L & ", ('ALG'," & NumRegElim & "," & (linea - 1 + jj) & ",1," & DBSet(Articulo, "T") & ",'Cuota de consumo '"
        L = L & ",'" & cadTitulo & "'," & cantidad & "," & cantidad & "," & DBSet(Precio, "N")
        L = L & ",0,0," & DBSet(Round2(Precio * cantidad, 2), "N") & ",'M',1)"
        
    
    End If

    AguaConsumo_o_Alcantarillado = L

End Function



Private Function ImportarFicherolecturasAgua(LeeLaFechaDelFichero As Boolean) As Boolean
Dim NF As Byte
Dim Cuentas As Long
Dim Fechas As Date
Dim Aux As String

    ImportarFicherolecturasAgua = False
    
    Label3(86).Caption = "Preparando datos"
    Label3(86).Refresh
    
    
    conn.Execute "DELETE FROM tmpinformes WHERE codusu =" & vUsu.codigo
    
    NF = FreeFile
    Open Me.TxtFichero(0).Text For Input As #NF
    
    'Lo ha abierto bien
    NumRegElim = 0
    cadFormula = ""
    While Not EOF(NF)
        
        Line Input #NF, codigo
        NumRegElim = NumRegElim + 1
        Label3(86).Caption = Format(NumRegElim, "000") & "  " & Mid(codigo, 1, 6)
        Label3(86).Refresh
        
        
        
        'Vale estamos aquin
        'Primer dato CONTADOR
        If codigo = ";;" Then codigo = ""
        numParam = InStr(1, codigo, ";")
        If numParam > 0 Then
            codigo = Replace(codigo, """", "") 'quito las comillas, si las hubiere
            codigo = Replace(codigo, ".", "") 'quito las puntos

            'Primer trozo.. contador
            miSQL = DBSet(Mid(codigo, 1, numParam - 1), "T")
            codigo = Mid(codigo, numParam + 1)
            
            numParam = InStr(1, codigo, ";")
            If numParam > 0 Then
                Aux = Mid(codigo, numParam + 1)
                codigo = Mid(codigo, 1, numParam - 1)
            Else
                Aux = ""
            End If
            
            If LeeLaFechaDelFichero Then
                
                
                Aux = Mid(Aux, 1, 10)
                
                
                
                If Aux <> "" Then
                    Fechas = CDate(Aux)
                Else
                    Fechas = "01/01/1900"
                End If
            Else
                Fechas = txtFecha(56).Text
            End If
            
            'codusu,codigo1,nombre1
            miSQL = ", (" & vUsu.codigo & "," & Val(codigo) & "," & miSQL & "," & NumRegElim & "," & DBSet(Fechas, "F") & ")"
            
            cadFormula = cadFormula & miSQL

        End If
        
        If (NumRegElim Mod 50) = 0 Then
            Label3(86).Caption = "Insertar"
            Label3(86).Refresh
            
            If cadFormula <> "" Then
                cadFormula = Mid(cadFormula, 2)
                miSQL = "INSERT INTO tmpinformes (codusu,importe1,nombre1,campo2,fecha1) VALUES " & cadFormula
                conn.Execute miSQL
                cadFormula = ""
            End If
        End If
    Wend
    Close #NF
    
    'Los que faltan
    If cadFormula <> "" Then
        cadFormula = Mid(cadFormula, 2)
        miSQL = "INSERT INTO tmpinformes (codusu,importe1,nombre1,campo2,fecha1) VALUES " & cadFormula
        conn.Execute miSQL
        cadFormula = ""
    End If

    conn.Execute "UPDATE tmpinformes SET campo1=0 WHERE codusu =" & vUsu.codigo
    
    'Ya hemos importado las lecturas. Vamos p'alla a comprobar datos
    'Primera comprobacion. Que todos los contadores existen en nuestra BD
    Label3(86).Caption = "Combropar contadores"
    Label3(86).Refresh
    miSQL = "select * from tmpinformes where codusu = " & vUsu.codigo & " and not nombre1 in (select contador from  aguacontadores)"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        miSQL = "UPDATE tmpinformes set campo1=1 WHERE codusu =" & vUsu.codigo & " AND nombre1=" & DBSet(miRsAux!nombre1, "T")
        conn.Execute miSQL
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    
    
    
    
    
    'De los que existen, veremos si estan dos veces
    Label3(86).Caption = "Lecturas OK"
    Label3(86).Refresh
    DoEvents
    miSQL = "select nombre1,count(*) from tmpinformes where codusu = " & vUsu.codigo & " AND campo1 =0 group by 1 having count(*)>1"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        miSQL = "UPDATE tmpinformes set campo1=3 WHERE codusu =" & vUsu.codigo & " AND nombre1=" & DBSet(miRsAux!nombre1, "T")
        conn.Execute miSQL
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    'De los contadores que existan comprobamos que si estan pendientes facturadar
    Label3(86).Caption = "Lecturas OK"
    Label3(86).Refresh
    
    
    Cuentas = 1
    While Cuentas <= NumRegElim
        Label3(86).Caption = "" & Cuentas & " - " & NumRegElim
        Label3(86).Refresh
        
        'select nombre1 from tmpinformes where codusu = 22000 and campo1=0
        'and campo2 between 1 and 10
        miSQL = " and campo2 between " & Cuentas
        Cuentas = Cuentas + 29
        miSQL = miSQL & " and  " & Cuentas
        
        
        miSQL = vUsu.codigo & " AND campo1 =0 " & miSQL
        miSQL = "select nombre1 from tmpinformes where codusu = " & miSQL
        miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        miSQL = ""
        While Not miRsAux.EOF
            miSQL = miSQL & ", " & DBSet(miRsAux!nombre1, "T")
            
            miRsAux.MoveNext
        Wend
        miRsAux.Close
        Cuentas = Cuentas + 1 'para el proximo select
        
        If miSQL <> "" Then
            miSQL = Mid(miSQL, 2)
            miSQL = "(" & miSQL & ")"
            codigo = "Select contador from aguacontadores WHERE not consumo is null  and contador IN " & miSQL
            miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
            While Not miRsAux.EOF
                miSQL = "UPDATE tmpinformes set campo1=2 WHERE codusu =" & vUsu.codigo & " AND nombre1=" & DBSet(miRsAux!Contador, "T")
                conn.Execute miSQL
                miRsAux.MoveNext
            Wend
            miRsAux.Close
            DoEvents
        End If
    Wend
    
    
    
    'Las fechas
    Label3(86).Caption = "Fechas OK"
    Label3(86).Refresh
    DoEvents
    
    miSQL = DevuelveDesdeBD(conAri, "max(fecha_anterior)", "aguacontadores", "1", "1")
    If miSQL <> "" Then
        Fechas = CDate(miSQL)
    Else
        Fechas = vEmpresa.FechaIni
    End If
    
    
    miSQL = "select distinct(fecha1) from tmpinformes where codusu = " & vUsu.codigo & " AND campo1 =0 "
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        If miRsAux.Fields(0) < Fechas Then
            miSQL = "UPDATE tmpinformes set campo1=4 WHERE codusu =" & vUsu.codigo & " AND fecha1=" & DBSet(miRsAux!fecha1, "F")
            conn.Execute miSQL
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    
    
    
    
    
    
    vMostrarTree = False 'tiene errores
    miSQL = "Select * from tmpinformes WHERE codusu = " & vUsu.codigo & " and campo1 >0 order by campo1,campo2"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then
        vMostrarTree = True
        NF = FreeFile
        cadTitulo = App.Path & "\agua.txt"
        Open cadTitulo For Output As #NF
       
        numParam = 0
        While Not miRsAux.EOF
            If numParam <> miRsAux!campo1 Then
                numParam = miRsAux!campo1
                If numParam = 1 Then
                    Print #NF, "Contadores No existentes"
                ElseIf numParam = 2 Then
                    Print #NF, vbCrLf & "Contadores pendientes de facturar"
                ElseIf numParam = 3 Then
                    Print #NF, vbCrLf & "Contadores repetidos en fichero"
                Else
                    Print #NF, vbCrLf & "Fechas incorrectas"
                End If
                Print #NF, String(40, "=") & vbCrLf
                
            End If
            
            If miRsAux!fecha1 = "01/01/1900" Then
                miSQL = "FALTA FECHA"
            Else
                miSQL = Format(miRsAux!fecha1, "dd/mm/yyyy")
            End If
            
            Print #NF, ".- " & miRsAux!nombre1 & "   " & Format(miRsAux!campo2, "000") & "     " & miSQL
            miRsAux.MoveNext
            
        Wend
        
        Close #NF
        MsgBox "Hay errores en la importación", vbExclamation
        LanzaVisorMimeDocumento Me.hwnd, cadTitulo
        
    End If
    miRsAux.Close
    
    'Si no tiene errores preparamos el informe
    If Not vMostrarTree Then
        Cuentas = 1
        While Cuentas <= NumRegElim
            Label3(86).Caption = "prepara informe " & Cuentas & " - " & NumRegElim
            Label3(86).Refresh
            
            'select nombre1 from tmpinformes where codusu = 22000 and campo1=0
            'and campo2 between 1 and 10
            miSQL = " and campo2 between " & Cuentas
            Cuentas = Cuentas + 19
            miSQL = miSQL & " and  " & Cuentas
            
            'codigo = "update tmpinformes,aguacontadores set nombre2=domconta ,fecha1=fecha_anterior"
            codigo = "update tmpinformes,aguacontadores set nombre2=domconta "
            codigo = codigo & ", importe2 = coalesce(lec_anterior,0), codigo1 = codclien"
            codigo = codigo & " where codusu =" & vUsu.codigo & " AND campo1 =0  " & miSQL & " and tmpinformes.nombre1=aguacontadores.contador"
            conn.Execute codigo
            Cuentas = Cuentas + 1
            
        Wend
    
    
        'Nombre propietario
        miSQL = "UPDATE tmpinformes ,sclien set nombre3=nomclien where codusu=" & vUsu.codigo & " and tmpinformes.codigo1 =sclien.codclien"
        conn.Execute miSQL
    
    
    
        If Me.chkVarios(27).Value = 0 Then
            'QUIERE EL LISTADO con ivas...
            'Para ello haremos una prefacturacion
            If Not preFacturacionAgua Then Exit Function
            
            If Not ListadoAguaPrefacturar Then Exit Function
        
            
        Else
    
            InicializarVbles True
            cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
            cadTitulo = "Listado importacion lecturas contador"
            
            codigo = DevuelveDesdeBD(conAri, "AlertaConsumo", "sparamagua", "1", "1")
            If Val(codigo) = 0 Then codigo = "60"
            
            miSQL = Me.TxtFichero(0) & "      Consumo superior: " & codigo
            CadParam = CadParam & "pdh1= ""Fichero:    " & miSQL & """|"
            CadParam = CadParam & "ValorAlerta= " & codigo & "|"
            numParam = 2
            
            cadPDFrpt = ""
            cadNomRPT = "aguControlImportar.rpt"
            conSubRPT = False
            vMostrarTree = False
            LlamarImprimir
        
        
            'Un ultimo control. LOS NEGATIVOS
            '{tmpinformes.importe1} - {tmpinformes.importe2}
            codigo = "Select count(*) from tmpinformes where codusu = " & vUsu.codigo & " AND importe2 > importe1"
            miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
            numParam = 0
            If Not miRsAux.EOF Then
                If DBLet(miRsAux.Fields(0), "N") > 0 Then numParam = 1
            End If
            miRsAux.Close
            
            If numParam = 1 Then
                MsgBox "Consumos negativos", vbExclamation
            Else
                'SI quiere insertar en los contadores....
                CadParam = String(60, "*")
                codigo = vbCrLf & vbCrLf & "Va a importar los datos del fichero y actualizar "
                codigo = codigo & vbCrLf & " los datos de lectura de los contadores"
                codigo = codigo & vbCrLf & vbCrLf & vbCrLf & "¿Continuar?" & vbCrLf & vbCrLf
                codigo = CadParam & codigo & CadParam
                If MsgBox(codigo, vbQuestion + vbYesNoCancel + vbDefaultButton3) = vbYes Then
                    
                    Label3(86).Caption = "Actualizando en BD"
                    Label3(86).Refresh
                    
                    
                    'OK. Metemos en LOG
                    CadParam = "select count(*),sum(importe1)-sum(importe2),max(fecha1) from tmpinformes where codusu =" & vUsu.codigo
                    miRsAux.Open CadParam, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
                    'NO puede ser eof
                    CadParam = Me.TxtFichero(0).Text
                    NumRegElim = InStrRev(CadParam, "\")
                    If NumRegElim > 0 Then CadParam = Mid(CadParam, NumRegElim + 1)
                    CadParam = "[IMPORTAR FICHERO]  " & CadParam & "  Fec: " & txtFecha(56).Text & vbCrLf
                    CadParam = CadParam & "Reg: " & miRsAux.Fields(0) & "  Sum cons." & Val(miRsAux.Fields(1)) & "  Fec. ant." & miRsAux.Fields(2)
                    miRsAux.Close
                    Set LOG = New cLOG
                    LOG.Insertar 29, vUsu, CadParam
                    Set LOG = Nothing
                    
                    
                    
                    codigo = "update tmpinformes,aguacontadores set fecha_actual = fecha1" '& DBSet(fecha1, "F")
                    codigo = codigo & ", lec_actual = floor(importe1), consumo=floor(importe1) - lec_anterior "
                    codigo = codigo & " where codusu =" & vUsu.codigo & " AND campo1 =0  and tmpinformes.nombre1=aguacontadores.contador"
                    conn.Execute codigo
                    
                    ImportarFicherolecturasAgua = True
                    
                End If
            End If
            
        
        End If
    End If
End Function



Private Function ListadoAguaEmpresa() As Boolean
Dim PorcenR As Currency
Dim PorcenNormal As Currency

Dim PonerFecha As Boolean

On Error GoTo eListadoAguaEmpresa
    ListadoAguaEmpresa = False
    
    Label3(86).Caption = "Leyendo datos"
    Label3(86).Refresh
    
    'Comprobaremos que hay una facturacion de agua ESE dia
    codigo = "codtipom = 'FAG' AND fecfactu"
    codigo = DevuelveDesdeBD(conAri, "count(*)", "scafac", codigo, DBSet(Me.txtFecha(56), "F"), "N")
    If Val(codigo) = 0 Then
        MsgBox "Ninguna factura para esa fecha", vbExclamation
        Exit Function
    End If
    
    
    Label3(86).Caption = "Preparando datos"
    Label3(86).Refresh
        
    conn.Execute "DELETE FROM tmpinformes WHERE codusu =" & vUsu.codigo
    
    Label3(86).Caption = "Leyendo datos IVA"
    Label3(86).Refresh
    
    
    
    

    
    
    cadTitulo = ""
    cadPDFrpt = ""
    PorcenR = 0
    For NumRegElim = 1 To 3
        codigo = "Select codigiv" & NumRegElim & " as tipo, porciva" & NumRegElim & " porcen from scafac where "
        codigo = codigo & " codtipom = 'FAG' AND fecfactu=" & DBSet(Me.txtFecha(56), "F")
        codigo = codigo & " GROUP BY 1"
        miRsAux.Open codigo, conn, adOpenForwardOnly, adLockOptimistic, adCmdText

        codigo = ""
        While Not miRsAux.EOF
            If Not IsNull(miRsAux!porcen) Then
                If miRsAux!porcen = 0 Then
                    
                    If cadTitulo = "" Then
                        cadTitulo = miRsAux!Tipo
                    Else
                        If cadTitulo <> miRsAux!Tipo Then Err.Raise 513, , "Mas de un tipo de IVA cero"
                    End If
                End If
            End If
            miRsAux.MoveNext
        Wend
        miRsAux.Close
    Next
    
    'If cadTitulo = "" Then Err.Raise 513, , "Error buscando IVA canon generalitat"
    If cadTitulo = "" Then cadTitulo = "999" 'Para que no de error ?
    'IVA NORMAL  y reducido
    
    PorcenNormal = -1
    PorcenR = 999
    For NumRegElim = 1 To 3
        codigo = "Select  max(porciva" & NumRegElim & ") from scafac where codigiv" & NumRegElim & "<>" & cadTitulo
        codigo = codigo & " AND codtipom = 'FAG' AND fecfactu=" & DBSet(Me.txtFecha(56), "F")
        miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        While Not miRsAux.EOF
            If Not IsNull(miRsAux.Fields(0)) Then
                If miRsAux.Fields(0) > PorcenNormal Then PorcenNormal = miRsAux.Fields(0)
            End If
            miRsAux.MoveNext
        Wend
        miRsAux.Close
    Next
    
    For NumRegElim = 1 To 3
        codigo = "Select  min(porciva" & NumRegElim & ") from scafac where codigiv" & NumRegElim & "<>" & cadTitulo
        codigo = codigo & " AND codtipom = 'FAG' AND fecfactu=" & DBSet(Me.txtFecha(56), "F")
        miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        While Not miRsAux.EOF
            If Not IsNull(miRsAux.Fields(0)) Then
                If miRsAux.Fields(0) < PorcenR Then PorcenR = miRsAux.Fields(0)
            End If
            miRsAux.MoveNext
        Wend
        miRsAux.Close
    Next
    

    
    
    Label3(86).Caption = "Obteniendo registros"
    Label3(86).Refresh
    

    codigo = "select scafac.numfactu,scafac.fecfactu ,nomclien,domclien,"
    'La linea 20 llevara el consumo en cantidad. Es una linea de separador
    codigo = codigo & "observa1,observa2,sum(if(numlinea=20,cantidad,0)) consumo, "
    codigo = codigo & "baseimp1,baseimp2,baseimp3,imporiv1,imporiv2,imporiv3 "
    codigo = codigo & ",porciva1,porciva2,porciva3,TotalFac,referenc"
    codigo = codigo & " from scafac,scafac1,slifac where"
    codigo = codigo & " scafac.codtipom='FAG' and scafac.fecfactu=" & DBSet(Me.txtFecha(56).Text, "F")
    codigo = codigo & " and scafac1.Codtipom = scafac.Codtipom And scafac1.NumFactu = scafac.NumFactu"
    codigo = codigo & " And scafac1.FecFactu = scafac.FecFactu AND scafac1.Codtipom = slifac.Codtipom"
    codigo = codigo & " And scafac1.NumFactu = slifac.NumFactu And scafac1.FecFactu = slifac.FecFactu"
    codigo = codigo & " and scafac1.numalbar=slifac.numalbar and scafac1.codtipoa="
    codigo = codigo & " slifac.codtipoa group by 1,2,3"
    
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    
    miSQL = "insert into tmpinformes(codusu,codigo1,fecha1,nombre1,nombre2,nombre3,obser,campo2,importe1,importe2,importe3,importe4,importe5,importeb1) VALUES  "
    
    'En cadtitulo tenemos el iva cero
    NumRegElim = 0
    codigo = ""
    While Not miRsAux.EOF
        NumRegElim = NumRegElim + 1
        codigo = codigo & ", (" & vUsu.codigo & "," & miRsAux!NumFactu & "," & DBSet(miRsAux!FecFactu, "F")
        codigo = codigo & "," & DBSet(miRsAux!Nomclien, "T") & ","
        
        
        
        
        cadPDFrpt = DevuelveDesdeBD(conAri, "domconta", "aguacontadores", "contador", miRsAux!referenc, "T")
        If cadPDFrpt = "" Then
            MsgBox "No se encuentra la direccion del contador: " & miRsAux!referenc
            cadPDFrpt = miRsAux!domclien
        End If
        codigo = codigo & DBSet(cadPDFrpt, "T")
        codigo = codigo & "," & DBSet(miRsAux!referenc, "T") & ","
        
        'Campo Obser llevara
        ' 10 posiciones FECHA anterior
        ' 5 posiciones lectura anterior
        ' 10 posiciones fecha actual
        ' 5 posiciones lectura actual
        
        'Separaremos
        PonerFecha = False
        cadPDFrpt = ""
        If DBLet(miRsAux!observa1, "T") <> "" Then
            If Mid(miRsAux!observa1, 6, 3) = "/20" Then PonerFecha = True
        End If
        If PonerFecha Then
            cadPDFrpt = Mid(miRsAux!observa1, 1, 10)
            cadFormula = Trim(Mid(miRsAux!observa1, 11))
            cadFormula = Right(Space(5) & cadFormula, 5)
            cadPDFrpt = cadPDFrpt & cadFormula
        Else
            cadPDFrpt = Space(15)
        End If
        
        PonerFecha = False
        cadTitulo = ""
        If DBLet(miRsAux!observa2, "T") <> "" Then
            If Mid(miRsAux!observa2, 6, 3) = "/20" Then PonerFecha = True
        End If
        If PonerFecha Then
            cadTitulo = Mid(miRsAux!observa2, 1, 10)
            cadFormula = Trim(Mid(miRsAux!observa2, 11))
            cadFormula = Right(Space(5) & cadFormula, 5)
            cadTitulo = cadTitulo & cadFormula
        Else
            cadTitulo = Space(15)
        End If
        cadPDFrpt = cadPDFrpt & cadTitulo
        
        
        
        codigo = codigo & DBSet(cadPDFrpt, "T") & "," & DBSet(miRsAux!Consumo, "N")
        
        
        'IMporte1 importe 2, suministro base + iva   REDUCIDO
        cadPDFrpt = ",0,0"
        'Importe3, importe 4  instalacion base + iva NORMAL
        cadTitulo = ",0,0"
        'importe5 tasas  EXENTO
        'Importe b1
        cadFormula = ",0"
        
        
        For numParam = 1 To 3
            'porciva1  imporiv1 baseimp1
            If Not IsNull(miRsAux.Fields("porciva" & numParam)) Then
                
                If miRsAux.Fields("porciva" & numParam) = 0 Then
                    'TASS
                    cadFormula = "," & DBSet(miRsAux.Fields("baseimp" & numParam), "N")
                ElseIf miRsAux.Fields("porciva" & numParam) = PorcenNormal Then
                    cadTitulo = "," & DBSet(miRsAux.Fields("baseimp" & numParam), "N") & "," & DBSet(miRsAux.Fields("imporiv" & numParam), "N")
                ElseIf miRsAux.Fields("porciva" & numParam) = PorcenR Then
                    cadPDFrpt = "," & DBSet(miRsAux.Fields("baseimp" & numParam), "N") & "," & DBSet(miRsAux.Fields("imporiv" & numParam), "N")
                Else
                    Err.Raise 513, , "%IVA no soportado"
                End If
            End If
        Next
        codigo = codigo & cadPDFrpt & cadTitulo & cadFormula & "," & DBSet(miRsAux!TotalFac, "N") & ")"
        
        If (NumRegElim Mod 5) = 0 Then
            Label3(86).Caption = "Numero: " & NumRegElim
            Label3(86).Refresh
            codigo = Mid(codigo, 2)
            codigo = miSQL & codigo
            conn.Execute codigo
            codigo = ""
        End If
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    If codigo <> "" Then
        codigo = Mid(codigo, 2)
        codigo = miSQL & codigo
        conn.Execute codigo
    End If
    
    
    InicializarVbles True
    cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
    cadTitulo = "Listado facturacion Aguas"
    
    CadParam = CadParam & "pdh1= ""Fecha factura:    " & Me.txtFecha(56).Text & """|"
    numParam = 1
    
    cadPDFrpt = ""
    cadNomRPT = "aguListadoFra.rpt"
    conSubRPT = False
    vMostrarTree = False
    LlamarImprimir


    
    Exit Function
eListadoAguaEmpresa:
    MuestraError Err.Number, Err.Description, Err.Description
    Set miRsAux = Nothing
End Function




Private Function ObtenerDatosFacturacionAguaGeneralitat() As Boolean

    On Error GoTo eObtenerDatosFacturacionAguaGeneralitat
    ObtenerDatosFacturacionAguaGeneralitat = False
    
    
    'Iremos metiendo lineas en tmpiformes
    conn.Execute "DELETE FROM tmpinformes where codusu = " & vUsu.codigo
    
    Set miRsAux = New ADODB.Recordset
    'insert into tmpinformes(codusu,codigo1,nombre1,nombre2) values
    'codigo = "insert into tmpinformes(codusu,codigo1,nombre1,nombre2) values "
    cadFormula = ""
    FI = CDate(txtFecha(57).Text)
    FF = CDate(txtFecha(58).Text)
    codigo = " codtipom = 'FAG' and fecfactu between " & DBSet(FI, "F") & " AND " & DBSet(FF, "F")
    
    
    NumRegElim = 0
    
    'Numero de facturas
    miSQL = "select count(*) from scafac where " & codigo
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = "0"
    If Not miRsAux.EOF Then miSQL = DBLet(miRsAux.Fields(0), "N")
    miRsAux.Close
    cadFormula = cadFormula & ", (" & vUsu.codigo & "," & NumRegElim & ",'Nº Facturas:','" & miSQL & "')"
    NumRegElim = NumRegElim + 1
    
    'm3 facturados
    miSQL = "select sum(cantidad) from slifac where  numlinea=20 and  " & codigo
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = "0"
    If Not miRsAux.EOF Then miSQL = Format(DBLet(miRsAux.Fields(0), "N"), "#,##0")
    miRsAux.Close
    cadFormula = cadFormula & ", (" & vUsu.codigo & "," & NumRegElim & ",'Metros cúbicos:','" & miSQL & "')"
    NumRegElim = NumRegElim + 1
    
    'importe canon generalitat
    'Linea 21
    miSQL = "select sum(if(numlinea=21,importel,0)) from slifac WHERE " & codigo
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = "0"
    If Not miRsAux.EOF Then miSQL = Format(DBLet(miRsAux.Fields(0), "N"), FormatoImporte)
    miRsAux.Close
    cadFormula = cadFormula & ", (" & vUsu.codigo & "," & NumRegElim & ",'Importe canon: ','" & miSQL & "')"
    NumRegElim = NumRegElim + 1

    'importe servicio generalitat
    'Linea 25
    miSQL = "select sum(if(numlinea=25,importel,0)) from slifac WHERE " & codigo
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = "0"
    If Not miRsAux.EOF Then miSQL = Format(DBLet(miRsAux.Fields(0), "N"), FormatoImporte)
    miRsAux.Close
    cadFormula = cadFormula & ", (" & vUsu.codigo & "," & NumRegElim & ",'Importe servicio: ','" & miSQL & "')"
    NumRegElim = NumRegElim + 1



    'Voy a la tesoreria las facturas de este periodo que faltan por pagar
    cadTitulo = DevuelveDesdeBD(conAri, "letraser", "stipom", "codtipom", "FAG", "T")
    miSQL = Mid(codigo, InStr(1, codigo, "between"))
    miSQL = "numserie= '" & cadTitulo & "' AND fecfaccl " & miSQL
    miSQL = "select sum(impvenci + coalesce(gastos,0) - coalesce(impcobro,0)) FROM scobro WHERE " & miSQL
    miRsAux.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = "0"
    If Not miRsAux.EOF Then miSQL = Format(DBLet(miRsAux.Fields(0), "N"), FormatoImporte)
    
    miRsAux.Close
    cadFormula = cadFormula & ", (" & vUsu.codigo & "," & NumRegElim & ",'Pendiente periodo: ','" & miSQL & "')"
    NumRegElim = NumRegElim + 1

    
    cadFormula = Mid(cadFormula, 2)
    miSQL = "insert into tmpinformes(codusu,codigo1,nombre1,nombre2) values " & cadFormula
    conn.Execute miSQL
    
    
    
    'Cobros anteriores
    'Pongo un separador 100
    'codusu,codigo1,campo1,campo2,nombre1,nombre2
    NumRegElim = 100
    cadFormula = ", (" & vUsu.codigo & "," & NumRegElim & ",0,0,'','')"
    miSQL = "select year(fecfaccl),month(fecfaccl),sum(impvenci+coalesce(gastos,0)-coalesce(impcobro,0)) from scobro  "
    miSQL = miSQL & " where numserie='" & cadTitulo & "' and fecfaccl < " & DBSet(FI, "F")
    miSQL = miSQL & " group by 1,2 order by 1 ,2"
    miRsAux.Open miSQL, ConnConta, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
        NumRegElim = NumRegElim + 1
        'en campo 1 llevamos el mes
        miSQL = "0"
        If Not miRsAux.EOF Then miSQL = Format(DBLet(miRsAux.Fields(2), "N"), FormatoImporte)
        
        cadFormula = cadFormula & ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux.Fields(0) & "," & miRsAux.Fields(1)
        cadFormula = cadFormula & ",'" & MonthName(miRsAux.Fields(1)) & "','" & miSQL & "')"
        
        
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    


    cadFormula = Mid(cadFormula, 2)
    miSQL = "insert into tmpinformes(codusu,codigo1,campo1,campo2,nombre1,nombre2) values " & cadFormula
    conn.Execute miSQL
    
    ObtenerDatosFacturacionAguaGeneralitat = True

eObtenerDatosFacturacionAguaGeneralitat:
    If Err.Number <> 0 Then MuestraError Err.Number, , Err.Description
    Set miRsAux = Nothing
End Function





'****************************************************************************
'****************************************************************************
'****************************************************************************
'****************************************************************************
'****************************************************************************
'MARZO 2015
'PREFACTURACION AGUA
'LISTADO MAS COMPLEJO

'****************************************************************************
'****************************************************************************
'****************************************************************************
'****************************************************************************
'****************************************************************************
'****************************************************************************

Private Function preFacturacionAgua() As Boolean
Dim linea As Byte
'De aqui cogera el aticulo
Dim RsParametros As ADODB.Recordset
Dim rsConcep As ADODB.Recordset
Dim J As Integer
Dim ARti2 As String
Dim canti As Integer
Dim Precio2 As Currency
Dim mesesPeriodo As Integer
Dim FInicioPeriodo As Date
Dim FF As Date
Dim ConsumoM3 As Integer

    On Error GoTo eprocesoFacturacionAgua_Inser
    
    
    conn.Execute "DELETE FROM aguPreFactAlb "
    conn.Execute "DELETE FROM aguPreFactLin  "
    
    
    
    preFacturacionAgua = False
    
    Label3(84).Caption = "Leyendo valores facturacion"
    Label3(84).Refresh
    
    CadParam = codigo 'Numero de registros a insertar
    cadPDFrpt = 1 'PonerTrabajadorConectado(codigo)    'codtraba
    
    
    
    'Obtengo contador de albaranes
    NumRegElim = 0   'Val(DevuelveDesdeBD(conAri, "contador", "stipom", "codtipom", "ALG", "T"))
    NumRegElim = NumRegElim + 1

    Set rsConcep = New ADODB.Recordset
    Set RsParametros = New ADODB.Recordset
    
    RsParametros.Open "Select * from sparamagua", conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    
    Select Case RsParametros!periodoFac
    Case 0
        'cadFormula = "Anual"
        'NumRegElim = NumRegElim + 1
        mesesPeriodo = 12
        
    Case 1
        'cadFormula = "Mes"
        'If Periodo > 12 Then vMostrarTree = True
        mesesPeriodo = 1
    Case 2
        'cadFormula = "Bimestre"
        'If Periodo > 6 Then vMostrarTree = True
        mesesPeriodo = 2
    Case 3
        'cadFormula = "Trimestre"
        'If Periodo > 4 Then vMostrarTree = True
        mesesPeriodo = 3
    Case 4
        'cadFormula = "Cuatrimestre"
        'If Periodo > 3 Then vMostrarTree = True
        mesesPeriodo = 4
    Case 6
        'cadFormula = "Semestre"
        'If Periodo > 2 Then vMostrarTree = True
        mesesPeriodo = 6
    
    Case Else
        'cadFormula = miRsAux!NoexisteElTipoFacturacion
         Err.Raise 513, , "Parametros periodo facturacion incorrecto"
    End Select
    
    
    'Fecha incio periodo

    
    If RsParametros!periodoFac = 0 Then
        'Anual
        'J = DiasMes(RS!UtimoPeridoLiquidado, RS!UltimoAnyoLiquidado)
        FInicioPeriodo = CDate("01/" & RsParametros!UtimoPeridoLiquidado & "/" & RsParametros!UltimoAnyoLiquidado)
        FInicioPeriodo = DateAdd("yyyy", 1, FInicioPeriodo)
    Else
        'Periodos
        
        J = mesesPeriodo * RsParametros!UtimoPeridoLiquidado
        FInicioPeriodo = CDate("01/" & J & "/" & RsParametros!UltimoAnyoLiquidado)
        FInicioPeriodo = DateAdd("m", 1, FInicioPeriodo)
        
    End If
    

    

    
    cadFormula = "INSERT INTO aguPreFactAlb(codtipom,numalbar,fechaalb,factursn,codclien,nomclien,domclien,codpobla,pobclien,"
    cadFormula = cadFormula & "proclien,nifclien,telclien,referenc,facturkm,codtraba,codtrab1,codtrab2,codagent,"
    cadFormula = cadFormula & "codforpa,codenvio,dtoppago,dtognral,tipofact,numpedcl,observa01,observa02,observa03,observa04,"
    cadFormula = cadFormula & "observa05,esticket) VALUES ("
    
    cadSelect = "INSERT INTO aguPreFactLin (codtipom,numalbar,numlinea,codalmac,codartic,nomartic,"
    cadSelect = cadSelect & "ampliaci,cantidad,numbultos,precioar , dtoline1, dtoline2, ImporteL, origpre, codproveX) VALUES "
    
    
    codigo = "Select count(*) from tmpinformes ,aguacontadores where tmpinformes.nombre1=contador and facturar=1 and codusu = " & vUsu.codigo
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    'no puede ser eof
    CadParam = miRsAux.Fields(0)
    miRsAux.Close
    
    codigo = "select importe1 lec_actual,importe2 lec_anterior,fecha_anterior,fecha1 fecha_actual,Contador,TipoFacturacion,TipoUso"
    codigo = codigo & ",aguacontadores.codclien,domconta,cpconta,pobconta,proconta,fecha_anterior,aguacontadores.codforpa"
    codigo = codigo & " ,aguacalibre.*"
    codigo = codigo & ",nomclien,domclien,codpobla,pobclien,proclien,nifclien,telclie1,CodEnvio"
    codigo = codigo & " from tmpinformes inner join aguacontadores ON tmpinformes.nombre1=contador and codusu = " & vUsu.codigo
    codigo = codigo & " left join sclien on aguacontadores.codclien=sclien.codclien"
    codigo = codigo & "  left join aguacalibre on aguacontadores.codcalibre=aguacalibre.codcalibre "
    codigo = codigo & " WHERE aguacontadores.facturar=1   ORDER BY codclien,contador"
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    Label3(84).Tag = 0
    While Not miRsAux.EOF
    

    
        Label3(84).Tag = Val(Label3(84).Tag) + 1
        Label3(86).Caption = Label3(84).Tag & " / " & CadParam & " - " & miRsAux!Nomclien
        Label3(86).Refresh
        If (NumRegElim Mod 25) = 0 Then
            DoEvents
            Me.Refresh
            Screen.MousePointer = vbHourglass
        End If
    
    
        'If miRsAux!Contador = "07BA272070" Then
    
    
        'Para ver cuantos conceptos se facturan
        codigo = "Select * from aguacontadoresconce where contador =" & DBSet(miRsAux!Contador, "T") & " ORDER BY codconceAg"
        rsConcep.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
        
        'LA CABECERA
        '------------------------------------------------------------------------------------------------------
        'codtipom,numalbar,fechaalb,factursn,codclien
        codigo = "'ALG'," & NumRegElim & " ," & DBSet(miRsAux!fecha_actual, "F") & ",1," & DBSet(miRsAux!codClien, "T") & ","
        'nomclien,domclien,codpobla,pobclien,proclien,nifclien
        codigo = codigo & DBSet(miRsAux!Nomclien, "T") & "," & DBSet(miRsAux!domclien, "T") & "," & DBSet(miRsAux!codpobla, "T")
        codigo = codigo & "," & DBSet(miRsAux!pobclien, "T", "N") & "," & DBSet(miRsAux!proclien, "T", "N") & "," & DBSet(miRsAux!nifClien, "T", "N")
        'telclien,referenc,facturkm codtraba,codtrab1,codtrab2,codagent,
        codigo = codigo & "," & DBSet(miRsAux!telclie1, "T") & "," & DBSet(miRsAux!Contador, "T") & ",0," & cadPDFrpt & "," & cadPDFrpt & "," & cadPDFrpt & "," & vParamAplic.PorDefecto_Agente
        'codforpa,codenvio,dtoppago,dtognral,tipofact,numpedcl
        codigo = codigo & "," & miRsAux!codforpa & "," & miRsAux!CodEnvio & ",0,0,1,null,"  'factura x albaran
        'observa01,observa02
        cadNomRPT = ""
        If IsNull(miRsAux!fecha_anterior) Then
            cadNomRPT = "--/--/----"
        Else
            cadNomRPT = Format(miRsAux!fecha_anterior, "dd/mm/yyyy")
        End If
        cadNomRPT = cadNomRPT & "  " & Format(DBLet(miRsAux!lec_anterior, "N"), "0000")
        
        codigo = codigo & DBSet(cadNomRPT, "T") & ",'" & Format(miRsAux!fecha_actual, "dd/mm/yyyy") & " " & Format(miRsAux!lec_actual, "0000") & "',"
        
        'observa03,observa04,
        
        codigo = codigo & DBSet(miRsAux!nomcalibre, "T") & "," & DBSet(Trim(""), "T")
        'observa05,esticket
        ' obs05 llevara los textos del DOGV y el tfno de averias
        ' con lo cual sera
        ' Dogv1(30)   Dogv3(30)  Tefono averias (20
        cadNomRPT = Mid(DBLet(RsParametros!TextoDOGV1, "T") & Space(40), 1, 30) & Mid(DBLet(RsParametros!TextoDOGV2, "T") & Space(40), 1, 30)
        cadNomRPT = cadNomRPT & Mid(DBLet(RsParametros!TfnoAverias, "T") & Space(30), 1, 20)
        codigo = codigo & "," & DBSet(cadNomRPT, "T") & ",0)"
         

        
        conn.Execute cadFormula & codigo
        
        codigo = ""

        
        
        'DATO  rsconcep NO puede ser eof
        
        '------------------------------------------------------------------------------------------------------
        
        'ME guardo el consumo
        If CByte(miRsAux!TipoFacturacion) = 2 Then
            'ANEXO. Consumo 0
            ConsumoM3 = 0
        
        ElseIf CByte(miRsAux!TipoFacturacion) = 0 Then
            'CONTADOR
            ConsumoM3 = miRsAux!lec_actual - DBLet(miRsAux!lec_anterior, "N")
        
        Else
            'AFORO
            'Se le factura el valor del aforo de la linea de prametros
            If miRsAux!TipoUso = 0 Then
                ConsumoM3 = RsParametros!AforoMaxDom
            Else
                ConsumoM3 = RsParametros!AforoMaxind
            End If
        End If
    
        '########
        'Si cambiamos cualquier cosa hay que tener en cuenta esas modificaciones en
        ' .- Prefacturacion
        ' .- Hco Facturas. Modificar consumo
        
        'Consumos
        linea = 1
        rsConcep.Find "codconceAg = 1", , adSearchForward, 1 'Facturamos consumo
        If Val(rsConcep!facturar) = 1 Then codigo = codigo & AguaConsumo_o_Alcantarillado(0, linea, RsParametros)
        
        'cuota servicio consumo
        linea = 5
        rsConcep.Find "codconceAg = 2", , adSearchForward, 1 'Facturamos cuota servicio consumo
        If Val(rsConcep!facturar) = 1 Then
                'ARiculo artCuotaServD artCuotaServI
                'Precio  CuotaSerD CuotaSerI
                If miRsAux!TipoUso = 0 Then
                    ARti2 = RsParametros!artCuotaServD
                    Precio2 = miRsAux!CuotaSerD
                Else
                    ARti2 = RsParametros!artCuotaServi
                    Precio2 = miRsAux!CuotaSerI
                End If
                canti = mesesPeriodo
                
                codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & ",'Cuota servicio agua potable'"
                codigo = codigo & ",NULL," & canti & "," & canti & "," & DBSet(Precio2, "N")
                codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        End If
        
        
        'Consumo alcantarillado
        linea = 6
        rsConcep.Find "codconceAg = 3", , adSearchForward, 1 'Facturamos consumo
        If Val(rsConcep!facturar) = 1 Then codigo = codigo & AguaConsumo_o_Alcantarillado(1, linea, RsParametros)
        
        'cuota servicio alcantarillado
        linea = 10
        rsConcep.Find "codconceAg = 4", , adSearchForward, 1 'Facturamos cuota servicio consumo
        If Val(rsConcep!facturar) = 1 Then
                'ARiculo artAlcanServD  artAlcanServI
                'Precio  SerAlcanD SerAlcanI
                If miRsAux!TipoUso = 0 Then
                    ARti2 = RsParametros!artAlcanServD
                    Precio2 = miRsAux!SerAlcanD
                Else
                    ARti2 = RsParametros!artAlcanServI
                    Precio2 = miRsAux!SerAlcanI
                End If
                canti = mesesPeriodo
                codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & ",'Cuota servicio alcantarillado'"
                codigo = codigo & ",NULL," & canti & "," & canti & "," & DBSet(Precio2, "N")
                codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        End If
        
        '*******************************************************************************
        '// Separador para mostrar el valor 'hasta el momento del IVA
        '--------------------------------------------------------------------------------
        'En cantidad llevara los dias traanscurridos entre las lecturas.
        'Si no hubiera fecha anterior cogeria fecha fin periodo anterior +1
        'Si fuera negativo o cero, pondremos 1
        linea = 11
        ARti2 = RsParametros!artVarios
        Precio2 = 0
        cadTitulo = "IVA"
        
        
        If miRsAux!TipoFacturacion > 0 Then
            'AFORO O anexo
            canti = mesesPeriodo * 30
        Else
            If IsNull(miRsAux!fecha_anterior) Then
                FF = FInicioPeriodo
            Else
                FF = miRsAux!fecha_anterior
            End If
            canti = DateDiff("d", FF, miRsAux!fecha_actual)
        
            If canti <= 0 Then canti = 1
        End If
    
    
    
        cadTitulo = ""
        codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
        codigo = codigo & ",null," & canti & "," & canti & "," & DBSet(Precio2, "N")
        codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        
        
        
        'Cuota mto contador
        linea = 12
        rsConcep.Find "codconceAg = 5", , adSearchForward, 1
        If Val(rsConcep!facturar) = 1 Then
                'artContadorD artContadorI
                'ContadD  ContadI
                If miRsAux!TipoUso = 0 Then
                    ARti2 = RsParametros!artContadorD
                    Precio2 = miRsAux!ContadD
                Else
                    ARti2 = RsParametros!artContadorI
                    Precio2 = miRsAux!ContadI
                End If
                canti = mesesPeriodo
                
                cadTitulo = "Cuota mantenimiento contador"
                codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
                codigo = codigo & ",null," & canti & "," & canti & "," & DBSet(Precio2, "N")
                codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        End If
        'Cuot servicio transitoira amortizaciones
        linea = 13
        rsConcep.Find "codconceAg = 6", , adSearchForward, 1 'Facturamos cuota servicio consumo
        If Val(rsConcep!facturar) = 1 Then
                'artAmortD  artAmortI
                'SerTranAmorD   SerTranAmorI
                If miRsAux!TipoUso = 0 Then
                    ARti2 = RsParametros!artAmortD
                    Precio2 = miRsAux!SerTranAmorD
                Else
                    ARti2 = RsParametros!artAmortI
                    Precio2 = miRsAux!SerTranAmorI
                End If
                canti = mesesPeriodo
                cadTitulo = "Cuota de servicio transitoria-amortizaciones"
                codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
                codigo = codigo & ",null," & canti & "," & canti & "," & DBSet(Precio2, "N")
                codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        End If
        
        
        
        'Cuota VARIOS
        linea = 14
        rsConcep.Find "codconceAg = 7", , adSearchForward, 1 'Facturamos cuota servicio consumo
        If Val(rsConcep!facturar) = 1 Then
                'Esta es la rara.
                'Articulo unico, y el precio lo coje de la tabla
                ARti2 = RsParametros!artVarios
                Precio2 = rsConcep!importeconcepto
                cadTitulo = rsConcep!Descripcion
                codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
                codigo = codigo & ",null,1,1," & DBSet(Precio2, "N")
                codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * 1, 2), "N") & ",'M',1)"
        End If
        
        
        '-------------------------------- sEGUNDO SEPARADOR
        linea = 20
        ARti2 = RsParametros!artVarios
        Precio2 = 0
        cadTitulo = "IVA"
        canti = ConsumoM3   'En cantidad llevara los m3 facturados
    
        cadTitulo = ""
        codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
        codigo = codigo & ",null," & canti & "," & canti & "," & DBSet(Precio2, "N")
        codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        
        
        
        
        
        'GENERALITAT
        '-------------------------------------------------------
        'Consumo
        linea = 22
        rsConcep.Find "codconceAg = 11", , adSearchForward, 1 'Facturamos cuota consumo
        If Val(rsConcep!facturar) = 1 Then codigo = codigo & AguaConsumo_o_Alcantarillado(2, linea, RsParametros)
        'Reservo la 23 para las facturaciones que lleven dos BOEs de precios
        
        linea = 25
        rsConcep.Find "codconceAg = 12", , adSearchForward, 1 'Facturamos cuota servicio generalitat
        If Val(rsConcep!facturar) = 1 Then
               
                
                ' artCuotaServGenD artCuotaServGenI
                'precios: CuotaCanonGenD CuotaCanonGenI
                If miRsAux!TipoUso = 0 Then
                    ARti2 = RsParametros!artCuotaServGenD
                    Precio2 = DBLet(miRsAux!CuotaCanonGenD, "N")
                Else
                    ARti2 = RsParametros!artCuotaServGenI
                    Precio2 = DBLet(miRsAux!CuotaCanonGenI, "N")
                End If
                
                canti = mesesPeriodo
                cadTitulo = "Cuota de servicio"
                
                codigo = codigo & ", ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
                codigo = codigo & ",null," & canti & "," & canti & "," & DBSet(Precio2, "N")
                codigo = codigo & ",0,0," & DBSet(Round2(Precio2 * canti, 2), "N") & ",'M',1)"
        End If
        
       
                
        If codigo = "" Then
            'Meteremos UNA LINEA a cero para que no de error
            ' Con la cuto de varios y el codigo linea =100
            linea = 100
            rsConcep.Find "codconceAg = 7", , adSearchForward, 1 'Facturamos cuota servicio consumo
        
            ARti2 = RsParametros!artVarios
            Precio2 = 0
            cadTitulo = "Sin facturacion"
            codigo = " ('ALG'," & NumRegElim & "," & linea & ",1," & DBSet(ARti2, "T") & "," & DBSet(cadTitulo, "T")
            codigo = codigo & ",null,1,1," & DBSet(Precio2, "N")
            codigo = codigo & ",0,0,0,'M',1)"
        
        Else
            'Hacemos el insert
            codigo = Mid(codigo, 2)
            
            
            
        End If
        codigo = cadSelect & codigo
        conn.Execute codigo
        
        
        'incemetamos eel contador
        NumRegElim = NumRegElim + 1
        rsConcep.Close  'cerramos los conceptos por contador
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    
    
    
    
    If NumRegElim = 0 Then Err.Raise 513, "", "Ningun dato generado"
    
    Label3(86).Caption = "Fin proceso (I)"
    Label3(86).Refresh
    Espera 0.5
    
    
    preFacturacionAgua = True
    
    
eprocesoFacturacionAgua_Inser:
    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description
    Set RsParametros = Nothing


End Function



Private Function ListadoAguaPrefacturar() As Boolean
Dim RN As ADODB.Recordset
Dim RIVA As ADODB.Recordset
Dim PonerFecha As Boolean
Dim fin As Boolean
Dim NumeroAlbaran As Long
Dim PorcenNormal As Currency
Dim Calculo As Currency
Dim Total As Currency
Dim Consumo As Currency
On Error GoTo eListadoAguaPrefacturar
    ListadoAguaPrefacturar = False
    


    
    Label3(86).Caption = "Preparando datos"
    Label3(86).Refresh
        
    conn.Execute "DELETE FROM tmpinformes WHERE codusu =" & vUsu.codigo
    
    Label3(86).Caption = "Leyendo datos IVA"
    Label3(86).Refresh
    
    
    
    

    
    
    cadTitulo = ""
    cadPDFrpt = ""

    
    codigo = "select distinct(codigiva) from sartic where codartic in (select codartic from aguprefactlin)"
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    NumRegElim = 0
    codigo = ""

    While Not miRsAux.EOF
        NumRegElim = NumRegElim + 1
        codigo = codigo & ", " & miRsAux!codigiva
        miRsAux.MoveNext
    Wend
    miRsAux.Close
    If NumRegElim > 3 Then Err.Raise 513, , "Mas de tres tipos de IVA"
    
    
    Set RIVA = New ADODB.Recordset
    codigo = Mid(codigo, 2)
    codigo = "Select porceiva,codigiva from tiposiva WHERE codigiva in (" & codigo & ") ORDER BY 1"
    RIVA.Open codigo, ConnConta, adOpenKeyset, adLockPessimistic, adCmdText
    
    'No puede ser eof
    'El primero sera el 0%
    If RIVA!PorceIVA <> 0 Then Err.Raise 513, , "IVA 0% erroneo. Codigo IVA: " & miRsAux!PorceIVA
    
    NumRegElim = 0
    While Not RIVA.EOF
        NumRegElim = NumRegElim + 1
        PorcenNormal = RIVA!PorceIVA
        RIVA.MoveNext
    Wend
    
    RIVA.MoveFirst
    
    If NumRegElim <> 3 Then Err.Raise 513, , "Nº IVAs erroneos. Total: " & NumRegElim
    
    
   

    

    
    
    Label3(86).Caption = "Obteniendo registros"
    Label3(86).Refresh
    


    

    Set RN = New ADODB.Recordset
    codigo = "Select aguprefactalb.*,domconta from aguprefactalb,aguacontadores where aguprefactalb.referenc=aguacontadores.contador ORDER BY numalbar    "
    RN.Open codigo, conn, adOpenKeyset, adLockPessimistic, adCmdText
    
        
    codigo = "select numalbar,codigiva,sum(importel) LaBase,sum(if(numlinea=20,cantidad,0)) consumo"
    codigo = codigo & " from aguprefactlin,sartic where aguprefactlin.codartic=sartic.codartic  group by 1,2  ORDER BY 1"
    miRsAux.Open codigo, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    
    
    miSQL = "insert into tmpinformes(codusu,codigo1,fecha1,nombre1,nombre2,nombre3,obser,campo2,importe1,importe2,importe3,importe4,importe5,importeb1) VALUES  "
    
    'En cadtitulo tenemos el iva cero
    NumRegElim = 0
    codigo = ""
    NumeroAlbaran = -1
    While Not miRsAux.EOF
    
        
        NumRegElim = NumRegElim + 1
        NumeroAlbaran = miRsAux!NumAlbar
        RN.Find "numalbar = " & NumeroAlbaran, , adSearchForward, 1   'NO PUEDE SER EOF
        
        
        Label3(86).Caption = "Nº: " & NumeroAlbaran & " " & DBLet(RN!Nomclien, "T")
        Label3(86).Refresh
        codigo = codigo & ", (" & vUsu.codigo & "," & miRsAux!NumAlbar & "," & DBSet(RN!FechaAlb, "F")
        codigo = codigo & "," & DBSet(RN!Nomclien, "T") & ","
        

        
        codigo = codigo & DBSet(RN!domconta, "T")
        codigo = codigo & "," & DBSet(RN!referenc, "T") & ","
        
        'Campo Obser llevara
        ' 10 posiciones FECHA anterior
        ' 5 posiciones lectura anterior
        ' 10 posiciones fecha actual
        ' 5 posiciones lectura actual
        
        'Separaremos
        PonerFecha = False
        cadPDFrpt = ""
        If DBLet(RN!observa01, "T") <> "" Then
            If Mid(RN!observa01, 6, 3) = "/20" Then PonerFecha = True
        End If
        If PonerFecha Then
            cadPDFrpt = Mid(RN!observa01, 1, 10)
            cadFormula = Trim(Mid(RN!observa01, 11))
            cadFormula = Right(Space(5) & cadFormula, 5)
            cadPDFrpt = cadPDFrpt & cadFormula
        Else
            cadPDFrpt = Space(15)
        End If
        
        PonerFecha = False
        cadTitulo = ""
        If DBLet(RN!observa02, "T") <> "" Then
            If Mid(RN!observa02, 6, 3) = "/20" Then PonerFecha = True
        End If
        If PonerFecha Then
            cadTitulo = Mid(RN!observa02, 1, 10)
            cadFormula = Trim(Mid(RN!observa02, 11))
            cadFormula = Right(Space(5) & cadFormula, 5)
            cadTitulo = cadTitulo & cadFormula
        Else
            cadTitulo = Space(15)
        End If
        cadPDFrpt = cadPDFrpt & cadTitulo
        
        
        
        codigo = codigo & DBSet(cadPDFrpt, "T")
        
        CadParam = 0
        'IMporte1 importe 2, suministro base + iva   REDUCIDO
        cadPDFrpt = ",0,0"
        'Importe3, importe 4  instalacion base + iva NORMAL
        cadTitulo = ",0,0"
        'importe5 tasas  EXENTO
        'Importe b1
        cadFormula = ",0"
        
        
        fin = False
        Total = 0
        Consumo = 0
        Do
            If miRsAux!Consumo <> 0 Then Consumo = miRsAux!Consumo
                      
            RIVA.Find "codigiva = " & miRsAux!codigiva, , adSearchForward, 1
            If RIVA.EOF Then Err.Raise 513, , "IVA no encontrado " & miRsAux!codigiva
            
            
             'Grabamos una variable u otra
            If RIVA!PorceIVA = 0 Then
                'TASS
                cadFormula = "," & DBSet(miRsAux!labase, "N")
                Calculo = 0
            ElseIf RIVA!PorceIVA = PorcenNormal Then
                Calculo = Round2((miRsAux!labase * RIVA!PorceIVA) / 100, 2)
                cadTitulo = "," & DBSet(miRsAux!labase, "N") & "," & DBSet(Calculo, "N")
            Else
                Calculo = Round2((miRsAux!labase * RIVA!PorceIVA) / 100, 2)
                cadPDFrpt = "," & DBSet(miRsAux!labase, "N") & "," & DBSet(Calculo, "N")
            End If
            Total = Total + Calculo + miRsAux!labase
            
            
            
            miRsAux.MoveNext
            If miRsAux.EOF Then
                fin = True
            Else
                If miRsAux!NumAlbar <> NumeroAlbaran Then fin = True

              
                
            End If
        Loop Until fin
        codigo = codigo & "," & DBSet(Consumo, "N")
        codigo = codigo & cadPDFrpt & cadTitulo & cadFormula & "," & DBSet(Total, "N") & ")"
        
        

        
        
        If (NumRegElim Mod 5) = 0 Then
            Label3(86).Caption = "Numero: " & NumRegElim
            Label3(86).Refresh
            codigo = Mid(codigo, 2)
            codigo = miSQL & codigo
            conn.Execute codigo
            codigo = ""
        End If
       
    Wend
    miRsAux.Close
    RIVA.Close
    RN.Close
    If codigo <> "" Then
        codigo = Mid(codigo, 2)
        codigo = miSQL & codigo
        conn.Execute codigo
    End If
    
    
    
    
    InicializarVbles True
    cadFormula = "{tmpinformes.codusu} = " & vUsu.codigo
    cadTitulo = "Prefacturacion final fichero consumo agua"
    
    CadParam = CadParam & "pdh1= ""Fichero: " & TxtFichero(0).Text & """|"
    numParam = 1
    
    cadPDFrpt = ""
    cadNomRPT = "aguPrefactura.rpt"
    conSubRPT = False
    vMostrarTree = False
    LlamarImprimir
    
    ListadoAguaPrefacturar = True
    
    
eListadoAguaPrefacturar:
    If Err.Number <> 0 Then MuestraError Err.Number, Err.Description, Err.Description
    Set miRsAux = Nothing
    Set RN = Nothing
    Set RIVA = Nothing
End Function




Private Function HacerSimulacionPedidoProveedor() As Boolean
Dim vPrecio As CPreciosCom
Dim origenPrecio As Byte
    '0 Ni precio ni dtos
    '1 Dtos, precio desde upc
    '2 De slispr
Dim TipoDto As Byte



    On Error GoTo eHacerSimulacionPedidoProveedor
    
    HacerSimulacionPedidoProveedor = False
    
    For numParam = 12 To 15
        Me.txtDecimal(numParam).Text = ""
    Next
    
    
    If txtCodProve(29).Text = "" Then Exit Function
    If Me.txtDescProve(29).Text = "" Then Exit Function
        
    Set miRsAux = New ADODB.Recordset
    Set vPrecio = New CPreciosCom
    

    conn.Execute "Delete from tmpslipreu where codusu =" & vUsu.codigo
    

    TipoDto = DevuelveDesdeBDNew(conAri, "sprove", "tipodtos", "codprove", txtCodProve(29).Text, "N")
            
    NumRegElim = RecuperaValor(Me.OtrosDatos, 4)
    miSQL = "Select slippr.*,artvario from slippr,sartic  where slippr.codartic=Sartic.codartic and numpedpr =" & NumRegElim
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    
    
    vectorSQL(0) = 0  'No cambiada
    vectorSQL(1) = 0  'descuentos
    vectorSQL(2) = 0  'todo cambiado
    vectorSQL(3) = 0    'Suma lineas
    vectorSQL(4) = 0    'Total con dto pp y dto gnral
    miSQL = ""
    While Not miRsAux.EOF
        
        
        origenPrecio = 0
        
        
        
        If miRsAux!artvario = 0 Then
            'cadparam -> Precio    cadselect-Dto1
            'cadFormula-> Dto 2    cadTitulo->importel
            If vPrecio.Leer(miRsAux!codArtic, txtCodProve(29).Text) Then
                If vPrecio.ComprobarCantidad(miRsAux!cantidad) Then
                    CadParam = vPrecio.ObtenerPrecio(txtFecha(59).Text)
                    cadSelect = vPrecio.Descuento1
                    cadFormula = vPrecio.Descuento2
                    
                    cadTitulo = CalcularImporteSng(CStr(miRsAux!cantidad), CadParam, cadSelect, cadFormula, TipoDto)
                    
                    vectorSQL(2) = Val(vectorSQL(2)) + 1
                    origenPrecio = 2
                End If
            
            
            End If
            
            
            If origenPrecio = 0 Then
            
                CadParam = DevuelveDesdeBDNew(conAri, "sartic", "preciouc", "codartic", miRsAux!codArtic, "T")
                If CadParam <> "" Then
                    'Septiembre 2010   'Descuentos
                    vPrecio.CodigoArtic = miRsAux!codArtic
                    vPrecio.CodigoProve = txtCodProve(29).Text
                    cadSelect = vPrecio.ObtenerDescuentos2(txtFecha(59).Text, cadFormula)
                    If cadSelect <> "" Then
                        cadTitulo = CalcularImporteSng(CStr(miRsAux!cantidad), CadParam, cadSelect, cadFormula, TipoDto)
                        origenPrecio = 1
                        vectorSQL(1) = Val(vectorSQL(1)) + 1
                    End If
                End If
            
            End If
        End If   'De VARIOS
        
        If origenPrecio = 0 Then
            CadParam = miRsAux!precioar
            cadSelect = miRsAux!dtoline1
            cadFormula = miRsAux!dtoline2
            cadTitulo = miRsAux!ImporteL
            vectorSQL(0) = Val(vectorSQL(0)) + 1
        End If
        vectorSQL(3) = CCur(vectorSQL(3)) + CCur(cadTitulo)
        
        
        'tmpslipreu(codusu,numofert,numlinea,codartic,nomartic,cantidad,precioar,dtoline1,dtoline2,importel,codalmac)
        'En codalmac tendremos si ha encontrado en slispr el precio del articulo-proveedor
        cadPDFrpt = ", (" & vUsu.codigo & "," & NumRegElim & "," & miRsAux!numlinea & "," & DBSet(miRsAux!codArtic, "T") & ","
        cadPDFrpt = cadPDFrpt & DBSet(miRsAux!NomArtic, "T") & "," & DBSet(miRsAux!cantidad, "N") & ","
        cadPDFrpt = cadPDFrpt & DBSet(CadParam, "N") & "," & DBSet(cadSelect, "N") & ","
        cadPDFrpt = cadPDFrpt & DBSet(cadFormula, "N") & "," & DBSet(cadTitulo, "N") & "," & origenPrecio & ")"
        miSQL = miSQL & cadPDFrpt
        miRsAux.MoveNext
        
    Wend
    miRsAux.Close
      
    If miSQL = "" Then
        'ERROR
    Else
        miSQL = Mid(miSQL, 2)
        miSQL = "INSERT INTO tmpslipreu(codusu,numofert,numlinea,codartic,nomartic,cantidad,precioar,dtoline1,dtoline2,importel,codalmac) VALUES " & miSQL
        conn.Execute miSQL
        
        'La cabecera por si quiere imprimirlo
        
    End If
        
    
    
    Me.txtDecimal(12) = Val(vectorSQL(0))
    Me.txtDecimal(13) = Val(vectorSQL(1))
    Me.txtDecimal(14) = Val(vectorSQL(2))
    Me.txtDecimal(15) = Format(CCur(vectorSQL(3)), FormatoImporte)
    
    
    cadPDFrpt = "0,00"
    miSQL = cadPDFrpt
    CadParam = vectorSQL(3)
    If Me.txtDecimal(10).Text <> "" Then miSQL = CalcularPorcentaje(ImporteFormateado(CadParam), ImporteFormateado(txtDecimal(10).Text), 2)
    If Me.txtDecimal(11).Text <> "" Then cadPDFrpt = CalcularPorcentaje(ImporteFormateado(CadParam), ImporteFormateado(txtDecimal(11).Text), 2)
    miSQL = CStr(CCur(CadParam) - CCur(miSQL) - CCur(cadPDFrpt))
    Me.txtDecimal(16) = Format(CCur(miSQL), FormatoImporte)
    
eHacerSimulacionPedidoProveedor:
    If Err.Number <> 0 Then
        MuestraError Err.Number
        
    End If
    Set miRsAux = Nothing
    Set vPrecio = New CPreciosCom
    
    
End Function



Private Function RealizarCambiosProveedorPedido2() As String
Dim vTipoMov As CTiposMov
    
    On Error GoTo eRealizarCambiosProveedorPedido
    
    RealizarCambiosProveedorPedido2 = ""
    
    'Quitamos la primera coma
    CadenaDesdeOtroForm = Mid(CadenaDesdeOtroForm, 2)   'tenemos las lineas que cambian de proveedor
    
    
    Set miRsAux = New ADODB.Recordset
    
    'Vemos si hay que desdoblar el pedido. Es decir, NO ha selecionado todoas las lineas a traspasar
    'Por lo tanto, las seleccionadas pasan y las que no se van a un albaran con los datos
    miSQL = RecuperaValor(Me.OtrosDatos, 4)
    miSQL = "numpedpr=" & miSQL & " and not numlinea in (" & CadenaDesdeOtroForm & ")"
    miRsAux.Open "Select * from slippr where " & miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    If Not miRsAux.EOF Then
        Set vTipoMov = New CTiposMov
        If Not vTipoMov.Leer("PEC") Then Err.Raise "Obteniendo contador pedido"
        vTipoMov.ConseguirContador vTipoMov.TipoMovimiento
        vTipoMov.IncrementarContador vTipoMov.TipoMovimiento
    End If
    miRsAux.Close
    
    
    
    If Not vTipoMov Is Nothing Then
        cadTitulo = RecuperaValor(Me.OtrosDatos, 4)   'Numero pedido
        'Hay que crear un nuevo con los otros datos
        cadFormula = ",fecpedpr,codprove,nomprove,domprove,codpobla,pobprove,proprove,nifprove,telprove,"
        cadFormula = cadFormula & "coddirea,coddiref,codforpa,codtraba,codtrab1,dtognral,dtoppago,restoped,codclien,"
        cadFormula = cadFormula & "observa1,observa2,observa3,observa4,observa5,tipoporte,obra,coddirre,"
        cadFormula = cadFormula & "NReferencia,SReferencia,codenvio,fecentrega"
        
        miSQL = "INSERT INTO scappr(numpedpr" & cadFormula & ") "
        miSQL = miSQL & "SELECT " & vTipoMov.Contador & cadFormula & " FROM scappr where numpedpr =" & cadTitulo
        conn.Execute miSQL
        
        
        'Lineas
        cadFormula = ",numlinea , codArtic, codAlmac, NomArtic, Ampliaci, cantidad, recibida, precioar, "
        cadFormula = cadFormula & "dtoline1, dtoline2, ImporteL, CodCCost, codclien, CodDirec, actuacion"
        miSQL = "INSERT INTO slippr(numpedpr" & cadFormula & ") "
        miSQL = miSQL & "SELECT " & vTipoMov.Contador & cadFormula & " FROM slippr where numpedpr =" & cadTitulo
        miSQL = miSQL & " and not numlinea in (" & CadenaDesdeOtroForm & ")"
        conn.Execute miSQL
        
    End If
            
            
            

    'Updateamos cabecera de pedido
    cadFormula = RecuperaValor(Me.OtrosDatos, 4)   'Numero pedido
    miRsAux.Open "Select * from sprove where codprove= " & Me.txtCodProve(29).Text, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    
    
    
    'NO PUEDE SER EOF
    'codprove   nomprove   domprove    codpobla   pobprove    proprove    nifprove    telprove

    miSQL = "UPDATE scappr SET codprove=" & miRsAux!Codprove
    miSQL = miSQL & ", nomprove = " & DBSet(miRsAux!nomprove, "T")
    miSQL = miSQL & ", domprove = " & DBSet(miRsAux!domprove, "T")
    miSQL = miSQL & ", codpobla = " & DBSet(miRsAux!codpobla, "N")
    miSQL = miSQL & ", pobprove = " & DBSet(miRsAux!pobprove, "T")
    miSQL = miSQL & ", proprove = " & DBSet(miRsAux!proprove, "T")
    miSQL = miSQL & ", nifprove = " & DBSet(miRsAux!nifProve, "T")
    miSQL = miSQL & ", telprove = " & DBSet(miRsAux!telprov1, "T")
    
    'Poner a NULL, por si acaso
    'coddirea    coddiref   obra    coddirre
    miSQL = miSQL & ", coddirea = NULL, coddiref = NULL"
    miSQL = miSQL & ", obra = NULL, coddirre = NULL"
    
    miSQL = miSQL & " WHERE numpedpr  = " & cadFormula
    conn.Execute miSQL
    
    miRsAux.Close
    
    
    
    
    'Las lineas. Solo las que cambien
    miSQL = "Select * from tmpslipreu where codusu =" & vUsu.codigo & " AND codalmac >0"
    'y estan seleccionadas en el previo
    miSQL = miSQL & " and  numlinea in (" & CadenaDesdeOtroForm & ")"
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    While Not miRsAux.EOF
    
        miSQL = "UPDATE slippr SET precioar=" & DBSet(miRsAux!precioar, "N")
        miSQL = miSQL & ", dtoline1=" & DBSet(miRsAux!dtoline1, "N")
        miSQL = miSQL & ", dtoline2=" & DBSet(miRsAux!dtoline2, "N")
        miSQL = miSQL & ", importel=" & DBSet(miRsAux!ImporteL, "N")
        miSQL = miSQL & " WHERE numpedpr  = " & cadFormula
        miSQL = miSQL & " AND numlinea = " & miRsAux!numlinea
        conn.Execute miSQL
        
        miRsAux.MoveNext
    Wend
    miRsAux.Close

    'Quito las que no ha marcado que se quedan con el proveedor anterior
    If Not vTipoMov Is Nothing Then
        miSQL = "DELETE FROM slippr where numpedpr =" & cadFormula
        miSQL = miSQL & " and not numlinea in (" & CadenaDesdeOtroForm & ")"
        conn.Execute miSQL
    End If
    
    'Llega has ta aqui...
        
    RealizarCambiosProveedorPedido2 = cadFormula
    If Not vTipoMov Is Nothing Then RealizarCambiosProveedorPedido2 = RealizarCambiosProveedorPedido2 & "," & vTipoMov.Contador

eRealizarCambiosProveedorPedido:
    If Err.Number <> 0 Then MuestraError Err.Number, , Err.Description
    Set miRsAux = Nothing
    Set vTipoMov = Nothing
End Function



Private Function GenerarFicheroExportarFAS() As Boolean
Dim NF As Integer

    On Error GoTo eGenerarFicheroExportarFAS
    GenerarFicheroExportarFAS = False
    
    miSQL = "select scaalb.numalbar,numlinea,fechaalb,codclien,nomclien,nifclien,codartic,nomartic,cantidad"
    miSQL = miSQL & " from slialb,scaalb where scaalb.codtipom=slialb.codtipom and scaalb.numalbar=slialb.numalbar"
    If Me.txtFecha(60).Text <> "" Then miSQL = miSQL & " AND scaalb.fechaalb >= " & DBSet(Me.txtFecha(60).Text, "F")
    If Me.txtFecha(61).Text <> "" Then miSQL = miSQL & " AND scaalb.fechaalb <= " & DBSet(Me.txtFecha(61).Text, "F")
    miSQL = miSQL & " and scaalb.codtipom='ALS' order by codclien"
    
    Set miRsAux = New ADODB.Recordset
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    miSQL = ""
    If Not miRsAux.EOF Then
        NF = FreeFile
        cadNomRPT = App.Path & "\ExpFAS.dat"  'lo utiliza cunado llame a la funcion guardar
        Open cadNomRPT For Output As #NF
        While Not miRsAux.EOF
            miSQL = vParam.CifEmpresa & ";"
            
            For numParam = 0 To miRsAux.Fields.Count - 1
                miSQL = miSQL & DBLet(miRsAux.Fields(CInt(numParam)), "T") & ";"
            Next
            
            Print #NF, miSQL
    
    
            miRsAux.MoveNext
        Wend
       
        GenerarFicheroExportarFAS = True
        
    End If 'EOF mirsaux
    miRsAux.Close
    
    If miSQL = "" Then MsgBox "No se ha generado ningun dato", vbExclamation
        
    
    
eGenerarFicheroExportarFAS:
    If Err.Number <> 0 Then MuestraError Err.Number, , Err.Description
    If NF > 0 Then Close #NF
    Set miRsAux = Nothing
End Function


'Para el check indicado lo concatenara a una cadena y sumara uno en numregelim
Private Function AnyadirCheckAgua(indice As Byte, Resetear As Boolean)
    If Resetear Then NumRegElim = 0: miSQL = "": codigo = ""
    If Me.chkAgua2(indice).Value = 1 Then
        NumRegElim = NumRegElim + 1
        miSQL = miSQL & "   " & Me.chkAgua2(indice).Caption
        codigo = codigo & ", " & Me.chkAgua2(indice).Tag
    End If
End Function


Private Function ListadoContadoresAgua() As Boolean

    On Error GoTo eListadoContadoresAgua
    
    ListadoContadoresAgua = False
    
    Set miRsAux = New ADODB.Recordset
    
    
    vMostrarTree = False
    
    'Cotnador aforo anexo
    AnyadirCheckAgua 0, True
    AnyadirCheckAgua 1, vMostrarTree
    AnyadirCheckAgua 2, vMostrarTree
    'No los ha seleccionado todos
    
    If NumRegElim = 0 Then
        Err.Raise 513, , "Seleccione al menos un tipo de facturacion"
    ElseIf NumRegElim < 3 Then
        cadPDFrpt = cadPDFrpt & "Tipo: " & Trim(miSQL)
        cadSelect = cadSelect & " AND @aguacontadores.TipoFacturacion#  IN (" & Mid(codigo, 2) & ")"
    End If
    
    'Domestico o industrial
    AnyadirCheckAgua 3, True
    AnyadirCheckAgua 4, vMostrarTree
    'No los ha seleccionado todos
    If NumRegElim = 0 Then
        Err.Raise 513, , "Seleccione al menos un tipo de uso"
    ElseIf NumRegElim < 2 Then
        cadPDFrpt = Trim(cadPDFrpt & "       Uso: " & Trim(miSQL))
        cadSelect = cadSelect & " AND @aguacontadores.TipoUso# IN (" & Mid(codigo, 2) & ")"
    End If
    
    'facturar
    AnyadirCheckAgua 5, True
    AnyadirCheckAgua 6, vMostrarTree
    'No los ha seleccionado todos
    If NumRegElim = 0 Then
        Err.Raise 513, , "Seleccione al menos un valor para facturar"
    ElseIf NumRegElim < 2 Then
        cadPDFrpt = Trim(cadPDFrpt & "       Facturar: " & Trim(miSQL))
        cadSelect = cadSelect & " AND @aguacontadores.Facturar# IN (" & Mid(codigo, 2) & ")"
    End If
    
    'Baja
 '   AnyadirCheckAgua 7, True
 '   AnyadirCheckAgua 8, vMostrarTree
 '   'No los ha seleccionado todos
 '   If NumRegElim < 2 Then
 '       cadPDFrpt = cadPDFrpt & Trim(cadParam & "       Baja: " & miSQL)
 '       cadSelect = cadSelect & " AND TipoUso IN (" & Mid(Codigo, 2) & ")"
 '   ElseIf NumRegElim = 0 Then
 '       Err.Raise 513, , "Seleccione al menos un valor para baja"
 '   End If
    
    CadParam = CadParam & "DesdeHasta=""" & cadPDFrpt & """|"
    numParam = numParam + 1
    
    cadPDFrpt = "1=1 " & cadSelect
    cadPDFrpt = Replace(cadPDFrpt, "@", "")
    cadPDFrpt = Replace(cadPDFrpt, "#", "")
    codigo = DevuelveDesdeBD(conAri, "count(*)", "aguacontadores", cadPDFrpt & " AND 1", "1")
    If Val(codigo) = 0 Then
        MsgBox "Ningun registro", vbExclamation
    Else
        cadFormula = Replace(cadSelect, "(", "[")
        cadFormula = Replace(cadFormula, ")", "]")
        cadFormula = Replace(cadFormula, "@", "{")
        cadFormula = Replace(cadFormula, "#", "}")
        'Quitamos el primer AND
        If cadFormula <> "" Then cadFormula = Mid(cadFormula, 5)
        ListadoContadoresAgua = True
    End If
    
    
eListadoContadoresAgua:
    If Err.Number <> 0 Then MuestraError Err.Number, , Err.Description
    Set miRsAux = Nothing
End Function


'Si va un albaran por campo, o van todos los campos juntos, lo unico que habra que hacer
'   sera agrupar el insert dentro de un RS
Private Function InsertarAlbaranesMarjalChipos()
Dim cantidad As Currency
Dim Trabajador As Long


    

    CadParam = "ALV"  'tipo malbaran
    cadPDFrpt = PonerTrabajadorConectado("")
    If cadPDFrpt = "" Then
        MsgBox "Error trabajador conectado", vbExclamation
        Exit Function
    End If
        
    miSQL = DevuelveDesdeBD(conAri, "contador", "stipom", "codtipom", CadParam, "T")
    NumRegElim = Val(miSQL)    'Contador
    'Agente
    cadSelect = DevuelveDesdeBD(conAri, "codagent", "sagent", "1", "1")
    'Envio
    miSQL = DevuelveDesdeBD(conAri, "codenvio", "senvio", "1", "1")
        
    'Cadena insercion cabecera ALBARAN
    cadFormula = "INSERT INTO scaalb(codenvio,codtipom,fechaalb,factursn,codtraba,codtrab1,codtrab2,codagent"
    cadFormula = cadFormula & ",numalbar,codclien,nomclien,domclien,codpobla,pobclien,proclien,"
    cadFormula = cadFormula & "nifclien,telclien,coddirec,nomdirec,referenc,codforpa,dtoppago,dtognral,tipofact"
    cadFormula = cadFormula & ",observa01,observa02,observa03,observa04,observa05,tipAlbaran) VALUES "
    cadFormula = cadFormula & "(" & miSQL & ",'" & CadParam & "'," & DBSet(txtFecha(62).Text, "F") & ",1,"
    cadFormula = cadFormula & cadPDFrpt & "," & cadPDFrpt & "," & cadPDFrpt & "," & cadSelect
    
    
    'Cadena INSERCION linea albaranç
    cadPDFrpt = DevuelveDesdeBD(conAri, "codprove", "sprove", "nifprove", vParam.CifEmpresa, "T")
    If cadPDFrpt = "" Then cadPDFrpt = DevuelveDesdeBD(conAri, "codprove", "sprove", "1", "1", "T")
    cadSelect = "INSERT INTO slialb(codprovex,codalmac,codtipom,numalbar,numlinea,codartic,nomartic,"
    cadSelect = cadSelect & "ampliaci,cantidad,numbultos,precioar,dtoline1,dtoline2,importel,origpre)"
    cadSelect = cadSelect & "VALUES (" & cadPDFrpt & ",1,'" & CadParam & "',"





    miSQL = "Select sclienhuertos.codclien,nomclien,domclien,codpobla,pobclien,proclien,nifclien,telclie1,codforpa"
    miSQL = miSQL & ",partida,poligono,parcela,recintos,supderec,tipofact,Id FROM  sclienhuertos,sclien where sclienhuertos.codclien=sclien.codclien"
    miSQL = miSQL & " and fecbajas is null ORDER BY sclienhuertos.codclien,id"
    
    miRsAux.Open miSQL, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    Trabajador = -1
    While Not miRsAux.EOF
        Label3(93).Caption = miRsAux!codClien & " - " & miRsAux!Nomclien
        Label3(93).Refresh
        
        If Trabajador <> miRsAux!codClien Then
            NumRegElim = NumRegElim + 1
            If Trabajador >= 0 Then
                'cadPDFrpt
                
                
            End If
            Trabajador = miRsAux!codClien
            cadPDFrpt = ""
        
            ',numalbar,codclien,nomclien,domclien,codpobla,pobclien,proclien,"
            miSQL = "," & NumRegElim & "," & miRsAux!codClien & "," & DBSet(miRsAux!Nomclien, "T") & "," & DBSet(miRsAux!domclien, "T") & ","
            miSQL = miSQL & DBSet(miRsAux!codpobla, "N") & "," & DBSet(miRsAux!pobclien, "T") & "," & DBSet(miRsAux!proclien, "T") & ","
            'nifclien,telclien,coddirec,nomdirec,referenc,codforpa,dtoppago,dtognral,tipofact"
            miSQL = miSQL & DBSet(miRsAux!nifClien, "T") & "," & DBSet(miRsAux!telclie1, "T", "S") & ",null,NULL,NULL,"
            miSQL = miSQL & miRsAux!codforpa & ", 0 , 0 ," & miRsAux!TipoFact & ", "
            'observa01,observa02,observa03,observa04,observa05,tipAlbaran) VALUES "
            miSQL = miSQL & DBSet(textoSinControl(0).Text, "T", "S") & " , NULL, NULL, NULL, NULL,0)"
            
            miSQL = cadFormula & miSQL
            conn.Execute miSQL
        
            
        End If
        
        'La linea(s)
        'numalbar,numlinea,codartic,nomartic,,ampliaci,cantidad numbultos
        'Pondremos los datos del campo
        cadPDFrpt = Trim(DBLet(miRsAux!partida, "T"))
        If cadPDFrpt <> "" Then cadPDFrpt = vbCrLf & "Partida: " & cadPDFrpt
        cadPDFrpt = "Polígono:" & Format(miRsAux!poligono, "00000") & "        Parcela:" & Format(miRsAux!parcela, "00000") & "      Recinto: " & DBLet(miRsAux!recintos, "T") & cadPDFrpt
        
        miSQL = NumRegElim & "," & miRsAux!Id & "," & DBSet(txtArticulo(15).Text, "T") & "," & DBSet(txtDescArticulo(15).Text, "T")
        
        
        cantidad = Round(miRsAux!supderec, 2)
        
        miSQL = miSQL & "," & DBSet(cadPDFrpt, "T", "S") & "," & DBSet(cantidad, "N") & ",1"
        
        'precioar,dtoline1,dtoline2,importel,origpre)"
        cantidad = Round(cantidad * ImporteFormateado(txtDecimal(17).Text), 2)
        miSQL = miSQL & "," & DBSet(Me.txtDecimal(17).Text, "N") & ",0,0," & DBSet(cantidad, "N") & ",'M')"
        
        miSQL = cadSelect & miSQL
        conn.Execute miSQL
        
        
        'Siguiente
        miRsAux.MoveNext
        
    Wend
    miRsAux.Close
    
    'UPdateamos contador
     miSQL = "UPDATE stipom SET contador=" & NumRegElim & " WHERE codtipom='" & CadParam & "'"
    conn.Execute miSQL
    
End Function

Private Sub InventariarRectificar()
    txtcantidad(0).Top = 3360
    If Opcion = 3 Then
        
        lblTitulo(26).ForeColor = Label4(198).ForeColor
        lblTitulo(26).Caption = "Rectificar último inventario"
        'txtcantidad(0).Top = 3360
        Label4(0).Caption = "Datos inventario"
        Label4(1).Caption = "Cantidad nueva"
        cmdRectificaInven.Caption = "Rectificar"
    Else
        lblTitulo(26).Caption = "Realizar inventario"
        lblTitulo(26).ForeColor = lblTitulo(54).ForeColor
        'txtcantidad(0).Top = 2160
        Label4(0).Caption = "Datos articulo"
        Label4(1).Caption = "Stock"
        cmdRectificaInven.Caption = "Aceptar"
    End If
  '  Label4(1).visible = Opcion = 3
   ' Text2.visible = Opcion = 3
End Sub



Private Function IntroduccionLotesFitosanitariosInventario() As Boolean
        IntroduccionLotesFitosanitariosInventario = False
        conn.Execute "DELETE FROM tmpnlotes where codusu =" & vUsu.codigo
        Espera 0.3
        
        CadParam = DevuelveDesdeBD(conAri, "count(*)", "slotes", "codartic", Me.txtArticulo(0).Text, "T")
        If Val(CadParam) = 0 Then
            MsgBox "Ningun lote disponible para el articulo", vbExclamation
            Exit Function
        End If
        CadParam = "Select " & vUsu.codigo & ",codartic,@rownum:=@rownum+1 AS rownum "
        CadParam = CadParam & ", fecentra,canentra*100,0,numlotes FROM slotes,(SELECT @rownum:=0) r"
        CadParam = CadParam & " WHERE codartic =" & DBSet(Me.txtArticulo(0).Text, "T")
        CadParam = CadParam & " ORDER BY fecentra desc"
          
       

        CadParam = "insert into tmpnlotes(codusu,codartic,numlinea,fechaalb,codprove,cantidad,numlotes)  " & CadParam
        conn.Execute CadParam
        
        
        

        CadenaDesdeOtroForm = ""
        frmFacTPVLotes.TotalLineas = ImporteFormateado(txtcantidad(0).Text)
        frmFacTPVLotes.NombreArticulo = txtDescArticulo(0).Text
        frmFacTPVLotes.DesdeInventario = True
        frmFacTPVLotes.Show vbModal
        
        If CadenaDesdeOtroForm <> "OK" Then
            'Ha cancelado el proceso
            conn.Execute "DELETE FROM tmpnlotes where codusu =" & vUsu.codigo
            Espera 0.3
        Else
        
           IntroduccionLotesFitosanitariosInventario = True
        End If
    
    Screen.MousePointer = vbDefault

End Function


Private Function ActualizarlosteFito() As Boolean
    On Error GoTo eActualizarlosteFito
    ActualizarlosteFito = False
    Set miRsAux = New ADODB.Recordset
    
    CadParam = "Select * from tmpnlotes where codusu = " & vUsu.codigo
    miRsAux.Open CadParam, conn, adOpenForwardOnly, adLockPessimistic, adCmdText
    cadFormula = ""
    cadNomRPT = ""
    While Not miRsAux.EOF
            If cadNomRPT = "" Then cadNomRPT = miRsAux!codArtic
            
            If miRsAux!cantidad > 0 Then
                CadParam = "UPDATE slotes SET vendida=canentra-" & DBSet(miRsAux!cantidad, "N") & " WHERE codartic= " & DBSet(cadNomRPT, "T")
                CadParam = CadParam & " AND numlotes = " & DBSet(miRsAux!numlotes, "T")
                CadParam = CadParam & " AND fecentra = " & DBSet(miRsAux!FechaAlb, "F")
                conn.Execute CadParam
            Else
                cadFormula = cadFormula & ", (" & DBSet(miRsAux!numlotes, "T") & ", " & DBSet(miRsAux!FechaAlb, "F") & ")"
            End If
            miRsAux.MoveNext
    Wend
    miRsAux.Close
    
    If cadFormula <> "" Then
        cadFormula = Mid(cadFormula, 2)
        CadParam = "UPDATE slotes SET vendida=canentra WHERE codartic= " & DBSet(cadNomRPT, "T")
        CadParam = CadParam & " AND (numlotes,fecentra) IN (" & cadFormula & ")"
        conn.Execute CadParam
    End If
    ActualizarlosteFito = True
eActualizarlosteFito:
    If Err.Number <> 0 Then MuestraError Err.Number, "ActualizarlosteFito", Err.Description
    Set miRsAux = Nothing
End Function
